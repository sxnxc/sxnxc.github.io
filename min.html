<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>sonic</title><style type="text/css">*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif;font-size:14px;line-height:1.5}:focus{outline:0}body{background:#f9f9f9;margin:0}table{border-collapse:collapse;text-align:left;width:100%}table tr{background:#fff;border-bottom:1px solid}table td span{background:#eee;color:#696969;display:none;font-size:10px;font-weight:700;padding:5px;position:absolute;text-transform:uppercase;top:0;left:0}a{text-decoration:none}a:hover{text-decoration:underline}button{padding:5px 20px;cursor:pointer;border:1px solid #ddd;margin:10px 10px 10px 0}h1{font-size:1.9em}h1,p{margin:.3em 0}td,th{border:1px solid #ddd;padding:.5em 5px;cursor:pointer}th{background:#f4f4f4;font-weight:400}caption{margin:0;font-weight:700;font-size:1.3em;background:#eee;padding:10px;border:1px solid #ddd}.comments{padding:5px}.comments-item{padding:10px 5px 0 0}.by{float:left;color:#121213;font-weight:700;margin-right:4px}.comments-time{display:inline-block;color:#aaa}#nav{padding:5px 15px;border:1px solid rgba(10,10,10,.1);background:#f9f9f9;position:sticky;top:0;z-index:1}.nav-item{margin:5px 10px 5px 0}.topics{margin-bottom:10px;white-space:pre-wrap;word-wrap:break-word}.topic-name,.topic-name a{cursor:pointer;width:fit-content}.topic-name.head a{margin-bottom:10px;font-size:15px;color:#1a1a1b;font-weight:500}.topic-name.head{margin-bottom:5px}.re:before{content:"ðŸ’¬ "}.new:before{content:"ðŸ“¢ "}.new{color:grey}.pell{border:1px solid rgba(10,10,10,.1);position:sticky;bottom:0;background:#f9f9f9}.pell-content{overflow-y:auto;padding:5px 10px 10px;white-space:pre-wrap;word-wrap:break-word}.pell-actionbar{background:#fff;border-bottom:1px solid rgba(10,10,10,.1)}.pell-button{background:transparent;border:none;width:30px;height:30px;vertical-align:bottom;margin:0;padding:0}.pell-button-selected{background:#f0f0f0}.pell-content[contenteditable]:empty:before{content:"Write a message...";color:#aaa}.pell-topic{display:none;overflow:hidden;padding:10px;color:grey;white-space:nowrap}.pell-topic:focus{white-space:normal}.pell.sticky .pell-topic{display:block}.pell-topic[contenteditable]:empty:before{content:"New Topic";color:#aaa}blockquote{width:fit-content;margin:0;padding:10px;background:#eee;border-radius:5px}blockquote:before{content:"\201C"}blockquote:after{content:"\201D"}.chat{padding:2px 15px;position:relative}.chat.cur,.chat:hover{background:#eee}.chat.topic{padding-top:5px;margin-top:2px}.chat:before{font-size:.9em;position:absolute;margin-top:2px;margin-left:-14px;cursor:pointer;color:#666}.chat:hover:before{content:"â˜†"}.chat.star:before{content:"ðŸŒŸ"!important}.rep{font-size:.85em;color:grey;cursor:pointer;width:fit-content}.chat:after{font-size:1em;position:absolute;top:2px;right:10px;cursor:pointer;color:#999}.chat:hover:after{content:"ðŸ”¨"}@media (max-width:600px){table thead{left:-9999px;position:absolute;visibility:hidden}table tr{border-bottom:0;display:flex;flex-direction:row;flex-wrap:wrap;margin-bottom:40px}table td{border:1px solid;margin:0 -1px -1px 0;padding-top:35px;position:relative;width:50%}table td span{display:block}.pell-topic{font-size:12px;padding:5px 10px}.pell-button,.pell-button b,i,strike,u{font-size:.85em;width:26px;height:26px}}.login{padding:0 15px}.login input{display:block;margin:5px 0;min-width:200px}</style></head><body><section class="app"></section><script src="https://cdn.jsdelivr.net/npm/zlibjs@0.3.1/bin/zlib.min.js"></script><script>!function(){"use strict";var e,t,n,r,o,a,i;!function(e){e.None=function(e){return{tag:"None",value:e}},e.Id=function(e){return{tag:"Id",value:e}},e.TopicId=function(e){return{tag:"TopicId",value:e}},e.ChannelId=function(e){return{tag:"ChannelId",value:e}},e.GroupId=function(e){return{tag:"GroupId",value:e}},e.By=function(e){return{tag:"By",value:e}}}(e||(e={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Email=function(e){return{tag:"Email",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(t||(t={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(n||(n={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(r||(r={})),function(e){e.Id=function(e){return{tag:"Id",value:e}}}(o||(o={})),function(e){e.User=function(e){return{tag:"User",value:e}},e.Group=function(e){return{tag:"Group",value:e}},e.Groups=function(e){return{tag:"Groups",value:e}},e.Channel=function(e){return{tag:"Channel",value:e}},e.Channels=function(e){return{tag:"Channels",value:e}},e.Topic=function(e){return{tag:"Topic",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.AddChat=function(e){return{tag:"AddChat",value:e}},e.AddUser=function(e){return{tag:"AddUser",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Topics=function(e){return{tag:"Topics",value:e}}}(a||(a={})),function(e){e.User=function(e){return{tag:"User",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Group=function(e){return{tag:"Group",value:e}},e.Groups=function(e){return{tag:"Groups",value:e}},e.Channel=function(e){return{tag:"Channel",value:e}},e.Channels=function(e){return{tag:"Channels",value:e}},e.Topic=function(e){return{tag:"Topic",value:e}},e.Topics=function(e){return{tag:"Topics",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.Chat=function(e){return{tag:"Chat",value:e}},e.Login=function(e){return{tag:"Login",value:e}}}(i||(i={}));const l=(e,t=0,n=!0)=>({pos:t,littleEndian:n,view:new DataView(e)}),s=(e,t)=>{const{view:{buffer:n},pos:r}=e,o=n.byteLength;if(o-r>t)return e;const a=Math.max(2*o,o+t),i=new Uint8Array(a);return i.set(new Uint8Array(n)),l(i.buffer,r,e.littleEndian)},c=(e,t)=>{e=s(e,1);const{view:n,pos:r}=e;return n.setUint8(r,t),e.pos+=1,e},u=(e,t)=>{e=s(e,4);const{view:n,pos:r,littleEndian:o}=e;return n.setUint32(r,t,o),e.pos+=4,e},d=(e,t)=>{e=s(e,2);const{view:n,pos:r,littleEndian:o}=e;return n.setUint16(r,t,o),e.pos+=2,e};function p(e,t){const{view:n,pos:r,littleEndian:o}=e;return n.setUint32(o?r:r+4,t,o),n.setUint32(o?r+4:r,0,o),e.pos+=8,e}const f=(e,t)=>{e=s(e,4);const{view:n,pos:r,littleEndian:o}=e;return n.setInt32(r,t,o),e.pos+=4,e},g=new TextEncoder,h="encodeInto"in g?(e,t)=>g.encodeInto(e,t).written:(e,t)=>{const n=g.encode(e);return t.set(n),n.length},y=(e,t)=>{e=s(e,3*t.length+8);const n=h(t,new Uint8Array(e.view.buffer,e.pos+8));return(e=p(e,n)).pos+=n,e},m=(e,t)=>c(e,t?1:0),v=e=>(t,n)=>n.reduce(e,((e,t)=>p(s(e,8),t))(t,n.length)),w=e=>(t,n)=>null===n?c(t,0):e(c(t,1),n),b=e=>{const{pos:t,view:n}=e;return e.pos+=1,n.getUint8(t)},A=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getUint32(t,r)},T=e=>{const{view:t,pos:n,littleEndian:r}=e;return e.pos+=8,t.getUint32(r?n:n+4,r)},E=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getInt32(t,r)},L=e=>1===b(e),U=e=>t=>1===b(t)?e(t):null,C=e=>t=>{const n=T(t),r=new Array;for(let o=0;o<n;o++)r.push(e(t));return r},I=new TextDecoder,N=e=>{const t=T(e),{pos:n,view:{buffer:r}}=e,o=I.decode(new Uint8Array(r,n,t));return e.pos+=t,o};var S=w(y),k=w(m),O=y,x=w(O),R=v(c),M=v(f),P=function(e,t){var n=t.id,r=t.handle,o=t.email,a=t.emailVerified,i=t.name,l=t.key,s=t.picture,c=t.gender,u=t.lastLogin,d=t.createdAt,p=t.updatedAt;return O(O(x(k(S(y(y(m(y(y(f(e,n),r),o),a),i),l),s),c),u),d),p)},D=(v(P),function(e,t){var n=t.id,r=t.name,o=t.handle,a=t.by,i=t.createdAt,l=t.updatedAt;return O(O(f(y(y(f(e,n),r),o),a),i),l)}),$=(v(D),function(e,t){var n=t.id,r=t.name,o=t.handle,a=t.groupId,i=t.by,l=t.createdAt,s=t.updatedAt;return O(O(f(f(y(y(f(e,n),r),o),a),i),l),s)}),_=(v($),function(e,t){var n=t.id,r=t.name,o=t.groupId,a=t.channelId,i=t.by,l=t.createdAt,s=t.updatedAt;return O(O(f(f(f(y(f(e,n),r),o),a),i),l),s)}),H=(v(_),function(e,t){var n=t.id,r=t.txt,o=t.by,a=t.re,i=t.nor,l=t.topicId,s=t.channelId,c=t.groupId,u=t.createdAt,d=t.updatedAt;return O(O(f(f(f(f(f(f(y(f(e,n),r),o),a),i),l),s),c),u),d)}),j=(v(H),function(e,t){var n=t.filter,r=t.ub,o=t.lb,a=t.limit;return d(f(f(function(e,t){switch(t.tag){case"None":return m(u(e,0),t.value);case"Id":return f(u(e,1),t.value);case"TopicId":return f(u(e,2),t.value);case"ChannelId":return f(u(e,3),t.value);case"GroupId":return f(u(e,4),t.value);case"By":return f(u(e,5),t.value)}}(e,n),r),o),a)}),B=function(e,t){switch(t.tag){case"User":return function(e,t){switch(t.tag){case"Id":return f(u(e,0),t.value);case"Email":return y(u(e,1),t.value);case"Handle":return y(u(e,2),t.value)}}(u(e,0),t.value);case"Group":return function(e,t){switch(t.tag){case"Id":return f(u(e,0),t.value);case"Handle":return y(u(e,1),t.value)}}(u(e,1),t.value);case"Groups":return function(e,t){var n=t.limit,r=t.page;return d(d(e,n),r)}(u(e,2),t.value);case"Channel":return function(e,t){switch(t.tag){case"Id":return f(u(e,0),t.value);case"Handle":return y(u(e,1),t.value)}}(u(e,3),t.value);case"Channels":return function(e,t){var n=t.group_id,r=t.limit,o=t.page;return d(d(f(e,n),r),o)}(u(e,4),t.value);case"Topic":return function(e,t){switch(t.tag){case"Id":return f(u(e,0),t.value)}}(u(e,5),t.value);case"Chats":return j(u(e,6),t.value);case"AddChat":return H(u(e,7),t.value);case"AddUser":return function(e,t){var n=t.email,r=t.handle,o=t.key;return R(y(y(e,n),r),o)}(u(e,8),t.value);case"Login":return function(e,t){var n=t.email,r=t.key;return R(y(e,n),r)}(u(e,9),t.value);case"Users":return M(u(e,10),t.value);case"Topics":return M(u(e,11),t.value)}},G=U(N),K=U(L),F=N,q=U(F),Y=C(b),V=(C(E),function(e){return{id:E(e),handle:N(e),email:N(e),emailVerified:L(e),name:N(e),key:N(e),picture:G(e),gender:K(e),lastLogin:q(e),createdAt:F(e),updatedAt:F(e)}}),z=C(V),W=function(e){return{id:E(e),name:N(e),handle:N(e),by:E(e),createdAt:F(e),updatedAt:F(e)}},X=C(W),J=function(e){return{id:E(e),name:N(e),handle:N(e),groupId:E(e),by:E(e),createdAt:F(e),updatedAt:F(e)}},Z=C(J),Q=function(e){return{id:E(e),name:N(e),groupId:E(e),channelId:E(e),by:E(e),createdAt:F(e),updatedAt:F(e)}},ee=C(Q),te=function(e){return{id:E(e),txt:N(e),by:E(e),re:E(e),nor:E(e),topicId:E(e),channelId:E(e),groupId:E(e),createdAt:F(e),updatedAt:F(e)}},ne=C(te),re=function(e){switch(A(e)){case 0:return i.User(V(e));case 1:return i.Users(z(e));case 2:return i.Group(W(e));case 3:return i.Groups(X(e));case 4:return i.Channel(J(e));case 5:return i.Channels(Z(e));case 6:return i.Topic(Q(e));case 7:return i.Topics(ee(e));case 8:return i.Chats(ne(e));case 9:return i.Chat(te(e));case 10:return i.Login(Y(e))}throw new Error("bad variant index for Response")},oe=l(new ArrayBuffer(512)),ae=function(e,t){return oe.pos=0,oe=t(oe,e),new Uint8Array(oe.view.buffer).slice(0,oe.pos)},ie=function(e,t){return t(l(e))},le=function(e){return ie(e.buffer,re)},se=function(e){return ae(e,B)};const ce=e=>new Zlib.Inflate(e).decompress(),ue=e=>new Zlib.Deflate(e).compress(),de=[];function pe(e){let t={};return function(){const n=de.slice.call(arguments),r=n.map((e=>{if(he(e)||Array.isArray(e)){let t={};for(let n in e)t[n]=ge(e[n]);return t}return ge(e)})),o=JSON.stringify(r);let a=t[o];return void 0===a&&(a=e.apply(this,n),a&&11===a.nodeType&&(a=de.slice.call(a.childNodes)),t[o]=a),a}}let fe=0;function ge(e){return"function"==typeof e||e instanceof Node?(e.$m||(e.$m=++fe),{$m:e.$m}):e}function he(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function ye(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var me,ve,we=ye((function(e,t){function n(e){var t=e>>3;return e%8!=0&&t++,t}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===e&&(e=0);var r=null==t?void 0:t.grow;this.grow=r&&isFinite(r)&&n(r)||r||0,this.buffer="number"==typeof e?new Uint8Array(n(e)):e}return e.prototype.get=function(e){var t=e>>3;return t<this.buffer.length&&!!(this.buffer[t]&128>>e%8)},e.prototype.set=function(e,t){void 0===t&&(t=!0);var n=e>>3;if(t){if(this.buffer.length<n+1){var r=Math.max(n+1,Math.min(2*this.buffer.length,this.grow));if(r<=this.grow){var o=new Uint8Array(r);o.set(this.buffer),this.buffer=o}}this.buffer[n]|=128>>e%8}else n<this.buffer.length&&(this.buffer[n]&=~(128>>e%8))},e.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=8*this.buffer.length);for(var r=t,o=r>>3,a=128>>r%8,i=this.buffer[o];r<n;r++)e(!!(i&a),r),a=1===a?(i=this.buffer[++o],128):a>>1},e}();t.default=r}(ve={path:me,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&ve.path)}},ve.exports),ve.exports));let be,Ae=[];function Te(e){let t=be,n=()=>{};be=n,Ue(n);let r=e((()=>{Le(n),be=void 0}));return be=t,r}function Ee(e){function t(n){if(0===arguments.length)return be&&!t.__o.has(be)&&(t.__o.add(be),be.u.push(t)),e;e=n;let r=be;return be=void 0,t.o=new Set(t.__o),t.o.forEach((e=>e.i=!1)),t.o.forEach((e=>{e.i||e()})),be=r,e}return t.$o=1,t.__o=new Set,t.t=Ae,t}function Le(e){e.__c.forEach(Le),e.u.forEach((t=>{t.__o.delete(e),t.o&&t.o.delete(e)})),e.l.forEach((e=>e())),Ue(e)}function Ue(e){e.u=[],e.__c=[],e.l=[]}const Ce=()=>window.scrollTo(0,document.body.scrollHeight),Ie=pe((e=>pe(((t,n)=>Te((()=>e(t,n))))))),Ne=e=>(t,...n)=>()=>Ie(e())(t,n),Se=e=>{console.log("Length",e instanceof ArrayBuffer?new Uint8Array(e).length:e.length,"bytes"),console.log((Object(e).buffer instanceof ArrayBuffer?e:"string"==typeof e?new TextEncoder("utf-8").encode(e):new Uint8ClampedArray(e)).reduce(((e,t,n,r)=>e+(n%16==0?n.toString(16).padStart(6,0)+"  ":" ")+t.toString(16).padStart(2,0)+(n===r.length-1||n%16==15?" ".repeat(3*(15-n%16))+Array.from(r).splice(n-n%16,16).reduce(((e,t)=>e+(t>31&&t<127||t>159?String.fromCharCode(t):".")),"  ")+"\n":"")),""))},ke=(e,t)=>{let n=0,r=0;for(;n<e.length;)r>=t.length&&(r=0),e.set([e[n]^t[r]],n),n++,r++},Oe=(e,t)=>(ke(e,t),Me(e,t)),xe=e=>{let{a:t,k:n}=Re(e);return ke(t,n),{a:t,k:n}},Re=e=>{let t=e[0],n=e.subarray(1,t+1);return{a:e.subarray(t+1),k:n}},Me=(e,t)=>{let n=new Uint8Array(1+t.length+e.length);return n[0]=t.length,n.set(t,1),n.set(e,1+t.length),n},Pe=(e,t)=>(e=Math.ceil(e),Math.floor(Math.random()*(Math.floor(t)-e)+e)),De=(e,t)=>{let n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n},$e=e=>(performance.now()-e).toFixed(2),_e=(e,t=64,n=8)=>Oe(e,crypto.getRandomValues(new Uint8Array(Pe(n,t)))),He=e=>{try{return new Uint8Array((e=>{const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0,r=e.length;t<r;t++)n[t]=e.charCodeAt(t);return t})(atob(e)))}catch(e){console.log(e)}},je=async(e,t,n)=>(console.log("[sec] encrypting data"),await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e)),Be=async(e,t,n)=>(console.log("[sec] decrypting data"),await crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,e)),Ge={};async function Ke(e,t){let n=new TextEncoder,r=await Fe(n.encode(e),n.encode(t));return await crypto.subtle.exportKey("raw",r)}async function Fe(e,t){let n=await crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}!async function(){let e=localStorage.getItem("a");Ge.salt=He(e),Ge.salt&&Ge.salt.length>32&&(Ge.salt=null);const t=He(localStorage.getItem("s"));t&&32==t.length&&(console.log(e),Se(t),Ge.sskey=await crypto.subtle.importKey("raw",t,"AES-GCM",!1,["encrypt","decrypt"]))}();const qe=document.location.hash.substr(1).match(/^ip\/(?<ip>[\:\.\d]+)$/),Ye="wss://"+(qe?qe.groups.ip:"192.168.100.11:443");let Ve,ze,We,Xe,Je,Ze,Qe,et,tt,nt,rt,ot=500,at=0,it={ready:!1},lt=0,st=1;console.group("[ws]","starting..."),function e(t){Ve=performance.now(),ze=new WebSocket(Ye),ze.binaryType="arraybuffer",ze.onopen=()=>{console.log(`[ws] open in ${$e(Ve)} ms`),console.groupEnd("[ws]"),console.group("[dc]","opening..."),t?ut():Je&&ft()},ze.onmessage=async e=>{console.log(`[ws] <- received answer in ${$e(Ve)} ms`);let t=new Uint8Array(e.data),{a:n,k:r}=xe(t);var o,a,i;ct=(e=>{const t=new we(e);return{z:t.get(0),m:t.get(1),c:t.get(2),d:t.get(3)}})(n),console.log(ct),it.onconfig&&it.onconfig(ct),r=await(o=r,crypto.subtle.importKey("raw",o,{name:"ECDH",namedCurve:"P-256"},!0,[])),nt=await(a=Xe.privateKey,i=r,crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:i},a,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])),tt=new Uint8Array(await crypto.subtle.exportKey("raw",nt));let l=JSON.parse((e=>(new TextDecoder).decode(ce(e)))(n.slice(1))),s=l.answer?l.answer:l;if(await Ze.setRemoteDescription(new RTCSessionDescription(s)),!l.candidate)return;const c=new RTCIceCandidate({candidate:l.candidate,sdpMid:0,sdpMLineIndex:0});await Ze.addIceCandidate(c)},ze.onclose=t=>{at++,ot+=Pe(0,at<16?200:3e3),console.log("[ws] closed",t),console.groupEnd("[ws]"),console.groupEnd("[ws]"),console.groupCollapsed("[ws]",`retry ${at} in ${(ot/1e3).toFixed(2)} sec`),setTimeout((()=>{e(!0)}),ot)},ze.onerror=e=>{console.log("[ws] error",e)}}(),ut();var ct={};function ut(){Qe=!1,function(){Ze=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]});let e=st++;Ze.onicecandidate=e=>{e.candidate},Ze.onconnectionstatechange=t=>{switch(Ze.connectionState){case"failed":case"disconnected":console.log("[peer]",e,"restarting....")}},Ze.oniceconnectionstatechange=e=>{switch(Ze.iceConnectionState){case"disconnected":console.log("[ice] restarting....")}}}(),rt=Ze.createDataChannel("cu",{}),rt.binaryType="arraybuffer",lt=0,it.send=dt,rt.onopen=e=>{console.log(`[dc] open in ${$e(Ve)} ms`),console.groupEnd("[dc]"),lt=0,it.ready=!0,it.open&&it.open(e)},rt.onmessage=pt,rt.onclose=e=>{console.log("[dc] close",e)},rt.onerror=e=>{console.log("[dc] error:",e)},async function(){const e=async()=>{let e=await Ze.createOffer();return await Ze.setLocalDescription(e),ue((new TextEncoder).encode(Ze.localDescription.sdp))},t=async()=>{if(et)return et;Xe=await(async()=>(console.log("[sec] generating key pairs"),await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"])))();let e=await crypto.subtle.exportKey("raw",Xe.publicKey);return et=new Uint8Array(e),et};Je=await(async(e,t,n)=>{let[r,o]=await Promise.all([e(),t()]);return n?Oe(Oe(r,o),n):_e(Oe(r,o),64,24)})(e,t,Ge.salt),console.log(`[dc] sdp in ${$e(Ve)} ms`),1===ze.readyState&&ft()}()}async function dt(e){if(lt++,console.groupEnd("[dc]"),console.group("[dc]","-> sending packet",lt,e),e=se(e),Se(e),ct.z&&(e=ue(e)),ct.m&&(e=_e(e,e.length),ke(e,tt)),ct.c){const t=crypto.getRandomValues(new Uint8Array(12));ke(e,t),e=De(t,new Uint8Array(await je(e,nt,t)))}if(ct.d){const t=crypto.getRandomValues(new Uint8Array(12));ke(e,t),e=De(t,new Uint8Array(await je(e,Ge.sskey,t)))}rt.send(e),We=performance.now(),console.groupEnd("[dc]")}async function pt(e){let t=new Uint8Array(e.data),n=t.length;if(console.groupEnd("[dc]"),console.group("[dc]","<- received",n,"bytes in",$e(We),"ms"),ct.d){let e=t.subarray(0,12);t=new Uint8Array(await Be(t.subarray(12),Ge.sskey,e)),ke(t,e)}if(ct.c){let e=t.subarray(0,12);t=new Uint8Array(await Be(t.subarray(12),nt,e)),ke(t,e)}if(ct.m){ke(t,tt);let{a:e}=xe(t);t=new Uint8Array(e)}ct.z&&(t=ce(t));let r=(100*n/t.length).toFixed(2);console.log(`[dc] unpacked ${n} / ${t.length} bytes ${r}% in ${$e(We)} ms`);let o=gt(t);it.recv&&it.recv(o),console.groupEnd("[dc]")}const ft=()=>{Qe||(console.log("[ws] -> sending offer"),ze.send(Je),Qe=!0)},gt=e=>{let t=le(e);return console.log(t),console.table(t.value),t};let ht={},yt=[];function mt(e){return this.t&&this.t[e.type](e)}ht.h=(...e)=>{let t,n=r=>{if(null==r);else if("string"==typeof r)t?ht.add(t,r):t=ht.s?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r);else if(Array.isArray(r))t||(t=document.createDocumentFragment()),r.forEach(n);else if(r instanceof Node)t?ht.add(t,r):t=r;else if("object"==typeof r)ht.property(t,r,null,ht.s);else if("function"==typeof r)if(t){let e=ht.add(t,"");ht.insert(t,r,e)}else t=r.apply(null,e.splice(1));else ht.add(t,""+r)};return e.forEach(n),t},ht.insert=(e,t,n,r,o)=>(e=n&&n.parentNode||e,o=o||r instanceof Node&&r,t===r||(r&&"string"!=typeof r||!("string"==typeof t||"number"==typeof t&&(t+=""))?"function"==typeof t?ht.subscribe((()=>{r=ht.insert(e,t.call({el:e,endMark:n}),n,r,o)})):(n?r&&(o||(o=r.o&&r.o.nextSibling||n.previousSibling),ht.rm(e,o,n)):e.textContent="",r=null,t&&!0!==t&&(r=ht.add(e,t,n))):(null!=r&&e.firstChild?n?(n.previousSibling||e.lastChild).data=t:e.firstChild.data=t:n?ht.add(e,t,n):e.textContent=t,r=t)),r),ht.property=(e,t,n,r,o)=>{if(null!=t)if(!n||"attrs"===n&&(r=!0))for(n in t)ht.property(e,t[n],n,r,o);else"o"!==n[0]||"n"!==n[1]||t.$o?"function"==typeof t?ht.subscribe((()=>{ht.property(e,t.call({el:e,name:n}),n,r,o)})):o?e.style.setProperty(n,t):r||"data-"===n.slice(0,5)||"aria-"===n.slice(0,5)?e.setAttribute(n,t):"style"===n?"string"==typeof t?e.style.cssText=t:ht.property(e,t,null,r,!0):("class"===n&&(n+="Name"),e[n]=t):((e,t,n)=>{t=t.slice(2).toLowerCase(),n?e.addEventListener(t,mt):e.removeEventListener(t,mt),(e.t||(e.t={}))[t]=n})(e,n,t)},ht.add=(e,t,n)=>{let r=(e=>{const{childNodes:t}=e;if(t&&11===e.nodeType)return t.length<2?t[0]:{o:ht.add(e,"",t[0])}})(t=(e=>"string"==typeof e?document.createTextNode(e):e instanceof Node?e:ht.h(yt,e))(t))||t;return e.insertBefore(t,n&&n.parentNode&&n),r},ht.rm=(e,t,n)=>{for(;t&&t!==n;){let n=t.nextSibling;e===t.parentNode&&e.removeChild(t),t=n}},ht.subscribe=function(e){return function(e,t){function n(){let r=be;return be&&be.__c.push(n),Le(n),n.i=!0,be=n,t=e(t),be=r,t}function r(){return n.i?be&&n.u.forEach((e=>e())):t=n(),t}e.s=n,Ue(n),n(),r.$o=1}(e),()=>Le(e.s)},ht.cleanup=function(e){return be&&be.l.push(e),e},ht.root=Te,ht.sample=function(e){let t=be;be=void 0;let n=e();return be=t,n},ht.hs=(...e)=>{let t=ht.s;ht.s=!0;let n=vt(...e);return ht.s=t,n};let vt=(...e)=>ht.h.apply(ht.h,e);function wt(e,t,n){const{root:r,subscribe:o,sample:a,cleanup:i}=ht;null==n&&(n=!t.$t);let l=ht.h([]),s=ht.add(l,""),c=new Map,u=new Map,d=new Set;function p(e,o){if(null==e)return;let a=u.get(e);return 1===o?(d.delete(e),a||(a=n?r((n=>(c.set(e,n),t(e.$v||e)))):t(e.$v||e),11===a.nodeType&&(a=(e=>{const{childNodes:t}=e,{length:n}=t;if(n<2)return t[0];let r=Array.from(t);return{nodeType:111,t:r[0],o:r[n-1],l(){if(t.length!==n){let t=0;for(;t<n;)e.appendChild(r[t++])}return e}}})(a)||a),u.set(e,a))):-1===o&&d.add(e),((e,t)=>111===e.nodeType?1/t<0?t?ht.rm(e.t.parentNode,e.t.nextSibling,e.o.nextSibling)||e.t:e.o:t?e.l():e.t:e)(a,o)}function f(e){let t=c.get(e);t&&(t(),c.delete(e)),u.delete(e)}return i(o((t=>{let n=e();return a((()=>{d.clear();let e=Array.from(function(e,t,n,r,o){let a,i,l=new Map,s=new Map;for(a=0;a<t.length;a++)l.set(t[a],a);for(a=0;a<n.length;a++)s.set(n[a],a);for(a=i=0;a!==t.length||i!==n.length;){var c=t[a],u=n[i];if(null===c)a++;else if(n.length<=i)e.removeChild(r(t[a],-1)),a++;else if(t.length<=a)e.insertBefore(r(u,1),r(t[a],0)||o),i++;else if(c===u)a++,i++;else{var d=s.get(c),p=l.get(u);void 0===d?(e.removeChild(r(t[a],-1)),a++):void 0===p?(e.insertBefore(r(u,1),r(t[a],0)||o),i++):(e.insertBefore(r(t[p],1),r(t[a],0)||o),t[p]=null,p>a+1&&a++,i++)}}return n}(s.parentNode,t||[],n,p,s));return d.forEach(f),e}))}))),i((function(){c.forEach((e=>e())),c.clear(),u.clear(),d.clear()})),l}const bt=()=>Et()===At?Et(Tt):Et(At),At=({items:e,keys:t},...n)=>vt([vt("table",null,vt("thead",null,vt("tr",null,wt(t,(e=>vt("th",{scope:"col"},e))))),vt("tbody",null,wt(e,(e=>vt("tr",{onclick:t=>location.hash="#channels/"+e.id},wt(t,(t=>vt("td",null,vt("span",null,t)," ",e[t])))))))),n]),Tt=({items:e},...t)=>vt([vt("ul",null,wt(e,(e=>vt("li",{id:e.id},e.name)))),t]),Et=Ee(At);const Lt=({group_id:e})=>{let t=Ee([]),n=0;it.recv=e=>{let r=e.value;if(Array.isArray(r))return 0==r.length?n--:t(r);let o=t();o.unshift(r),t(o)};const r=t=>a.Channels({group_id:e,limit:30,page:t}),o=e=>{n++,it.send(r(n))};return it.open=e=>o(),it.ready&&o(),vt([vt("button",{onclick:e=>{n--,n<1&&(n=1),it.send(r(n))}},"Prev Item"),vt("button",{onclick:o},"Next Item"),vt("button",{onclick:e=>{n=0;let t=setInterval((function(){300==n?clearInterval(t):o()}),1)}},"Run Load"),vt("button",{onclick:Ut},"Switch Component"),vt("h2",null,"Channels"),vt(Ne(Nt),{items:t,keys:()=>Object.keys(t()[0]||{})})])},Ut=()=>Nt()===Ct?Nt(It):Nt(Ct),Ct=({items:e,keys:t},...n)=>vt([vt("table",null,vt("thead",null,vt("tr",null,wt(t,(e=>vt("th",{scope:"col"},e))))),vt("tbody",null,wt(e,(e=>vt("tr",{onclick:t=>location.hash="#topics/"+e.id},wt(t,(t=>vt("td",null,vt("span",null,t)," ",e[t])))))))),n]),It=({items:e},...t)=>vt([vt("ul",null,wt(e,(e=>vt("li",{id:e.id},e.name)))),t]),Nt=Ee(Ct),St="defaultParagraphSeparator",kt="formatBlock",Ot=(e,t,n)=>e.addEventListener(t,n),xt=(e,t)=>e.appendChild(t),Rt=e=>document.createElement(e),Mt=e=>document.queryCommandState(e),Pt=(e,t=null)=>document.execCommand(e,!1,t),Dt={bold:{icon:"<b>B</b>",title:"Bold",state:()=>Mt("bold"),result:()=>Pt("bold")},italic:{icon:"<i>I</i>",title:"Italic",state:()=>Mt("italic"),result:()=>Pt("italic")},underline:{icon:"<u>U</u>",title:"Underline",state:()=>Mt("underline"),result:()=>Pt("underline")},strikethrough:{icon:"<strike>S</strike>",title:"Strike-through",state:()=>Mt("strikeThrough"),result:()=>Pt("strikeThrough")},heading1:{icon:"<b>H1</b>",title:"Heading 1",result:()=>Pt(kt,"<h1>")},heading2:{icon:"<b>H2</b>",title:"Heading 2",result:()=>Pt(kt,"<h2>")},quote:{icon:"&#8220;&#8221;",title:"Quote",result:()=>Pt(kt,"<blockquote>")},olist:{icon:"1.",title:"Ordered List",result:()=>Pt("insertOrderedList")},ulist:{icon:"&#8226;",title:"Unordered List",result:()=>Pt("insertUnorderedList")},code:{icon:"&lt;&gt;",title:"Code",result:()=>Pt(kt,"<pre>")},line:{icon:"&#8213;",title:"Horizontal Line",result:()=>Pt("insertHorizontalRule")},link:{icon:"&#128279;",title:"Link",result:()=>{const e=window.prompt("Enter the link URL");e&&Pt("createLink",e)}},image:{icon:"&#128247;",title:"Image",result:()=>{const e=window.prompt("Enter the image URL");e&&Pt("insertImage",e)}}},$t={actionbar:"pell-actionbar",button:"pell-button",content:"pell-content",selected:"pell-button-selected",topic:"pell-topic"};let _t,Ht=openDatabase("sonic","1.0","Test DB",1073741824);Ht.transaction((e=>{e.executeSql("CREATE TABLE IF NOT EXISTS users (\n            id integer NOT NULL PRIMARY KEY,\n            handle varchar(50) NOT NULL,\n            email varchar(100) NOT NULL,\n            emailVerified boolean NOT NULL DEFAULT '0',\n            name varchar(100) NOT NULL,\n            key varchar(60) NOT NULL,\n            picture varchar(250),\n            gender boolean,\n            lastLogin datetime,\n            createdAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP\n        )",[],Yt,Vt),e.executeSql("CREATE TABLE IF NOT EXISTS topics (\n            id integer NOT NULL PRIMARY KEY,\n            name varchar(250) NOT NULL,\n            groupId integer NOT NULL,\n            channelId integer NOT NULL,\n            by integer NOT NULL,\n            createdAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP\n        )",[],Yt,Vt),e.executeSql("CREATE TABLE IF NOT EXISTS chats (\n            id integer NOT NULL PRIMARY KEY,\n            txt text NOT NULL,\n            by integer NOT NULL,\n            re integer NOT NULL,\n            nor integer NOT NULL DEFAULT '0',\n            topicId integer NOT NULL,\n            channelId integer NOT NULL,\n            groupId integer NOT NULL,\n            createdAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            star boolean\n        )",[],Yt,Vt)}));let jt=indexedDB.open("sonic",1);jt.onsuccess=function(e){_t=e.target.result,console.log("[db] opened")},jt.onupgradeneeded=function(e){_t=e.target.result;_t.createObjectStore("store"),_t.createObjectStore("chats",{keyPath:"id"}),_t.createObjectStore("users",{keyPath:"id"}),_t.createObjectStore("topics",{keyPath:"id"});console.log("[db] setup complete")};const Bt=async(e,t)=>{Se(t),_t.transaction(["store"],"readwrite").objectStore("store").put(t,e),caches.open("sonic").then((function(n){n.put(e,new Response(t))}));const n=(r=t,btoa(String.fromCharCode.apply(null,new Uint8Array(r))));var r;localStorage.setItem(e,n),console.log(n)},Gt=(e,t)=>{let n=_t.transaction([e],"readwrite").objectStore(e);t.forEach((e=>n.add(e))),Ht.transaction((n=>{t.forEach((t=>{let r=Object.keys(t),o=`INSERT OR REPLACE INTO ${e} (${r.join(",")}) VALUES (${Array(r.length).fill("?").join(",")})`;n.executeSql(o,Object.values(t).map((e=>"function"==typeof e?e():e)),Yt,Vt)}))}))},Kt=(e,t)=>{let n=[],r=new Set,o=_t.transaction([e],"readwrite").objectStore(e),a=0;return new Promise((e=>{t.forEach((i=>{let l=o.get(i);l.onsuccess=o=>{l.result?n.push(l.result):r.add(i),++a===t.length&&e({value:n,missed:Array.from(r)})}}))}))},Ft=([e,t])=>{let n=new Set;for(var r=e;r<=t;r++)n.add(r);return n},qt=e=>{var t,n=[];return e.sort(((e,t)=>e[0]-t[0]||e[1]-t[1])),e.forEach((e=>{!t||e[0]>t[1]+1?n.push(t=e):e[1]>t[1]&&(t[1]=e[1])})),n};function Yt(e,t){}function Vt(e,t){console.log(e,t)}const zt=(e,t={})=>e.reduce(((e,t)=>(e[t.id]=t,e)),t),Wt=({topic_id:t,chat_id:n})=>{let r=Ee([]),o={},i={},l={},s=Ee(0),c=0,u="";const d=((...e)=>{const t={},n={};return{create:e=>n[e]=new Promise((n=>t[e]=n)),complete:(e,n)=>t[e](n),join:e=>n[e],joinall:()=>Promise.all(e.map((e=>n[e]))),select:()=>Promise.race(e.map((e=>n[e])))}})("users","topics");it.recv=async e=>{switch(e.tag){case"Users":Gt("users",e.value),d.complete("users",e.value);break;case"Topics":Gt("topics",e.value),d.complete("topics",e.value);break;case"Chat":let t=window.scrollY+window.innerHeight===document.body.scrollHeight,n=r();e.value.nor=Ee(0),e.value.star=Ee(!1),o[e.value.id]=e.value,n.push(e.value.id),r(n),t&&Ce();break;case"Chats":let a=e.value;if(0==a.length)return;Gt("chats",a),((e,t)=>{let n=_t.transaction(["store"],"readwrite").objectStore("store"),r=n.get(e);r.onsuccess=o=>{if(!r.result)return n.put([t],e);r.result.push(t),n.put(qt(r.result),e)}})("chats",[a[a.length-1].id,a[0].id]),p(a)}};const p=async e=>{let n=e[0].id,s=new Set,c=new Set,u=r();u=e.reverse().map((e=>(e.nor=Ee(e.nor),e.star=Ee(!1),e.createdAt=new Date(e.createdAt),e.updatedAt=new Date(e.updatedAt),o[e.id]=e,s.add(e.by),c.add(e.topicId),e.id))).concat(u);let p=await Kt("users",Array.from(s)),f=await Kt("topics",Array.from(c));zt(p.value,i),zt(f.value,l),p.missed.length>0&&d.create("users",it.send(a.Users(p.missed))),f.missed.length>0&&d.create("topics",it.send(a.Topics(f.missed)));let[g,h]=await d.joinall();g&&zt(g,i),h&&zt(h,l),r(u),t&&(document.title=l[t].name),window.scrollY<100&&setTimeout((()=>document.getElementById(n).scrollIntoView()))},f=(r,o,i)=>{let l=a.Chats({filter:t>0?e.TopicId(t):n>0?e.Id(n):e.None(!0),ub:r||99999,lb:o,limit:i});it.send(l)},g=async(e,t=30)=>{let n=e||r()[0];if(n){let e=await((e,t)=>{console.log("scan",e,t);let n=[],r=Ft(t),o=_t.transaction([e],"readwrite").objectStore(e);return new Promise((e=>{o.openCursor(IDBKeyRange.bound(...t),"prev").onsuccess=t=>{var o=t.target.result;o?(n.push(o.value),r.delete(o.key),o.continue()):e({value:n,missed:Array.from(r)})}}))})("chats",[n-t,n-1]);console.log("chats",e);let r=e.value[0]?e.value[0].id:0;return r?p(e.value):f(n,r,t)}let o=await((e,t)=>{let n=[],r=_t.transaction([e],"readwrite").objectStore(e),o=0;return new Promise((e=>{r.openCursor(null,"prev").onsuccess=r=>{var a=r.target.result;if(a){if(n.push(a.value),++o===t)return e({value:n});a.continue()}else{console.log("No more entries!");let r=n[o-1],a=Ft([r+o+1-t,r]);e({value:n,missed:Array.from(a)})}}}))})("chats",t);console.log("chats",o);let a=o.value[0]?o.value[0].id:0;a&&p(o.value),f(n,a,t)};it.ready||(it.open=e=>{it.open=void 0,setTimeout((()=>g()))}),setTimeout((function(){new IntersectionObserver((e=>{e[0].intersectionRatio<=0||it.ready&&setTimeout((()=>g()))}),{}).observe(A)}));const h=(e=>{const t=e.actions?e.actions.map((e=>"string"==typeof e?Dt[e]:Dt[e.name]?{...Dt[e.name],...e}:e)):Object.keys(Dt).map((e=>Dt[e])),n={...$t,...e.classes},r=e.defaultParagraphSeparator||"div",o=e.element.topic=Rt("div");o.contentEditable=!0,o.className=n.topic,o.onkeydown=e=>{"Enter"===e.key&&(a.focus(),e.preventDefault())},xt(e.element,o);const a=e.element.content=Rt("div");a.contentEditable=!0,a.className=n.content,a.onfocus=()=>{let t=window.scrollY+window.innerHeight===document.body.scrollHeight;e.element.classList.add("sticky"),t&&setTimeout((()=>Ce()))},a.onblur=()=>{setTimeout((()=>{e.element.contains(document.activeElement)||e.element.classList.remove("sticky")}))},a.oninput=({target:{firstChild:t}})=>{e.onchange(a.innerHTML)},a.onkeydown=t=>{"Enter"!==t.key||t.shiftKey||(e.onsend(),t.preventDefault())},xt(e.element,a);const i=Rt("div");return i.className=n.actionbar,xt(e.element,i),t.forEach((e=>{const t=Rt("button");if(t.className=n.button,t.innerHTML=e.icon,t.title=e.title,t.setAttribute("type","button"),t.onclick=()=>e.result()&&a.focus(),e.state){const r=()=>t.classList[e.state()?"add":"remove"](n.selected);Ot(a,"keyup",r),Ot(a,"mouseup",r),Ot(t,"click",r)}xt(i,t)})),e.styleWithCSS&&Pt("styleWithCSS"),Pt(St,r),e.element})({element:vt("div",{class:"pell"}),onchange:e=>{},onsend:()=>{if(!h.content.textContent.trim())return;let e=s()||c,{topicId:t,channelId:n,groupId:r}=o[e];h.topic.textContent!==u&&(e=0,t=Object.keys(l).length+1,l[t].name=h.topic.textContent);let i=h.content.innerHTML.trim(),d=(new Date).toISOString();it.send(a.AddChat({id:0,txt:i,by:1,re:e,nor:0,topicId:t,channelId:n,groupId:r,createdAt:d,updatedAt:d})),h.content.textContent="",y({})}});h.content.innerHTML="";const y=({id:e,txt:t})=>{if(!e||s()===e)return h.topic.textContent="",u="",void s(0);h.topic.innerHTML=t,h.topic.textContent=h.topic.textContent,u=h.topic.textContent,s(e)},m=(e,n)=>{let{id:a,txt:u,by:d,topicId:p,re:f,star:g,nor:h}=e,y=o[c]||{},m=y.by!==d,b=y.topicId!==p;c=a;let A=l[p];const T=()=>{v("#reps/"+a,a)};return vt("div",{id:a,class:function(){return"chat"+(()=>(g()?" star":"")+(b?" topic":"")+(s()===a?" cur":"")).call(this)},onclick:t=>w(t,e)},b?vt("div",{class:"topic-name"+(f?" re":" new")+(t?" head":"")},vt("a",{href:function(){return"#chats/"+("function"==typeof p?p.call(this):p)},onclick:e=>(v("#chats/"+p,A.name),e.preventDefault(),!1),innerHTML:A.name})):null,m||b?vt("div",{class:"by"},i[d].handle):null,vt("div",{onclick:e=>e.stopPropagation()},(()=>{let e=h();if(1!==e||a!==o[r()[n+1]].re)return e>0?vt([vt("span",{class:"rep",onclick:T},e," ðŸ’¬")," "]):void 0}),(e=>document.createRange().createContextualFragment(e))(u)))},v=(e,t)=>{let n=screen.width/2-300,r=screen.height/2-300;window.open(e,t,`toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=600,height=600,top=${r}, left=${n}`)},w=(e,t)=>{e.x<18&&e.offsetY<22&&b(t),e.x+28>e.target.offsetWidth&&e.offsetY<22&&y(t)},b=({id:e,star:t})=>{const n=r().filter((t=>t===e))[0],a=o[n];a.star?a.star(!t()):a.star=Ee(!1)},A=vt("div",{class:"sentinel"});return vt([A,vt("div",{class:"topics"},wt(r,((e,t)=>m(o[e],t)))),h])};var Xt;it.onconfig=e=>{e.d?Qt(Zt):Qt(Jt)};const Jt=()=>(it.recv=async e=>{switch(e.tag){case"Login":if(e.value.length<16)return void console.warn("login failed");Ge.salt=new Uint8Array(e.value),Ge.sskey=await Fe(Xt,Ge.salt);let t=await crypto.subtle.exportKey("raw",Ge.sskey);Bt("a",Ge.salt.buffer),Bt("s",t),ct.d=!0,Qt(Zt)}},vt("div",{class:"login"},vt("h2",null,"Login"),vt("form",{onsubmit:async function(e){e.preventDefault();let t=e.target,n=t.email.value;Xt=await Ke(t.password.value,n);let r={email:n,key:Array.from(new Uint8Array(Xt))};it.send(a.Login(r)),console.log(r)}},vt("input",{type:"text",name:"email",placeholder:"email",required:!0,autocomplete:"true"}),vt("input",{type:"password",name:"password",placeholder:"password",required:!0,autocomplete:"true"}),vt("button",{type:"submit"},"Login")),vt("h2",null,"Register"),vt("form",{onsubmit:async function(e){e.preventDefault();let t=e.target,n=t.email.value,r=t.username.value;Xt=await Ke(t.password.value,n);let o={email:n,handle:r,key:Array.from(new Uint8Array(Xt))};it.send(a.AddUser(o)),console.log(o)}},vt("input",{type:"text",name:"email",placeholder:"email",required:!0,autocomplete:"true"}),vt("input",{type:"text",name:"username",placeholder:"username",required:!0,autocomplete:"true"}),vt("input",{type:"password",name:"password",placeholder:"password",required:!0,autocomplete:"true"}),vt("button",{type:"submit"},"Register")))),Zt=()=>vt("div",null,"You have logged in"),Qt=Ee((()=>null)),en=(e,t)=>({pattern:e,view:t}),tn=["channels","groups","login"],nn=[en(/^$/,Wt),en(/^groups$/,(()=>{let e=Ee([]),t=0;it.recv=n=>{let r=n.value;if(Array.isArray(r))return 0==r.length?t--:e(r);let o=e();o.unshift(r),e(o)};const n=e=>a.Groups({limit:30,page:e}),r=e=>{t++,it.send(n(t))};return it.open=e=>r(),it.ready&&r(),vt([vt("button",{onclick:e=>{t--,t<1&&(t=1),it.send(n(t))}},"Prev Item"),vt("button",{onclick:r},"Next Item"),vt("button",{onclick:e=>{t=0;let n=setInterval((function(){300==t?clearInterval(n):r()}),1)}},"Run Load"),vt("button",{onclick:bt},"Switch Component"),vt("h2",null,"Groups"),vt(Ne(Et),{items:e,keys:()=>Object.keys(e()[0]||{})})])})),en(/^channels$/,Lt),en(/^login$/,(()=>vt(Ne(Qt),null))),en(/^channels\/(?<group_id>\d+)$/,Lt),en(/^chats\/(?<topic_id>\d+)$/,Wt),en(/^reps\/(?<chat_id>\d+)$/,Wt),en(/^products\/(?<id>\d+)$/,(({id:e})=>vt("h2",null,"Product ",e))),en(/^users\/(?<name>\w+)$/,(({name:e})=>vt("h2",null,e,"'s Profile"))),en(/^ip\/(?<ip>[\.\d]+)$/,Wt)],rn=Ee("");const on=()=>rn(document.location.hash.substr(1));window.addEventListener("hashchange",on),on();let an=!1,ln=window.pageYOffset;window.onscroll=function(e){an||(window.requestAnimationFrame((function(){!function(e){let t=window.scrollY+window.innerHeight===document.body.scrollHeight,n=window.pageYOffset;document.getElementById("nav").style.top=ln>n||t?"0":"-50px",ln=n}(),an=!1})),an=!0)},document.querySelector(".app").append(vt([vt("div",{id:"nav"},vt("a",{href:"#",class:"nav-item"},"home"),(()=>tn.map((e=>vt("a",{href:"#"+e,class:"nav-item "+(rn()===e?"is-active":"")},e))))),vt("div",{class:"container"},(()=>function(e){for(const{pattern:t,view:n}of nn){const r=e.match(t);if(r)return n({...r.groups})}}(rn())))]))}();</script></body></html>