<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>sonic</title><style type="text/css">*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif;font-size:14px;line-height:1.5}:focus{outline:0}body{background:#f9f9f9;margin:0}table{border-collapse:collapse;text-align:left;width:100%}table tr{background:#fff;border-bottom:1px solid}table td span{background:#eee;color:#696969;display:none;font-size:10px;font-weight:700;padding:5px;position:absolute;text-transform:uppercase;top:0;left:0}a{text-decoration:none}a:hover{text-decoration:underline}button{padding:5px 20px;cursor:pointer;border:1px solid #ddd;margin:10px 10px 10px 0;background:#efefef}h1{font-size:1.9em}h1,p{margin:.3em 0}td,th{border:1px solid #ddd;padding:.5em 5px;cursor:pointer}th{background:#f4f4f4;font-weight:400}caption{margin:0;font-weight:700;font-size:1.3em;background:#eee;padding:10px;border:1px solid #ddd}.comments{padding:5px}.comments-item{padding:10px 5px 0 0}.by{float:left;color:#121213;font-weight:700;margin-right:4px}.comments-time{display:inline-block;color:#aaa}#nav{padding:5px 15px;border:1px solid rgba(10,10,10,.1);background:#f9f9f9;position:sticky;top:0;z-index:1}.nav-item{margin:5px 10px 5px 0}.topics{margin-bottom:10px;white-space:pre-wrap;word-wrap:break-word}.topic-name,.topic-name a{cursor:pointer;width:fit-content}.topic-name.head a{margin-bottom:10px;font-size:15px;color:#1a1a1b;font-weight:500}.topic-name.head{margin-bottom:5px}.re:before{content:"ðŸ’¬ "}.new:before{content:"ðŸ“¢ "}.new{color:grey}.pell{border:1px solid rgba(10,10,10,.1);position:sticky;bottom:0;background:#f9f9f9}.pell-content{overflow-y:auto;padding:5px 10px 10px;white-space:pre-wrap;word-wrap:break-word}.pell-actionbar{background:#fff;border-bottom:1px solid rgba(10,10,10,.1)}.pell-button{background:transparent;border:none;width:30px;height:30px;vertical-align:bottom;margin:0;padding:0}.pell-button-selected{background:#f0f0f0}.pell-content[contenteditable]:empty:before{content:"Write a message...";color:#aaa}.pell-topic{display:none;overflow:hidden;padding:10px;color:grey;white-space:nowrap}.pell-topic:focus{white-space:normal}.pell.sticky .pell-topic{display:block}.pell-topic[contenteditable]:empty:before{content:"New Topic";color:#aaa}blockquote{width:fit-content;margin:0;padding:10px;background:#eee;border-radius:5px}blockquote:before{content:"\201C"}blockquote:after{content:"\201D"}.chat{padding:2px 15px;position:relative}.chat.cur,.chat:hover{background:#eee}.chat.topic{padding-top:5px;margin-top:2px}.chat:before{font-size:.9em;position:absolute;margin-top:2px;margin-left:-14px;cursor:pointer;color:#666}.chat:hover:before{content:"â˜†"}.chat.star:before{content:"ðŸŒŸ"!important}.rep{font-size:.85em;color:grey;cursor:pointer;width:fit-content}.chat:after{font-size:1em;position:absolute;top:2px;right:10px;cursor:pointer;color:#999}.chat:hover:after{content:"ðŸ”¨"}@media (max-width:600px){table thead{left:-9999px;position:absolute;visibility:hidden}table tr{border-bottom:0;display:flex;flex-direction:row;flex-wrap:wrap;margin-bottom:40px}table td{border:1px solid;margin:0 -1px -1px 0;padding-top:35px;position:relative;width:50%}table td span{display:block}.pell-topic{font-size:12px;padding:5px 10px}.pell-button,.pell-button b,i,strike,u{font-size:.85em;width:26px;height:26px}}.login{padding:0 15px}.login input{display:block;margin:5px 0;min-width:200px}</style></head><body><section class="app"></section><script src="https://cdn.jsdelivr.net/npm/zlibjs@0.3.1/bin/zlib.min.js"></script><script>!function(){"use strict";const e=[];function t(t){let n={};return function(){const a=e.slice.call(arguments),i=a.map((e=>{if(o(e)||Array.isArray(e)){let t={};for(let n in e)t[n]=r(e[n]);return t}return r(e)})),l=JSON.stringify(i);let s=n[l];return void 0===s&&(s=t.apply(this,a),s&&11===s.nodeType&&(s=e.slice.call(s.childNodes)),n[l]=s),s}}let n=0;function r(e){return"function"==typeof e||e instanceof Node?(e.$m||(e.$m=++n),{$m:e.$m}):e}function o(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i,l,s=a((function(e,t){function n(e){var t=e>>3;return e%8!=0&&t++,t}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===e&&(e=0);var r=null==t?void 0:t.grow;this.grow=r&&isFinite(r)&&n(r)||r||0,this.buffer="number"==typeof e?new Uint8Array(n(e)):e}return e.prototype.get=function(e){var t=e>>3;return t<this.buffer.length&&!!(this.buffer[t]&128>>e%8)},e.prototype.set=function(e,t){void 0===t&&(t=!0);var n=e>>3;if(t){if(this.buffer.length<n+1){var r=Math.max(n+1,Math.min(2*this.buffer.length,this.grow));if(r<=this.grow){var o=new Uint8Array(r);o.set(this.buffer),this.buffer=o}}this.buffer[n]|=128>>e%8}else n<this.buffer.length&&(this.buffer[n]&=~(128>>e%8))},e.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=8*this.buffer.length);for(var r=t,o=r>>3,a=128>>r%8,i=this.buffer[o];r<n;r++)e(!!(i&a),r),a=1===a?(i=this.buffer[++o],128):a>>1},e}();t.default=r}(l={path:i,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&l.path)}},l.exports),l.exports));let c,u=[];function d(e){let t=c,n=()=>{};c=n,g(n);let r=e((()=>{f(n),c=void 0}));return c=t,r}function p(e){function t(n){if(0===arguments.length)return c&&!t.__o.has(c)&&(t.__o.add(c),c.u.push(t)),e;e=n;let r=c;return c=void 0,t.o=new Set(t.__o),t.o.forEach((e=>e.i=!1)),t.o.forEach((e=>{e.i||e()})),c=r,e}return t.$o=1,t.__o=new Set,t.t=u,t}function f(e){e.__c.forEach(f),e.u.forEach((t=>{t.__o.delete(e),t.o&&t.o.delete(e)})),e.l.forEach((e=>e())),g(e)}function g(e){e.u=[],e.__c=[],e.l=[]}const h=(e,t={})=>e.reduce(((e,t)=>(e[t.id]=t,e)),t),m=()=>window.scrollTo(0,document.body.scrollHeight),y=t((e=>t(((t,n)=>d((()=>e(t,n))))))),v=e=>(t,...n)=>()=>y(e())(t,n),w=e=>{if("number"==typeof e)return console.log(e);console.log("Length",e instanceof ArrayBuffer?new Uint8Array(e).length:e.length,"bytes"),console.log((Object(e).buffer instanceof ArrayBuffer?e:"string"==typeof e?new TextEncoder("utf-8").encode(e):new Uint8ClampedArray(e)).reduce(((e,t,n,r)=>e+(n%16==0?n.toString(16).padStart(6,0)+"  ":" ")+t.toString(16).padStart(2,0)+(n===r.length-1||n%16==15?" ".repeat(3*(15-n%16))+Array.from(r).splice(n-n%16,16).reduce(((e,t)=>e+(t>31&&t<127||t>159?String.fromCharCode(t):".")),"  ")+"\n":"")),""))},b=(e,t)=>{let n=0,r=0;for(;n<e.length;)r>=t.length&&(r=0),e.set([e[n]^t[r]],n),n++,r++},A=(e,t)=>(b(e,t),L(e,t)),T=e=>{let{a:t,k:n}=E(e);return b(t,n),{a:t,k:n}},E=e=>{let t=e[0],n=e.subarray(1,t+1);return{a:e.subarray(t+1),k:n}},L=(e,t)=>{let n=new Uint8Array(1+t.length+e.length);return n[0]=t.length,n.set(t,1),n.set(e,1+t.length),n},U=(e,t)=>(e=Math.ceil(e),Math.floor(Math.random()*(Math.floor(t)-e)+e)),C=(e,t)=>{let n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n},I=e=>(performance.now()-e).toFixed(2),N=(e,t=64,n=8)=>A(e,crypto.getRandomValues(new Uint8Array(U(n,t)))),S=()=>{let e,t=new Promise((t=>e=t));return{complete:t=>e(t),join:()=>t}},k=navigator.vendor.includes("Apple")?{transaction:()=>{}}:openDatabase("sonic","1.0","Test DB",1073741824);function O(e,t){}function x(e,t){console.log(e,t)}k.transaction((e=>{e.executeSql("CREATE TABLE IF NOT EXISTS users (\n            id integer NOT NULL PRIMARY KEY,\n            handle varchar(50) NOT NULL,\n            email varchar(100) NOT NULL,\n            emailVerified boolean NOT NULL DEFAULT '0',\n            name varchar(100) NOT NULL,\n            key varchar(60) NOT NULL,\n            picture varchar(250),\n            gender boolean,\n            lastLogin datetime,\n            createdAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP\n        )",[],O,x),e.executeSql("CREATE TABLE IF NOT EXISTS topics (\n            id integer NOT NULL PRIMARY KEY,\n            name varchar(250) NOT NULL,\n            groupId integer NOT NULL,\n            channelId integer NOT NULL,\n            by integer NOT NULL,\n            createdAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP\n        )",[],O,x),e.executeSql("CREATE TABLE IF NOT EXISTS chats (\n            id integer NOT NULL PRIMARY KEY,\n            txt text NOT NULL,\n            by integer NOT NULL,\n            re integer NOT NULL,\n            nor integer NOT NULL DEFAULT '0',\n            topicId integer NOT NULL,\n            channelId integer NOT NULL,\n            groupId integer NOT NULL,\n            createdAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            star boolean\n        )",[],O,x)}));const R=S();let M,P,D=indexedDB.open("sonic",1);D.onsuccess=e=>{M=D.result,console.log("[db] open"),R.complete(M),D.open?D.open():D.open=!0},D.onupgradeneeded=e=>{M=D.result;M.createObjectStore("store"),M.createObjectStore("chats",{keyPath:"id"}),M.createObjectStore("users",{keyPath:"id"}),M.createObjectStore("topics",{keyPath:"id"});console.log("[db] setup complete")},caches.open("sonic").then((e=>P=e));const $=async(e,t)=>{w(t),M.transaction(["store"],"readwrite").objectStore("store").put(t,e),P.put(e,new Response(t))},j=(e,t)=>{let n=M.transaction([e],"readwrite").objectStore(e);t.forEach((e=>n.add(e))),k.transaction((n=>{t.forEach((t=>{let r=Object.keys(t),o=`INSERT OR REPLACE INTO ${e} (${r.join(",")}) VALUES (${Array(r.length).fill("?").join(",")})`;n.executeSql(o,Object.values(t).map((e=>"function"==typeof e?e():e)),O,x)}))}))},_=(e,t)=>{let n=performance.now(),r=[],o=new Set,a=M.transaction([e],"readonly").objectStore(e),i=0;return new Promise((l=>{t.forEach((s=>{let c=a.get(s);c.onsuccess=a=>{c.result?r.push(c.result):o.add(s),++i===t.length&&(console.log("[db]",`get ${e} in`,I(n),"ms"),l({value:r,missed:Array.from(o)}))}}))}))},H=async(e,t,n,r=!1)=>{await R.join();let o=performance.now(),a=[],i=(([e,t])=>{let n=new Set;for(var r=e;r<=t;r++)n.add(r);return n})([n-t,n-1]),l=M.transaction([e],"readonly").objectStore(e),s=0,c=n?IDBKeyRange.upperBound(n,r):null;return new Promise((r=>{l.openCursor(c,"prev").onsuccess=l=>{var c=l.target.result;if(c){if(a.push(c.value),i.delete(c.key),++s===t)return console.log("[db]","scan "+e,t,n||"","in",I(o),"ms"),r({value:a,missed:Array.from(i)});c.continue()}else console.log("[db]","scan "+e,t,n||"","in",I(o),"ms"),r({value:a,missed:Array.from(i)})}}))},B=async e=>{await R.join();let t=M.transaction(["store"],"readonly").objectStore("store");return new Promise((n=>{let r=t.get(e);r.onsuccess=e=>n(r.result)}))},G=e=>{var t,n=[];return e.sort(((e,t)=>e[0]-t[0]||e[1]-t[1])),e.forEach((e=>{!t||e[0]>t[1]+1?n.push(t=e):e[1]>t[1]&&(t[1]=e[1])})),n};var K,F,q,Y,V,z,W;!function(e){e.None=function(e){return{tag:"None",value:e}},e.Id=function(e){return{tag:"Id",value:e}},e.TopicId=function(e){return{tag:"TopicId",value:e}},e.ChannelId=function(e){return{tag:"ChannelId",value:e}},e.GroupId=function(e){return{tag:"GroupId",value:e}},e.By=function(e){return{tag:"By",value:e}}}(K||(K={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Email=function(e){return{tag:"Email",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(F||(F={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(q||(q={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(Y||(Y={})),function(e){e.Id=function(e){return{tag:"Id",value:e}}}(V||(V={})),function(e){e.User=function(e){return{tag:"User",value:e}},e.Group=function(e){return{tag:"Group",value:e}},e.Groups=function(e){return{tag:"Groups",value:e}},e.Channel=function(e){return{tag:"Channel",value:e}},e.Channels=function(e){return{tag:"Channels",value:e}},e.Topic=function(e){return{tag:"Topic",value:e}},e.ChatScan=function(e){return{tag:"ChatScan",value:e}},e.AddChat=function(e){return{tag:"AddChat",value:e}},e.AddUser=function(e){return{tag:"AddUser",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Topics=function(e){return{tag:"Topics",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}}}(z||(z={})),function(e){e.User=function(e){return{tag:"User",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Group=function(e){return{tag:"Group",value:e}},e.Groups=function(e){return{tag:"Groups",value:e}},e.Channel=function(e){return{tag:"Channel",value:e}},e.Channels=function(e){return{tag:"Channels",value:e}},e.Topic=function(e){return{tag:"Topic",value:e}},e.Topics=function(e){return{tag:"Topics",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.Chat=function(e){return{tag:"Chat",value:e}},e.Login=function(e){return{tag:"Login",value:e}}}(W||(W={}));const X=(e,t=0,n=!0)=>({pos:t,littleEndian:n,view:new DataView(e)}),J=(e,t)=>{const{view:{buffer:n},pos:r}=e,o=n.byteLength;if(o-r>t)return e;const a=Math.max(2*o,o+t),i=new Uint8Array(a);return i.set(new Uint8Array(n)),X(i.buffer,r,e.littleEndian)},Z=(e,t)=>{e=J(e,1);const{view:n,pos:r}=e;return n.setUint8(r,t),e.pos+=1,e},Q=(e,t)=>{e=J(e,4);const{view:n,pos:r,littleEndian:o}=e;return n.setUint32(r,t,o),e.pos+=4,e},ee=(e,t)=>{e=J(e,2);const{view:n,pos:r,littleEndian:o}=e;return n.setUint16(r,t,o),e.pos+=2,e};function te(e,t){const{view:n,pos:r,littleEndian:o}=e;return n.setUint32(o?r:r+4,t,o),n.setUint32(o?r+4:r,0,o),e.pos+=8,e}const ne=(e,t)=>{e=J(e,4);const{view:n,pos:r,littleEndian:o}=e;return n.setInt32(r,t,o),e.pos+=4,e},re=new TextEncoder,oe="encodeInto"in re?(e,t)=>re.encodeInto(e,t).written:(e,t)=>{const n=re.encode(e);return t.set(n),n.length},ae=(e,t)=>{e=J(e,3*t.length+8);const n=oe(t,new Uint8Array(e.view.buffer,e.pos+8));return(e=te(e,n)).pos+=n,e},ie=(e,t)=>Z(e,t?1:0),le=e=>(t,n)=>n.reduce(e,((e,t)=>te(J(e,8),t))(t,n.length)),se=e=>(t,n)=>null===n?Z(t,0):e(Z(t,1),n),ce=e=>{const{pos:t,view:n}=e;return e.pos+=1,n.getUint8(t)},ue=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getUint32(t,r)},de=e=>{const{view:t,pos:n,littleEndian:r}=e;return e.pos+=8,t.getUint32(r?n:n+4,r)},pe=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getInt32(t,r)},fe=e=>1===ce(e),ge=e=>t=>1===ce(t)?e(t):null,he=e=>t=>{const n=de(t),r=new Array;for(let o=0;o<n;o++)r.push(e(t));return r},me=new TextDecoder,ye=e=>{const t=de(e),{pos:n,view:{buffer:r}}=e,o=me.decode(new Uint8Array(r,n,t));return e.pos+=t,o};var ve=se(ae),we=se(ie),be=ae,Ae=se(be),Te=le(Z),Ee=le(ne),Le=function(e,t){var n=t.id,r=t.handle,o=t.email,a=t.emailVerified,i=t.name,l=t.key,s=t.picture,c=t.gender,u=t.lastLogin,d=t.createdAt,p=t.updatedAt;return be(be(Ae(we(ve(ae(ae(ie(ae(ae(ne(e,n),r),o),a),i),l),s),c),u),d),p)},Ue=(le(Le),function(e,t){var n=t.id,r=t.name,o=t.handle,a=t.by,i=t.createdAt,l=t.updatedAt;return be(be(ne(ae(ae(ne(e,n),r),o),a),i),l)}),Ce=(le(Ue),function(e,t){var n=t.id,r=t.name,o=t.handle,a=t.groupId,i=t.by,l=t.createdAt,s=t.updatedAt;return be(be(ne(ne(ae(ae(ne(e,n),r),o),a),i),l),s)}),Ie=(le(Ce),function(e,t){var n=t.id,r=t.name,o=t.groupId,a=t.channelId,i=t.by,l=t.createdAt,s=t.updatedAt;return be(be(ne(ne(ne(ae(ne(e,n),r),o),a),i),l),s)}),Ne=(le(Ie),function(e,t){var n=t.id,r=t.txt,o=t.by,a=t.re,i=t.nor,l=t.topicId,s=t.channelId,c=t.groupId,u=t.createdAt,d=t.updatedAt;return be(be(ne(ne(ne(ne(ne(ne(ae(ne(e,n),r),o),a),i),l),s),c),u),d)}),Se=(le(Ne),function(e,t){var n=t.filter,r=t.ub,o=t.lb,a=t.limit;return ee(ne(ne(function(e,t){switch(t.tag){case"None":return ie(Q(e,0),t.value);case"Id":return ne(Q(e,1),t.value);case"TopicId":return ne(Q(e,2),t.value);case"ChannelId":return ne(Q(e,3),t.value);case"GroupId":return ne(Q(e,4),t.value);case"By":return ne(Q(e,5),t.value)}}(e,n),r),o),a)}),ke=function(e,t){switch(t.tag){case"User":return function(e,t){switch(t.tag){case"Id":return ne(Q(e,0),t.value);case"Email":return ae(Q(e,1),t.value);case"Handle":return ae(Q(e,2),t.value)}}(Q(e,0),t.value);case"Group":return function(e,t){switch(t.tag){case"Id":return ne(Q(e,0),t.value);case"Handle":return ae(Q(e,1),t.value)}}(Q(e,1),t.value);case"Groups":return function(e,t){var n=t.limit,r=t.page;return ee(ee(e,n),r)}(Q(e,2),t.value);case"Channel":return function(e,t){switch(t.tag){case"Id":return ne(Q(e,0),t.value);case"Handle":return ae(Q(e,1),t.value)}}(Q(e,3),t.value);case"Channels":return function(e,t){var n=t.group_id,r=t.limit,o=t.page;return ee(ee(ne(e,n),r),o)}(Q(e,4),t.value);case"Topic":return function(e,t){switch(t.tag){case"Id":return ne(Q(e,0),t.value)}}(Q(e,5),t.value);case"ChatScan":return Se(Q(e,6),t.value);case"AddChat":return Ne(Q(e,7),t.value);case"AddUser":return function(e,t){var n=t.email,r=t.handle,o=t.key;return Te(ae(ae(e,n),r),o)}(Q(e,8),t.value);case"Login":return function(e,t){var n=t.email,r=t.key;return Te(ae(e,n),r)}(Q(e,9),t.value);case"Users":return Ee(Q(e,10),t.value);case"Topics":return Ee(Q(e,11),t.value);case"Chats":return Ee(Q(e,12),t.value)}},Oe=ge(ye),xe=ge(fe),Re=ye,Me=ge(Re),Pe=he(ce),De=(he(pe),function(e){return{id:pe(e),handle:ye(e),email:ye(e),emailVerified:fe(e),name:ye(e),key:ye(e),picture:Oe(e),gender:xe(e),lastLogin:Me(e),createdAt:Re(e),updatedAt:Re(e)}}),$e=he(De),je=function(e){return{id:pe(e),name:ye(e),handle:ye(e),by:pe(e),createdAt:Re(e),updatedAt:Re(e)}},_e=he(je),He=function(e){return{id:pe(e),name:ye(e),handle:ye(e),groupId:pe(e),by:pe(e),createdAt:Re(e),updatedAt:Re(e)}},Be=he(He),Ge=function(e){return{id:pe(e),name:ye(e),groupId:pe(e),channelId:pe(e),by:pe(e),createdAt:Re(e),updatedAt:Re(e)}},Ke=he(Ge),Fe=function(e){return{id:pe(e),txt:ye(e),by:pe(e),re:pe(e),nor:pe(e),topicId:pe(e),channelId:pe(e),groupId:pe(e),createdAt:Re(e),updatedAt:Re(e)}},qe=he(Fe),Ye=function(e){switch(ue(e)){case 0:return W.User(De(e));case 1:return W.Users($e(e));case 2:return W.Group(je(e));case 3:return W.Groups(_e(e));case 4:return W.Channel(He(e));case 5:return W.Channels(Be(e));case 6:return W.Topic(Ge(e));case 7:return W.Topics(Ke(e));case 8:return W.Chats(qe(e));case 9:return W.Chat(Fe(e));case 10:return W.Login(Pe(e))}throw new Error("bad variant index for Response")},Ve=X(new ArrayBuffer(512)),ze=function(e,t){return Ve.pos=0,Ve=t(Ve,e),new Uint8Array(Ve.view.buffer).slice(0,Ve.pos)},We=function(e,t){return t(X(e))},Xe=function(e){return We(e.buffer,Ye)},Je=function(e){return ze(e,ke)};const Ze=e=>new Zlib.Inflate(e).decompress(),Qe=e=>new Zlib.Deflate(e).compress(),et=async(e,t,n)=>(console.log("[sec] encrypting data"),await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e)),tt=async(e,t,n)=>(console.log("[sec] decrypting data"),await crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,e)),nt={};async function rt(){let e=await B("a");e&&(e=new Uint8Array(e),16===e.length&&(nt.salt=e));let t=await B("s");return t&&(t=new Uint8Array(t),32===t.length&&(nt.sskey=await crypto.subtle.importKey("raw",t,"AES-GCM",!1,["encrypt","decrypt"]))),console.log("[auth]",nt),nt.salt}async function ot(e,t){let n=new TextEncoder,r=await at(n.encode(e),n.encode(t));return await crypto.subtle.exportKey("raw",r)}async function at(e,t){let n=await crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}const it=document.location.hash.substr(1).match(/^ip\/(?<ip>[\:\.\d]+)$/),lt="wss://"+(it?it.groups.ip:"192.168.100.11:443");let st,ct,ut,dt,pt,ft,gt,ht,mt,yt,vt,wt=500,bt=0,At={},Tt=0,Et=1;console.group("[ws]","starting..."),function e(t){st=performance.now(),ct=new WebSocket(lt),ct.binaryType="arraybuffer",ct.onopen=()=>{console.log(`[ws] open in ${I(st)} ms`),console.groupEnd("[ws]"),console.group("[dc]","opening..."),t?Ct():pt&&St()},ct.onmessage=async e=>{console.log(`[ws] <- received answer in ${I(st)} ms`);let t=new Uint8Array(e.data),{a:n,k:r}=T(t);var o,a,i;Ut=(e=>{const t=new s(e);return{z:t.get(0),m:t.get(1),c:t.get(2),d:t.get(3)}})(n),console.log(Ut),At.onconfig&&At.onconfig(Ut),r=await(o=r,crypto.subtle.importKey("raw",o,{name:"ECDH",namedCurve:"P-256"},!0,[])),yt=await(a=dt.privateKey,i=r,crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:i},a,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])),mt=new Uint8Array(await crypto.subtle.exportKey("raw",yt));let l=JSON.parse((e=>(new TextDecoder).decode(Ze(e)))(n.slice(1))),c=l.answer?l.answer:l;if(await ft.setRemoteDescription(new RTCSessionDescription(c)),!l.candidate)return;const u=new RTCIceCandidate({candidate:l.candidate,sdpMid:0,sdpMLineIndex:0});await ft.addIceCandidate(u)},ct.onclose=t=>{bt++,wt+=U(0,bt<16?200:3e3),console.log("[ws] closed",t),console.groupEnd("[ws]"),console.groupEnd("[ws]"),console.groupCollapsed("[ws]",`retry ${bt} in ${(wt/1e3).toFixed(2)} sec`),setTimeout((()=>{e(!0)}),wt)},ct.onerror=e=>{console.log("[ws] error",e)}}(),Ct();const Lt=S();var Ut={};function Ct(){gt=!1,function(){ft=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]});let e=Et++;ft.onicecandidate=e=>{e.candidate},ft.onconnectionstatechange=t=>{switch(ft.connectionState){case"failed":case"disconnected":console.log("[peer]",e,"restarting....")}},ft.oniceconnectionstatechange=e=>{switch(ft.iceConnectionState){case"disconnected":console.log("[ice] restarting....")}}}(),vt=ft.createDataChannel("cu",{}),vt.binaryType="arraybuffer",Tt=0,At.send=It,vt.onopen=e=>{console.log(`[dc] open in ${I(st)} ms`),console.groupEnd("[dc]"),Tt=0,Lt.complete(vt)},vt.onmessage=Nt,vt.onclose=e=>{console.log("[dc] close",e)},vt.onerror=e=>{console.log("[dc] error:",e)},async function(){const e=async()=>{let e=await ft.createOffer();return await ft.setLocalDescription(e),Qe((new TextEncoder).encode(ft.localDescription.sdp))},t=async()=>{if(ht)return ht;dt=await(async()=>(console.log("[sec] generating key pairs"),await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"])))();let e=await crypto.subtle.exportKey("raw",dt.publicKey);return ht=new Uint8Array(e),ht};pt=await(async(e,t,n)=>{let[r,o,a]=await Promise.all([e(),t(),n()]);return a?A(A(r,o),a):N(A(r,o),64,24)})(e,t,rt),console.log(`[dc] sdp in ${I(st)} ms`),1===ct.readyState&&St()}()}async function It(e){if(await Lt.join(),Tt++,console.groupEnd("[dc]"),console.group("[dc]","-> sending packet",Tt,e),e=Je(e),w(e),Ut.z&&(e=Qe(e)),Ut.m&&(e=N(e,e.length),b(e,mt)),Ut.c){const t=crypto.getRandomValues(new Uint8Array(12));b(e,t),e=C(t,new Uint8Array(await et(e,yt,t)))}if(Ut.d){const t=crypto.getRandomValues(new Uint8Array(12));b(e,t),e=C(t,new Uint8Array(await et(e,nt.sskey,t)))}vt.send(e),ut=performance.now(),console.groupEnd("[dc]")}async function Nt(e){let t=new Uint8Array(e.data),n=t.length;if(console.groupEnd("[dc]"),console.group("[dc]","<- received",n,"bytes in",I(ut),"ms"),Ut.d){let e=t.subarray(0,12);t=new Uint8Array(await tt(t.subarray(12),nt.sskey,e)),b(t,e)}if(Ut.c){let e=t.subarray(0,12);t=new Uint8Array(await tt(t.subarray(12),yt,e)),b(t,e)}if(Ut.m){b(t,mt);let{a:e}=T(t);t=new Uint8Array(e)}Ut.z&&(t=Ze(t));let r=(100*n/t.length).toFixed(2);console.log(`[dc] unpacked ${n} / ${t.length} bytes ${r}% in ${I(ut)} ms`);let o=kt(t);At.recv&&At.recv(o),console.groupEnd("[dc]")}const St=()=>{gt||(console.log("[ws] -> sending offer"),ct.send(pt),gt=!0)},kt=e=>{let t=Xe(e);return console.log(t),console.table(t.value),t};let Ot={},xt=[];function Rt(e){return this.t&&this.t[e.type](e)}Ot.h=(...e)=>{let t,n=r=>{if(null==r);else if("string"==typeof r)t?Ot.add(t,r):t=Ot.s?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r);else if(Array.isArray(r))t||(t=document.createDocumentFragment()),r.forEach(n);else if(r instanceof Node)t?Ot.add(t,r):t=r;else if("object"==typeof r)Ot.property(t,r,null,Ot.s);else if("function"==typeof r)if(t){let e=Ot.add(t,"");Ot.insert(t,r,e)}else t=r.apply(null,e.splice(1));else Ot.add(t,""+r)};return e.forEach(n),t},Ot.insert=(e,t,n,r,o)=>(e=n&&n.parentNode||e,o=o||r instanceof Node&&r,t===r||(r&&"string"!=typeof r||!("string"==typeof t||"number"==typeof t&&(t+=""))?"function"==typeof t?Ot.subscribe((()=>{r=Ot.insert(e,t.call({el:e,endMark:n}),n,r,o)})):(n?r&&(o||(o=r.o&&r.o.nextSibling||n.previousSibling),Ot.rm(e,o,n)):e.textContent="",r=null,t&&!0!==t&&(r=Ot.add(e,t,n))):(null!=r&&e.firstChild?n?(n.previousSibling||e.lastChild).data=t:e.firstChild.data=t:n?Ot.add(e,t,n):e.textContent=t,r=t)),r),Ot.property=(e,t,n,r,o)=>{if(null!=t)if(!n||"attrs"===n&&(r=!0))for(n in t)Ot.property(e,t[n],n,r,o);else"o"!==n[0]||"n"!==n[1]||t.$o?"function"==typeof t?Ot.subscribe((()=>{Ot.property(e,t.call({el:e,name:n}),n,r,o)})):o?e.style.setProperty(n,t):r||"data-"===n.slice(0,5)||"aria-"===n.slice(0,5)?e.setAttribute(n,t):"style"===n?"string"==typeof t?e.style.cssText=t:Ot.property(e,t,null,r,!0):("class"===n&&(n+="Name"),e[n]=t):((e,t,n)=>{t=t.slice(2).toLowerCase(),n?e.addEventListener(t,Rt):e.removeEventListener(t,Rt),(e.t||(e.t={}))[t]=n})(e,n,t)},Ot.add=(e,t,n)=>{let r=(e=>{const{childNodes:t}=e;if(t&&11===e.nodeType)return t.length<2?t[0]:{o:Ot.add(e,"",t[0])}})(t=(e=>"string"==typeof e?document.createTextNode(e):e instanceof Node?e:Ot.h(xt,e))(t))||t;return e.insertBefore(t,n&&n.parentNode&&n),r},Ot.rm=(e,t,n)=>{for(;t&&t!==n;){let n=t.nextSibling;e===t.parentNode&&e.removeChild(t),t=n}},Ot.subscribe=function(e){return function(e,t){function n(){let r=c;return c&&c.__c.push(n),f(n),n.i=!0,c=n,t=e(t),c=r,t}function r(){return n.i?c&&n.u.forEach((e=>e())):t=n(),t}e.s=n,g(n),n(),r.$o=1}(e),()=>f(e.s)},Ot.cleanup=function(e){return c&&c.l.push(e),e},Ot.root=d,Ot.sample=function(e){let t=c;c=void 0;let n=e();return c=t,n},Ot.hs=(...e)=>{let t=Ot.s;Ot.s=!0;let n=Mt(...e);return Ot.s=t,n};let Mt=(...e)=>Ot.h.apply(Ot.h,e);function Pt(e,t,n){const{root:r,subscribe:o,sample:a,cleanup:i}=Ot;null==n&&(n=!t.$t);let l=Ot.h([]),s=Ot.add(l,""),c=new Map,u=new Map,d=new Set;function p(e,o){if(null==e)return;let a=u.get(e);return 1===o?(d.delete(e),a||(a=n?r((n=>(c.set(e,n),t(e.$v||e)))):t(e.$v||e),11===a.nodeType&&(a=(e=>{const{childNodes:t}=e,{length:n}=t;if(n<2)return t[0];let r=Array.from(t);return{nodeType:111,t:r[0],o:r[n-1],l(){if(t.length!==n){let t=0;for(;t<n;)e.appendChild(r[t++])}return e}}})(a)||a),u.set(e,a))):-1===o&&d.add(e),((e,t)=>111===e.nodeType?1/t<0?t?Ot.rm(e.t.parentNode,e.t.nextSibling,e.o.nextSibling)||e.t:e.o:t?e.l():e.t:e)(a,o)}function f(e){let t=c.get(e);t&&(t(),c.delete(e)),u.delete(e)}return i(o((t=>{let n=e();return a((()=>{d.clear();let e=Array.from(function(e,t,n,r,o){let a,i,l=new Map,s=new Map;for(a=0;a<t.length;a++)l.set(t[a],a);for(a=0;a<n.length;a++)s.set(n[a],a);for(a=i=0;a!==t.length||i!==n.length;){var c=t[a],u=n[i];if(null===c)a++;else if(n.length<=i)e.removeChild(r(t[a],-1)),a++;else if(t.length<=a)e.insertBefore(r(u,1),r(t[a],0)||o),i++;else if(c===u)a++,i++;else{var d=s.get(c),p=l.get(u);void 0===d?(e.removeChild(r(t[a],-1)),a++):void 0===p?(e.insertBefore(r(u,1),r(t[a],0)||o),i++):(e.insertBefore(r(t[p],1),r(t[a],0)||o),t[p]=null,p>a+1&&a++,i++)}}return n}(s.parentNode,t||[],n,p,s));return d.forEach(f),e}))}))),i((function(){c.forEach((e=>e())),c.clear(),u.clear(),d.clear()})),l}const Dt=()=>_t()===$t?_t(jt):_t($t),$t=({items:e,keys:t},...n)=>Mt([Mt("table",null,Mt("thead",null,Mt("tr",null,Pt(t,(e=>Mt("th",{scope:"col"},e))))),Mt("tbody",null,Pt(e,(e=>Mt("tr",{onclick:t=>location.hash="#channels/"+e.id},Pt(t,(t=>Mt("td",null,Mt("span",null,t)," ",e[t])))))))),n]),jt=({items:e},...t)=>Mt([Mt("ul",null,Pt(e,(e=>Mt("li",{id:e.id},e.name)))),t]),_t=p($t);const Ht=({group_id:e})=>{let t=p([]),n=0;At.recv=e=>{let r=e.value;if(Array.isArray(r))return 0==r.length?n--:t(r);let o=t();o.unshift(r),t(o)};const r=t=>z.Channels({group_id:e,limit:30,page:t}),o=e=>{n++,At.send(r(n))};return o(),Mt([Mt("button",{onclick:e=>{n--,n<1&&(n=1),At.send(r(n))}},"Prev Item"),Mt("button",{onclick:o},"Next Item"),Mt("button",{onclick:e=>{n=0;let t=setInterval((function(){300==n?clearInterval(t):o()}),1)}},"Run Load"),Mt("button",{onclick:Bt},"Switch Component"),Mt("h2",null,"Channels"),Mt(v(Ft),{items:t,keys:()=>Object.keys(t()[0]||{})})])},Bt=()=>Ft()===Gt?Ft(Kt):Ft(Gt),Gt=({items:e,keys:t},...n)=>Mt([Mt("table",null,Mt("thead",null,Mt("tr",null,Pt(t,(e=>Mt("th",{scope:"col"},e))))),Mt("tbody",null,Pt(e,(e=>Mt("tr",{onclick:t=>location.hash="#topics/"+e.id},Pt(t,(t=>Mt("td",null,Mt("span",null,t)," ",e[t])))))))),n]),Kt=({items:e},...t)=>Mt([Mt("ul",null,Pt(e,(e=>Mt("li",{id:e.id},e.name)))),t]),Ft=p(Gt),qt="defaultParagraphSeparator",Yt="formatBlock",Vt=(e,t,n)=>e.addEventListener(t,n),zt=(e,t)=>e.appendChild(t),Wt=e=>document.createElement(e),Xt=e=>document.queryCommandState(e),Jt=(e,t=null)=>document.execCommand(e,!1,t),Zt={bold:{icon:"<b>B</b>",title:"Bold",state:()=>Xt("bold"),result:()=>Jt("bold")},italic:{icon:"<i>I</i>",title:"Italic",state:()=>Xt("italic"),result:()=>Jt("italic")},underline:{icon:"<u>U</u>",title:"Underline",state:()=>Xt("underline"),result:()=>Jt("underline")},strikethrough:{icon:"<strike>S</strike>",title:"Strike-through",state:()=>Xt("strikeThrough"),result:()=>Jt("strikeThrough")},heading1:{icon:"<b>H1</b>",title:"Heading 1",result:()=>Jt(Yt,"<h1>")},heading2:{icon:"<b>H2</b>",title:"Heading 2",result:()=>Jt(Yt,"<h2>")},quote:{icon:"&#8220;&#8221;",title:"Quote",result:()=>Jt(Yt,"<blockquote>")},olist:{icon:"1.",title:"Ordered List",result:()=>Jt("insertOrderedList")},ulist:{icon:"&#8226;",title:"Unordered List",result:()=>Jt("insertUnorderedList")},code:{icon:"&lt;&gt;",title:"Code",result:()=>Jt(Yt,"<pre>")},line:{icon:"&#8213;",title:"Horizontal Line",result:()=>Jt("insertHorizontalRule")},link:{icon:"&#128279;",title:"Link",result:()=>{const e=window.prompt("Enter the link URL");e&&Jt("createLink",e)}},image:{icon:"&#128247;",title:"Image",result:()=>{const e=window.prompt("Enter the image URL");e&&Jt("insertImage",e)}}},Qt={actionbar:"pell-actionbar",button:"pell-button",content:"pell-content",selected:"pell-button-selected",topic:"pell-topic"},en=({topic_id:e,chat_id:t})=>{let n,r,o=p([]),a={},i={},l={},s=p(0);const c=((...e)=>{const t={},n={};return{create:e=>n[e]=new Promise((n=>t[e]=n)),complete:(e,n)=>t[e](n),join:e=>n[e],joinall:()=>Promise.all(e.map((e=>n[e]))),select:()=>Promise.race(e.map((e=>n[e])))}})("users","topics");At.recv=async e=>{switch(e.tag){case"Users":j("users",e.value),c.complete("users",e.value);break;case"Topics":j("topics",e.value),c.complete("topics",e.value);break;case"Chat":let t=window.scrollY+window.innerHeight===document.body.scrollHeight,n=o();e.value.nor=p(0),e.value.star=p(!1),a[e.value.id]=e.value,n.push(e.value.id),o(n),t&&m();break;case"Chats":let r=e.value;if(0==r.length)return;j("chats",r),((e,t)=>{let n=M.transaction(["store"],"readwrite").objectStore("store"),r=n.get(e);r.onsuccess=async o=>{r.result?(r.result.push(t),n.put(G(r.result),e)):n.put([t],e)}})("chats",[r[r.length-1].id,r[0].id]),u(r)}};const u=async t=>{let n=t[0].id,r=new Set,i=new Set,s=o();s=t.reverse().map((e=>(e.nor=p(e.nor),e.star=p(!1),e.createdAt=new Date(e.createdAt),e.updatedAt=new Date(e.updatedAt),a[e.id]=e,r.add(e.by),i.add(e.topicId),e.id))).concat(s),await d(r,i),o(s),e&&(document.title=l[e].name),window.scrollY<100&&setTimeout((()=>document.getElementById(n).scrollIntoView()))},d=async(e,t)=>{let n=await _("users",Array.from(e)),r=await _("topics",Array.from(t));h(n.value,i),h(r.value,l),n.missed.length>0&&c.create("users",At.send(z.Users(n.missed))),r.missed.length>0&&c.create("topics",At.send(z.Topics(r.missed)));let[o,a]=await c.joinall();o&&h(o,i),a&&h(a,l)},f=(n,r,o)=>{let a=z.ChatScan({filter:e>0?K.TopicId(e):t>0?K.Id(t):K.None(!0),ub:n,lb:r,limit:o});At.send(a)};(async(e=30)=>{let t=await H("chats",e);console.log("[chats]",t);let n=t.value[0]?t.value[0].id:0;n&&u(t.value),f(99999,n,e)})(),setTimeout((function(){new IntersectionObserver((e=>{e[0].intersectionRatio<=0||setTimeout((()=>(async(e=30)=>{let t=o()[0];if(!t)return;let{value:n,missed:r}=await H("chats",e,t,!0);n.length>0?(u(n),r.length>0&&At.send(z.Chats(r))):f(t,0,e)})()))}),{}).observe(T)}));const g=(e=>{const t=e.actions?e.actions.map((e=>"string"==typeof e?Zt[e]:Zt[e.name]?{...Zt[e.name],...e}:e)):Object.keys(Zt).map((e=>Zt[e])),n={...Qt,...e.classes},r=e.defaultParagraphSeparator||"div",o=e.element.topic=Wt("div");o.contentEditable=!0,o.className=n.topic,o.onkeydown=e=>{"Enter"===e.key&&(a.focus(),e.preventDefault())},zt(e.element,o);const a=e.element.content=Wt("div");a.contentEditable=!0,a.className=n.content,a.onfocus=()=>{let t=window.scrollY+window.innerHeight===document.body.scrollHeight;e.element.classList.add("sticky"),t&&setTimeout((()=>m()))},a.onblur=()=>{setTimeout((()=>{e.element.contains(document.activeElement)||e.element.classList.remove("sticky")}))},a.oninput=({target:{firstChild:t}})=>{e.onchange(a.innerHTML)},a.onkeydown=t=>{"Enter"!==t.key||t.shiftKey||(e.onsend(),t.preventDefault())},zt(e.element,a);const i=Wt("div");return i.className=n.actionbar,zt(e.element,i),t.forEach((e=>{const t=Wt("button");if(t.className=n.button,t.innerHTML=e.icon,t.title=e.title,t.setAttribute("type","button"),t.onclick=()=>e.result()&&a.focus(),e.state){const r=()=>t.classList[e.state()?"add":"remove"](n.selected);Vt(a,"keyup",r),Vt(a,"mouseup",r),Vt(t,"click",r)}zt(i,t)})),e.styleWithCSS&&Jt("styleWithCSS"),Jt(qt,r),e.element})({element:Mt("div",{class:"pell"}),onchange:e=>{},onsend:()=>{if(!g.content.textContent.trim())return;let e=s()||r,{topicId:t,channelId:o,groupId:i}=a[e];g.topic.textContent!==n&&(e=0,t=Object.keys(l).length+1,l[t].name=g.topic.textContent);let c=g.content.innerHTML.trim(),u=(new Date).toISOString();At.send(z.AddChat({id:0,txt:c,by:1,re:e,nor:0,topicId:t,channelId:o,groupId:i,createdAt:u,updatedAt:u})),g.content.textContent="",y({})}});g.content.innerHTML="";const y=({id:e,txt:t})=>{if(!e||s()===e)return g.topic.textContent="",n="",void s(0);g.topic.innerHTML=t,g.topic.textContent=g.topic.textContent,n=g.topic.textContent,s(e)},v=(t,n)=>{let{id:c,txt:u,by:d,topicId:p,re:f,star:g,nor:h}=t,m=a[r]||{},y=m.by!==d,v=m.topicId!==p;r=c;let A=l[p];const T=()=>{w("#reps/"+c,c)};return Mt("div",{id:c,class:function(){return"chat"+(()=>(g()?" star":"")+(v?" topic":"")+(s()===c?" cur":"")).call(this)},onclick:e=>b(e,t)},v?Mt("div",{class:"topic-name"+(f?" re":" new")+(e?" head":"")},Mt("a",{href:function(){return"#chats/"+("function"==typeof p?p.call(this):p)},onclick:e=>(w("#chats/"+p,A.name),e.preventDefault(),!1),innerHTML:A.name})):null,y||v?Mt("div",{class:"by"},i[d].handle):null,Mt("div",{onclick:e=>e.stopPropagation()},(()=>{let e=h();if(1!==e||c!==a[o()[n+1]].re)return e>0?Mt([Mt("span",{class:"rep",onclick:T},e," ðŸ’¬")," "]):void 0}),(e=>document.createRange().createContextualFragment(e))(u)))},w=(e,t)=>{let n=screen.width/2-300,r=screen.height/2-300;window.open(e,t,`toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=600,height=600,top=${r}, left=${n}`)},b=(e,t)=>{e.x<18&&e.offsetY<22&&A(t),e.x+28>e.target.offsetWidth&&e.offsetY<22&&y(t)},A=({id:e,star:t})=>{const n=o().filter((t=>t===e))[0],r=a[n];r.star?r.star(!t()):r.star=p(!1)},T=Mt("div",{class:"sentinel"});return Mt([T,Mt("div",{class:"topics"},Pt(o,((e,t)=>v(a[e],t)))),g])};var tn;At.onconfig=e=>{e.d?on(rn):on(nn)};const nn=()=>(At.recv=async e=>{switch(e.tag){case"Login":if(e.value.length<16)return void console.warn("login failed");let t=new Uint8Array(e.value.slice(0,4));nt.id=new DataView(t.buffer).getInt32(t,!1),nt.salt=new Uint8Array(e.value.slice(4)),nt.sskey=await at(tn,nt.salt);let n=await crypto.subtle.exportKey("raw",nt.sskey);$("u",nt.id),$("a",nt.salt.buffer),$("s",n),Ut.d=!0,on(rn)}},Mt("div",{class:"login"},Mt("h2",null,"Login"),Mt("form",{onsubmit:async function(e){e.preventDefault();let t=e.target,n=t.email.value;tn=await ot(t.password.value,n);let r={email:n,key:Array.from(new Uint8Array(tn))};At.send(z.Login(r)),console.log(r)}},Mt("input",{type:"text",name:"email",placeholder:"email",required:!0,autocomplete:"true"}),Mt("input",{type:"password",name:"password",placeholder:"password",required:!0,autocomplete:"true"}),Mt("button",{type:"submit"},"Login")),Mt("h2",null,"Register"),Mt("form",{onsubmit:async function(e){e.preventDefault();let t=e.target,n=t.email.value,r=t.username.value;tn=await ot(t.password.value,n);let o={email:n,handle:r,key:Array.from(new Uint8Array(tn))};At.send(z.AddUser(o)),console.log(o)}},Mt("input",{type:"text",name:"email",placeholder:"email",required:!0,autocomplete:"true"}),Mt("input",{type:"text",name:"username",placeholder:"username",required:!0,autocomplete:"true"}),Mt("input",{type:"password",name:"password",placeholder:"password",required:!0,autocomplete:"true"}),Mt("button",{type:"submit"},"Register")))),rn=()=>Mt("div",null,"You have logged in"),on=p((()=>null)),an=(e,t)=>({pattern:e,view:t}),ln=["channels","groups","login"],sn=[an(/^$/,en),an(/^groups$/,(()=>{let e=p([]),t=0;At.recv=n=>{let r=n.value;if(Array.isArray(r))return 0==r.length?t--:e(r);let o=e();o.unshift(r),e(o)};const n=e=>z.Groups({limit:30,page:e}),r=e=>{t++,At.send(n(t))};return r(),Mt([Mt("button",{onclick:e=>{t--,t<1&&(t=1),At.send(n(t))}},"Prev Item"),Mt("button",{onclick:r},"Next Item"),Mt("button",{onclick:e=>{t=0;let n=setInterval((function(){300==t?clearInterval(n):r()}),1)}},"Run Load"),Mt("button",{onclick:Dt},"Switch Component"),Mt("h2",null,"Groups"),Mt(v(_t),{items:e,keys:()=>Object.keys(e()[0]||{})})])})),an(/^channels$/,Ht),an(/^login$/,(()=>Mt(v(on),null))),an(/^channels\/(?<group_id>\d+)$/,Ht),an(/^chats\/(?<topic_id>\d+)$/,en),an(/^reps\/(?<chat_id>\d+)$/,en),an(/^products\/(?<id>\d+)$/,(({id:e})=>Mt("h2",null,"Product ",e))),an(/^users\/(?<name>\w+)$/,(({name:e})=>Mt("h2",null,e,"'s Profile"))),an(/^ip\/(?<ip>[\.\d]+)$/,en)],cn=p("");const un=()=>cn(document.location.hash.substr(1));window.addEventListener("hashchange",un),un();let dn=!1,pn=window.pageYOffset;window.onscroll=function(e){dn||(window.requestAnimationFrame((function(){!function(e){let t=window.scrollY+window.innerHeight===document.body.scrollHeight,n=window.pageYOffset;document.getElementById("nav").style.top=pn>n||t?"0":"-50px",pn=n}(),dn=!1})),dn=!0)},document.querySelector(".app").append(Mt([Mt("div",{id:"nav"},Mt("a",{href:"#",class:"nav-item"},"home"),(()=>ln.map((e=>Mt("a",{href:"#"+e,class:"nav-item "+(cn()===e?"is-active":"")},e))))),Mt("div",{class:"container"},(()=>function(e){for(const{pattern:t,view:n}of sn){const r=e.match(t);if(r)return n({...r.groups})}}(cn())))]))}();</script></body></html>