<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>sonic</title><style type="text/css">*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif;font-size:14px;line-height:1.5}:focus{outline:0}body{margin:0;padding-top:33px}table{border-collapse:collapse;text-align:left;width:100%}table tr{background:#fff;border-bottom:1px solid}table thead{border:1px solid #ddd}table td span{background:#eee;color:#696969;display:none;font-size:10px;font-weight:700;padding:5px;position:absolute;text-transform:uppercase;top:0;left:0}a{text-decoration:none;cursor:pointer}a:hover{text-decoration:underline}button{padding:3px 15px;cursor:pointer;border:1px solid #ddd;background:#efefef}h1{font-size:1.9em}h1,p{margin:.3em 0}td,th{border:1px solid #ddd;padding:.5em 5px;cursor:pointer}th{text-transform:capitalize;background:#f4f4f4;font-weight:400}.by{float:left;color:#262626;font-weight:600;margin-right:4px}.n{user-select:none;border:1px solid rgba(10,10,10,.1);background:#f5f5f5;position:fixed;width:100%;top:0;z-index:1}.n>div:first-child{padding:5px 15px}.m{position:absolute;top:0;right:0;margin:5px 15px 0 5px;max-width:100px;overflow:hidden;text-overflow:ellipsis}.tn{color:#aaa;width:fit-content;padding-bottom:5px}.tn>a{color:#00e;max-width:400px;font-size:14px;margin-right:10px}.dr a{color:#aaa;cursor:pointer;max-width:50px;display:inline-block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:-5px;font-size:12px}.dr span:last-child a{max-width:200px}.dr span:only-child a{max-width:400px}.dr span>a:hover{color:#000;max-width:300px}.dr>span+span:before{padding:0;color:#ccc;content:"/ "}.re:before{content:"↩️ "}.nw:before{content:"📢 "}.nw{color:grey}.fx .cs{position:absolute;bottom:68px;max-height:100%;width:100%}.ed .cs{bottom:103px}.e{border:1px solid rgba(10,10,10,.1);position:sticky;width:100%;bottom:0;background:#f9f9f9}.fx .e{position:fixed}.e-c{cursor:text;overflow-y:auto;padding:7px 10px;white-space:pre-wrap;word-wrap:break-word}.e-a{user-select:none;background:#fff;border-bottom:1px solid rgba(10,10,10,.1)}.e-b{background:transparent;border:none;width:30px;height:30px;vertical-align:bottom;margin:0;padding:0}.e-bs{background:#f0f0f0}.e-c[contenteditable]:empty:before{content:"Write a message...";color:#aaa}.e-t{display:none;overflow:hidden;padding:7px 10px;color:grey;white-space:nowrap}.e-t:focus{white-space:normal}.ed .e-t{display:block}.e-t[contenteditable]:empty:before{content:"New topic";color:#aaa}blockquote{width:fit-content;margin:0;padding:10px;background:#eee;border-radius:5px}blockquote:before{content:"\201C"}blockquote:after{content:"\201D"}.c{padding:2px 15px;position:relative;white-space:pre-wrap}.c.cur,.c:hover{background:#f9f9f9}.c.t{padding-top:5px;margin-top:2px}.c:before{font-size:.9em;position:absolute;margin-top:2px;margin-left:-14px;cursor:pointer;color:#666}.c:hover:before{content:"☆"}.c.star:before{content:"🌟"!important}.pm,.pr{display:none;cursor:pointer;color:#666;position:absolute;right:15px;top:-10px;padding:0 5px;border:1px solid rgba(10,10,10,.1);border-radius:3px;background:#fff;z-index:1;user-select:none}.pm:hover{background:#eee}.pr{right:42px}.c:hover .pm{display:unset}.pu{display:none;position:absolute;border:1px solid rgba(10,10,10,.1);border-radius:3px;background:#fff;z-index:1;user-select:none;right:0;margin-top:1px}.c:last-child .pu{bottom:23px}.pu div{font-size:12px;white-space:nowrap;padding:3px 5px}.pu div:hover{background:#eee}.pm:hover .pu{display:block}.rep{font-size:.85em;color:grey;cursor:pointer;width:fit-content}.ct{border:1px solid hsla(0,0%,100%,0)}.ce{background:#f9f9f9;border:1px solid rgba(10,10,10,.1)}@media (max-width:600px){.e-t{font-size:12px;padding:5px 10px}.e-b,.e-b b,i,strike,u{font-size:.85em;width:26px;height:26px}}.login{border-top:1px solid rgba(10,10,10,.1);padding:10px 15px 30px}.login input{display:block;margin:5px 0;min-width:200px}.bc{padding:0;list-style:none;white-space:nowrap;overflow:hidden;margin:0 40px 0 0}.grid .bc{display:block;padding:8px 15px;border-radius:4px;background-color:#f5f5f5;margin-right:0}.bc>li{cursor:pointer;display:inline-block;overflow:hidden;text-overflow:ellipsis;max-width:100px;margin-bottom:-5px}.bc>li:hover{max-width:unset}.bc>li+li:before{padding:0 0 0 5px;color:#ccc;content:"/\00a0"}.bc>li:last-child{max-width:unset}.bc>li:only-child:after{padding:0 0 0 5px;color:#ccc;content:"/\00a0 .."}ol,ul{margin-top:0}.relative{position:relative}.drop-container:hover .drop{display:block}.drop-container .drop{display:none;position:absolute;top:20px;left:0;min-width:120px;max-width:300px;background:#f5f5f5}.drop-container .drop a{display:block;padding:8px 13px;white-space:nowrap}.list{list-style-type:none;padding-left:0}li{display:list-item}.s{border-top:1px solid rgba(10,10,10,.1);background:#f9f9f9}.s-c{font-size:13px;cursor:text;overflow-y:auto;padding:5px 10px;white-space:pre-wrap;word-wrap:break-word}.s-c[contenteditable]:empty:before{content:"Search keyword...";color:#aaa}.tbl{overflow-y:scroll;max-height:40vh;border-top:1px solid #ddd}table td{border:none;border-bottom:1px solid #ddd;padding:3px;font-size:13px;white-space:nowrap}table tr td:first-child{width:26px}table td button{padding:1px 10px;font-size:10px}table tr:hover{background:#f5f5f5}.v{font-size:9px;color:#aaa;float:right;font-family:Menlo,monospace}</style></head><body><script src="https://cdn.jsdelivr.net/npm/zlibjs@0.3.1/bin/zlib.min.js"></script><script>!function(){"use strict";const e=[];function t(t){let n={};return function(){const i=e.slice.call(arguments),o=i.map((e=>{if(a(e)||Array.isArray(e)){let t={};for(let n in e)t[n]=r(e[n]);return t}return r(e)})),s=JSON.stringify(o);let l=n[s];return void 0===l&&(l=t.apply(this,i),l&&11===l.nodeType&&(l=e.slice.call(l.childNodes)),n[s]=l),l}}let n=0;function r(e){return"function"==typeof e||e instanceof Node?(e.$m||(e.$m=++n),{$m:e.$m}):e}function a(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function o(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var s,l,c=o((function(e,t){function n(e){var t=e>>3;return e%8!=0&&t++,t}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===e&&(e=0);var r=null==t?void 0:t.grow;this.grow=r&&isFinite(r)&&n(r)||r||0,this.buffer="number"==typeof e?new Uint8Array(n(e)):e}return e.prototype.get=function(e){var t=e>>3;return t<this.buffer.length&&!!(this.buffer[t]&128>>e%8)},e.prototype.set=function(e,t){void 0===t&&(t=!0);var n=e>>3;if(t){if(this.buffer.length<n+1){var r=Math.max(n+1,Math.min(2*this.buffer.length,this.grow));if(r<=this.grow){var a=new Uint8Array(r);a.set(this.buffer),this.buffer=a}}this.buffer[n]|=128>>e%8}else n<this.buffer.length&&(this.buffer[n]&=~(128>>e%8))},e.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=8*this.buffer.length);for(var r=t,a=r>>3,i=128>>r%8,o=this.buffer[a];r<n;r++)e(!!(o&i),r),i=1===i?(o=this.buffer[++a],128):i>>1},e}();t.default=r}(l={path:s,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&l.path)}},l.exports),l.exports));let u,d=[];function h(e){let t=u,n=()=>{};u=n,m(n);let r=e((()=>{p(n),u=void 0}));return u=t,r}function f(e){function t(n){if(0===arguments.length)return u&&!t.__o.has(u)&&(t.__o.add(u),u.u.push(t)),e;e=n;let r=u;return u=void 0,t.o=new Set(t.__o),t.o.forEach((e=>e.i=!1)),t.o.forEach((e=>{e.i||e()})),u=r,e}return t.$o=1,t.__o=new Set,t.t=d,t}function p(e){e.__c.forEach(p),e.u.forEach((t=>{t.__o.delete(e),t.o&&t.o.delete(e)})),e.l.forEach((e=>e())),m(e)}function m(e){e.u=[],e.__c=[],e.l=[]}const w=(e,t)=>e.reduce(((e,t)=>(e.set(t.id,t),e)),t),y=()=>window.scrollTo(0,document.body.scrollHeight),g=t((e=>t(((t,n)=>h((()=>e(t,n))))))),v=e=>(t,...n)=>()=>g(e())(t,n),b=(e,t)=>{let n=0,r=0;for(;n<e.length;)r>=t.length&&(r=0),e.set([e[n]^t[r]],n),n++,r++},C=(e,t)=>(b(e,t),S(e,t)),E=e=>{let{a:t,k:n}=L(e);return b(t,n),{a:t,k:n}},L=e=>{let t=e[0],n=e.subarray(1,t+1);return{a:e.subarray(t+1),k:n}},S=(e,t)=>{let n=new Uint8Array(1+t.length+e.length);return n[0]=t.length,n.set(t,1),n.set(e,1+t.length),n},A=(e,t)=>(e=Math.ceil(e),Math.floor(Math.random()*(Math.floor(t)-e)+e)),T=(e,t)=>{let n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n},U=(e,t=64,n=8)=>C(e,crypto.getRandomValues(new Uint8Array(A(n,t)))),x=()=>{let e,t=new Promise((t=>e=t));return{complete:t=>e(t),join:()=>t}},N=navigator.vendor.includes("Apple")?{transaction:()=>{}}:openDatabase("sonic","1.0","Test DB",1073741824);function k(e,t){}function O(e,t){}N.transaction((e=>{e.executeSql("CREATE TABLE IF NOT EXISTS users (\n            id integer NOT NULL PRIMARY KEY,\n            name varchar(50) NOT NULL\n        )",[],k,O),e.executeSql("CREATE TABLE IF NOT EXISTS userchans (\n            id integer NOT NULL PRIMARY KEY\n        )",[],k,O),e.executeSql("CREATE TABLE IF NOT EXISTS chans (\n            id integer NOT NULL PRIMARY KEY,\n            name varchar(50) NOT NULL,\n            fullname varchar(150) NOT NULL,\n            mom integer NOT NULL,\n            by integer NOT NULL,\n            dir text NOT NULL,\n            ispub boolean NOT NULL DEFAULT '0',\n            isprv boolean NOT NULL DEFAULT '0',\n            timestamp datetime NOT NULL DEFAULT CURRENT_TIMESTAMP\n        )",[],k,O),e.executeSql("CREATE TABLE IF NOT EXISTS chats (\n            id integer NOT NULL PRIMARY KEY,\n            txt text NOT NULL,\n            by integer NOT NULL,\n            re integer NOT NULL,\n            nor integer NOT NULL DEFAULT '0',\n            chanid integer NOT NULL,\n            dir text NOT NULL,\n            status integer NOT NULL DEFAULT '0',\n            timestamp datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            star boolean\n        )",[],k,O),e.executeSql("CREATE TABLE IF NOT EXISTS chanchats (\n            chanid integer NOT NULL,\n            chatid integer NOT NULL,\n            PRIMARY KEY (chanid, chatid)\n        )",[],k,O)})),window._qd=()=>{N.transaction((e=>{e.executeSql("SELECT * FROM sqlite_master WHERE type = 'table' AND name NOT LIKE '\\_%' escape '\\'",[],((e,t)=>{var n,r,a,i;function o(){--a<0&&N.changeVersion(N.version,"",console.log,console.error)}for(n=t.rows,a=r=n.length;r--;)i=n.item(r).name,e.executeSql("DROP TABLE "+i,[],o,console.error);o()}),console.error)}))},window._q=(e,t=[])=>{N.transaction((n=>{n.executeSql(e,t,((e,t)=>{}),console.error)}))};const D=x(),j="sonic",I=["session","chats","users","chans","ranges","chanchats"];let R;window._d=()=>_(j);let M=indexedDB.open(j,1);function _(e){var t=window.indexedDB.deleteDatabase(e);t.onerror=e=>{},t.onsuccess=e=>{}}M.onsuccess=e=>{R=M.result,function(e){let t=e.objectStoreNames;for(const e of I)if(!t.contains(e))return void _(j)}(R),D.complete(R),M.open?M.open():M.open=!0},M.onerror=e=>{D.complete()},M.onblocked=e=>{},M.onupgradeneeded=e=>{R=M.result;let t=R.objectStoreNames;if(!t.contains("session")){R.createObjectStore("session")}if(!t.contains("ranges")){R.createObjectStore("ranges")}if(!t.contains("chats")){let e=R.createObjectStore("chats",{keyPath:"id"});e.createIndex("chanid",["chanid","id"],{unique:!1}),e.createIndex("re",["re","id"],{unique:!1}),e.createIndex("by",["by","id"],{unique:!1})}if(!t.contains("users")){R.createObjectStore("users",{keyPath:"id"})}if(!t.contains("chans")){R.createObjectStore("chans",{keyPath:"id"}).createIndex("mom",["mom","id"],{unique:!1})}if(!t.contains("chanchats")){R.createObjectStore("chanchats",{keyPath:["chanid","chatid"]})}for(const e of I)R.objectStoreNames.contains(e)||R.createObjectStore(e)};const P=async(e,t)=>{let n=await D.join();n&&n.transaction(["session"],"readwrite").objectStore("session").put(t,e)},B=async()=>{let e=await D.join();e&&(e.transaction(["session"],"readwrite").objectStore("session").clear(),await q(0))},K=async(e,t)=>{let n=await D.join();if(!n)return;let r=n.transaction([e],"readwrite").objectStore(e);t.forEach((e=>{"string"==typeof e.timestamp&&(e.timestamp=new Date(e.timestamp)),r.add(e).onerror=console.error})),N.transaction((n=>{t.forEach((t=>{let r=Object.keys(t),a=`INSERT OR REPLACE INTO ${e} (${r.join(",")}) VALUES (${Array(r.length).fill("?").join(",")})`;n.executeSql(a,Object.values(t).map((e=>"function"==typeof e?e():e)),k,O)}))}))},q=async(...e)=>{let t=await D.join();t&&(await X(e),function(e){let n=t.transaction(["chanchats"],"readwrite").objectStore("chanchats");e.forEach((e=>{let t=IDBKeyRange.bound([e],[e,Number.MAX_VALUE]);n.delete(t).onerror=console.error}))}(e),function(e){let n=t.transaction(["chats"],"readwrite").objectStore("chats"),r=n.index("chanid");e.forEach((e=>{let t=IDBKeyRange.bound([e],[e,Number.MAX_VALUE]);r.openCursor(t).onsuccess=e=>{var t=e.target.result;t&&(n.delete(t.primaryKey).onerror=console.error,t.continue())}}))}(e.filter((e=>e>0))))},H=async(e,t)=>{let n=await D.join();n&&(n.transaction([e],"readwrite").objectStore(e).put(t).onerror=console.error,N.transaction((n=>{let r=Object.keys(t),a=`INSERT OR REPLACE INTO ${e} (${r.join(",")}) VALUES (${Array(r.length).fill("?").join(",")})`;n.executeSql(a,Object.values(t).map((e=>"function"==typeof e?e():e)),k,O)})))},F=async(e,t)=>{let n=await D.join();if(!n)return{value:[],missed:t};if(0===t.length)return{value:[],missed:[]};performance.now();let r=[],a=new Set,i=n.transaction([e],"readonly").objectStore(e),o=0;return new Promise((e=>{t.forEach((n=>{let s=i.get(n);s.onerror=console.error,s.onsuccess=i=>{if(s.result?r.push(s.result):a.add(n),++o===t.length){let t={value:r,missed:Array.from(a)};e(t)}}}))}))},$=(e,t,n,r)=>{let a=n?IDBKeyRange.upperBound(n,r):null;if(!t)return[e,a];let i=n||Number.MAX_VALUE;switch(t.tag){case"Chanid":a=IDBKeyRange.bound([t.value],[t.value,i],!1,r)}return[e,a]},Y=async(e,t,n=30,r=!0)=>(await(async(e,t,n,r,a,i,o)=>{let s=await D.join();if(!s)return;performance.now();let l=[],c=s.transaction([e],"readonly"),[u,d]=i?i(c.objectStore(e),t,r,a):[c.objectStore(e),null],h=0;return new Promise((e=>{u.openCursor(d,o).onsuccess=t=>{var r=t.target.result;if(r){if(l.push(r.value),++h===n)return e(l);r.continue()}else e(l)}}))})("chanchats",e,n,t,r,$,"prev")).map((e=>e.chatid)),V=async(e,t,n)=>{let r=await D.join();if(!r)return;let a=r.transaction(["ranges"],"readwrite").objectStore("ranges"),i=a.get(e);i.onerror=console.error,i.onsuccess=async r=>{if(i.result){if(n)return a.put([i.result[0],i.result[1],n],e).onerror=console.error;t[0]<i.result[0]&&(t[0]=i.result[0]),t[1]>i.result[0]&&(t[1]=i.result[1])}a.put(t,e).onerror=console.error}},J=e=>G(e,"ranges"),X=async(...e)=>{let t=await D.join();if(!t)return;let n=t.transaction(["ranges"],"readwrite").objectStore("ranges");e.forEach((e=>n.delete(e).onerror=console.error))},z=e=>G(e,"session"),G=async(e,t)=>{let n=await D.join();if(!n)return;let r=n.transaction([t],"readonly").objectStore(t);return new Promise((t=>{let n=r.get(e);n.onerror=console.error,n.onsuccess=e=>t(n.result)}))};var W,Z,Q;!function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Chanid=function(e){return{tag:"Chanid",value:e}},e.By=function(e){return{tag:"By",value:e}}}(W||(W={})),function(e){e.ChatScan=function(e){return{tag:"ChatScan",value:e}},e.ChanScan=function(e){return{tag:"ChanScan",value:e}},e.AddChat=function(e){return{tag:"AddChat",value:e}},e.AddUser=function(e){return{tag:"AddUser",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.Logout=function(e){return{tag:"Logout",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Chans=function(e){return{tag:"Chans",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.ChanJoin=function(e){return{tag:"ChanJoin",value:e}},e.ChanLeave=function(e){return{tag:"ChanLeave",value:e}},e.DelChat=function(e){return{tag:"DelChat",value:e}},e.DelChan=function(e){return{tag:"DelChan",value:e}},e.EditChat=function(e){return{tag:"EditChat",value:e}}}(Z||(Z={})),function(e){e.ChatScan=function(e){return{tag:"ChatScan",value:e}},e.ChanScan=function(e){return{tag:"ChanScan",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.Chans=function(e){return{tag:"Chans",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Chat=function(e){return{tag:"Chat",value:e}},e.Chan=function(e){return{tag:"Chan",value:e}},e.User=function(e){return{tag:"User",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.ChanJoin=function(e){return{tag:"ChanJoin",value:e}},e.DelChat=function(e){return{tag:"DelChat",value:e}},e.DelChan=function(e){return{tag:"DelChan",value:e}},e.EditChat=function(e){return{tag:"EditChat",value:e}}}(Q||(Q={}));const ee=(e,t=0,n=!0)=>({pos:t,littleEndian:n,view:new DataView(e)}),te=(e,t)=>{const{view:{buffer:n},pos:r}=e,a=n.byteLength;if(a-r>t)return e;const i=Math.max(2*a,a+t),o=new Uint8Array(i);return o.set(new Uint8Array(n)),ee(o.buffer,r,e.littleEndian)},ne=(e,t)=>{e=te(e,1);const{view:n,pos:r}=e;return n.setUint8(r,t),e.pos+=1,e},re=(e,t)=>{e=te(e,4);const{view:n,pos:r,littleEndian:a}=e;return n.setUint32(r,t,a),e.pos+=4,e};function ae(e,t){const{view:n,pos:r,littleEndian:a}=e;return n.setUint32(a?r:r+4,t,a),n.setUint32(a?r+4:r,0,a),e.pos+=8,e}const ie=(e,t)=>{e=te(e,4);const{view:n,pos:r,littleEndian:a}=e;return n.setInt32(r,t,a),e.pos+=4,e},oe=new TextEncoder,se="encodeInto"in oe?(e,t)=>oe.encodeInto(e,t).written:(e,t)=>{const n=oe.encode(e);return t.set(n),n.length},le=(e,t)=>{e=te(e,3*t.length+8);const n=se(t,new Uint8Array(e.view.buffer,e.pos+8));return(e=ae(e,n)).pos+=n,e},ce=(e,t)=>ne(e,t?1:0),ue=e=>(t,n)=>n.reduce(e,((e,t)=>ae(te(e,8),t))(t,n.length)),de=e=>(t,n)=>null===n?ne(t,0):e(ne(t,1),n),he=e=>{const{pos:t,view:n}=e;return e.pos+=1,n.getUint8(t)},fe=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getUint32(t,r)},pe=e=>{const{view:t,pos:n,littleEndian:r}=e;return e.pos+=8,t.getUint32(r?n:n+4,r)},me=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getInt32(t,r)},we=e=>1===he(e),ye=e=>t=>1===he(t)?e(t):null,ge=e=>t=>{const n=pe(t),r=new Array;for(let a=0;a<n;a++)r.push(e(t));return r},ve=new TextDecoder,be=e=>{const t=pe(e),{pos:n,view:{buffer:r}}=e,a=ve.decode(new Uint8Array(r,n,t));return e.pos+=t,a};var Ce=ue(ie),Ee=de((function(e,t){switch(t.tag){case"Id":return ie(re(e,0),t.value);case"Chanid":return ie(re(e,1),t.value);case"By":return ie(re(e,2),t.value)}})),Le=de(le),Se=de(ie),Ae=de(ne),Te=ue(ne),Ue=(de(Ce),function(e,t){var n=t.id,r=t.txt,a=t.by,i=t.re,o=t.nor,s=t.chanid,l=t.dir,c=t.status,u=t.timestamp;return le(((e,t)=>{e=te(e,2);const{view:n,pos:r,littleEndian:a}=e;return n.setUint16(r,t,a),e.pos+=2,e})(Ce(ie(ie(ie(ie(le(ie(e,n),r),a),i),o),s),l),c),u)}),xe=(ue(Ue),function(e,t){var n=t.id,r=t.name,a=t.fullname,i=t.mom,o=t.by,s=t.dir,l=t.ispub,c=t.isprv,u=t.timestamp;return le(ce(ce(Ce(ie(ie(le(le(ie(e,n),r),a),i),o),s),l),c),u)}),Ne=(ue(xe),ue((function(e,t){var n=t.id,r=t.name;return le(ie(e,n),r)})),de(Ue),de(xe),de((function(e,t){var n=t.id,r=t.name,a=t.email,i=t.emailverified,o=t.fullname,s=t.key,l=t.timestamp;return le(le(le(ce(le(le(ie(e,n),r),a),i),o),s),l)})),de((function(e,t){var n=t.data,r=t.chans;return Ce(Te(e,n),r)})),function(e,t){var n=t.filter,r=t.kw,a=t.ub,i=t.lb,o=t.limit;return Ae(Se(Se(Le(Ee(e,n),r),a),i),o)}),ke=function(e,t){var n=t.id,r=t.txt;return le(ie(e,n),r)},Oe=function(e,t){switch(t.tag){case"ChatScan":return Ne(re(e,0),t.value);case"ChanScan":return Ne(re(e,1),t.value);case"AddChat":return function(e,t){var n=t.txt,r=t.re,a=t.chname;return Le(Se(le(e,n),r),a)}(re(e,2),t.value);case"AddUser":return function(e,t){var n=t.email,r=t.name,a=t.key;return Te(le(le(e,n),r),a)}(re(e,3),t.value);case"Login":return function(e,t){var n=t.email,r=t.key;return Te(le(e,n),r)}(re(e,4),t.value);case"Logout":return Te(re(e,5),t.value);case"Users":return Ce(re(e,6),t.value);case"Chans":return Ce(re(e,7),t.value);case"Chats":return Ce(re(e,8),t.value);case"ChanJoin":return ie(re(e,9),t.value);case"ChanLeave":return ie(re(e,10),t.value);case"DelChat":return ie(re(e,11),t.value);case"DelChan":return ie(re(e,12),t.value);case"EditChat":return ke(re(e,13),t.value)}},De=ge(me),je=(ye((function(e){switch(fe(e)){case 0:return W.Id(me(e));case 1:return W.Chanid(me(e));case 2:return W.By(me(e))}throw new Error("bad variant index for Filter")})),ye(be),ye(me)),Ie=(ye(he),ge(he)),Re=ye(De),Me=function(e){return{id:me(e),txt:be(e),by:me(e),re:me(e),nor:me(e),chanid:me(e),dir:De(e),status:(e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=2,n.getUint16(t,r)})(e),timestamp:be(e)}},_e=ge(Me),Pe=function(e){return{id:me(e),name:be(e),fullname:be(e),mom:me(e),by:me(e),dir:De(e),ispub:we(e),isprv:we(e),timestamp:be(e)}},Be=ge(Pe),Ke=ge((function(e){return{id:me(e),name:be(e)}})),qe=ye(Me),He=ye(Pe),Fe=ye((function(e){return{id:me(e),name:be(e),email:be(e),emailverified:we(e),fullname:be(e),key:be(e),timestamp:be(e)}})),$e=ye((function(e){return{data:Ie(e),chans:De(e)}})),Ye=function(e){return{id:me(e),txt:be(e)}},Ve=function(e){switch(fe(e)){case 0:return Q.ChatScan(Re(e));case 1:return Q.ChanScan(Re(e));case 2:return Q.Chats(_e(e));case 3:return Q.Chans(Be(e));case 4:return Q.Users(Ke(e));case 5:return Q.Chat(qe(e));case 6:return Q.Chan(He(e));case 7:return Q.User(Fe(e));case 8:return Q.Login($e(e));case 9:return Q.ChanJoin(je(e));case 10:return Q.DelChat(me(e));case 11:return Q.DelChan(me(e));case 12:return Q.EditChat(Ye(e))}throw new Error("bad variant index for Response")},Je=ee(new ArrayBuffer(512)),Xe=function(e,t){return Je.pos=0,Je=t(Je,e),new Uint8Array(Je.view.buffer).slice(0,Je.pos)},ze=function(e,t){return t(ee(e))},Ge=function(e){return ze(e.buffer,Ve)},We=function(e){return Xe(e,Oe)};const Ze=e=>new Zlib.Inflate(e).decompress(),Qe=e=>new Zlib.Deflate(e).compress(),et=async(e,t,n)=>await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e),tt=async(e,t,n)=>await crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,e);let nt={},rt=[];function at(e){return this.t&&this.t[e.type](e)}nt.h=(...e)=>{let t,n=r=>{if(null==r);else if("string"==typeof r)t?nt.add(t,r):t=nt.s?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r);else if(Array.isArray(r))t||(t=document.createDocumentFragment()),r.forEach(n);else if(r instanceof Node)t?nt.add(t,r):t=r;else if("object"==typeof r)nt.property(t,r,null,nt.s);else if("function"==typeof r)if(t){let e=nt.add(t,"");nt.insert(t,r,e)}else t=r.apply(null,e.splice(1));else nt.add(t,""+r)};return e.forEach(n),t},nt.insert=(e,t,n,r,a)=>(e=n&&n.parentNode||e,a=a||r instanceof Node&&r,t===r||(r&&"string"!=typeof r||!("string"==typeof t||"number"==typeof t&&(t+=""))?"function"==typeof t?nt.subscribe((()=>{r=nt.insert(e,t.call({el:e,endMark:n}),n,r,a)})):(n?r&&(a||(a=r.o&&r.o.nextSibling||n.previousSibling),nt.rm(e,a,n)):e.textContent="",r=null,t&&!0!==t&&(r=nt.add(e,t,n))):(null!=r&&e.firstChild?n?(n.previousSibling||e.lastChild).data=t:e.firstChild.data=t:n?nt.add(e,t,n):e.textContent=t,r=t)),r),nt.property=(e,t,n,r,a)=>{if(null!=t)if(!n||"attrs"===n&&(r=!0))for(n in t)nt.property(e,t[n],n,r,a);else"o"!==n[0]||"n"!==n[1]||t.$o?"function"==typeof t?nt.subscribe((()=>{nt.property(e,t.call({el:e,name:n}),n,r,a)})):a?e.style.setProperty(n,t):r||"data-"===n.slice(0,5)||"aria-"===n.slice(0,5)?e.setAttribute(n,t):"style"===n?"string"==typeof t?e.style.cssText=t:nt.property(e,t,null,r,!0):("class"===n&&(n+="Name"),e[n]=t):((e,t,n)=>{t=t.slice(2).toLowerCase(),n?e.addEventListener(t,at):e.removeEventListener(t,at),(e.t||(e.t={}))[t]=n})(e,n,t)},nt.add=(e,t,n)=>{let r=(e=>{const{childNodes:t}=e;if(t&&11===e.nodeType)return t.length<2?t[0]:{o:nt.add(e,"",t[0])}})(t=(e=>"string"==typeof e?document.createTextNode(e):e instanceof Node?e:nt.h(rt,e))(t))||t;return e.insertBefore(t,n&&n.parentNode&&n),r},nt.rm=(e,t,n)=>{for(;t&&t!==n;){let n=t.nextSibling;e===t.parentNode&&e.removeChild(t),t=n}},nt.subscribe=function(e){return function(e,t){function n(){let r=u;return u&&u.__c.push(n),p(n),n.i=!0,u=n,t=e(t),u=r,t}function r(){return n.i?u&&n.u.forEach((e=>e())):t=n(),t}e.s=n,m(n),n(),r.$o=1}(e),()=>p(e.s)},nt.cleanup=function(e){return u&&u.l.push(e),e},nt.root=h,nt.sample=function(e){let t=u;u=void 0;let n=e();return u=t,n},nt.hs=(...e)=>{let t=nt.s;nt.s=!0;let n=it(...e);return nt.s=t,n};let it=(...e)=>nt.h.apply(nt.h,e);const ot=new Map,st=(e,t,n=!1)=>{let r=ot.get(e)||[];n?r=[t]:r.push(t),ot.set(e,r)},lt=(e,t)=>ot.has(e)?ot.get(e).forEach((e=>e(t))):void 0,ct={},ut=e=>(e&&(Object.assign(ct,e),lt("config",ct)),ct),dt=f(void 0),ht={id:f(0),name:f(""),chans:f([])};async function ft(){let e=await z("a");if(!e||e.byteLength<53)return;let t=new Uint8Array(e,0,16),n=new Uint8Array(e,16,32);t&&16===t.length&&(ht.salt=t),n&&32===n.length&&(ht.sskey=await crypto.subtle.importKey("raw",n,"AES-GCM",!1,["encrypt","decrypt"]));let r=new Uint8Array(e,48,4),a=new Uint8Array(e,52),i=new DataView(r.buffer).getInt32(48,!1),o=(new TextDecoder).decode(a);i&&o&&(ht.id(i),ht.name(o));let s=await z("c");return s&&s instanceof Array&&ht.chans(s),ht.salt}async function pt(e,t){let n=new TextEncoder,r=await mt(n.encode(e),n.encode(t));return await crypto.subtle.exportKey("raw",r)}async function mt(e,t){let n=await crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}const wt=document.location.hash.substr(1).match(/^ip\/(?<ip>[\:\.\d]+)$/);let yt="wss://"+(wt?wt.groups.ip:"192.168.100.11:443");window._ws=e=>(e&&("string"==typeof e&&(yt="wss://"+e),It(!0)),yt),window._ws=()=>vt,window._pc=()=>Lt,window._dc=()=>xt;let gt,vt,bt,Ct,Et,Lt,St,At,Tt,Ut,xt,Nt=500,kt=0,Ot=new Set,Dt={recv:e=>Ot.add(e)};It(),Rt();const jt=x();function It(e){gt=performance.now(),vt=new WebSocket(yt),vt.binaryType="arraybuffer",vt.onopen=()=>{e?Rt():Et&&Pt()},vt.onmessage=async e=>{let t=new Uint8Array(e.data),{a:n,k:r}=E(t);ut((e=>{const t=new c(e);return{z:t.get(0),m:t.get(1),c:t.get(2),d:t.get(3)}})(n));var a,i,o;r=await(a=r,crypto.subtle.importKey("raw",a,{name:"ECDH",namedCurve:"P-256"},!0,[])),Ut=await(i=Ct.privateKey,o=r,crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:o},i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])),Tt=new Uint8Array(await crypto.subtle.exportKey("raw",Ut));let s=JSON.parse((e=>(new TextDecoder).decode(Ze(e)))(n.slice(1))),l=s.answer?s.answer:s;if(await Lt.setRemoteDescription(new RTCSessionDescription(l)),!s.candidate)return;const u=new RTCIceCandidate({candidate:s.candidate,sdpMid:0,sdpMLineIndex:0});await Lt.addIceCandidate(u)},vt.onclose=e=>{kt++,Nt+=A(0,kt<16?200:3e3),setTimeout((()=>{It(!0)}),Nt)},vt.onerror=e=>{}}function Rt(){St=!1,Lt=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]}),Lt.onicecandidate=e=>{e.candidate},Lt.onconnectionstatechange=e=>{Lt.connectionState},Lt.oniceconnectionstatechange=e=>{Lt.iceConnectionState},xt=Lt.createDataChannel("cu",{}),xt.binaryType="arraybuffer",Dt.send=Mt,xt.onopen=e=>{jt.complete(xt)},xt.onmessage=_t,xt.onclose=e=>{},xt.onerror=e=>{},async function(){const e=async()=>{let e=await Lt.createOffer();return await Lt.setLocalDescription(e),Qe((new TextEncoder).encode(Lt.localDescription.sdp))},t=async()=>{if(At)return At;Ct=await(async()=>await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"]))();let e=await crypto.subtle.exportKey("raw",Ct.publicKey);return At=new Uint8Array(e),At};Et=await(async(e,t,n)=>{let[r,a,i]=await Promise.all([e(),t(),n()]);return i?C(C(r,a),i):U(C(r,a),64,24)})(e,t,ft),1===vt.readyState&&Pt()}()}async function Mt(e){await jt.join(),(e=>{e.length||e.byteLength})(e=We(e));let{z:t,m:n,c:r,d:a}=ut();if(t&&(e=Qe(e)),n&&(e=U(e,e.length),b(e,Tt)),r){const t=crypto.getRandomValues(new Uint8Array(12));b(e,t),e=T(t,new Uint8Array(await et(e,Ut,t)))}if(a){const t=crypto.getRandomValues(new Uint8Array(12));b(e,t),e=T(t,new Uint8Array(await et(e,ht.sskey,t)))}xt.send(e),bt=performance.now()}async function _t(e){let t=new Uint8Array(e.data),n=t.length,{z:r,m:a,c:i,d:o}=ut();if(o){let e=t.subarray(0,12);t=new Uint8Array(await tt(t.subarray(12),ht.sskey,e)),b(t,e)}if(i){let e=t.subarray(0,12);t=new Uint8Array(await tt(t.subarray(12),Ut,e)),b(t,e)}if(a){b(t,Tt);let{a:e}=E(t);t=new Uint8Array(e)}r&&(t=Ze(t));(100*n/t.length).toFixed(2);let s=Bt(t);Ot.forEach((e=>e(s)))}const Pt=()=>{St||(vt.send(Et),St=!0)},Bt=e=>Ge(e);function Kt(e,t,n){const{root:r,subscribe:a,sample:i,cleanup:o}=nt;null==n&&(n=!t.$t);let s=nt.h([]),l=nt.add(s,""),c=new Map,u=new Map,d=new Set;function h(e,a){if(null==e)return;let i=u.get(e);return 1===a?(d.delete(e),i||(i=n?r((n=>(c.set(e,n),t(e.$v||e)))):t(e.$v||e),11===i.nodeType&&(i=(e=>{const{childNodes:t}=e,{length:n}=t;if(n<2)return t[0];let r=Array.from(t);return{nodeType:111,t:r[0],o:r[n-1],l(){if(t.length!==n){let t=0;for(;t<n;)e.appendChild(r[t++])}return e}}})(i)||i),u.set(e,i))):-1===a&&d.add(e),((e,t)=>111===e.nodeType?1/t<0?t?nt.rm(e.t.parentNode,e.t.nextSibling,e.o.nextSibling)||e.t:e.o:t?e.l():e.t:e)(i,a)}function f(e){let t=c.get(e);t&&(t(),c.delete(e)),u.delete(e)}return o(a((t=>{let n=e();return i((()=>{d.clear();let e=Array.from(function(e,t,n,r,a){let i,o,s=new Map,l=new Map;for(i=0;i<t.length;i++)s.set(t[i],i);for(i=0;i<n.length;i++)l.set(n[i],i);for(i=o=0;i!==t.length||o!==n.length;){var c=t[i],u=n[o];if(null===c)i++;else if(n.length<=o)e.removeChild(r(t[i],-1)),i++;else if(t.length<=i)e.insertBefore(r(u,1),r(t[i],0)||a),o++;else if(c===u)i++,o++;else{var d=l.get(c),h=s.get(u);void 0===d?(e.removeChild(r(t[i],-1)),i++):void 0===h?(e.insertBefore(r(u,1),r(t[i],0)||a),o++):(e.insertBefore(r(t[h],1),r(t[i],0)||a),t[h]=null,h>i+1&&i++,o++)}}return n}(l.parentNode,t||[],n,h,l));return d.forEach(f),e}))}))),o((function(){c.forEach((e=>e())),c.clear(),u.clear(),d.clear()})),s}window._b=Dt;const qt="0VMZYpdgCGL3iKAzDHwocTt97e1hasO2mJNjExq4PvR6XyWSFbIn-5B_8fUukQlr",Ht=qt.split(""),Ft=new Array(123);for(let e=0;e<qt.length;e++)Ft[qt.charCodeAt(e)]=e;const $t=e=>{if(e<0)return"-"+$t(-e);let t=e>>>0,n=e/4294967296>>>0,r="";for(;n>0;)r=Ht[63&t]+r,t>>>=6,t|=(63&n)<<26,n>>>=6;let a="";do{a=Ht[63&t]+a,t>>>=6}while(t>0);return a+r};var Yt={ntob:$t,bton:e=>{let t=0;for(let n=0;n<e.length;n++)t=64*t+Ft[e.charCodeAt(n)];return t}};const Vt=[0,null,"🏠",0],Jt=(()=>{let e=Vt;const t=f([e]),n=t=>e=t;return{path:t=>e[t],paths:t,len:()=>t().length,setpath:n,same:t=>t===e,cd:e=>{let r=t();r[e[0]]!==e&&(r[e[0]]=e),r.splice(e[0]+1),t(r),n(e),location.hash=e[0]>0?Yt.ntob(e[3]):""},update:e=>{t([Vt,...e]),n(e[e.length-1]||Vt)}}})(),Xt=[];function zt(){!function(e){for(const t of Xt)t(e)}(document.location.hash.substr(1))}window.addEventListener("hashchange",zt),setTimeout(zt);const Gt=30,Wt=new Map,Zt=new Map,Qt=new Map,en=e=>(t,n)=>{if(!t)return e;let r=e.get(t);return n?r?r[n]:void 0:r},tn=f([]),nn=f([]),rn=f(0),an=f(0),on=f(0),sn=f(0),ln=f(""),cn=f(""),un=f(!1),dn=f(!1),hn=en(Wt),fn=en(Zt),pn=en(Qt),mn=(()=>{const e={},t={};return{create:n=>t[n]=new Promise((t=>e[n]=t)),complete:(t,n)=>e[t]?e[t](n):null,join:e=>t[e],joinall:(...e)=>Promise.all(e.map((e=>t[e]))),select:(...e)=>Promise.race(e.map((e=>t[e])))}})();Dt.recv((async e=>{switch(e.tag){case"Login":if(!e.value)return dt(void 0),void lt("login",!1);await async function({data:e,chans:t}){let n=new Uint8Array(e.slice(16,20)),r=new Uint8Array(e.slice(20)),a=new DataView(n.buffer).getInt32(0,!1),i=(new TextDecoder).decode(r);ht.id(a),ht.name(i),ht.chans(t),ht.salt=new Uint8Array(e.slice(0,16)),ht.sskey=await mt(dt(),ht.salt),dt(void 0);let o=new Uint8Array(await crypto.subtle.exportKey("raw",ht.sskey)),s=ht.salt.length,l=new Uint8Array(s+o.length+n.length+r.length);l.set(ht.salt),l.set(o,s),l.set(n,s+o.length),l.set(r,s+o.length+n.length),P("a",l.buffer),ut({d:!0}),P("c",t),H("users",{id:a,name:i})}(e.value),lt("login",!0);break;case"Users":K("users",e.value),mn.complete("users",e.value);break;case"Chans":K("chans",e.value),mn.complete("chans",e.value);break;case"Chat":let t=nn();if(t.includes(e.value.id))return;let n=window.scrollY+window.innerHeight===document.body.scrollHeight;await H("chats",e.value);let r=new Set(pn().has(e.value.by)?[]:[e.value.by]),a=e.value.dir.filter((e=>!hn(e))),i=new Set(a);await vn(r,i),e.value.nor=f(0),e.value.star=f(!1),e.value.txt=f(e.value.txt),fn().set(e.value.id,e.value),t.push(e.value.id),nn(t),n&&y();break;case"Chats":if(0===e.value.length)return;K("chats",e.value),mn.complete("chats",e.value);break;case"ChatScan":let o=e.value||[],s=rn();if(0===o.length)return un(!0),V(s,null,!0),void mn.complete("chatscan",o);un(!1),V(s,[o[0],o[o.length-1]]);let l=o.map((e=>({chanid:s,chatid:e})));K("chanchats",l),mn.complete("chatscan",o);break;case"ChanScan":let c=e.value||[];c.length>0?(dn(!1),await Cn(c)):dn(!0),mn.complete("chanscan",c);break;case"ChanJoin":mn.complete("chanjoin",e.value);break;case"DelChat":xn(e.value);break;case"EditChat":let{id:u,txt:d}=e.value,h=fn(u);h&&h.txt(d),h=await G(u,"chats"),h&&(h.txt=d,await H("chats",h))}}));const wn="/"+qt;(e=>{Xt.push(e)})((async e=>{if(!e||!wn.includes(e[0]))return rn(0),bn([]),document.title="sonic",Un(),void(document.getElementsByClassName("tbl").length>0&&An(0));if("/"===e[0]){let t=Yt.bton(e.slice(1));an(t),await gn([t]),Un();let n=fn(t).dir;return await Cn(n),bn(n),void(document.title=hn(rn(),"fullname")+" - sonic")}let t=Yt.bton(e);rn(t),Un(),await Cn([t]);let n=hn(t).dir;await Cn(n),bn([...n,t]),document.getElementsByClassName("tbl").length>0&&An(Jt.path(3)),document.title=hn(rn(),"fullname")+" - sonic"}));const yn=async(e,t=null)=>{await gn(e);let n=e[0],r=new Set,a=new Set,i=nn(),o=new Set;switch(e.forEach((e=>{let t=fn(e);t.txt=f(t.txt),t.nor=f(t.nor),t.star=f(!1),"string"==typeof t.timestamp&&(t.timestamp=new Date(t.timestamp)),pn().has(t.by)||r.add(t.by),t.dir.forEach((e=>{hn().has(e)||a.add(e)})),o.has(e),o.add(e)})),await vn(r,a),e.reverse(),t){case"re":nn(e);break;case"pre":nn(i.concat(e));break;default:nn(e.concat(i))}o=new Set,nn().forEach((e=>{o.has(e),o.add(e)})),n&&lt("keysloaded",n)},gn=async e=>{if(0===(e=e.filter((e=>!fn().has(e)))).length)return;let{value:t,missed:n}=await F("chats",e);if(w(t,fn()),n.length>0){let e=await mn.create("chats",Dt.send(Z.Chats(n)));w(e,fn())}},vn=async(e,t)=>{let n=await F("users",Array.from(e)),r=await F("chans",Array.from(t));w(n.value,pn()),w(r.value,hn()),n.missed.length>0&&mn.create("users",Dt.send(Z.Users(n.missed))),r.missed.length>0&&mn.create("chans",Dt.send(Z.Chans(r.missed)));let[a,i]=await mn.joinall("users","chans");a&&w(a,pn()),i&&w(i,hn())},bn=e=>{let t=e.map(((e,t)=>{let n=hn(e)||{};return[t+1,n.mom,n.name,e]}));Jt.update(t)},Cn=async e=>{if(0===(e=e.filter((e=>!hn().has(e)))).length)return;let{value:t,missed:n}=await F("chans",e);if(w(t,hn()),n.length>0){let e=await mn.create("chans",Dt.send(Z.Chans(n)));w(e,hn())}};let En=null;const Ln=async(e,t=null,n=null)=>{performance.now();let r=await((e,t=null,n=null,r=null,a=null)=>{t&&cn(t);let i=Z.ChanScan({filter:Sn(e),kw:t,ub:n,lb:r,limit:a});return mn.create("chanscan",Dt.send(i))})(e,t,n);n?0===r.length||tn(tn().concat(r)):(0!==r.length||t||lt("nochan"),tn(r))},Sn=e=>(En=e,"number"==typeof e?W.Chanid(e):null),An=async e=>{En!==e&&Ln(e)},Tn=(e=null,t=null,n=null)=>{let r=Z.ChatScan({filter:an()>0?W.Id(an()):rn()>0?W.Chanid(rn()):ht.id()>0?W.By(ht.id()):null,kw:null,ub:e,lb:t,limit:n});return mn.create("chatscan",Dt.send(r))};async function Un(){un(!1),sn(!1),on(0);let e=rn();performance.now();let t=(await J(e)||[])[0]||null,n=await Y(W.Chanid(e),null,Gt);await yn(n,"re"),sn(!0),lt("reloaded");let r=await Tn(null,t)||[];await yn(r,r.length!==Gt&&0!==n.length&&t?"pre":"re"),lt("reloaded")}async function xn(e){let t=fn(e)||await G(e,"chats");t&&await(async({id:e,dir:t})=>{let n=await D.join();if(!n)return;let r=[0,...t];!function(e,t){t.forEach((async t=>{let n=await J(t);n&&n.includes(e)&&X(t)}))}(e,r),function(e,t){let r=n.transaction(["chanchats"],"readwrite").objectStore("chanchats");t.forEach((t=>{let n=IDBKeyRange.only([t,e]);r.delete(n).onerror=console.error}))}(e,r),function(...e){let t=n.transaction(["chats"],"readwrite").objectStore("chats");e.forEach((e=>{t.delete(e).onerror=console.error}))}(e)})(t),Zt.delete(e);let n=nn(),r=n.indexOf(e);r>-1&&(n.splice(r,1),nn(n))}window._chn=()=>Array.from(Wt.values()),window._ch=()=>Array.from(Zt.values()),window._us=()=>Array.from(Qt.values()),window._chns=()=>tn().map((e=>Wt.get(e))),window._chs=()=>nn().map((e=>Zt.get(e))),window._chnid=rn,window._chid=an,window._curid=on,window._curtxt=ln,window._chnkw=cn;const Nn=()=>{const e=document.createElement("div");e.contentEditable=!0,e.className="s-c",e.oninput=({target:{firstChild:t}})=>{var n,r,a,i;(n=function(){let t=e.textContent;var n;t.length>50||(n=t,Ln(Jt.path(3),n))},r=100,function(){var e=this,t=arguments,o=function(){i=null,a||n.apply(e,t)},s=a&&!i;clearTimeout(i),i=setTimeout(o,r),s&&n.apply(e,t)})()},e.onkeydown=e=>{"Enter"!==e.key||e.shiftKey||e.preventDefault()};const t=(e,t)=>{if(e.stopPropagation(),!ht.id())return alert("you are not login!");ht.chans().includes(t)?(async e=>{performance.now();let t=await mn.create("chanjoin",Dt.send(Z.ChanLeave(e)));if(!t)return;let n=ht.chans();if(!n.includes(t))return;const r=n.indexOf(t);r>-1&&n.splice(r,1),ht.chans(n),await P("c",n),await q(0,e),Un()})(t):(async e=>{performance.now();let t=await mn.create("chanjoin",Dt.send(Z.ChanJoin(e)));if(!t)return;let n=ht.chans();n.includes(t)||(n.push(t),ht.chans(n),await P("c",n),await q(0),Un())})(t)};let n=it("div",null);setTimeout((function(){new IntersectionObserver((t=>{if(t[0].intersectionRatio<=0)return;let n=tn(),r=n[n.length-1];if(!r||dn()||n.length<Gt)return;let a=e.textContent||null;a&&a.length>50||setTimeout((()=>Ln(Jt.path(3),a,r)))}),{}).observe(n)}));return it([it("div",{class:"s"},e),it("div",{class:"tbl"},it("table",null,it("tbody",null,Kt(tn,(e=>{let n=hn(e);return it("tr",{onclick:()=>(async({id:e,mom:t,name:n})=>{await Ln(e),Jt.cd([Jt.path(0)+1,t,n,e])})(n)},it("td",null,it("button",{onclick:n=>t(n,e)},(()=>ht.chans().includes(e)?"✅":"➕"))),it("td",null,n.fullname))})),(()=>tn().length>0?null:it("tr",null,it("td",null,"no result"))),n))),it("div",{class:"grid"},it("div",{class:"container"},it("ol",{class:"bc"},it("li",null,it("a",{href:"#"},"#")," ",it("a",{href:"#"},"rust")),it("li",{class:"active relative drop-container"},it("a",null,"general"),it("div",{class:"drop"},it("ul",{class:"list"},it("li",null,it("a",{href:"#"},"security")),it("li",null,it("a",{href:"#"},"random")),it("li",null,it("a",{href:"#"},"backend")),it("li",null,it("a",{href:"#"},"compiler")),it("li",null,it("a",{href:"#"},"gamedev"))))))))])};var kn={date:"1/8/2021, 1:58:18 AM",build:"d95b974",ver:"0.0.39"};let On;async function Dn(){await Dt.send(Z.Logout(Array.from(ht.salt))),await B(),ut({d:!1}),ht.id(0),ht.name(""),ht.chans([]),ht.sskey=void 0,ht.salt=void 0,Un(),Ln(Jt.path(3)),lt("logout")}st("config",(({d:e})=>Mn(e?Rn:In))),st("login",(e=>{e&&(Un(),Ln(Jt.path(3)))}));const jn=()=>it("div",{class:"login"},it(v(Mn),null),it("div",{class:"v"},kn.ver," ",kn.build)),In=()=>it([it("h2",null,"Login"),it("form",{onsubmit:function(e){e.preventDefault();let{m:t,p:n}=e.target;!async function(e,t){On=performance.now(),await B();let n=await pt(t,e),r={email:e,key:Array.from(new Uint8Array(n))};dt(n),Dt.send(Z.Login(r))}(t.value,n.value)}},it("input",{type:"text",name:"m",placeholder:"email",required:!0,autocomplete:"true"}),it("input",{type:"password",name:"p",placeholder:"password",required:!0,autocomplete:"true"}),it("button",{type:"submit"},"Login")),it("h2",null,"Register"),it("form",{onsubmit:function(e){e.preventDefault();let{m:t,n:n,p:r}=e.target;!async function(e,t,n){On=performance.now(),await B();let r=await pt(n,e),a={email:e,name:t,key:Array.from(new Uint8Array(r))};dt(r),Dt.send(Z.AddUser(a))}(t.value,n.value,r.value)}},it("input",{type:"text",name:"m",placeholder:"email",required:!0,autocomplete:"true"}),it("input",{type:"text",name:"n",placeholder:"name",required:!0,autocomplete:"true"}),it("input",{type:"password",name:"p",placeholder:"password",required:!0,autocomplete:"true"}),it("button",{type:"submit"},"Register"))]),Rn=()=>it([it("div",null,"You have logged in as ",it("b",null,ht.name)),it("button",{onclick:Dn},"Logout")]),Mn=f((()=>null));window._v=()=>kn;const _n="defaultParagraphSeparator",Pn="formatBlock",Bn=(e,t,n)=>e.addEventListener(t,n),Kn=(e,t)=>e.appendChild(t),qn=e=>document.createElement(e),Hn=e=>document.queryCommandState(e),Fn=(e,t=null)=>document.execCommand(e,!1,t),$n={bold:{icon:"<b>B</b>",title:"Bold",state:()=>Hn("bold"),result:()=>Fn("bold")},italic:{icon:"<i>I</i>",title:"Italic",state:()=>Hn("italic"),result:()=>Fn("italic")},underline:{icon:"<u>U</u>",title:"Underline",state:()=>Hn("underline"),result:()=>Fn("underline")},strikethrough:{icon:"<strike>S</strike>",title:"Strike-through",state:()=>Hn("strikeThrough"),result:()=>Fn("strikeThrough")},heading1:{icon:"<b>H1</b>",title:"Heading 1",result:()=>Fn(Pn,"<h1>")},heading2:{icon:"<b>H2</b>",title:"Heading 2",result:()=>Fn(Pn,"<h2>")},quote:{icon:"&#8220;&#8221;",title:"Quote",result:()=>Fn(Pn,"<blockquote>")},olist:{icon:"1.",title:"Ordered List",result:()=>Fn("insertOrderedList")},ulist:{icon:"&#8226;",title:"Unordered List",result:()=>Fn("insertUnorderedList")},code:{icon:"&lt;&gt;",title:"Code",result:()=>Fn(Pn,"<pre>")},line:{icon:"&#8213;",title:"Horizontal Line",result:()=>Fn("insertHorizontalRule")},link:{icon:"&#128279;",title:"Link",result:()=>{const e=window.prompt("Enter the link URL");e&&Fn("createLink",e)}},image:{icon:"&#128247;",title:"Image",result:()=>{const e=window.prompt("Enter the image URL");e&&Fn("insertImage",e)}}},Yn={actionbar:"e-a",button:"e-b",content:"e-c",selected:"e-bs",topic:"e-t"};function Vn(){return window.scrollY+window.innerHeight===document.body.scrollHeight}const Jn=({topic:e,content:t})=>{if(!ht.id())return alert("you are not login!");if(!t.textContent.trim())return;let n=on()||nn()[nn().length-1],r=null;if(!n||e.textContent!==ln()){if(r=e.textContent,0===r.trim().length)return alert("topic should not be empty"),!1;n=null}let a=t.innerHTML.trim();Dt.send(Z.AddChat({txt:a,re:n,chname:r})),t.textContent="",Xn({},{topic:e})},Xn=({id:e,txt:t},{topic:n})=>{if(!e||on()===e)return n.textContent="",ln(""),void on(0);n.innerHTML=t(),n.textContent=n.textContent,ln(n.textContent),on(e)};st("keysloaded",(e=>{document.getElementById(Yt.ntob(e)).scrollIntoView()})),st("reloaded",(()=>{setTimeout((()=>{window.innerHeight-document.getElementsByClassName("cs")[0].clientHeight>110?document.body.classList.add("fx"):document.body.classList.remove("fx")}))}));const zn=()=>{const e=(e=>{const t=e.actions?e.actions.map((e=>"string"==typeof e?$n[e]:$n[e.name]?{...$n[e.name],...e}:e)):Object.keys($n).map((e=>$n[e])),n={...Yn,...e.classes},r=e.defaultParagraphSeparator||"div",a=e.element.topic=qn("div");a.contentEditable=!0,a.className=n.topic,a.onkeydown=e=>{"Enter"===e.key&&(i.focus(),e.preventDefault())},Kn(e.element,a);const i=e.element.content=qn("div");i.contentEditable=!0,i.className=n.content,i.onfocus=()=>{let e=Vn();document.body.classList.add("ed"),e&&setTimeout((()=>y()))},i.onblur=()=>{setTimeout((()=>{e.element.contains(document.activeElement)||document.body.classList.remove("ed")}))},i.oninput=({target:{firstChild:t}})=>{e.oninput(i.innerHTML)},i.onkeydown=t=>{"Enter"===t.key&&(Vn()&&setTimeout((()=>y())),t.shiftKey||(e.onsend({topic:a,content:i}),t.preventDefault()))},Kn(e.element,i);const o=qn("div");return o.className=n.actionbar,Kn(e.element,o),t.forEach((e=>{const t=qn("button");if(t.className=n.button,t.innerHTML=e.icon,t.title=e.title,t.setAttribute("type","button"),t.onclick=()=>e.result()&&i.focus(),e.state){const r=()=>t.classList[e.state()?"add":"remove"](n.selected);Bn(i,"keyup",r),Bn(i,"mouseup",r),Bn(t,"click",r)}Kn(o,t)})),e.styleWithCSS&&Fn("styleWithCSS"),Fn(_n,r),e.element})({element:it("div",{class:"e"}),oninput:e=>{},onsend:Jn}),t=f(0),n=e=>{let{id:n,txt:a,by:o,chanid:l,re:u,star:d,nor:h}=e,f=nn(),p=hn(l);let m=f[f.indexOf(n)-1],w=fn(m)||{},y=w.by!==o,g=!u||w.chanid!==l,v=Yt.ntob(n),b=Yt.ntob(p.id);const C=()=>{c("#/"+v,v)},E=(e,t)=>{c("#"+t,t),e.preventDefault()};return it("div",{id:v,class:function(){return"c"+(()=>(d()?" star":"")+(g?" t":"")+(on()===n?" cur":"")).call(this)},onclick:t=>s(t,e),onmouseover:e=>t()!==n&&t(n)},g?it("div",{class:"tn"+(u?" re":" nw")},it("a",{href:function(){return"#"+("function"==typeof b?b.call(this):b)},onclick:e=>E(e,b),innerHTML:hn(p.id,"fullname")}),it("div",{class:"dr"},Kt((()=>[...p.dir.slice(Jt.len()-1)]),(e=>{let t=Yt.ntob(e);return it("span",null,it("a",{href:function(){return"#"+("function"==typeof t?t.call(this):t)},onclick:e=>E(e,t),innerHTML:hn(e,"name")}))})))):null,y||g?it("div",{class:"by"},pn(o).name):null,it("div",{onclick:e=>e.stopPropagation()},(()=>{let e=h();if(1!==e||n!==fn(nn()[i+1]).re)return e>0?it([it("span",{class:"rep",onclick:C},e," ↩️")," "]):void 0}),it("div",{class:"ct"},(()=>(e=>document.createRange().createContextualFragment(e))(a())))),(()=>t()===n?r(v,e):null))},r=(t,n)=>it([it("div",{class:"pm pr",onclick:t=>Xn(n,e)},"↩️"),it("div",{class:"pm"},"💬",it("div",{class:"pu"},it("div",{onclick:e=>a(t,n)},"✏️ edit"),it("div",{onclick:e=>o(n)},"❌ delete")))]),a=(e,t)=>{let n=document.getElementById(e).querySelector(".ct");if("true"==n.contentEditable)return n.contentEditable=!1,void n.classList.remove("ce");n.contentEditable=!0,n.focus(),n.classList.add("ce"),n.oninput=e=>{},n.onkeydown=e=>{"Enter"===e.key&&(e.shiftKey||(e.preventDefault(),function(e,t){Dt.send(Z.EditChat({id:e,txt:t}))}(t.id,n.innerHTML.trim()),n.contentEditable=!1,n.classList.remove("ce")))}},o=({id:e,txt:t})=>{confirm('Do you want to delete this chat? \n"'+t()+'"')&&function(e){Dt.send(Z.DelChat(e)),xn(e)}(e)},s=(e,t)=>{e.x<18&&e.offsetY<22&&l(t)},l=({id:e,star:t})=>{const n=nn().filter((t=>t===e))[0],r=fn(n);r.star?r.star(!t()):r.star=f(!1)},c=(e,t)=>{let n=screen.width/2-300,r=screen.height/2-300;window.open(e,t,`toolbar=yes,location=yes,status=no,menubar=yes,scrollbars=yes,resizable=yes,width=600,height=600,top=${r}, left=${n}`)},u=it("div",null);return setTimeout((function(){new IntersectionObserver((e=>{if(e[0].intersectionRatio<=0)return void(document.body.classList.contains("fx")&&(document.body.classList.remove("fx"),y()));if(!sn())return;!nn()[0]||un()||nn().length<Gt||setTimeout((()=>{if(!sn())return;let e=nn()[0];!e||un()||nn().length<Gt||(async e=>{let t=rn();performance.now();let n=await J(t)||[];if(n[2]&&e===n[1])return void un(!0);un(!1);let r=await Y(W.Chanid(t),e,Gt);if(n[2]||r.length===Gt)return void await yn(r);let a=await Tn(e);a.length>0&&await yn(a)})(e)}))}),{}).observe(u)})),it([it("div",{class:"cs"},u,Kt(nn,(e=>n(fn(e))))),e])},Gn=()=>{},Wn=f(Gn);document.querySelector("body").append((()=>{st("login",(e=>e&&Wn(Gn))),st("logout",(()=>Wn(Gn))),st("nochan",(()=>Wn(Gn)));return it([it("div",{class:"n"},it("div",null,it("ol",{class:"bc"},(()=>Kt(Jt.paths,(e=>it("li",null,it("a",{onclick:t=>(e=>{Wn()!==Nn?e[0]===Jt.len()-1?Wn(Nn):Jt.cd(e):Jt.same(e)&&Wn(Gn),Jt.setpath(e),Wn()===Nn&&An(e[3])})(e)},e[2])))))),it("div",{class:"m"},it("a",{onclick:e=>{Wn()===jn?Wn(Gn):Wn(jn)}},(()=>ht.name()||"login")))),it(v(Wn),null)),zn])})())}();</script></body></html>