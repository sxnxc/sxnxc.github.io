<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>sonic</title><style type="text/css">*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif;font-size:14px;line-height:1.5}:focus{outline:0}body{margin:0;padding-top:33px}table{border-collapse:collapse;text-align:left;width:100%}table tr{background:#fff;border-bottom:1px solid}table thead{border:1px solid #ddd}table td span{background:#eee;color:#696969;display:none;font-size:10px;font-weight:700;padding:5px;position:absolute;text-transform:uppercase;top:0;left:0}a{text-decoration:none;cursor:pointer}a:hover{text-decoration:underline}button{padding:3px 15px;cursor:pointer;border:1px solid #ddd;background:#efefef}h1{font-size:1.9em}h1,p{margin:.3em 0}td,th{border:1px solid #ddd;padding:.5em 5px;cursor:pointer}th{text-transform:capitalize;background:#f4f4f4;font-weight:400}.by{float:left;color:#262626;font-weight:600;margin-right:4px}.n{user-select:none;border:1px solid rgba(10,10,10,.1);background:#f5f5f5;position:fixed;width:100%;top:0;z-index:1}.n>div:first-child{padding:5px 15px}.m{position:absolute;top:0;right:0;margin:5px 15px 0 5px;max-width:100px;overflow:hidden;text-overflow:ellipsis}.tn{color:#aaa;width:fit-content;padding-bottom:5px}.tn>a{color:#00e;max-width:400px;font-size:14px;margin-right:10px}.dr a{color:#aaa;cursor:pointer;max-width:50px;display:inline-block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:-5px;font-size:12px}.dr span:last-child a{max-width:200px}.dr span:only-child a{max-width:400px}.dr span>a:hover{color:#000;max-width:300px}.dr>span+span:before{padding:0;color:#ccc;content:"/ "}.re:before{content:"↩️ "}.nw:before{content:"📢 "}.nw{color:grey}.fx .cs{position:absolute;bottom:68px;max-height:100%;width:100%}.ed .cs{bottom:103px}.e{border:1px solid rgba(10,10,10,.1);position:sticky;width:100%;bottom:0;background:#f9f9f9}.fx .e{position:fixed}.e-c{cursor:text;overflow-y:auto;padding:7px 10px;white-space:pre-wrap;word-wrap:break-word}.e-a{user-select:none;background:#fff;border-bottom:1px solid rgba(10,10,10,.1)}.e-b{background:transparent;border:none;width:30px;height:30px;vertical-align:bottom;margin:0;padding:0}.e-bs{background:#f0f0f0}.e-c[contenteditable]:empty:before{content:"Write a message...";color:#aaa}.e-t{display:none;overflow:hidden;padding:7px 10px;color:grey;white-space:nowrap}.e-t:focus{white-space:normal}.ed .e-t{display:block}.e-t[contenteditable]:empty:before{content:"New topic";color:#aaa}blockquote{width:fit-content;margin:0;padding:10px;background:#eee;border-radius:5px}blockquote:before{content:"\201C"}blockquote:after{content:"\201D"}.c{padding:2px 15px;position:relative;white-space:pre-wrap}.c.cur,.c:hover{background:#f9f9f9}.c.t{padding-top:5px;margin-top:2px}.c:before{font-size:.9em;position:absolute;margin-top:2px;margin-left:-14px;cursor:pointer;color:#666}.c:hover:before{content:"☆"}.c.star:before{content:"🌟"!important}.pm,.pr{display:none;cursor:pointer;color:#666;position:absolute;right:15px;top:-10px;padding:0 5px;border:1px solid rgba(10,10,10,.1);border-radius:3px;background:#fff;z-index:1;user-select:none}.pm:hover{background:#eee}.pr{right:42px}.c:hover .pm{display:unset}.pu{display:none;position:absolute;border:1px solid rgba(10,10,10,.1);border-radius:3px;background:#fff;z-index:1;user-select:none;right:0;margin-top:1px}.c:last-child .pu{bottom:23px}.pu div{font-size:12px;white-space:nowrap;padding:3px 5px}.pu div:hover{background:#eee}.pm:hover .pu{display:block}.rep{font-size:.85em;color:grey;cursor:pointer;width:fit-content}.ct{border:1px solid hsla(0,0%,100%,0)}.ce{background:#f9f9f9;border:1px solid rgba(10,10,10,.1)}@media (max-width:600px){.e-t{font-size:12px;padding:5px 10px}.e-b,.e-b b,i,strike,u{font-size:.85em;width:26px;height:26px}}.login{border-top:1px solid rgba(10,10,10,.1);padding:10px 15px 30px}.login input{display:block;margin:5px 0;min-width:200px}.bc{padding:0;list-style:none;white-space:nowrap;overflow:hidden;margin:0 40px 0 0}.grid .bc{display:block;padding:8px 15px;border-radius:4px;background-color:#f5f5f5;margin-right:0}.bc>li{cursor:pointer;display:inline-block;overflow:hidden;text-overflow:ellipsis;max-width:100px;margin-bottom:-5px}.bc>li:hover{max-width:unset}.bc>li+li:before{padding:0 0 0 5px;color:#ccc;content:"/\00a0"}.bc>li:last-child{max-width:unset}.bc>li:only-child:after{padding:0 0 0 5px;color:#ccc;content:"/\00a0 .."}ol,ul{margin-top:0}.relative{position:relative}.drop-container:hover .drop{display:block}.drop-container .drop{display:none;position:absolute;top:20px;left:0;min-width:120px;max-width:300px;background:#f5f5f5}.drop-container .drop a{display:block;padding:8px 13px;white-space:nowrap}.list{list-style-type:none;padding-left:0}li{display:list-item}.s{border-top:1px solid rgba(10,10,10,.1);background:#f9f9f9}.s-c{font-size:13px;cursor:text;overflow-y:auto;padding:5px 10px;white-space:pre-wrap;word-wrap:break-word}.s-c[contenteditable]:empty:before{content:"Search keyword...";color:#aaa}.tbl{overflow-y:scroll;max-height:40vh;border-top:1px solid #ddd}table td{border:none;border-bottom:1px solid #ddd;padding:3px;font-size:13px;white-space:nowrap}table tr td:first-child{width:26px}table td button{padding:1px 10px;font-size:10px}table tr:hover{background:#f5f5f5}.v{font-size:9px;color:#aaa;float:right;font-family:Menlo,monospace}</style></head><body><script src="https://cdn.jsdelivr.net/npm/zlibjs@0.3.1/bin/zlib.min.js"></script><script>!function(){"use strict";const e=[];function t(t){let n={};return function(){const i=e.slice.call(arguments),o=i.map((e=>{if(a(e)||Array.isArray(e)){let t={};for(let n in e)t[n]=r(e[n]);return t}return r(e)})),l=JSON.stringify(o);let s=n[l];return void 0===s&&(s=t.apply(this,i),s&&11===s.nodeType&&(s=e.slice.call(s.childNodes)),n[l]=s),s}}let n=0;function r(e){return"function"==typeof e||e instanceof Node?(e.$m||(e.$m=++n),{$m:e.$m}):e}function a(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function o(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var l,s,c=o((function(e,t){function n(e){var t=e>>3;return e%8!=0&&t++,t}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===e&&(e=0);var r=null==t?void 0:t.grow;this.grow=r&&isFinite(r)&&n(r)||r||0,this.buffer="number"==typeof e?new Uint8Array(n(e)):e}return e.prototype.get=function(e){var t=e>>3;return t<this.buffer.length&&!!(this.buffer[t]&128>>e%8)},e.prototype.set=function(e,t){void 0===t&&(t=!0);var n=e>>3;if(t){if(this.buffer.length<n+1){var r=Math.max(n+1,Math.min(2*this.buffer.length,this.grow));if(r<=this.grow){var a=new Uint8Array(r);a.set(this.buffer),this.buffer=a}}this.buffer[n]|=128>>e%8}else n<this.buffer.length&&(this.buffer[n]&=~(128>>e%8))},e.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=8*this.buffer.length);for(var r=t,a=r>>3,i=128>>r%8,o=this.buffer[a];r<n;r++)e(!!(o&i),r),i=1===i?(o=this.buffer[++a],128):i>>1},e}();t.default=r}(s={path:l,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&s.path)}},s.exports),s.exports));let u,d=[];function h(e){let t=u,n=()=>{};u=n,m(n);let r=e((()=>{p(n),u=void 0}));return u=t,r}function f(e){function t(n){if(0===arguments.length)return u&&!t.__o.has(u)&&(t.__o.add(u),u.u.push(t)),e;e=n;let r=u;return u=void 0,t.o=new Set(t.__o),t.o.forEach((e=>e.i=!1)),t.o.forEach((e=>{e.i||e()})),u=r,e}return t.$o=1,t.__o=new Set,t.t=d,t}function p(e){e.__c.forEach(p),e.u.forEach((t=>{t.__o.delete(e),t.o&&t.o.delete(e)})),e.l.forEach((e=>e())),m(e)}function m(e){e.u=[],e.__c=[],e.l=[]}const w=(e,t)=>e.reduce(((e,t)=>(e.set(t.id,t),e)),t),y=()=>window.scrollTo(0,document.body.scrollHeight),g=t((e=>t(((t,n)=>h((()=>e(t,n))))))),v=e=>(t,...n)=>()=>g(e())(t,n),b=(e,t)=>{let n=0,r=0;for(;n<e.length;)r>=t.length&&(r=0),e.set([e[n]^t[r]],n),n++,r++},C=(e,t)=>(b(e,t),S(e,t)),E=e=>{let{a:t,k:n}=L(e);return b(t,n),{a:t,k:n}},L=e=>{let t=e[0],n=e.subarray(1,t+1);return{a:e.subarray(t+1),k:n}},S=(e,t)=>{let n=new Uint8Array(1+t.length+e.length);return n[0]=t.length,n.set(t,1),n.set(e,1+t.length),n},A=(e,t)=>(e=Math.ceil(e),Math.floor(Math.random()*(Math.floor(t)-e)+e)),T=(e,t)=>{let n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n},U=(e,t=64,n=8)=>C(e,crypto.getRandomValues(new Uint8Array(A(n,t)))),x=()=>{let e,t=new Promise((t=>e=t));return{complete:t=>e(t),join:()=>t}},N=navigator.vendor.includes("Apple")?{transaction:()=>{}}:openDatabase("sonic","1.0","sonic",1073741824);function k(e,t){}function O(e,t){}N.transaction((e=>{e.executeSql("CREATE TABLE IF NOT EXISTS users (\n            id integer NOT NULL PRIMARY KEY,\n            name varchar(50) NOT NULL\n        )",[],k,O),e.executeSql("CREATE TABLE IF NOT EXISTS userchans (\n            id integer NOT NULL PRIMARY KEY\n        )",[],k,O),e.executeSql("CREATE TABLE IF NOT EXISTS chans (\n            id integer NOT NULL PRIMARY KEY,\n            name varchar(50) NOT NULL,\n            fullname varchar(150) NOT NULL,\n            mom integer NOT NULL,\n            by integer NOT NULL,\n            dir text NOT NULL,\n            ispub boolean NOT NULL DEFAULT '0',\n            isprv boolean NOT NULL DEFAULT '0',\n            timestamp datetime NOT NULL DEFAULT CURRENT_TIMESTAMP\n        )",[],k,O),e.executeSql("CREATE TABLE IF NOT EXISTS chats (\n            id integer NOT NULL PRIMARY KEY,\n            txt text NOT NULL,\n            by integer NOT NULL,\n            re integer NOT NULL,\n            nor integer NOT NULL DEFAULT '0',\n            chanid integer NOT NULL,\n            dir text NOT NULL,\n            status integer NOT NULL DEFAULT '0',\n            timestamp datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            star boolean\n        )",[],k,O),e.executeSql("CREATE TABLE IF NOT EXISTS chanchats (\n            chanid integer NOT NULL,\n            chatid integer NOT NULL,\n            PRIMARY KEY (chanid, chatid)\n        )",[],k,O)}));const j=()=>{N.transaction((e=>{e.executeSql("SELECT * FROM sqlite_master WHERE type = 'table' AND name NOT LIKE '\\_%' escape '\\'",[],((e,t)=>{var n,r,a;function i(){}for(r=(n=t.rows).length;r--;)a=n.item(r).name,e.executeSql("DROP TABLE "+a,[],i,console.error)}),console.error)}))};window._qd=j,window._q=(e,t=[])=>{N.transaction((n=>{n.executeSql(e,t,((e,t)=>{}),console.error)}))};var D={date:"1/8/2021, 3:06:54 AM",build:"46898d2",ver:"0.0.42"};const I=x(),R="sonic",_=["session","chats","users","chans","ranges","chanchats"];let M;localStorage.getItem("_")!==D.ver&&(localStorage.setItem("_",D.ver),B(R),j()),window._d=()=>B(R);let P=indexedDB.open(R,1);function B(e){var t=window.indexedDB.deleteDatabase(e);t.onerror=e=>{},t.onsuccess=e=>{}}P.onsuccess=e=>{M=P.result,function(e){let t=e.objectStoreNames;for(const e of _)if(!t.contains(e))return void B(R)}(M),I.complete(M),P.open?P.open():P.open=!0},P.onerror=e=>{I.complete()},P.onblocked=e=>{},P.onupgradeneeded=e=>{M=P.result;let t=M.objectStoreNames;if(!t.contains("session")){M.createObjectStore("session")}if(!t.contains("ranges")){M.createObjectStore("ranges")}if(!t.contains("chats")){let e=M.createObjectStore("chats",{keyPath:"id"});e.createIndex("chanid",["chanid","id"],{unique:!1}),e.createIndex("re",["re","id"],{unique:!1}),e.createIndex("by",["by","id"],{unique:!1})}if(!t.contains("users")){M.createObjectStore("users",{keyPath:"id"})}if(!t.contains("chans")){M.createObjectStore("chans",{keyPath:"id"}).createIndex("mom",["mom","id"],{unique:!1})}if(!t.contains("chanchats")){M.createObjectStore("chanchats",{keyPath:["chanid","chatid"]})}for(const e of _)M.objectStoreNames.contains(e)||M.createObjectStore(e)};const K=async(e,t)=>{let n=await I.join();n&&n.transaction(["session"],"readwrite").objectStore("session").put(t,e)},q=async()=>{let e=await I.join();e&&(e.transaction(["session"],"readwrite").objectStore("session").clear(),await F(0))},H=async(e,t)=>{let n=await I.join();if(!n)return;let r=n.transaction([e],"readwrite").objectStore(e);t.forEach((e=>{"string"==typeof e.timestamp&&(e.timestamp=new Date(e.timestamp)),r.add(e).onerror=console.error})),N.transaction((n=>{t.forEach((t=>{let r=Object.keys(t),a=`INSERT OR REPLACE INTO ${e} (${r.join(",")}) VALUES (${Array(r.length).fill("?").join(",")})`;n.executeSql(a,Object.values(t).map((e=>"function"==typeof e?e():e)),k,O)}))}))},F=async(...e)=>{let t=await I.join();t&&(await G(...e),function(e){let n=t.transaction(["chanchats"],"readwrite").objectStore("chanchats");e.forEach((e=>{let t=IDBKeyRange.bound([e],[e,Number.MAX_VALUE]);n.delete(t).onerror=console.error}))}(e),function(e){let n=t.transaction(["chats"],"readwrite").objectStore("chats"),r=n.index("chanid");e.forEach((e=>{let t=IDBKeyRange.bound([e],[e,Number.MAX_VALUE]);r.openCursor(t).onsuccess=e=>{var t=e.target.result;t&&(n.delete(t.primaryKey).onerror=console.error,t.continue())}}))}(e.filter((e=>e>0))))},$=async(e,t)=>{let n=await I.join();n&&(n.transaction([e],"readwrite").objectStore(e).put(t).onerror=console.error,N.transaction((n=>{let r=Object.keys(t),a=`INSERT OR REPLACE INTO ${e} (${r.join(",")}) VALUES (${Array(r.length).fill("?").join(",")})`;n.executeSql(a,Object.values(t).map((e=>"function"==typeof e?e():e)),k,O)})))},Y=async(e,t)=>{let n=await I.join();if(!n)return{value:[],missed:t};if(0===t.length)return{value:[],missed:[]};performance.now();let r=[],a=new Set,i=n.transaction([e],"readonly").objectStore(e),o=0;return new Promise((e=>{t.forEach((n=>{let l=i.get(n);l.onerror=console.error,l.onsuccess=i=>{if(l.result?r.push(l.result):a.add(n),++o===t.length){let t={value:r,missed:Array.from(a)};e(t)}}}))}))},V=(e,t,n,r)=>{let a=n?IDBKeyRange.upperBound(n,r):null;if(!t)return[e,a];let i=n||Number.MAX_VALUE;switch(t.tag){case"Chanid":a=IDBKeyRange.bound([t.value],[t.value,i],!1,r)}return[e,a]},J=async(e,t,n=30,r=!0)=>(await(async(e,t,n,r,a,i,o)=>{let l=await I.join();if(!l)return;performance.now();let s=[],c=l.transaction([e],"readonly"),[u,d]=i?i(c.objectStore(e),t,r,a):[c.objectStore(e),null],h=0;return new Promise((e=>{u.openCursor(d,o).onsuccess=t=>{var r=t.target.result;if(r){if(s.push(r.value),++h===n)return e(s);r.continue()}else e(s)}}))})("chanchats",e,n,t,r,V,"prev")).map((e=>e.chatid)),X=async(e,t,n)=>{let r=await I.join();if(!r)return;let a=r.transaction(["ranges"],"readwrite").objectStore("ranges"),i=a.get(e);i.onerror=console.error,i.onsuccess=async r=>{if(i.result){if(n)return a.put([i.result[0],i.result[1],n],e).onerror=console.error;t[0]<i.result[0]&&(t[0]=i.result[0]),t[1]>i.result[0]&&(t[1]=i.result[1])}a.put(t,e).onerror=console.error}},z=e=>Z(e,"ranges"),G=async(...e)=>{let t=await I.join();if(!t)return;let n=t.transaction(["ranges"],"readwrite").objectStore("ranges");e.forEach((e=>n.delete(e).onerror=console.error))},W=e=>Z(e,"session"),Z=async(e,t)=>{let n=await I.join();if(!n)return;let r=n.transaction([t],"readonly").objectStore(t);return new Promise((t=>{let n=r.get(e);n.onerror=console.error,n.onsuccess=e=>t(n.result)}))};var Q,ee,te;!function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Chanid=function(e){return{tag:"Chanid",value:e}},e.By=function(e){return{tag:"By",value:e}}}(Q||(Q={})),function(e){e.ChatScan=function(e){return{tag:"ChatScan",value:e}},e.ChanScan=function(e){return{tag:"ChanScan",value:e}},e.AddChat=function(e){return{tag:"AddChat",value:e}},e.AddUser=function(e){return{tag:"AddUser",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.Logout=function(e){return{tag:"Logout",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Chans=function(e){return{tag:"Chans",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.ChanJoin=function(e){return{tag:"ChanJoin",value:e}},e.ChanLeave=function(e){return{tag:"ChanLeave",value:e}},e.DelChat=function(e){return{tag:"DelChat",value:e}},e.DelChan=function(e){return{tag:"DelChan",value:e}},e.EditChat=function(e){return{tag:"EditChat",value:e}}}(ee||(ee={})),function(e){e.ChatScan=function(e){return{tag:"ChatScan",value:e}},e.ChanScan=function(e){return{tag:"ChanScan",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.Chans=function(e){return{tag:"Chans",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Chat=function(e){return{tag:"Chat",value:e}},e.Chan=function(e){return{tag:"Chan",value:e}},e.User=function(e){return{tag:"User",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.ChanJoin=function(e){return{tag:"ChanJoin",value:e}},e.DelChat=function(e){return{tag:"DelChat",value:e}},e.DelChan=function(e){return{tag:"DelChan",value:e}},e.EditChat=function(e){return{tag:"EditChat",value:e}}}(te||(te={}));const ne=(e,t=0,n=!0)=>({pos:t,littleEndian:n,view:new DataView(e)}),re=(e,t)=>{const{view:{buffer:n},pos:r}=e,a=n.byteLength;if(a-r>t)return e;const i=Math.max(2*a,a+t),o=new Uint8Array(i);return o.set(new Uint8Array(n)),ne(o.buffer,r,e.littleEndian)},ae=(e,t)=>{e=re(e,1);const{view:n,pos:r}=e;return n.setUint8(r,t),e.pos+=1,e},ie=(e,t)=>{e=re(e,4);const{view:n,pos:r,littleEndian:a}=e;return n.setUint32(r,t,a),e.pos+=4,e};function oe(e,t){const{view:n,pos:r,littleEndian:a}=e;return n.setUint32(a?r:r+4,t,a),n.setUint32(a?r+4:r,0,a),e.pos+=8,e}const le=(e,t)=>{e=re(e,4);const{view:n,pos:r,littleEndian:a}=e;return n.setInt32(r,t,a),e.pos+=4,e},se=new TextEncoder,ce="encodeInto"in se?(e,t)=>se.encodeInto(e,t).written:(e,t)=>{const n=se.encode(e);return t.set(n),n.length},ue=(e,t)=>{e=re(e,3*t.length+8);const n=ce(t,new Uint8Array(e.view.buffer,e.pos+8));return(e=oe(e,n)).pos+=n,e},de=(e,t)=>ae(e,t?1:0),he=e=>(t,n)=>n.reduce(e,((e,t)=>oe(re(e,8),t))(t,n.length)),fe=e=>(t,n)=>null===n?ae(t,0):e(ae(t,1),n),pe=e=>{const{pos:t,view:n}=e;return e.pos+=1,n.getUint8(t)},me=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getUint32(t,r)},we=e=>{const{view:t,pos:n,littleEndian:r}=e;return e.pos+=8,t.getUint32(r?n:n+4,r)},ye=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getInt32(t,r)},ge=e=>1===pe(e),ve=e=>t=>1===pe(t)?e(t):null,be=e=>t=>{const n=we(t),r=new Array;for(let a=0;a<n;a++)r.push(e(t));return r},Ce=new TextDecoder,Ee=e=>{const t=we(e),{pos:n,view:{buffer:r}}=e,a=Ce.decode(new Uint8Array(r,n,t));return e.pos+=t,a};var Le=he(le),Se=fe((function(e,t){switch(t.tag){case"Id":return le(ie(e,0),t.value);case"Chanid":return le(ie(e,1),t.value);case"By":return le(ie(e,2),t.value)}})),Ae=fe(ue),Te=fe(le),Ue=fe(ae),xe=he(ae),Ne=(fe(Le),function(e,t){var n=t.id,r=t.txt,a=t.by,i=t.re,o=t.nor,l=t.chanid,s=t.dir,c=t.status,u=t.timestamp;return ue(((e,t)=>{e=re(e,2);const{view:n,pos:r,littleEndian:a}=e;return n.setUint16(r,t,a),e.pos+=2,e})(Le(le(le(le(le(ue(le(e,n),r),a),i),o),l),s),c),u)}),ke=(he(Ne),function(e,t){var n=t.id,r=t.name,a=t.fullname,i=t.mom,o=t.by,l=t.dir,s=t.ispub,c=t.isprv,u=t.timestamp;return ue(de(de(Le(le(le(ue(ue(le(e,n),r),a),i),o),l),s),c),u)}),Oe=(he(ke),he((function(e,t){var n=t.id,r=t.name;return ue(le(e,n),r)})),fe(Ne),fe(ke),fe((function(e,t){var n=t.id,r=t.name,a=t.email,i=t.emailverified,o=t.fullname,l=t.key,s=t.timestamp;return ue(ue(ue(de(ue(ue(le(e,n),r),a),i),o),l),s)})),fe((function(e,t){var n=t.data,r=t.chans;return Le(xe(e,n),r)})),function(e,t){var n=t.filter,r=t.kw,a=t.ub,i=t.lb,o=t.limit;return Ue(Te(Te(Ae(Se(e,n),r),a),i),o)}),je=function(e,t){var n=t.id,r=t.txt;return ue(le(e,n),r)},De=function(e,t){switch(t.tag){case"ChatScan":return Oe(ie(e,0),t.value);case"ChanScan":return Oe(ie(e,1),t.value);case"AddChat":return function(e,t){var n=t.txt,r=t.re,a=t.chname;return Ae(Te(ue(e,n),r),a)}(ie(e,2),t.value);case"AddUser":return function(e,t){var n=t.email,r=t.name,a=t.key;return xe(ue(ue(e,n),r),a)}(ie(e,3),t.value);case"Login":return function(e,t){var n=t.email,r=t.key;return xe(ue(e,n),r)}(ie(e,4),t.value);case"Logout":return xe(ie(e,5),t.value);case"Users":return Le(ie(e,6),t.value);case"Chans":return Le(ie(e,7),t.value);case"Chats":return Le(ie(e,8),t.value);case"ChanJoin":return le(ie(e,9),t.value);case"ChanLeave":return le(ie(e,10),t.value);case"DelChat":return le(ie(e,11),t.value);case"DelChan":return le(ie(e,12),t.value);case"EditChat":return je(ie(e,13),t.value)}},Ie=be(ye),Re=(ve((function(e){switch(me(e)){case 0:return Q.Id(ye(e));case 1:return Q.Chanid(ye(e));case 2:return Q.By(ye(e))}throw new Error("bad variant index for Filter")})),ve(Ee),ve(ye)),_e=(ve(pe),be(pe)),Me=ve(Ie),Pe=function(e){return{id:ye(e),txt:Ee(e),by:ye(e),re:ye(e),nor:ye(e),chanid:ye(e),dir:Ie(e),status:(e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=2,n.getUint16(t,r)})(e),timestamp:Ee(e)}},Be=be(Pe),Ke=function(e){return{id:ye(e),name:Ee(e),fullname:Ee(e),mom:ye(e),by:ye(e),dir:Ie(e),ispub:ge(e),isprv:ge(e),timestamp:Ee(e)}},qe=be(Ke),He=be((function(e){return{id:ye(e),name:Ee(e)}})),Fe=ve(Pe),$e=ve(Ke),Ye=ve((function(e){return{id:ye(e),name:Ee(e),email:Ee(e),emailverified:ge(e),fullname:Ee(e),key:Ee(e),timestamp:Ee(e)}})),Ve=ve((function(e){return{data:_e(e),chans:Ie(e)}})),Je=function(e){return{id:ye(e),txt:Ee(e)}},Xe=function(e){switch(me(e)){case 0:return te.ChatScan(Me(e));case 1:return te.ChanScan(Me(e));case 2:return te.Chats(Be(e));case 3:return te.Chans(qe(e));case 4:return te.Users(He(e));case 5:return te.Chat(Fe(e));case 6:return te.Chan($e(e));case 7:return te.User(Ye(e));case 8:return te.Login(Ve(e));case 9:return te.ChanJoin(Re(e));case 10:return te.DelChat(ye(e));case 11:return te.DelChan(ye(e));case 12:return te.EditChat(Je(e))}throw new Error("bad variant index for Response")},ze=ne(new ArrayBuffer(512)),Ge=function(e,t){return ze.pos=0,ze=t(ze,e),new Uint8Array(ze.view.buffer).slice(0,ze.pos)},We=function(e,t){return t(ne(e))},Ze=function(e){return We(e.buffer,Xe)},Qe=function(e){return Ge(e,De)};const et=e=>new Zlib.Inflate(e).decompress(),tt=e=>new Zlib.Deflate(e).compress(),nt=async(e,t,n)=>await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e),rt=async(e,t,n)=>await crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,e);let at={},it=[];function ot(e){return this.t&&this.t[e.type](e)}at.h=(...e)=>{let t,n=r=>{if(null==r);else if("string"==typeof r)t?at.add(t,r):t=at.s?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r);else if(Array.isArray(r))t||(t=document.createDocumentFragment()),r.forEach(n);else if(r instanceof Node)t?at.add(t,r):t=r;else if("object"==typeof r)at.property(t,r,null,at.s);else if("function"==typeof r)if(t){let e=at.add(t,"");at.insert(t,r,e)}else t=r.apply(null,e.splice(1));else at.add(t,""+r)};return e.forEach(n),t},at.insert=(e,t,n,r,a)=>(e=n&&n.parentNode||e,a=a||r instanceof Node&&r,t===r||(r&&"string"!=typeof r||!("string"==typeof t||"number"==typeof t&&(t+=""))?"function"==typeof t?at.subscribe((()=>{r=at.insert(e,t.call({el:e,endMark:n}),n,r,a)})):(n?r&&(a||(a=r.o&&r.o.nextSibling||n.previousSibling),at.rm(e,a,n)):e.textContent="",r=null,t&&!0!==t&&(r=at.add(e,t,n))):(null!=r&&e.firstChild?n?(n.previousSibling||e.lastChild).data=t:e.firstChild.data=t:n?at.add(e,t,n):e.textContent=t,r=t)),r),at.property=(e,t,n,r,a)=>{if(null!=t)if(!n||"attrs"===n&&(r=!0))for(n in t)at.property(e,t[n],n,r,a);else"o"!==n[0]||"n"!==n[1]||t.$o?"function"==typeof t?at.subscribe((()=>{at.property(e,t.call({el:e,name:n}),n,r,a)})):a?e.style.setProperty(n,t):r||"data-"===n.slice(0,5)||"aria-"===n.slice(0,5)?e.setAttribute(n,t):"style"===n?"string"==typeof t?e.style.cssText=t:at.property(e,t,null,r,!0):("class"===n&&(n+="Name"),e[n]=t):((e,t,n)=>{t=t.slice(2).toLowerCase(),n?e.addEventListener(t,ot):e.removeEventListener(t,ot),(e.t||(e.t={}))[t]=n})(e,n,t)},at.add=(e,t,n)=>{let r=(e=>{const{childNodes:t}=e;if(t&&11===e.nodeType)return t.length<2?t[0]:{o:at.add(e,"",t[0])}})(t=(e=>"string"==typeof e?document.createTextNode(e):e instanceof Node?e:at.h(it,e))(t))||t;return e.insertBefore(t,n&&n.parentNode&&n),r},at.rm=(e,t,n)=>{for(;t&&t!==n;){let n=t.nextSibling;e===t.parentNode&&e.removeChild(t),t=n}},at.subscribe=function(e){return function(e,t){function n(){let r=u;return u&&u.__c.push(n),p(n),n.i=!0,u=n,t=e(t),u=r,t}function r(){return n.i?u&&n.u.forEach((e=>e())):t=n(),t}e.s=n,m(n),n(),r.$o=1}(e),()=>p(e.s)},at.cleanup=function(e){return u&&u.l.push(e),e},at.root=h,at.sample=function(e){let t=u;u=void 0;let n=e();return u=t,n},at.hs=(...e)=>{let t=at.s;at.s=!0;let n=lt(...e);return at.s=t,n};let lt=(...e)=>at.h.apply(at.h,e);const st=new Map,ct=(e,t,n=!1)=>{let r=st.get(e)||[];n?r=[t]:r.push(t),st.set(e,r)},ut=(e,t)=>st.has(e)?st.get(e).forEach((e=>e(t))):void 0,dt={},ht=e=>(e&&(Object.assign(dt,e),ut("config",dt)),dt),ft=f(void 0),pt={id:f(0),name:f(""),chans:f([])};async function mt(){let e=await W("a");if(!e||e.byteLength<53)return;let t=new Uint8Array(e,0,16),n=new Uint8Array(e,16,32);t&&16===t.length&&(pt.salt=t),n&&32===n.length&&(pt.sskey=await crypto.subtle.importKey("raw",n,"AES-GCM",!1,["encrypt","decrypt"]));let r=new Uint8Array(e,48,4),a=new Uint8Array(e,52),i=new DataView(r.buffer).getInt32(48,!1),o=(new TextDecoder).decode(a);i&&o&&(pt.id(i),pt.name(o));let l=await W("c");return l&&l instanceof Array&&pt.chans(l),pt.salt}async function wt(e,t){let n=new TextEncoder,r=await yt(n.encode(e),n.encode(t));return await crypto.subtle.exportKey("raw",r)}async function yt(e,t){let n=await crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}const gt=document.location.hash.substr(1).match(/^ip\/(?<ip>[\:\.\d]+)$/);let vt="wss://"+(gt?gt.groups.ip:"192.168.100.11:443");window._ws=e=>(e&&("string"==typeof e&&(vt="wss://"+e),_t(!0)),vt),window._ws=()=>Ct,window._pc=()=>At,window._dc=()=>kt;let bt,Ct,Et,Lt,St,At,Tt,Ut,xt,Nt,kt,Ot=500,jt=0,Dt=new Set,It={recv:e=>Dt.add(e)};_t(),Mt();const Rt=x();function _t(e){bt=performance.now(),Ct=new WebSocket(vt),Ct.binaryType="arraybuffer",Ct.onopen=()=>{e?Mt():St&&Kt()},Ct.onmessage=async e=>{let t=new Uint8Array(e.data),{a:n,k:r}=E(t);ht((e=>{const t=new c(e);return{z:t.get(0),m:t.get(1),c:t.get(2),d:t.get(3)}})(n));var a,i,o;r=await(a=r,crypto.subtle.importKey("raw",a,{name:"ECDH",namedCurve:"P-256"},!0,[])),Nt=await(i=Lt.privateKey,o=r,crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:o},i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])),xt=new Uint8Array(await crypto.subtle.exportKey("raw",Nt));let l=JSON.parse((e=>(new TextDecoder).decode(et(e)))(n.slice(1))),s=l.answer?l.answer:l;if(await At.setRemoteDescription(new RTCSessionDescription(s)),!l.candidate)return;const u=new RTCIceCandidate({candidate:l.candidate,sdpMid:0,sdpMLineIndex:0});await At.addIceCandidate(u)},Ct.onclose=e=>{jt++,Ot+=A(0,jt<16?200:3e3),setTimeout((()=>{_t(!0)}),Ot)},Ct.onerror=e=>{}}function Mt(){Tt=!1,At=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]}),At.onicecandidate=e=>{e.candidate},At.onconnectionstatechange=e=>{At.connectionState},At.oniceconnectionstatechange=e=>{At.iceConnectionState},kt=At.createDataChannel("cu",{}),kt.binaryType="arraybuffer",It.send=Pt,kt.onopen=e=>{Rt.complete(kt)},kt.onmessage=Bt,kt.onclose=e=>{},kt.onerror=e=>{},async function(){const e=async()=>{let e=await At.createOffer();return await At.setLocalDescription(e),tt((new TextEncoder).encode(At.localDescription.sdp))},t=async()=>{if(Ut)return Ut;Lt=await(async()=>await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"]))();let e=await crypto.subtle.exportKey("raw",Lt.publicKey);return Ut=new Uint8Array(e),Ut};St=await(async(e,t,n)=>{let[r,a,i]=await Promise.all([e(),t(),n()]);return i?C(C(r,a),i):U(C(r,a),64,24)})(e,t,mt),1===Ct.readyState&&Kt()}()}async function Pt(e){await Rt.join(),(e=>{e.length||e.byteLength})(e=Qe(e));let{z:t,m:n,c:r,d:a}=ht();if(t&&(e=tt(e)),n&&(e=U(e,e.length),b(e,xt)),r){const t=crypto.getRandomValues(new Uint8Array(12));b(e,t),e=T(t,new Uint8Array(await nt(e,Nt,t)))}if(a){const t=crypto.getRandomValues(new Uint8Array(12));b(e,t),e=T(t,new Uint8Array(await nt(e,pt.sskey,t)))}kt.send(e),Et=performance.now()}async function Bt(e){let t=new Uint8Array(e.data),n=t.length,{z:r,m:a,c:i,d:o}=ht();if(o){let e=t.subarray(0,12);t=new Uint8Array(await rt(t.subarray(12),pt.sskey,e)),b(t,e)}if(i){let e=t.subarray(0,12);t=new Uint8Array(await rt(t.subarray(12),Nt,e)),b(t,e)}if(a){b(t,xt);let{a:e}=E(t);t=new Uint8Array(e)}r&&(t=et(t));(100*n/t.length).toFixed(2);let l=qt(t);Dt.forEach((e=>e(l)))}const Kt=()=>{Tt||(Ct.send(St),Tt=!0)},qt=e=>Ze(e);function Ht(e,t,n){const{root:r,subscribe:a,sample:i,cleanup:o}=at;null==n&&(n=!t.$t);let l=at.h([]),s=at.add(l,""),c=new Map,u=new Map,d=new Set;function h(e,a){if(null==e)return;let i=u.get(e);return 1===a?(d.delete(e),i||(i=n?r((n=>(c.set(e,n),t(e.$v||e)))):t(e.$v||e),11===i.nodeType&&(i=(e=>{const{childNodes:t}=e,{length:n}=t;if(n<2)return t[0];let r=Array.from(t);return{nodeType:111,t:r[0],o:r[n-1],l(){if(t.length!==n){let t=0;for(;t<n;)e.appendChild(r[t++])}return e}}})(i)||i),u.set(e,i))):-1===a&&d.add(e),((e,t)=>111===e.nodeType?1/t<0?t?at.rm(e.t.parentNode,e.t.nextSibling,e.o.nextSibling)||e.t:e.o:t?e.l():e.t:e)(i,a)}function f(e){let t=c.get(e);t&&(t(),c.delete(e)),u.delete(e)}return o(a((t=>{let n=e();return i((()=>{d.clear();let e=Array.from(function(e,t,n,r,a){let i,o,l=new Map,s=new Map;for(i=0;i<t.length;i++)l.set(t[i],i);for(i=0;i<n.length;i++)s.set(n[i],i);for(i=o=0;i!==t.length||o!==n.length;){var c=t[i],u=n[o];if(null===c)i++;else if(n.length<=o)e.removeChild(r(t[i],-1)),i++;else if(t.length<=i)e.insertBefore(r(u,1),r(t[i],0)||a),o++;else if(c===u)i++,o++;else{var d=s.get(c),h=l.get(u);void 0===d?(e.removeChild(r(t[i],-1)),i++):void 0===h?(e.insertBefore(r(u,1),r(t[i],0)||a),o++):(e.insertBefore(r(t[h],1),r(t[i],0)||a),t[h]=null,h>i+1&&i++,o++)}}return n}(s.parentNode,t||[],n,h,s));return d.forEach(f),e}))}))),o((function(){c.forEach((e=>e())),c.clear(),u.clear(),d.clear()})),l}window._b=It;const Ft="0VMZYpdgCGL3iKAzDHwocTt97e1hasO2mJNjExq4PvR6XyWSFbIn-5B_8fUukQlr",$t=Ft.split(""),Yt=new Array(123);for(let e=0;e<Ft.length;e++)Yt[Ft.charCodeAt(e)]=e;const Vt=e=>{if(e<0)return"-"+Vt(-e);let t=e>>>0,n=e/4294967296>>>0,r="";for(;n>0;)r=$t[63&t]+r,t>>>=6,t|=(63&n)<<26,n>>>=6;let a="";do{a=$t[63&t]+a,t>>>=6}while(t>0);return a+r};var Jt={ntob:Vt,bton:e=>{let t=0;for(let n=0;n<e.length;n++)t=64*t+Yt[e.charCodeAt(n)];return t}};const Xt=[0,null,"🏠",0],zt=(()=>{let e=Xt;const t=f([e]),n=t=>e=t;return{path:t=>e[t],paths:t,len:()=>t().length,setpath:n,same:t=>t===e,cd:e=>{let r=t();r[e[0]]!==e&&(r[e[0]]=e),r.splice(e[0]+1),t(r),n(e),location.hash=e[0]>0?Jt.ntob(e[3]):""},update:e=>{t([Xt,...e]),n(e[e.length-1]||Xt)}}})(),Gt=[];function Wt(){!function(e){for(const t of Gt)t(e)}(document.location.hash.substr(1))}window.addEventListener("hashchange",Wt),setTimeout(Wt);const Zt=30,Qt=new Map,en=new Map,tn=new Map,nn=e=>(t,n)=>{if(!t)return e;let r=e.get(t);return n?r?r[n]:void 0:r},rn=f([]),an=f([]),on=f(0),ln=f(0),sn=f(0),cn=f(0),un=f(""),dn=f(""),hn=f(!1),fn=f(!1),pn=nn(Qt),mn=nn(en),wn=nn(tn),yn=(()=>{const e={},t={};return{create:n=>t[n]=new Promise((t=>e[n]=t)),complete:(t,n)=>e[t]?e[t](n):null,join:e=>t[e],joinall:(...e)=>Promise.all(e.map((e=>t[e]))),select:(...e)=>Promise.race(e.map((e=>t[e])))}})();It.recv((async e=>{switch(e.tag){case"Login":if(!e.value)return ft(void 0),void ut("login",!1);await async function({data:e,chans:t}){let n=new Uint8Array(e.slice(16,20)),r=new Uint8Array(e.slice(20)),a=new DataView(n.buffer).getInt32(0,!1),i=(new TextDecoder).decode(r);pt.id(a),pt.name(i),pt.chans(t),pt.salt=new Uint8Array(e.slice(0,16)),pt.sskey=await yt(ft(),pt.salt),ft(void 0);let o=new Uint8Array(await crypto.subtle.exportKey("raw",pt.sskey)),l=pt.salt.length,s=new Uint8Array(l+o.length+n.length+r.length);s.set(pt.salt),s.set(o,l),s.set(n,l+o.length),s.set(r,l+o.length+n.length),K("a",s.buffer),ht({d:!0}),K("c",t),$("users",{id:a,name:i})}(e.value),ut("login",!0);break;case"Users":H("users",e.value),yn.complete("users",e.value);break;case"Chans":H("chans",e.value),yn.complete("chans",e.value);break;case"Chat":let t=an();if(t.includes(e.value.id))return;let n=window.scrollY+window.innerHeight===document.body.scrollHeight;await $("chats",e.value);let r=new Set(wn().has(e.value.by)?[]:[e.value.by]),a=e.value.dir.filter((e=>!pn(e))),i=new Set(a);await Cn(r,i),e.value.nor=f(0),e.value.star=f(!1),e.value.txt=f(e.value.txt),mn().set(e.value.id,e.value),t.push(e.value.id),an(t),n&&y();break;case"Chats":if(0===e.value.length)return;H("chats",e.value),yn.complete("chats",e.value);break;case"ChatScan":let o=e.value||[],l=on();if(0===o.length)return hn(!0),X(l,null,!0),void yn.complete("chatscan",o);hn(!1),X(l,[o[0],o[o.length-1]]);let s=o.map((e=>({chanid:l,chatid:e})));H("chanchats",s),yn.complete("chatscan",o);break;case"ChanScan":let c=e.value||[];c.length>0?(fn(!1),await Ln(c)):fn(!0),yn.complete("chanscan",c);break;case"ChanJoin":yn.complete("chanjoin",e.value);break;case"DelChat":kn(e.value);break;case"EditChat":let{id:u,txt:d}=e.value,h=mn(u);h&&h.txt(d),h=await Z(u,"chats"),h&&(h.txt=d,await $("chats",h))}}));const gn="/"+Ft;(e=>{Gt.push(e)})((async e=>{if(!e||!gn.includes(e[0]))return on(0),En([]),document.title="sonic",Nn(),void(document.getElementsByClassName("tbl").length>0&&Un(0));if("/"===e[0]){let t=Jt.bton(e.slice(1));ln(t),await bn([t]),Nn();let n=mn(t).dir;return await Ln(n),En(n),void(document.title=pn(on(),"fullname")+" - sonic")}let t=Jt.bton(e);on(t),Nn(),await Ln([t]);let n=pn(t).dir;await Ln(n),En([...n,t]),document.getElementsByClassName("tbl").length>0&&Un(zt.path(3)),document.title=pn(on(),"fullname")+" - sonic"}));const vn=async(e,t=null)=>{await bn(e);let n=e[0],r=new Set,a=new Set,i=an(),o=new Set;switch(e.forEach((e=>{let t=mn(e);t.txt=f(t.txt),t.nor=f(t.nor),t.star=f(!1),"string"==typeof t.timestamp&&(t.timestamp=new Date(t.timestamp)),wn().has(t.by)||r.add(t.by),t.dir.forEach((e=>{pn().has(e)||a.add(e)})),o.has(e),o.add(e)})),await Cn(r,a),e.reverse(),t){case"re":an(e);break;case"pre":an(i.concat(e));break;default:an(e.concat(i))}o=new Set,an().forEach((e=>{o.has(e),o.add(e)})),n&&ut("keysloaded",n)},bn=async e=>{if(0===(e=e.filter((e=>!mn().has(e)))).length)return;let{value:t,missed:n}=await Y("chats",e);if(w(t,mn()),n.length>0){let e=await yn.create("chats",It.send(ee.Chats(n)));w(e,mn())}},Cn=async(e,t)=>{let n=await Y("users",Array.from(e)),r=await Y("chans",Array.from(t));w(n.value,wn()),w(r.value,pn()),n.missed.length>0&&yn.create("users",It.send(ee.Users(n.missed))),r.missed.length>0&&yn.create("chans",It.send(ee.Chans(r.missed)));let[a,i]=await yn.joinall("users","chans");a&&w(a,wn()),i&&w(i,pn())},En=e=>{let t=e.map(((e,t)=>{let n=pn(e)||{};return[t+1,n.mom,n.name,e]}));zt.update(t)},Ln=async e=>{if(0===(e=e.filter((e=>!pn().has(e)))).length)return;let{value:t,missed:n}=await Y("chans",e);if(w(t,pn()),n.length>0){let e=await yn.create("chans",It.send(ee.Chans(n)));w(e,pn())}};let Sn=null;const An=async(e,t=null,n=null)=>{performance.now();let r=await((e,t=null,n=null,r=null,a=null)=>{t&&dn(t);let i=ee.ChanScan({filter:Tn(e),kw:t,ub:n,lb:r,limit:a});return yn.create("chanscan",It.send(i))})(e,t,n);n?0===r.length||rn(rn().concat(r)):(0!==r.length||t||ut("nochan"),rn(r))},Tn=e=>(Sn=e,"number"==typeof e?Q.Chanid(e):null),Un=async e=>{Sn!==e&&An(e)},xn=(e=null,t=null,n=null)=>{let r=ee.ChatScan({filter:ln()>0?Q.Id(ln()):on()>0?Q.Chanid(on()):pt.id()>0?Q.By(pt.id()):null,kw:null,ub:e,lb:t,limit:n});return yn.create("chatscan",It.send(r))};async function Nn(){hn(!1),cn(!1),sn(0);let e=on();performance.now();let t=(await z(e)||[])[0]||null,n=await J(Q.Chanid(e),null,Zt);await vn(n,"re"),cn(!0),ut("reloaded");let r=await xn(null,t)||[];await vn(r,r.length!==Zt&&0!==n.length&&t?"pre":"re"),ut("reloaded")}async function kn(e){let t=mn(e)||await Z(e,"chats");t&&await(async({id:e,dir:t})=>{let n=await I.join();if(!n)return;let r=[0,...t];!function(e,t){t.forEach((async t=>{let n=await z(t);n&&n.includes(e)&&G(t)}))}(e,r),function(e,t){let r=n.transaction(["chanchats"],"readwrite").objectStore("chanchats");t.forEach((t=>{let n=IDBKeyRange.only([t,e]);r.delete(n).onerror=console.error}))}(e,r),function(...e){let t=n.transaction(["chats"],"readwrite").objectStore("chats");e.forEach((e=>{t.delete(e).onerror=console.error}))}(e)})(t),en.delete(e);let n=an(),r=n.indexOf(e);r>-1&&(n.splice(r,1),an(n))}window._chn=()=>Array.from(Qt.values()),window._ch=()=>Array.from(en.values()),window._us=()=>Array.from(tn.values()),window._chns=()=>rn().map((e=>Qt.get(e))),window._chs=()=>an().map((e=>en.get(e))),window._chnid=on,window._chid=ln,window._curid=sn,window._curtxt=un,window._chnkw=dn;const On=()=>{const e=document.createElement("div");e.contentEditable=!0,e.className="s-c",e.oninput=({target:{firstChild:t}})=>{var n,r,a,i;(n=function(){let t=e.textContent;var n;t.length>50||(n=t,An(zt.path(3),n))},r=100,function(){var e=this,t=arguments,o=function(){i=null,a||n.apply(e,t)},l=a&&!i;clearTimeout(i),i=setTimeout(o,r),l&&n.apply(e,t)})()},e.onkeydown=e=>{"Enter"!==e.key||e.shiftKey||e.preventDefault()};const t=(e,t)=>{if(e.stopPropagation(),!pt.id())return alert("you are not login!");pt.chans().includes(t)?(async e=>{performance.now();let t=await yn.create("chanjoin",It.send(ee.ChanLeave(e)));if(!t)return;let n=pt.chans();if(!n.includes(t))return;const r=n.indexOf(t);r>-1&&n.splice(r,1),pt.chans(n),await K("c",n),await F(0,e),Nn()})(t):(async e=>{performance.now();let t=await yn.create("chanjoin",It.send(ee.ChanJoin(e)));if(!t)return;let n=pt.chans();n.includes(t)||(n.push(t),pt.chans(n),await K("c",n),await F(0),Nn())})(t)};let n=lt("div",null);setTimeout((function(){new IntersectionObserver((t=>{if(t[0].intersectionRatio<=0)return;let n=rn(),r=n[n.length-1];if(!r||fn()||n.length<Zt)return;let a=e.textContent||null;a&&a.length>50||setTimeout((()=>An(zt.path(3),a,r)))}),{}).observe(n)}));return lt([lt("div",{class:"s"},e),lt("div",{class:"tbl"},lt("table",null,lt("tbody",null,Ht(rn,(e=>{let n=pn(e);return lt("tr",{onclick:()=>(async({id:e,mom:t,name:n})=>{await An(e),zt.cd([zt.path(0)+1,t,n,e])})(n)},lt("td",null,lt("button",{onclick:n=>t(n,e)},(()=>pt.chans().includes(e)?"✅":"➕"))),lt("td",null,n.fullname))})),(()=>rn().length>0?null:lt("tr",null,lt("td",null,"no result"))),n))),lt("div",{class:"grid"},lt("div",{class:"container"},lt("ol",{class:"bc"},lt("li",null,lt("a",{href:"#"},"#")," ",lt("a",{href:"#"},"rust")),lt("li",{class:"active relative drop-container"},lt("a",null,"general"),lt("div",{class:"drop"},lt("ul",{class:"list"},lt("li",null,lt("a",{href:"#"},"security")),lt("li",null,lt("a",{href:"#"},"random")),lt("li",null,lt("a",{href:"#"},"backend")),lt("li",null,lt("a",{href:"#"},"compiler")),lt("li",null,lt("a",{href:"#"},"gamedev"))))))))])};let jn;async function Dn(){await It.send(ee.Logout(Array.from(pt.salt))),await q(),ht({d:!1}),pt.id(0),pt.name(""),pt.chans([]),pt.sskey=void 0,pt.salt=void 0,Nn(),An(zt.path(3)),ut("logout")}ct("config",(({d:e})=>Mn(e?_n:Rn))),ct("login",(e=>{e&&(Nn(),An(zt.path(3)))}));const In=()=>lt("div",{class:"login"},lt(v(Mn),null),lt("div",{class:"v"},D.ver," ",D.build)),Rn=()=>lt([lt("h2",null,"Login"),lt("form",{onsubmit:function(e){e.preventDefault();let{m:t,p:n}=e.target;!async function(e,t){jn=performance.now(),await q();let n=await wt(t,e),r={email:e,key:Array.from(new Uint8Array(n))};ft(n),It.send(ee.Login(r))}(t.value,n.value)}},lt("input",{type:"text",name:"m",placeholder:"email",required:!0,autocomplete:"true"}),lt("input",{type:"password",name:"p",placeholder:"password",required:!0,autocomplete:"true"}),lt("button",{type:"submit"},"Login")),lt("h2",null,"Register"),lt("form",{onsubmit:function(e){e.preventDefault();let{m:t,n:n,p:r}=e.target;!async function(e,t,n){jn=performance.now(),await q();let r=await wt(n,e),a={email:e,name:t,key:Array.from(new Uint8Array(r))};ft(r),It.send(ee.AddUser(a))}(t.value,n.value,r.value)}},lt("input",{type:"text",name:"m",placeholder:"email",required:!0,autocomplete:"true"}),lt("input",{type:"text",name:"n",placeholder:"name",required:!0,autocomplete:"true"}),lt("input",{type:"password",name:"p",placeholder:"password",required:!0,autocomplete:"true"}),lt("button",{type:"submit"},"Register"))]),_n=()=>lt([lt("div",null,"You have logged in as ",lt("b",null,pt.name)),lt("button",{onclick:Dn},"Logout")]),Mn=f((()=>null));window._v=()=>D;const Pn="defaultParagraphSeparator",Bn="formatBlock",Kn=(e,t,n)=>e.addEventListener(t,n),qn=(e,t)=>e.appendChild(t),Hn=e=>document.createElement(e),Fn=e=>document.queryCommandState(e),$n=(e,t=null)=>document.execCommand(e,!1,t),Yn={bold:{icon:"<b>B</b>",title:"Bold",state:()=>Fn("bold"),result:()=>$n("bold")},italic:{icon:"<i>I</i>",title:"Italic",state:()=>Fn("italic"),result:()=>$n("italic")},underline:{icon:"<u>U</u>",title:"Underline",state:()=>Fn("underline"),result:()=>$n("underline")},strikethrough:{icon:"<strike>S</strike>",title:"Strike-through",state:()=>Fn("strikeThrough"),result:()=>$n("strikeThrough")},heading1:{icon:"<b>H1</b>",title:"Heading 1",result:()=>$n(Bn,"<h1>")},heading2:{icon:"<b>H2</b>",title:"Heading 2",result:()=>$n(Bn,"<h2>")},quote:{icon:"&#8220;&#8221;",title:"Quote",result:()=>$n(Bn,"<blockquote>")},olist:{icon:"1.",title:"Ordered List",result:()=>$n("insertOrderedList")},ulist:{icon:"&#8226;",title:"Unordered List",result:()=>$n("insertUnorderedList")},code:{icon:"&lt;&gt;",title:"Code",result:()=>$n(Bn,"<pre>")},line:{icon:"&#8213;",title:"Horizontal Line",result:()=>$n("insertHorizontalRule")},link:{icon:"&#128279;",title:"Link",result:()=>{const e=window.prompt("Enter the link URL");e&&$n("createLink",e)}},image:{icon:"&#128247;",title:"Image",result:()=>{const e=window.prompt("Enter the image URL");e&&$n("insertImage",e)}}},Vn={actionbar:"e-a",button:"e-b",content:"e-c",selected:"e-bs",topic:"e-t"};function Jn(){return window.scrollY+window.innerHeight===document.body.scrollHeight}const Xn=({topic:e,content:t})=>{if(!pt.id())return alert("you are not login!");if(!t.textContent.trim())return;let n=sn()||an()[an().length-1],r=null;if(!n||e.textContent!==un()){if(r=e.textContent,0===r.trim().length)return alert("topic should not be empty"),!1;n=null}let a=t.innerHTML.trim();It.send(ee.AddChat({txt:a,re:n,chname:r})),t.textContent="",zn({},{topic:e})},zn=({id:e,txt:t},{topic:n})=>{if(!e||sn()===e)return n.textContent="",un(""),void sn(0);n.innerHTML=t(),n.textContent=n.textContent,un(n.textContent),sn(e)};ct("keysloaded",(e=>{document.getElementById(Jt.ntob(e)).scrollIntoView()})),ct("reloaded",(()=>{setTimeout((()=>{window.innerHeight-document.getElementsByClassName("cs")[0].clientHeight>110?document.body.classList.add("fx"):document.body.classList.remove("fx")}))}));const Gn=()=>{const e=(e=>{const t=e.actions?e.actions.map((e=>"string"==typeof e?Yn[e]:Yn[e.name]?{...Yn[e.name],...e}:e)):Object.keys(Yn).map((e=>Yn[e])),n={...Vn,...e.classes},r=e.defaultParagraphSeparator||"div",a=e.element.topic=Hn("div");a.contentEditable=!0,a.className=n.topic,a.onkeydown=e=>{"Enter"===e.key&&(i.focus(),e.preventDefault())},qn(e.element,a);const i=e.element.content=Hn("div");i.contentEditable=!0,i.className=n.content,i.onfocus=()=>{let e=Jn();document.body.classList.add("ed"),e&&setTimeout((()=>y()))},i.onblur=()=>{setTimeout((()=>{e.element.contains(document.activeElement)||document.body.classList.remove("ed")}))},i.oninput=({target:{firstChild:t}})=>{e.oninput(i.innerHTML)},i.onkeydown=t=>{"Enter"===t.key&&(Jn()&&setTimeout((()=>y())),t.shiftKey||(e.onsend({topic:a,content:i}),t.preventDefault()))},qn(e.element,i);const o=Hn("div");return o.className=n.actionbar,qn(e.element,o),t.forEach((e=>{const t=Hn("button");if(t.className=n.button,t.innerHTML=e.icon,t.title=e.title,t.setAttribute("type","button"),t.onclick=()=>e.result()&&i.focus(),e.state){const r=()=>t.classList[e.state()?"add":"remove"](n.selected);Kn(i,"keyup",r),Kn(i,"mouseup",r),Kn(t,"click",r)}qn(o,t)})),e.styleWithCSS&&$n("styleWithCSS"),$n(Pn,r),e.element})({element:lt("div",{class:"e"}),oninput:e=>{},onsend:Xn}),t=f(0),n=e=>{let{id:n,txt:a,by:o,chanid:s,re:u,star:d,nor:h}=e,f=an(),p=pn(s);let m=f[f.indexOf(n)-1],w=mn(m)||{},y=w.by!==o,g=!u||w.chanid!==s,v=Jt.ntob(n),b=Jt.ntob(p.id);const C=()=>{c("#/"+v,v)},E=(e,t)=>{c("#"+t,t),e.preventDefault()};return lt("div",{id:v,class:function(){return"c"+(()=>(d()?" star":"")+(g?" t":"")+(sn()===n?" cur":"")).call(this)},onclick:t=>l(t,e),onmouseover:e=>t()!==n&&t(n)},g?lt("div",{class:"tn"+(u?" re":" nw")},lt("a",{href:function(){return"#"+("function"==typeof b?b.call(this):b)},onclick:e=>E(e,b),innerHTML:pn(p.id,"fullname")}),lt("div",{class:"dr"},Ht((()=>[...p.dir.slice(zt.len()-1)]),(e=>{let t=Jt.ntob(e);return lt("span",null,lt("a",{href:function(){return"#"+("function"==typeof t?t.call(this):t)},onclick:e=>E(e,t),innerHTML:pn(e,"name")}))})))):null,y||g?lt("div",{class:"by"},wn(o).name):null,lt("div",{onclick:e=>e.stopPropagation()},(()=>{let e=h();if(1!==e||n!==mn(an()[i+1]).re)return e>0?lt([lt("span",{class:"rep",onclick:C},e," ↩️")," "]):void 0}),lt("div",{class:"ct"},(()=>(e=>document.createRange().createContextualFragment(e))(a())))),(()=>t()===n?r(v,e):null))},r=(t,n)=>lt([lt("div",{class:"pm pr",onclick:t=>zn(n,e)},"↩️"),lt("div",{class:"pm"},"💬",lt("div",{class:"pu"},lt("div",{onclick:e=>a(t,n)},"✏️ edit"),lt("div",{onclick:e=>o(n)},"❌ delete")))]),a=(e,t)=>{let n=document.getElementById(e).querySelector(".ct");if("true"==n.contentEditable)return n.contentEditable=!1,void n.classList.remove("ce");n.contentEditable=!0,n.focus(),n.classList.add("ce"),n.oninput=e=>{},n.onkeydown=e=>{"Enter"===e.key&&(e.shiftKey||(e.preventDefault(),function(e,t){It.send(ee.EditChat({id:e,txt:t}))}(t.id,n.innerHTML.trim()),n.contentEditable=!1,n.classList.remove("ce")))}},o=({id:e,txt:t})=>{confirm('Do you want to delete this chat? \n"'+t()+'"')&&function(e){It.send(ee.DelChat(e)),kn(e)}(e)},l=(e,t)=>{e.x<18&&e.offsetY<22&&s(t)},s=({id:e,star:t})=>{const n=an().filter((t=>t===e))[0],r=mn(n);r.star?r.star(!t()):r.star=f(!1)},c=(e,t)=>{let n=screen.width/2-300,r=screen.height/2-300;window.open(e,t,`toolbar=yes,location=yes,status=no,menubar=yes,scrollbars=yes,resizable=yes,width=600,height=600,top=${r}, left=${n}`)},u=lt("div",null);return setTimeout((function(){new IntersectionObserver((e=>{if(e[0].intersectionRatio<=0)return void(document.body.classList.contains("fx")&&(document.body.classList.remove("fx"),y()));if(!cn())return;!an()[0]||hn()||an().length<Zt||setTimeout((()=>{if(!cn())return;let e=an()[0];!e||hn()||an().length<Zt||(async e=>{let t=on();performance.now();let n=await z(t)||[];if(n[2]&&e===n[1])return void hn(!0);hn(!1);let r=await J(Q.Chanid(t),e,Zt);if(n[2]||r.length===Zt)return void await vn(r);let a=await xn(e);a.length>0&&await vn(a)})(e)}))}),{}).observe(u)})),lt([lt("div",{class:"cs"},u,Ht(an,(e=>n(mn(e))))),e])},Wn=()=>{},Zn=f(Wn);document.querySelector("body").append((()=>{ct("login",(e=>e&&Zn(Wn))),ct("logout",(()=>Zn(Wn))),ct("nochan",(()=>Zn(Wn)));return lt([lt("div",{class:"n"},lt("div",null,lt("ol",{class:"bc"},(()=>Ht(zt.paths,(e=>lt("li",null,lt("a",{onclick:t=>(e=>{Zn()!==On?e[0]===zt.len()-1?Zn(On):zt.cd(e):zt.same(e)&&Zn(Wn),zt.setpath(e),Zn()===On&&Un(e[3])})(e)},e[2])))))),lt("div",{class:"m"},lt("a",{onclick:e=>{Zn()===In?Zn(Wn):Zn(In)}},(()=>pt.name()||"login")))),lt(v(Zn),null)),Gn])})())}();</script></body></html>