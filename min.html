<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>sonic</title><style type="text/css">*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif;font-size:14px;line-height:1.5}:focus{outline:0}body{background:#f9f9f9;margin:0}table{border-collapse:collapse;text-align:left;width:100%}table tr{background:#fff;border-bottom:1px solid}table td span{background:#eee;color:#696969;display:none;font-size:10px;font-weight:700;padding:5px;position:absolute;text-transform:uppercase;top:0;left:0}a{text-decoration:none}a:hover{text-decoration:underline}button{padding:5px 20px;cursor:pointer;border:1px solid #ddd;margin:10px 10px 10px 0;background:#efefef}h1{font-size:1.9em}h1,p{margin:.3em 0}td,th{border:1px solid #ddd;padding:.5em 5px;cursor:pointer}th{background:#f4f4f4;font-weight:400}caption{margin:0;font-weight:700;font-size:1.3em;background:#eee;padding:10px;border:1px solid #ddd}.comments{padding:5px}.comments-item{padding:10px 5px 0 0}.by{float:left;color:#121213;font-weight:700;margin-right:4px}.comments-time{display:inline-block;color:#aaa}#nav{padding:5px 15px;border:1px solid rgba(10,10,10,.1);background:#f9f9f9;position:sticky;top:0;z-index:1}.nav-item{margin:5px 10px 5px 0}.topics{margin-bottom:10px;white-space:pre-wrap;word-wrap:break-word}.topic-name,.topic-name a{cursor:pointer;width:fit-content}.topic-name.head a{margin-bottom:10px;font-size:15px;color:#1a1a1b;font-weight:500}.topic-name.head{margin-bottom:5px}.re:before{content:"ðŸ’¬ "}.new:before{content:"ðŸ“¢ "}.new{color:grey}.pell{border:1px solid rgba(10,10,10,.1);position:sticky;bottom:0;background:#f9f9f9}.pell-content{overflow-y:auto;padding:5px 10px 10px;white-space:pre-wrap;word-wrap:break-word}.pell-actionbar{background:#fff;border-bottom:1px solid rgba(10,10,10,.1)}.pell-button{background:transparent;border:none;width:30px;height:30px;vertical-align:bottom;margin:0;padding:0}.pell-button-selected{background:#f0f0f0}.pell-content[contenteditable]:empty:before{content:"Write a message...";color:#aaa}.pell-topic{display:none;overflow:hidden;padding:10px;color:grey;white-space:nowrap}.pell-topic:focus{white-space:normal}.pell.sticky .pell-topic{display:block}.pell-topic[contenteditable]:empty:before{content:"New Topic";color:#aaa}blockquote{width:fit-content;margin:0;padding:10px;background:#eee;border-radius:5px}blockquote:before{content:"\201C"}blockquote:after{content:"\201D"}.chat{padding:2px 15px;position:relative}.chat.cur,.chat:hover{background:#eee}.chat.topic{padding-top:5px;margin-top:2px}.chat:before{font-size:.9em;position:absolute;margin-top:2px;margin-left:-14px;cursor:pointer;color:#666}.chat:hover:before{content:"â˜†"}.chat.star:before{content:"ðŸŒŸ"!important}.rep{font-size:.85em;color:grey;cursor:pointer;width:fit-content}.chat:after{font-size:1em;position:absolute;top:2px;right:10px;cursor:pointer;color:#999}.chat:hover:after{content:"ðŸ”¨"}@media (max-width:600px){table thead{left:-9999px;position:absolute;visibility:hidden}table tr{border-bottom:0;display:flex;flex-direction:row;flex-wrap:wrap;margin-bottom:40px}table td{border:1px solid;margin:0 -1px -1px 0;padding-top:35px;position:relative;width:50%}table td span{display:block}.pell-topic{font-size:12px;padding:5px 10px}.pell-button,.pell-button b,i,strike,u{font-size:.85em;width:26px;height:26px}}.login{padding:0 15px}.login input{display:block;margin:5px 0;min-width:200px}</style></head><body><section class="app"></section><script src="https://cdn.jsdelivr.net/npm/zlibjs@0.3.1/bin/zlib.min.js"></script><script>!function(){"use strict";const e=[];function t(t){let n={};return function(){const a=e.slice.call(arguments),i=a.map((e=>{if(o(e)||Array.isArray(e)){let t={};for(let n in e)t[n]=r(e[n]);return t}return r(e)})),s=JSON.stringify(i);let l=n[s];return void 0===l&&(l=t.apply(this,a),l&&11===l.nodeType&&(l=e.slice.call(l.childNodes)),n[s]=l),l}}let n=0;function r(e){return"function"==typeof e||e instanceof Node?(e.$m||(e.$m=++n),{$m:e.$m}):e}function o(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i,s,l=a((function(e,t){function n(e){var t=e>>3;return e%8!=0&&t++,t}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===e&&(e=0);var r=null==t?void 0:t.grow;this.grow=r&&isFinite(r)&&n(r)||r||0,this.buffer="number"==typeof e?new Uint8Array(n(e)):e}return e.prototype.get=function(e){var t=e>>3;return t<this.buffer.length&&!!(this.buffer[t]&128>>e%8)},e.prototype.set=function(e,t){void 0===t&&(t=!0);var n=e>>3;if(t){if(this.buffer.length<n+1){var r=Math.max(n+1,Math.min(2*this.buffer.length,this.grow));if(r<=this.grow){var o=new Uint8Array(r);o.set(this.buffer),this.buffer=o}}this.buffer[n]|=128>>e%8}else n<this.buffer.length&&(this.buffer[n]&=~(128>>e%8))},e.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=8*this.buffer.length);for(var r=t,o=r>>3,a=128>>r%8,i=this.buffer[o];r<n;r++)e(!!(i&a),r),a=1===a?(i=this.buffer[++o],128):a>>1},e}();t.default=r}(s={path:i,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&s.path)}},s.exports),s.exports));let c,u=[];function d(e){let t=c,n=()=>{};c=n,g(n);let r=e((()=>{f(n),c=void 0}));return c=t,r}function p(e){function t(n){if(0===arguments.length)return c&&!t.__o.has(c)&&(t.__o.add(c),c.u.push(t)),e;e=n;let r=c;return c=void 0,t.o=new Set(t.__o),t.o.forEach((e=>e.i=!1)),t.o.forEach((e=>{e.i||e()})),c=r,e}return t.$o=1,t.__o=new Set,t.t=u,t}function f(e){e.__c.forEach(f),e.u.forEach((t=>{t.__o.delete(e),t.o&&t.o.delete(e)})),e.l.forEach((e=>e())),g(e)}function g(e){e.u=[],e.__c=[],e.l=[]}const h=(e,t={})=>e.reduce(((e,t)=>(e[t.id]=t,e)),t),m=()=>window.scrollTo(0,document.body.scrollHeight),y=t((e=>t(((t,n)=>d((()=>e(t,n))))))),v=e=>(t,...n)=>()=>y(e())(t,n),w=e=>{if(!(e instanceof ArrayBuffer||e.length))return console.log(e);console.log("Length",e instanceof ArrayBuffer?new Uint8Array(e).length:e.length,"bytes"),console.log((Object(e).buffer instanceof ArrayBuffer?e:"string"==typeof e?new TextEncoder("utf-8").encode(e):new Uint8ClampedArray(e)).reduce(((e,t,n,r)=>e+(n%16==0?n.toString(16).padStart(6,0)+"  ":" ")+t.toString(16).padStart(2,0)+(n===r.length-1||n%16==15?" ".repeat(3*(15-n%16))+Array.from(r).splice(n-n%16,16).reduce(((e,t)=>e+(t>31&&t<127||t>159?String.fromCharCode(t):".")),"  ")+"\n":"")),""))},b=(e,t)=>{let n=0,r=0;for(;n<e.length;)r>=t.length&&(r=0),e.set([e[n]^t[r]],n),n++,r++},A=(e,t)=>(b(e,t),I(e,t)),T=e=>{let{a:t,k:n}=E(e);return b(t,n),{a:t,k:n}},E=e=>{let t=e[0],n=e.subarray(1,t+1);return{a:e.subarray(t+1),k:n}},I=(e,t)=>{let n=new Uint8Array(1+t.length+e.length);return n[0]=t.length,n.set(t,1),n.set(e,1+t.length),n},C=(e,t)=>(e=Math.ceil(e),Math.floor(Math.random()*(Math.floor(t)-e)+e)),L=(e,t)=>{let n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n},S=e=>(performance.now()-e).toFixed(2),U=(e,t=64,n=8)=>A(e,crypto.getRandomValues(new Uint8Array(C(n,t)))),k=()=>{let e,t=new Promise((t=>e=t));return{complete:t=>e(t),join:()=>t}},N=navigator.vendor.includes("Apple")?{transaction:()=>{}}:openDatabase("sonic","1.0","Test DB",1073741824);function x(e,t){}function O(e,t){console.log(e,t)}N.transaction((e=>{e.executeSql("CREATE TABLE IF NOT EXISTS users (\n            id integer NOT NULL PRIMARY KEY,\n            handle varchar(50) NOT NULL\n        )",[],x,O),e.executeSql("CREATE TABLE IF NOT EXISTS topics (\n            id integer NOT NULL PRIMARY KEY,\n            name varchar(250) NOT NULL,\n            groupId integer NOT NULL,\n            channelId integer NOT NULL,\n            by integer NOT NULL,\n            createdAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP\n        )",[],x,O),e.executeSql("CREATE TABLE IF NOT EXISTS chats (\n            id integer NOT NULL PRIMARY KEY,\n            txt text NOT NULL,\n            by integer NOT NULL,\n            re integer NOT NULL,\n            nor integer NOT NULL DEFAULT '0',\n            topicId integer NOT NULL,\n            channelId integer NOT NULL,\n            groupId integer NOT NULL,\n            createdAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            star boolean\n        )",[],x,O)}));const j=k(),P="sonic",R=["session","ranges","chats","users","topics","channels","groups"];let $,M,D=indexedDB.open(P,1);function H(e){console.warn("[db] deleting database",e);var t=window.indexedDB.deleteDatabase(e);t.onerror=t=>{console.error("[db] error deleting database",e,t)},t.onsuccess=t=>{console.warn("[db] deleted database",e)}}D.onsuccess=e=>{$=D.result,console.log("[db] open -",$.name,$.version,$.objectStoreNames),function(e){let t=e.objectStoreNames;for(const e of R)if(!t.contains(e))return console.warn("[db] db store missing",e),void H(P)}($),j.complete($),D.open?D.open():D.open=!0},D.onerror=e=>{console.error("[db] error",e.target.error),j.complete()},D.onblocked=e=>{console.log("[db] blocked",e)},D.onupgradeneeded=e=>{console.warn("[db] database upgrade needed from version",e.oldVersion,"->",e.newVersion),$=D.result;let t=$.objectStoreNames;if(console.log(t),!t.contains("session")){console.log("make session store");$.createObjectStore("session")}if(!t.contains("ranges")){console.log("make ranges store");$.createObjectStore("ranges")}if(!t.contains("chats")){console.log("make chats store");$.createObjectStore("chats",{keyPath:"id"})}if(!t.contains("users")){console.log("make users store");$.createObjectStore("users",{keyPath:"id"})}if(!t.contains("topics")){console.log("make topics store");$.createObjectStore("topics",{keyPath:"id"})}if(!t.contains("channels")){console.log("make channels store");$.createObjectStore("channels",{keyPath:"id"})}if(!t.contains("groups")){console.log("make groups store");$.createObjectStore("groups",{keyPath:"id"})}for(const e of R)$.objectStoreNames.contains(e)||(console.warn(`[db] ${e} store missing, creating a dummy one`),$.createObjectStore(e));console.warn("[db] database upgrade complete")},caches.open("sonic").then((e=>M=e));const _=async(e,t)=>{let n=await j.join();n&&(w(t),n.transaction(["session"],"readwrite").objectStore("session").put(t,e))},B=async(e,t)=>{let n=await j.join();if(!n)return;let r=n.transaction([e],"readwrite").objectStore(e);t.forEach((e=>r.add(e))),N.transaction((n=>{t.forEach((t=>{let r=Object.keys(t),o=`INSERT OR REPLACE INTO ${e} (${r.join(",")}) VALUES (${Array(r.length).fill("?").join(",")})`;n.executeSql(o,Object.values(t).map((e=>"function"==typeof e?e():e)),x,O)}))}))},G=async(e,t)=>{let n=await j.join();n&&(console.log("add",e,t),n.transaction([e],"readwrite").objectStore(e).add(t),N.transaction((n=>{let r=Object.keys(t),o=`INSERT OR REPLACE INTO ${e} (${r.join(",")}) VALUES (${Array(r.length).fill("?").join(",")})`;n.executeSql(o,Object.values(t).map((e=>"function"==typeof e?e():e)),x,O)})))},K=async(e,t)=>{let n=await j.join();if(!n)return{value:[],missed:t};let r=performance.now(),o=[],a=new Set,i=n.transaction([e],"readonly").objectStore(e),s=0;return new Promise((n=>{t.forEach((l=>{let c=i.get(l);c.onsuccess=i=>{c.result?o.push(c.result):a.add(l),++s===t.length&&(console.log("[db]",`get ${e} in`,S(r),"ms"),n({value:o,missed:Array.from(a)}))}}))}))},q=async(e,t,n,r=!1)=>{let o=await j.join();if(!o)return{value:[]};let a=performance.now(),i=[],s=(([e,t])=>{let n=new Set;for(var r=e;r<=t;r++)n.add(r);return n})([n-t,n-1]),l=o.transaction([e],"readonly").objectStore(e),c=0,u=n?IDBKeyRange.upperBound(n,r):null;return new Promise((r=>{l.openCursor(u,"prev").onsuccess=o=>{var l=o.target.result;if(l){if(i.push(l.value),s.delete(l.key),++c===t)return console.log("[db]","scan "+e,t,n||"","in",S(a),"ms"),r({value:i,missed:Array.from(s)});l.continue()}else console.log("[db]","scan "+e,t,n||"","in",S(a),"ms"),r({value:i,missed:Array.from(s)})}}))},F=async(e,t)=>{let n=await j.join();if(!n)return;let r=n.transaction(["ranges"],"readwrite").objectStore("ranges"),o=r.get(e);o.onsuccess=async n=>{o.result?(o.result.push(t),r.put(z(o.result),e)):r.put([t],e)}},Y=e=>V(e,"session"),V=async(e,t)=>{let n=await j.join();if(!n)return;let r=n.transaction([t],"readonly").objectStore(t);return new Promise((t=>{let n=r.get(e);n.onsuccess=e=>t(n.result)}))},z=e=>{var t,n=[];return e.sort(((e,t)=>e[0]-t[0]||e[1]-t[1])),e.forEach((e=>{!t||e[0]>t[1]+1?n.push(t=e):e[1]>t[1]&&(t[1]=e[1])})),n};var W,X,J,Z,Q,ee,te;!function(e){e.None=function(e){return{tag:"None",value:e}},e.Id=function(e){return{tag:"Id",value:e}},e.TopicId=function(e){return{tag:"TopicId",value:e}},e.ChannelId=function(e){return{tag:"ChannelId",value:e}},e.GroupId=function(e){return{tag:"GroupId",value:e}},e.By=function(e){return{tag:"By",value:e}}}(W||(W={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Email=function(e){return{tag:"Email",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(X||(X={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(J||(J={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(Z||(Z={})),function(e){e.Id=function(e){return{tag:"Id",value:e}}}(Q||(Q={})),function(e){e.User=function(e){return{tag:"User",value:e}},e.Group=function(e){return{tag:"Group",value:e}},e.Groups=function(e){return{tag:"Groups",value:e}},e.Channel=function(e){return{tag:"Channel",value:e}},e.Channels=function(e){return{tag:"Channels",value:e}},e.Topic=function(e){return{tag:"Topic",value:e}},e.ChatScan=function(e){return{tag:"ChatScan",value:e}},e.AddChat=function(e){return{tag:"AddChat",value:e}},e.AddUser=function(e){return{tag:"AddUser",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.Logout=function(e){return{tag:"Logout",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Topics=function(e){return{tag:"Topics",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}}}(ee||(ee={})),function(e){e.User=function(e){return{tag:"User",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Group=function(e){return{tag:"Group",value:e}},e.Groups=function(e){return{tag:"Groups",value:e}},e.Channel=function(e){return{tag:"Channel",value:e}},e.Channels=function(e){return{tag:"Channels",value:e}},e.Topic=function(e){return{tag:"Topic",value:e}},e.Topics=function(e){return{tag:"Topics",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.Chat=function(e){return{tag:"Chat",value:e}},e.Login=function(e){return{tag:"Login",value:e}}}(te||(te={}));const ne=(e,t=0,n=!0)=>({pos:t,littleEndian:n,view:new DataView(e)}),re=(e,t)=>{const{view:{buffer:n},pos:r}=e,o=n.byteLength;if(o-r>t)return e;const a=Math.max(2*o,o+t),i=new Uint8Array(a);return i.set(new Uint8Array(n)),ne(i.buffer,r,e.littleEndian)},oe=(e,t)=>{e=re(e,1);const{view:n,pos:r}=e;return n.setUint8(r,t),e.pos+=1,e},ae=(e,t)=>{e=re(e,4);const{view:n,pos:r,littleEndian:o}=e;return n.setUint32(r,t,o),e.pos+=4,e},ie=(e,t)=>{e=re(e,2);const{view:n,pos:r,littleEndian:o}=e;return n.setUint16(r,t,o),e.pos+=2,e};function se(e,t){const{view:n,pos:r,littleEndian:o}=e;return n.setUint32(o?r:r+4,t,o),n.setUint32(o?r+4:r,0,o),e.pos+=8,e}const le=(e,t)=>{e=re(e,4);const{view:n,pos:r,littleEndian:o}=e;return n.setInt32(r,t,o),e.pos+=4,e},ce=new TextEncoder,ue="encodeInto"in ce?(e,t)=>ce.encodeInto(e,t).written:(e,t)=>{const n=ce.encode(e);return t.set(n),n.length},de=(e,t)=>{e=re(e,3*t.length+8);const n=ue(t,new Uint8Array(e.view.buffer,e.pos+8));return(e=se(e,n)).pos+=n,e},pe=(e,t)=>oe(e,t?1:0),fe=e=>(t,n)=>n.reduce(e,((e,t)=>se(re(e,8),t))(t,n.length)),ge=e=>(t,n)=>null===n?oe(t,0):e(oe(t,1),n),he=e=>{const{pos:t,view:n}=e;return e.pos+=1,n.getUint8(t)},me=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getUint32(t,r)},ye=e=>{const{view:t,pos:n,littleEndian:r}=e;return e.pos+=8,t.getUint32(r?n:n+4,r)},ve=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getInt32(t,r)},we=e=>1===he(e),be=e=>t=>1===he(t)?e(t):null,Ae=e=>t=>{const n=ye(t),r=new Array;for(let o=0;o<n;o++)r.push(e(t));return r},Te=new TextDecoder,Ee=e=>{const t=ye(e),{pos:n,view:{buffer:r}}=e,o=Te.decode(new Uint8Array(r,n,t));return e.pos+=t,o};ge(de),ge(pe);var Ie=de,Ce=(ge(Ie),fe(oe)),Le=fe(le),Se=(fe((function(e,t){var n=t.id,r=t.handle;return de(le(e,n),r)})),function(e,t){var n=t.id,r=t.name,o=t.handle,a=t.by,i=t.createdAt,s=t.updatedAt;return Ie(Ie(le(de(de(le(e,n),r),o),a),i),s)}),Ue=(fe(Se),function(e,t){var n=t.id,r=t.name,o=t.handle,a=t.groupId,i=t.by,s=t.createdAt,l=t.updatedAt;return Ie(Ie(le(le(de(de(le(e,n),r),o),a),i),s),l)}),ke=(fe(Ue),function(e,t){var n=t.id,r=t.name,o=t.groupId,a=t.channelId,i=t.by,s=t.createdAt,l=t.updatedAt;return Ie(Ie(le(le(le(de(le(e,n),r),o),a),i),s),l)}),Ne=(fe(ke),function(e,t){var n=t.id,r=t.txt,o=t.by,a=t.re,i=t.nor,s=t.topicId,l=t.channelId,c=t.groupId,u=t.createdAt,d=t.updatedAt;return Ie(Ie(le(le(le(le(le(le(de(le(e,n),r),o),a),i),s),l),c),u),d)}),xe=(fe(Ne),function(e,t){var n=t.filter,r=t.ub,o=t.lb,a=t.limit;return ie(le(le(function(e,t){switch(t.tag){case"None":return pe(ae(e,0),t.value);case"Id":return le(ae(e,1),t.value);case"TopicId":return le(ae(e,2),t.value);case"ChannelId":return le(ae(e,3),t.value);case"GroupId":return le(ae(e,4),t.value);case"By":return le(ae(e,5),t.value)}}(e,n),r),o),a)}),Oe=function(e,t){switch(t.tag){case"User":return function(e,t){switch(t.tag){case"Id":return le(ae(e,0),t.value);case"Email":return de(ae(e,1),t.value);case"Handle":return de(ae(e,2),t.value)}}(ae(e,0),t.value);case"Group":return function(e,t){switch(t.tag){case"Id":return le(ae(e,0),t.value);case"Handle":return de(ae(e,1),t.value)}}(ae(e,1),t.value);case"Groups":return function(e,t){var n=t.limit,r=t.page;return ie(ie(e,n),r)}(ae(e,2),t.value);case"Channel":return function(e,t){switch(t.tag){case"Id":return le(ae(e,0),t.value);case"Handle":return de(ae(e,1),t.value)}}(ae(e,3),t.value);case"Channels":return function(e,t){var n=t.group_id,r=t.limit,o=t.page;return ie(ie(le(e,n),r),o)}(ae(e,4),t.value);case"Topic":return function(e,t){switch(t.tag){case"Id":return le(ae(e,0),t.value)}}(ae(e,5),t.value);case"ChatScan":return xe(ae(e,6),t.value);case"AddChat":return function(e,t){var n=t.txt,r=t.by,o=t.re,a=t.topicName,i=t.topicId,s=t.channelId,l=t.groupId;return le(le(le(de(le(le(de(e,n),r),o),a),i),s),l)}(ae(e,7),t.value);case"AddUser":return function(e,t){var n=t.email,r=t.handle,o=t.key;return Ce(de(de(e,n),r),o)}(ae(e,8),t.value);case"Login":return function(e,t){var n=t.email,r=t.key;return Ce(de(e,n),r)}(ae(e,9),t.value);case"Logout":return Ce(ae(e,10),t.value);case"Users":return Le(ae(e,11),t.value);case"Topics":return Le(ae(e,12),t.value);case"Chats":return Le(ae(e,13),t.value)}},je=be(Ee),Pe=be(we),Re=Ee,$e=be(Re),Me=Ae(he),De=(Ae(ve),Ae((function(e){return{id:ve(e),handle:Ee(e)}}))),He=function(e){return{id:ve(e),name:Ee(e),handle:Ee(e),by:ve(e),createdAt:Re(e),updatedAt:Re(e)}},_e=Ae(He),Be=function(e){return{id:ve(e),name:Ee(e),handle:Ee(e),groupId:ve(e),by:ve(e),createdAt:Re(e),updatedAt:Re(e)}},Ge=Ae(Be),Ke=function(e){return{id:ve(e),name:Ee(e),groupId:ve(e),channelId:ve(e),by:ve(e),createdAt:Re(e),updatedAt:Re(e)}},qe=Ae(Ke),Fe=function(e){return{id:ve(e),txt:Ee(e),by:ve(e),re:ve(e),nor:ve(e),topicId:ve(e),channelId:ve(e),groupId:ve(e),createdAt:Re(e),updatedAt:Re(e)}},Ye=Ae(Fe),Ve=function(e){switch(me(e)){case 0:return te.User(function(e){return{id:ve(e),handle:Ee(e),email:Ee(e),emailVerified:we(e),name:Ee(e),key:Ee(e),picture:je(e),gender:Pe(e),lastLogin:$e(e),createdAt:Re(e),updatedAt:Re(e)}}(e));case 1:return te.Users(De(e));case 2:return te.Group(He(e));case 3:return te.Groups(_e(e));case 4:return te.Channel(Be(e));case 5:return te.Channels(Ge(e));case 6:return te.Topic(Ke(e));case 7:return te.Topics(qe(e));case 8:return te.Chats(Ye(e));case 9:return te.Chat(Fe(e));case 10:return te.Login(Me(e))}throw new Error("bad variant index for Response")},ze=ne(new ArrayBuffer(512)),We=function(e,t){return ze.pos=0,ze=t(ze,e),new Uint8Array(ze.view.buffer).slice(0,ze.pos)},Xe=function(e,t){return t(ne(e))},Je=function(e){return Xe(e.buffer,Ve)},Ze=function(e){return We(e,Oe)};const Qe=e=>new Zlib.Inflate(e).decompress(),et=e=>new Zlib.Deflate(e).compress(),tt=async(e,t,n)=>(console.log("[sec] encrypting data"),await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e)),nt=async(e,t,n)=>(console.log("[sec] decrypting data"),await crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,e)),rt={};async function ot(){let e=await Y("u");e&&(rt.user=e);let t=await Y("a");t&&(t=new Uint8Array(t),16===t.length&&(rt.salt=t));let n=await Y("s");return n&&(n=new Uint8Array(n),32===n.length&&(rt.sskey=await crypto.subtle.importKey("raw",n,"AES-GCM",!1,["encrypt","decrypt"]))),console.log("[au]",rt),rt.salt}async function at(e,t){let n=new TextEncoder,r=await it(n.encode(e),n.encode(t));return await crypto.subtle.exportKey("raw",r)}async function it(e,t){let n=await crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}const st=document.location.hash.substr(1).match(/^ip\/(?<ip>[\:\.\d]+)$/),lt="wss://"+(st?st.groups.ip:"192.168.100.11:443");let ct,ut,dt,pt,ft,gt,ht,mt,yt,vt,wt,bt=500,At=0,Tt={},Et=0,It=1;console.group("[ws]","starting..."),function e(t){ct=performance.now(),ut=new WebSocket(lt),ut.binaryType="arraybuffer",ut.onopen=()=>{console.log(`[ws] open in ${S(ct)} ms`),console.groupEnd("[ws]"),console.group("[dc]","opening..."),t?St():ft&&Nt()},ut.onmessage=async e=>{console.log(`[ws] <- received answer in ${S(ct)} ms`);let t=new Uint8Array(e.data),{a:n,k:r}=T(t);var o,a,i;Lt=(e=>{const t=new l(e);return{z:t.get(0),m:t.get(1),c:t.get(2),d:t.get(3)}})(n),console.log(Lt),Tt.onconfig&&Tt.onconfig(Lt),r=await(o=r,crypto.subtle.importKey("raw",o,{name:"ECDH",namedCurve:"P-256"},!0,[])),vt=await(a=pt.privateKey,i=r,crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:i},a,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])),yt=new Uint8Array(await crypto.subtle.exportKey("raw",vt));let s=JSON.parse((e=>(new TextDecoder).decode(Qe(e)))(n.slice(1))),c=s.answer?s.answer:s;if(await gt.setRemoteDescription(new RTCSessionDescription(c)),!s.candidate)return;const u=new RTCIceCandidate({candidate:s.candidate,sdpMid:0,sdpMLineIndex:0});await gt.addIceCandidate(u)},ut.onclose=t=>{At++,bt+=C(0,At<16?200:3e3),console.warn("[ws] closed",t),console.groupEnd("[ws]"),console.groupEnd("[ws]"),console.groupCollapsed("[ws]",`retry ${At} in ${(bt/1e3).toFixed(2)} sec`),setTimeout((()=>{e(!0)}),bt)},ut.onerror=e=>{console.error("[ws] error",e)}}(),St();const Ct=k();var Lt={};function St(){ht=!1,function(){gt=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]});let e=It++;gt.onicecandidate=e=>{e.candidate},gt.onconnectionstatechange=t=>{switch(gt.connectionState){case"failed":case"disconnected":console.warn("[peer]",e,gt.connectionState,"restarting....")}},gt.oniceconnectionstatechange=t=>{switch(gt.iceConnectionState){case"disconnected":console.warn("[ice]",e,gt.connectionState,"restarting....")}}}(),wt=gt.createDataChannel("cu",{}),wt.binaryType="arraybuffer",Et=0,Tt.send=Ut,wt.onopen=e=>{console.log(`[dc] open in ${S(ct)} ms`),console.groupEnd("[dc]"),Et=0,Ct.complete(wt)},wt.onmessage=kt,wt.onclose=e=>{console.warn("[dc] close",e)},wt.onerror=e=>{console.error("[dc] error:",e)},async function(){const e=async()=>{let e=await gt.createOffer();return await gt.setLocalDescription(e),et((new TextEncoder).encode(gt.localDescription.sdp))},t=async()=>{if(mt)return mt;pt=await(async()=>(console.log("[sec] generating key pairs"),await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"])))();let e=await crypto.subtle.exportKey("raw",pt.publicKey);return mt=new Uint8Array(e),mt};ft=await(async(e,t,n)=>{let[r,o,a]=await Promise.all([e(),t(),n()]);return a?A(A(r,o),a):U(A(r,o),64,24)})(e,t,ot),console.log(`[dc] sdp in ${S(ct)} ms`),1===ut.readyState&&Nt()}()}async function Ut(e){if(await Ct.join(),Et++,console.groupEnd("[dc]"),console.group("[dc]","-> sending packet",Et,e),e=Ze(e),w(e),Lt.z&&(e=et(e)),Lt.m&&(e=U(e,e.length),b(e,yt)),Lt.c){const t=crypto.getRandomValues(new Uint8Array(12));b(e,t),e=L(t,new Uint8Array(await tt(e,vt,t)))}if(Lt.d){const t=crypto.getRandomValues(new Uint8Array(12));b(e,t),e=L(t,new Uint8Array(await tt(e,rt.sskey,t)))}wt.send(e),dt=performance.now(),console.groupEnd("[dc]")}async function kt(e){let t=new Uint8Array(e.data),n=t.length;if(console.groupEnd("[dc]"),console.group("[dc]","<- received",n,"bytes in",S(dt),"ms"),Lt.d){let e=t.subarray(0,12);t=new Uint8Array(await nt(t.subarray(12),rt.sskey,e)),b(t,e)}if(Lt.c){let e=t.subarray(0,12);t=new Uint8Array(await nt(t.subarray(12),vt,e)),b(t,e)}if(Lt.m){b(t,yt);let{a:e}=T(t);t=new Uint8Array(e)}Lt.z&&(t=Qe(t));let r=(100*n/t.length).toFixed(2);console.log(`[dc] unpacked ${n} / ${t.length} bytes ${r}% in ${S(dt)} ms`);let o=xt(t);Tt.recv&&Tt.recv(o),console.groupEnd("[dc]")}const Nt=()=>{ht||(console.log("[ws] -> sending offer"),ut.send(ft),ht=!0)},xt=e=>{let t=Je(e);return console.log(t),console.table(t.value),t};let Ot={},jt=[];function Pt(e){return this.t&&this.t[e.type](e)}Ot.h=(...e)=>{let t,n=r=>{if(null==r);else if("string"==typeof r)t?Ot.add(t,r):t=Ot.s?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r);else if(Array.isArray(r))t||(t=document.createDocumentFragment()),r.forEach(n);else if(r instanceof Node)t?Ot.add(t,r):t=r;else if("object"==typeof r)Ot.property(t,r,null,Ot.s);else if("function"==typeof r)if(t){let e=Ot.add(t,"");Ot.insert(t,r,e)}else t=r.apply(null,e.splice(1));else Ot.add(t,""+r)};return e.forEach(n),t},Ot.insert=(e,t,n,r,o)=>(e=n&&n.parentNode||e,o=o||r instanceof Node&&r,t===r||(r&&"string"!=typeof r||!("string"==typeof t||"number"==typeof t&&(t+=""))?"function"==typeof t?Ot.subscribe((()=>{r=Ot.insert(e,t.call({el:e,endMark:n}),n,r,o)})):(n?r&&(o||(o=r.o&&r.o.nextSibling||n.previousSibling),Ot.rm(e,o,n)):e.textContent="",r=null,t&&!0!==t&&(r=Ot.add(e,t,n))):(null!=r&&e.firstChild?n?(n.previousSibling||e.lastChild).data=t:e.firstChild.data=t:n?Ot.add(e,t,n):e.textContent=t,r=t)),r),Ot.property=(e,t,n,r,o)=>{if(null!=t)if(!n||"attrs"===n&&(r=!0))for(n in t)Ot.property(e,t[n],n,r,o);else"o"!==n[0]||"n"!==n[1]||t.$o?"function"==typeof t?Ot.subscribe((()=>{Ot.property(e,t.call({el:e,name:n}),n,r,o)})):o?e.style.setProperty(n,t):r||"data-"===n.slice(0,5)||"aria-"===n.slice(0,5)?e.setAttribute(n,t):"style"===n?"string"==typeof t?e.style.cssText=t:Ot.property(e,t,null,r,!0):("class"===n&&(n+="Name"),e[n]=t):((e,t,n)=>{t=t.slice(2).toLowerCase(),n?e.addEventListener(t,Pt):e.removeEventListener(t,Pt),(e.t||(e.t={}))[t]=n})(e,n,t)},Ot.add=(e,t,n)=>{let r=(e=>{const{childNodes:t}=e;if(t&&11===e.nodeType)return t.length<2?t[0]:{o:Ot.add(e,"",t[0])}})(t=(e=>"string"==typeof e?document.createTextNode(e):e instanceof Node?e:Ot.h(jt,e))(t))||t;return e.insertBefore(t,n&&n.parentNode&&n),r},Ot.rm=(e,t,n)=>{for(;t&&t!==n;){let n=t.nextSibling;e===t.parentNode&&e.removeChild(t),t=n}},Ot.subscribe=function(e){return function(e,t){function n(){let r=c;return c&&c.__c.push(n),f(n),n.i=!0,c=n,t=e(t),c=r,t}function r(){return n.i?c&&n.u.forEach((e=>e())):t=n(),t}e.s=n,g(n),n(),r.$o=1}(e),()=>f(e.s)},Ot.cleanup=function(e){return c&&c.l.push(e),e},Ot.root=d,Ot.sample=function(e){let t=c;c=void 0;let n=e();return c=t,n},Ot.hs=(...e)=>{let t=Ot.s;Ot.s=!0;let n=Rt(...e);return Ot.s=t,n};let Rt=(...e)=>Ot.h.apply(Ot.h,e);function $t(e,t,n){const{root:r,subscribe:o,sample:a,cleanup:i}=Ot;null==n&&(n=!t.$t);let s=Ot.h([]),l=Ot.add(s,""),c=new Map,u=new Map,d=new Set;function p(e,o){if(null==e)return;let a=u.get(e);return 1===o?(d.delete(e),a||(a=n?r((n=>(c.set(e,n),t(e.$v||e)))):t(e.$v||e),11===a.nodeType&&(a=(e=>{const{childNodes:t}=e,{length:n}=t;if(n<2)return t[0];let r=Array.from(t);return{nodeType:111,t:r[0],o:r[n-1],l(){if(t.length!==n){let t=0;for(;t<n;)e.appendChild(r[t++])}return e}}})(a)||a),u.set(e,a))):-1===o&&d.add(e),((e,t)=>111===e.nodeType?1/t<0?t?Ot.rm(e.t.parentNode,e.t.nextSibling,e.o.nextSibling)||e.t:e.o:t?e.l():e.t:e)(a,o)}function f(e){let t=c.get(e);t&&(t(),c.delete(e)),u.delete(e)}return i(o((t=>{let n=e();return a((()=>{d.clear();let e=Array.from(function(e,t,n,r,o){let a,i,s=new Map,l=new Map;for(a=0;a<t.length;a++)s.set(t[a],a);for(a=0;a<n.length;a++)l.set(n[a],a);for(a=i=0;a!==t.length||i!==n.length;){var c=t[a],u=n[i];if(null===c)a++;else if(n.length<=i)e.removeChild(r(t[a],-1)),a++;else if(t.length<=a)e.insertBefore(r(u,1),r(t[a],0)||o),i++;else if(c===u)a++,i++;else{var d=l.get(c),p=s.get(u);void 0===d?(e.removeChild(r(t[a],-1)),a++):void 0===p?(e.insertBefore(r(u,1),r(t[a],0)||o),i++):(e.insertBefore(r(t[p],1),r(t[a],0)||o),t[p]=null,p>a+1&&a++,i++)}}return n}(l.parentNode,t||[],n,p,l));return d.forEach(f),e}))}))),i((function(){c.forEach((e=>e())),c.clear(),u.clear(),d.clear()})),s}const Mt=()=>_t()===Dt?_t(Ht):_t(Dt),Dt=({items:e,keys:t},...n)=>Rt([Rt("table",null,Rt("thead",null,Rt("tr",null,$t(t,(e=>Rt("th",{scope:"col"},e))))),Rt("tbody",null,$t(e,(e=>Rt("tr",{onclick:t=>location.hash="#channels/"+e.id},$t(t,(t=>Rt("td",null,Rt("span",null,t)," ",e[t])))))))),n]),Ht=({items:e},...t)=>Rt([Rt("ul",null,$t(e,(e=>Rt("li",{id:e.id},e.name)))),t]),_t=p(Dt);const Bt=({group_id:e})=>{let t=p([]),n=0;Tt.recv=e=>{let r=e.value;if(Array.isArray(r))return 0==r.length?n--:t(r);let o=t();o.unshift(r),t(o)};const r=t=>ee.Channels({group_id:e,limit:30,page:t}),o=e=>{n++,Tt.send(r(n))};return o(),Rt([Rt("button",{onclick:e=>{n--,n<1&&(n=1),Tt.send(r(n))}},"Prev Item"),Rt("button",{onclick:o},"Next Item"),Rt("button",{onclick:e=>{n=0;let t=setInterval((function(){300==n?clearInterval(t):o()}),1)}},"Run Load"),Rt("button",{onclick:Gt},"Switch Component"),Rt("h2",null,"Channels"),Rt(v(Ft),{items:t,keys:()=>Object.keys(t()[0]||{})})])},Gt=()=>Ft()===Kt?Ft(qt):Ft(Kt),Kt=({items:e,keys:t},...n)=>Rt([Rt("table",null,Rt("thead",null,Rt("tr",null,$t(t,(e=>Rt("th",{scope:"col"},e))))),Rt("tbody",null,$t(e,(e=>Rt("tr",{onclick:t=>location.hash="#topics/"+e.id},$t(t,(t=>Rt("td",null,Rt("span",null,t)," ",e[t])))))))),n]),qt=({items:e},...t)=>Rt([Rt("ul",null,$t(e,(e=>Rt("li",{id:e.id},e.name)))),t]),Ft=p(Kt),Yt="defaultParagraphSeparator",Vt="formatBlock",zt=(e,t,n)=>e.addEventListener(t,n),Wt=(e,t)=>e.appendChild(t),Xt=e=>document.createElement(e),Jt=e=>document.queryCommandState(e),Zt=(e,t=null)=>document.execCommand(e,!1,t),Qt={bold:{icon:"<b>B</b>",title:"Bold",state:()=>Jt("bold"),result:()=>Zt("bold")},italic:{icon:"<i>I</i>",title:"Italic",state:()=>Jt("italic"),result:()=>Zt("italic")},underline:{icon:"<u>U</u>",title:"Underline",state:()=>Jt("underline"),result:()=>Zt("underline")},strikethrough:{icon:"<strike>S</strike>",title:"Strike-through",state:()=>Jt("strikeThrough"),result:()=>Zt("strikeThrough")},heading1:{icon:"<b>H1</b>",title:"Heading 1",result:()=>Zt(Vt,"<h1>")},heading2:{icon:"<b>H2</b>",title:"Heading 2",result:()=>Zt(Vt,"<h2>")},quote:{icon:"&#8220;&#8221;",title:"Quote",result:()=>Zt(Vt,"<blockquote>")},olist:{icon:"1.",title:"Ordered List",result:()=>Zt("insertOrderedList")},ulist:{icon:"&#8226;",title:"Unordered List",result:()=>Zt("insertUnorderedList")},code:{icon:"&lt;&gt;",title:"Code",result:()=>Zt(Vt,"<pre>")},line:{icon:"&#8213;",title:"Horizontal Line",result:()=>Zt("insertHorizontalRule")},link:{icon:"&#128279;",title:"Link",result:()=>{const e=window.prompt("Enter the link URL");e&&Zt("createLink",e)}},image:{icon:"&#128247;",title:"Image",result:()=>{const e=window.prompt("Enter the image URL");e&&Zt("insertImage",e)}}},en={actionbar:"pell-actionbar",button:"pell-button",content:"pell-content",selected:"pell-button-selected",topic:"pell-topic"},tn=({topic_id:e,chat_id:t})=>{let n,r=p([]),o={},a={},i={},s=p(0),l="";const c=((...e)=>{const t={},n={};return{create:e=>n[e]=new Promise((n=>t[e]=n)),complete:(e,n)=>t[e](n),join:e=>n[e],joinall:()=>Promise.all(e.map((e=>n[e]))),select:()=>Promise.race(e.map((e=>n[e])))}})("users","topics");Tt.recv=async e=>{switch(e.tag){case"Users":B("users",e.value),c.complete("users",e.value);break;case"Topics":B("topics",e.value),c.complete("topics",e.value);break;case"Chat":let t=window.scrollY+window.innerHeight===document.body.scrollHeight;await G("chats",e.value),F("chats",[e.value.id,e.value.id]);let n=new Set([e.value.by]),a=new Set([e.value.topicId]);await d(n,a);let i=r();e.value.nor=p(0),e.value.star=p(!1),o[e.value.id]=e.value,i.push(e.value.id),r(i),t&&m();break;case"Chats":let s=e.value;if(0==s.length)return;await B("chats",s),F("chats",[s[s.length-1].id,s[0].id]),u(s)}};const u=async t=>{let n=t[0].id,a=new Set,s=new Set,l=r();l=t.reverse().map((e=>(e.nor=p(e.nor),e.star=p(!1),e.createdAt=new Date(e.createdAt),e.updatedAt=new Date(e.updatedAt),o[e.id]=e,a.add(e.by),s.add(e.topicId),e.id))).concat(l),await d(a,s),r(l),e&&(document.title=i[e].name),window.scrollY<100&&setTimeout((()=>document.getElementById(n).scrollIntoView()))},d=async(e,t)=>{let n=await K("users",Array.from(e)),r=await K("topics",Array.from(t));h(n.value,a),h(r.value,i),n.missed.length>0&&c.create("users",Tt.send(ee.Users(n.missed))),r.missed.length>0&&c.create("topics",Tt.send(ee.Topics(r.missed)));let[o,s]=await c.joinall();o&&h(o,a),s&&h(s,i)},f=(n,r,o)=>{let a=ee.ChatScan({filter:e>0?W.TopicId(e):t>0?W.Id(t):W.None(!0),ub:n,lb:r,limit:o});Tt.send(a)};(async(e=30)=>{let t=await q("chats",e);console.log("[chats]",t);let n=t.value[0]?t.value[0].id:0;n&&u(t.value),f(99999,n,e)})(),setTimeout((function(){new IntersectionObserver((e=>{e[0].intersectionRatio<=0||setTimeout((()=>(async(e=30)=>{let t=r()[0];if(!t)return;let{value:n,missed:o}=await q("chats",e,t,!0);n.length>0?(u(n),o.length>0&&Tt.send(ee.Chats(o))):f(t,0,e)})()))}),{}).observe(T)}));const g=(e=>{const t=e.actions?e.actions.map((e=>"string"==typeof e?Qt[e]:Qt[e.name]?{...Qt[e.name],...e}:e)):Object.keys(Qt).map((e=>Qt[e])),n={...en,...e.classes},r=e.defaultParagraphSeparator||"div",o=e.element.topic=Xt("div");o.contentEditable=!0,o.className=n.topic,o.onkeydown=e=>{"Enter"===e.key&&(a.focus(),e.preventDefault())},Wt(e.element,o);const a=e.element.content=Xt("div");a.contentEditable=!0,a.className=n.content,a.onfocus=()=>{let t=window.scrollY+window.innerHeight===document.body.scrollHeight;e.element.classList.add("sticky"),t&&setTimeout((()=>m()))},a.onblur=()=>{setTimeout((()=>{e.element.contains(document.activeElement)||e.element.classList.remove("sticky")}))},a.oninput=({target:{firstChild:t}})=>{e.onchange(a.innerHTML)},a.onkeydown=t=>{"Enter"!==t.key||t.shiftKey||(e.onsend(),t.preventDefault())},Wt(e.element,a);const i=Xt("div");return i.className=n.actionbar,Wt(e.element,i),t.forEach((e=>{const t=Xt("button");if(t.className=n.button,t.innerHTML=e.icon,t.title=e.title,t.setAttribute("type","button"),t.onclick=()=>e.result()&&a.focus(),e.state){const r=()=>t.classList[e.state()?"add":"remove"](n.selected);zt(a,"keyup",r),zt(a,"mouseup",r),zt(t,"click",r)}Wt(i,t)})),e.styleWithCSS&&Zt("styleWithCSS"),Zt(Yt,r),e.element})({element:Rt("div",{class:"pell"}),onchange:e=>{},onsend:()=>{if(!rt.user||!rt.user.id)return void alert("you are not login!");if(!g.content.textContent.trim())return;let e=s()||n,{topicId:t,channelId:r,groupId:a}=o[e],i="";if(console.log(l),g.topic.textContent!==l&&(e=0,t=0,i=g.topic.textContent,0===i.trim().length))return void alert("topic should not be empty");let c=g.content.innerHTML.trim(),u=rt.user.id;Tt.send(ee.AddChat({txt:c,by:u,re:e,topicName:i,topicId:t,channelId:r,groupId:a})),g.content.textContent="",y({})}});g.content.innerHTML="";const y=({id:e,txt:t})=>{if(!e||s()===e)return g.topic.textContent="",l="",void s(0);g.topic.innerHTML=t,g.topic.textContent=g.topic.textContent,l=g.topic.textContent,s(e)},v=(t,l)=>{let{id:c,txt:u,by:d,topicId:p,re:f,star:g,nor:h}=t,m=o[n]||{},y=m.by!==d,v=m.topicId!==p;n=c;let A=i[p];const T=()=>{w("#reps/"+c,c)};return Rt("div",{id:c,class:function(){return"chat"+(()=>(g()?" star":"")+(v?" topic":"")+(s()===c?" cur":"")).call(this)},onclick:e=>b(e,t)},v?Rt("div",{class:"topic-name"+(f?" re":" new")+(e?" head":"")},Rt("a",{href:function(){return"#chats/"+("function"==typeof p?p.call(this):p)},onclick:e=>(w("#chats/"+p,A.name),e.preventDefault(),!1),innerHTML:A.name})):null,y||v?Rt("div",{class:"by"},a[d].handle):null,Rt("div",{onclick:e=>e.stopPropagation()},(()=>{let e=h();if(1!==e||c!==o[r()[l+1]].re)return e>0?Rt([Rt("span",{class:"rep",onclick:T},e," ðŸ’¬")," "]):void 0}),(e=>document.createRange().createContextualFragment(e))(u)))},w=(e,t)=>{let n=screen.width/2-300,r=screen.height/2-300;window.open(e,t,`toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=600,height=600,top=${r}, left=${n}`)},b=(e,t)=>{e.x<18&&e.offsetY<22&&A(t),e.x+28>e.target.offsetWidth&&e.offsetY<22&&y(t)},A=({id:e,star:t})=>{const n=r().filter((t=>t===e))[0],a=o[n];a.star?a.star(!t()):a.star=p(!1)},T=Rt("div",{class:"sentinel"});return Rt([T,Rt("div",{class:"topics"},$t(r,((e,t)=>v(o[e],t)))),g])};var nn;Tt.onconfig=e=>{e.d?an(on):an(rn)};const rn=()=>Rt("div",{class:"login"},Rt("h2",null,"Login"),Rt("form",{onsubmit:async function(e){e.preventDefault();let t=e.target,n=t.email.value;nn=await at(t.password.value,n);let r={email:n,key:Array.from(new Uint8Array(nn))};Tt.send(ee.Login(r)),console.log(r)}},Rt("input",{type:"text",name:"email",placeholder:"email",required:!0,autocomplete:"true"}),Rt("input",{type:"password",name:"password",placeholder:"password",required:!0,autocomplete:"true"}),Rt("button",{type:"submit"},"Login")),Rt("h2",null,"Register"),Rt("form",{onsubmit:async function(e){e.preventDefault();let t=e.target,n=t.email.value,r=t.username.value;nn=await at(t.password.value,n);let o={email:n,handle:r,key:Array.from(new Uint8Array(nn))};Tt.send(ee.AddUser(o)),console.log(o)}},Rt("input",{type:"text",name:"email",placeholder:"email",required:!0,autocomplete:"true"}),Rt("input",{type:"text",name:"username",placeholder:"username",required:!0,autocomplete:"true"}),Rt("input",{type:"password",name:"password",placeholder:"password",required:!0,autocomplete:"true"}),Rt("button",{type:"submit"},"Register"))),on=()=>Rt([Rt("div",null,"You have logged in"),Rt("button",{onclick:async()=>{await Tt.send(ee.Logout(Array.from(rt.salt))),(async()=>{let e=await j.join();e&&e.transaction(["session"],"readwrite").objectStore("session").clear()})(),Lt.d=!1,rt.user=void 0,rt.sskey=void 0,rt.salt=void 0,an(rn)}},"Logout")]),an=p((()=>null)),sn=(e,t)=>({pattern:e,view:t}),ln=["channels","groups","login"],cn=[sn(/^$/,tn),sn(/^groups$/,(()=>{let e=p([]),t=0;Tt.recv=n=>{let r=n.value;if(Array.isArray(r))return 0==r.length?t--:e(r);let o=e();o.unshift(r),e(o)};const n=e=>ee.Groups({limit:30,page:e}),r=e=>{t++,Tt.send(n(t))};return r(),Rt([Rt("button",{onclick:e=>{t--,t<1&&(t=1),Tt.send(n(t))}},"Prev Item"),Rt("button",{onclick:r},"Next Item"),Rt("button",{onclick:e=>{t=0;let n=setInterval((function(){300==t?clearInterval(n):r()}),1)}},"Run Load"),Rt("button",{onclick:Mt},"Switch Component"),Rt("h2",null,"Groups"),Rt(v(_t),{items:e,keys:()=>Object.keys(e()[0]||{})})])})),sn(/^channels$/,Bt),sn(/^login$/,(()=>(Tt.recv=async e=>{switch(e.tag){case"Login":if(e.value.length<16)return void console.warn("login failed");let t=new Uint8Array(e.value.slice(16,20));rt.user={id:new DataView(t.buffer).getInt32(t,!1),handle:(new TextDecoder).decode(new Uint8Array(e.value.slice(20)))},rt.salt=new Uint8Array(e.value.slice(0,16)),rt.sskey=await it(nn,rt.salt);let n=await crypto.subtle.exportKey("raw",rt.sskey);_("u",rt.user),_("a",rt.salt.buffer),_("s",n),G("users",rt.user),Lt.d=!0,an(on)}},Rt("div",null,Rt(v(an),null))))),sn(/^channels\/(?<group_id>\d+)$/,Bt),sn(/^chats\/(?<topic_id>\d+)$/,tn),sn(/^reps\/(?<chat_id>\d+)$/,tn),sn(/^products\/(?<id>\d+)$/,(({id:e})=>Rt("h2",null,"Product ",e))),sn(/^users\/(?<name>\w+)$/,(({name:e})=>Rt("h2",null,e,"'s Profile"))),sn(/^ip\/(?<ip>[\.\d]+)$/,tn)],un=p("");const dn=()=>un(document.location.hash.substr(1));window.addEventListener("hashchange",dn),dn();let pn=!1,fn=window.pageYOffset;window.onscroll=function(e){pn||(window.requestAnimationFrame((function(){!function(e){let t=window.scrollY+window.innerHeight===document.body.scrollHeight,n=window.pageYOffset;document.getElementById("nav").style.top=fn>n||t?"0":"-50px",fn=n}(),pn=!1})),pn=!0)},document.querySelector(".app").append(Rt([Rt("div",{id:"nav"},Rt("a",{href:"#",class:"nav-item"},"home"),(()=>ln.map((e=>Rt("a",{href:"#"+e,class:"nav-item "+(un()===e?"is-active":"")},e))))),Rt("div",{class:"container"},(()=>function(e){for(const{pattern:t,view:n}of cn){const r=e.match(t);if(r)return n({...r.groups})}}(un())))]))}();</script></body></html>