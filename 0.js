!function(){"use strict";var n,e=function(){var n,e=new Promise((function(e){return n=e}));return{complete:function(e){return n(e)},join:function(){return e}}},t=e(),r="s",i=["_t","_p","_e","_h","_r","_c","_s","_u","_n","_d","_m"],o=indexedDB.open(r,1);function u(n){console.warn("[db] deleting database",n);var e=window.indexedDB.deleteDatabase(n);e.onerror=function(e){console.error("[db] error deleting database",n,e)},e.onsuccess=function(e){console.warn("[db] deleted database",n)}}function a(n,e,t,r){return new(t||(t=Promise))((function(i,o){function u(n){try{s(r.next(n))}catch(n){o(n)}}function a(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(u,a)}s((r=r.apply(n,e||[])).next())}))}function s(n,e){var t,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(n,u)}catch(n){o=[6,n],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function c(n,e){for(var t=0,r=e.length,i=n.length;t<r;t++,i++)n[i]=e[t];return n}function l(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}o.onsuccess=function(e){n=o.result,console.log("[db] open -",n.name,n.version,n.objectStoreNames),function(n){var e=n.objectStoreNames;if(e.length!==i.length)return console.warn("[db] db store missing"),void u(r);for(var t=0,o=i;t<o.length;t++){var a=o[t];if(!e.contains(a))return console.warn("[db] db store missing",a),void u(r)}}(n),t.complete(n)},o.onerror=function(n){console.error("[db] error",n.target.error),u(r),location.reload()},o.onblocked=function(n){console.log("[db] blocked",n)},o.onupgradeneeded=function(e){console.warn("[db] database upgrade needed from version",e.oldVersion,"->",e.newVersion);var t,r=(n=o.result).objectStoreNames;(console.log(r),r.contains("_s")||(console.log("make _ store"),n.createObjectStore("_s")),r.contains("_r")||(console.log("make ranges store"),n.createObjectStore("_r")),r.contains("_e")||(console.log("make users store"),n.createObjectStore("_e",{keyPath:"id"})),r.contains("_t"))||(console.log("make chats store"),(t=n.createObjectStore("_t",{keyPath:"id"})).createIndex("chanid",["chanid","id"],{unique:!1}),t.createIndex("re",["re","id"],{unique:!1}),t.createIndex("by",["by","id"],{unique:!1}),t.createIndex("dir","dir",{unique:!1}));r.contains("_p")||(console.log("make p2p chats store"),(t=n.createObjectStore("_p",{keyPath:"id",autoIncrement:!0})).createIndex("room",["room","id"],{unique:!1}));r.contains("_h")||(console.log("make chans store"),(u=n.createObjectStore("_h",{keyPath:"id"})).createIndex("mom",["mom","id"],{unique:!1}),u.createIndex("dir","dir",{unique:!1}),u.createIndex("chatid","chatid",{unique:!1}));if(!r.contains("_c")){console.log("make chanchats store");var u=n.createObjectStore("_c",{keyPath:["chanid","chatid"]})}r.contains("_u")||(console.log("make updates store"),n.createObjectStore("_u")),r.contains("_n")||(console.log("make chanusers store"),n.createObjectStore("_n")),r.contains("_d")||(console.log("make chanupdates store"),n.createObjectStore("_d")),r.contains("_m")||(console.log("make memupdates store"),n.createObjectStore("_m"));for(var a=0,s=i;a<s.length;a++){var c=s[a];n.objectStoreNames.contains(c)||(console.warn("[db] "+c+" store missing, creating a dummy one"),n.createObjectStore(c))}console.warn("[db] database upgrade complete")};var d={};function f(n){var e=n>>3;return n%8!=0&&e++,e}Object.defineProperty(d,"__esModule",{value:!0});var v=function(){function n(n,e){void 0===n&&(n=0);var t=null==e?void 0:e.grow;this.grow=t&&isFinite(t)&&f(t)||t||0,this.buffer="number"==typeof n?new Uint8Array(f(n)):n}return n.prototype.get=function(n){var e=n>>3;return e<this.buffer.length&&!!(this.buffer[e]&128>>n%8)},n.prototype.set=function(n,e){void 0===e&&(e=!0);var t=n>>3;if(e){if(this.buffer.length<t+1){var r=Math.max(t+1,Math.min(2*this.buffer.length,this.grow));if(r<=this.grow){var i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}this.buffer[t]|=128>>n%8}else t<this.buffer.length&&(this.buffer[t]&=~(128>>n%8))},n.prototype.forEach=function(n,e,t){void 0===e&&(e=0),void 0===t&&(t=8*this.buffer.length);for(var r=e,i=r>>3,o=128>>r%8,u=this.buffer[i];r<t;r++)n(!!(u&o),r),o=1===o?(u=this.buffer[++i],128):o>>1},n}(),h=d.default=v;function p(n,e,t){var r,i=this;return void 0===t&&(t=!1),function(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];r&&clearTimeout(r),t&&!r&&n.apply(i,o),r=setTimeout((function(){r=null,t||n.apply(i,o)}),e)}}function m(){var n;document.execCommand("selectAll",!1,void 0),null===(n=document.getSelection())||void 0===n||n.collapseToEnd()}function g(){var n=document.getSelection();return console.warn(n),n.focusOffset}var b=function(n){return document.getElementById(n.toString())};function y(){window.scrollTo(0,document.documentElement.scrollHeight)}var w=function(n,e){for(var t=0,r=0;t<n.length;)r>=e.length&&(r=0),n.set([n[t]^e[r]],t),t++,r++},k=function(n,e){return M(S(n,e),64,24)},C=function(n){var e=E(n).a;return E(e)},S=function(n,e){return w(n,e),A(n,e)},E=function(n){var e=x(n),t=e.a,r=e.k;return w(t,r),{a:t,k:r}},x=function(n){var e=n[0],t=n.subarray(1,e+1);return{a:n.subarray(e+1),k:t}},A=function(n,e){var t=new Uint8Array(1+e.length+n.length);return t[0]=e.length,t.set(e,1),t.set(n,1+e.length),t},_=function(n,e){return n=Math.ceil(n),Math.floor(Math.random()*(Math.floor(e)-n)+n)},U=function(n,e){var t=new Uint8Array(n.length+e.length);return t.set(n,0),t.set(e,n.length),t},T=function(n){return(performance.now()-n).toFixed(2)},M=function(n,e,t){return void 0===e&&(e=64),void 0===t&&(t=8),S(n,crypto.getRandomValues(new Uint8Array(_(t,e))))},D=function(n){return function(n){return"hsl("+n%360+",100%,30%)"}(function(n){var e=0;if(0==n.length)return e;for(var t=0;t<n.length;t++)e=n.charCodeAt(t)+((e<<5)-e),e&=e;return e}(n+"#"))};function L(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)&&n.length<70}function P(n){return n.length<2||n.length>30?10:/^[0-9a-z_]+$/.test(n)?0:10}function O(){return window.scrollY+window.innerHeight===document.documentElement.scrollHeight}function j(){return Intl.DateTimeFormat().resolvedOptions().timeZone}function I(n){if(!/^[a-z0-9\_@\.]+$/.test(n.key))return n.preventDefault(),!1}function N(n){if(!/^[a-z0-9\_]+$/.test(n.key))return n.preventDefault(),!1}function K(n){n.target.value=n.target.value.toLowerCase().replace(/\s/g,"")}function F(n,e){return n.length<6?12:e&&n==e?14:void 0}function z(n,e){return!!e&&(n.getFullYear()===e.getFullYear()&&n.getMonth()===e.getMonth()&&n.getDate()===e.getDate())}var q=function(n,e){return crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:e},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])},R=function(n){return crypto.subtle.importKey("raw",n,{name:"ECDH",namedCurve:"P-256"},!0,[])},B=function(){return a(void 0,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return console.log("[sec] generating key pairs"),[4,crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"])];case 1:return[2,n.sent()]}}))}))},H=function(n,e,t){return a(void 0,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,n)];case 1:return[2,r.sent()]}}))}))},V=function(n,e,t){return a(void 0,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,crypto.subtle.decrypt({name:"AES-GCM",iv:t},e,n)];case 1:return[2,r.sent()]}}))}))};let W,$=[];function Y(n){function e(t){if(0===arguments.length)return W&&!e.__o.has(W)&&(e.__o.add(W),W.u.push(e)),n;n=t;let r=W;return W=void 0,e.o=new Set(e.__o),e.o.forEach((n=>n.i=!1)),e.o.forEach((n=>{n.i||n()})),W=r,n}return e.$o=1,e.__o=new Set,e.t=$,e}function G(n){n.__c.forEach(G),n.u.forEach((e=>{e.__o.delete(n),e.o&&e.o.delete(n)})),n.l.forEach((n=>n())),X(n)}function X(n){n.u=[],n.__c=[],n.l=[]}let Z=(n,e,t,r)=>{let i={};for(let o=1;o<e.length;o++){let u=e[o],a="number"==typeof u?t[u]:u,s=e[++o];if(1===s)r[0]=a;else if(3===s)r[1]=Object.assign(r[1]||{},a);else if(5===s)(r[1]=r[1]||{})[e[++o]]=a;else if(6===s){let n=e[++o],t=(r[1]=r[1]||{})[n],u=i[n];u||"function"!=typeof a&&"function"!=typeof t||(u=t&&[t]||[],r[1][n]=function(){let n="";for(var e=0;e<u.length;e++)n+="function"==typeof u[e]?u[e].call(this):u[e];return n}),u?u.push(a):r[1][n]+=a+""}else if(s){let e=()=>n.apply(null,Z(n,a,t,["",null]));r.push("function"==typeof r[0]?e:e())}else r.push(a)}return r},J=function(n){let e,t,r=1,i="",o="",u=[0],a=n=>{1===r&&(n||(i=i.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?u.push(n||i,0):3===r&&(n||i)?(u.push(n||i,1),r=2):2===r&&"..."===i&&n?u.push(n,3):2===r&&i&&!n?u.push(!0,5,i):r>=5&&((i||!n&&5===r)&&(u.push(i,r,t),r=6),n&&(u.push(n,r,t),r=6)),i=""};for(let s=0;s<n.length;s++){s&&(1===r&&a(),a(s));for(let c=0;c<n[s].length;c++)e=n[s][c],1===r?"<"===e?(a(),u=[u],r=3):i+=e:4===r?"--"===i&&">"===e?(r=1,i=""):i=e+i[0]:o?e===o?o="":i+=e:'"'===e||"'"===e?o=e:">"===e?(a(),r=1):r&&("="===e?(r=5,t=i,i=""):"/"===e&&(r<5||">"===n[s][c+1])?(a(),3===r&&(u=u[0]),r=u,(u=u[0]).push(r,2),r=0):" "===e||"\t"===e||"\n"===e||"\r"===e?(a(),r=2):i+=e),3===r&&"!--"===i&&(r=4,u=u[0])}return a(),u},Q=new Map,nn=function(n){let e=Q.get(this);return e||(e=new Map,Q.set(this,e)),e=Z(this,e.get(n)||(e.set(n,e=J(n)),e),arguments,[]),e.length>1?e:e[0]},en=function(){let n=nn.apply(this,arguments);if(n)return Array.isArray(n)?this(n):"object"==typeof n?n:this([n])};function tn(){let n=en.bind(this);return(this.wrap||n).apply(n,arguments)}let rn={},on=[];function un(n){return this.t&&this.t[n.type](n)}rn.h=(...n)=>{let e,t=r=>{if(null==r);else if("string"==typeof r)e?rn.add(e,r):e=rn.s?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r);else if(Array.isArray(r))e||(e=document.createDocumentFragment()),r.forEach(t);else if(r instanceof Node)e?rn.add(e,r):e=r;else if("object"==typeof r)rn.property(e,r,null,rn.s);else if("function"==typeof r)if(e){let n=rn.add(e,"");rn.insert(e,r,n)}else e=r.apply(null,n.splice(1));else rn.add(e,""+r)};return n.forEach(t),e},rn.insert=(n,e,t,r,i)=>(n=t&&t.parentNode||n,i=i||r instanceof Node&&r,e===r||(r&&"string"!=typeof r||!("string"==typeof e||"number"==typeof e&&(e+=""))?"function"==typeof e?rn.subscribe((()=>{r=rn.insert(n,e.call({el:n,endMark:t}),t,r,i)})):(t?r&&(i||(i=r.o&&r.o.nextSibling||t.previousSibling),rn.rm(n,i,t)):n.textContent="",r=null,e&&!0!==e&&(r=rn.add(n,e,t))):(null!=r&&n.firstChild?t?(t.previousSibling||n.lastChild).data=e:n.firstChild.data=e:t?rn.add(n,e,t):n.textContent=e,r=e)),r),rn.property=(n,e,t,r,i)=>{if(null!=e)if(!t||"attrs"===t&&(r=!0))for(t in e)rn.property(n,e[t],t,r,i);else"o"!==t[0]||"n"!==t[1]||e.$o?"function"==typeof e?rn.subscribe((()=>{rn.property(n,e.call({el:n,name:t}),t,r,i)})):i?n.style.setProperty(t,e):r||"data-"===t.slice(0,5)||"aria-"===t.slice(0,5)?n.setAttribute(t,e):"style"===t?"string"==typeof e?n.style.cssText=e:rn.property(n,e,null,r,!0):("class"===t&&(t+="Name"),n[t]=e):((n,e,t)=>{e=e.slice(2).toLowerCase(),t?n.addEventListener(e,un):n.removeEventListener(e,un),(n.t||(n.t={}))[e]=t})(n,t,e)},rn.add=(n,e,t)=>{let r=(n=>{const{childNodes:e}=n;if(e&&11===n.nodeType)return e.length<2?e[0]:{o:rn.add(n,"",e[0])}})(e=(n=>"string"==typeof n?document.createTextNode(n):n instanceof Node?n:rn.h(on,n))(e))||e;return n.insertBefore(e,t&&t.parentNode&&t),r},rn.rm=(n,e,t)=>{for(;e&&e!==t;){let t=e.nextSibling;n===e.parentNode&&n.removeChild(e),e=t}},rn.subscribe=function(n){return function(n,e){function t(){let r=W;return W&&W.__c.push(t),G(t),t.i=!0,W=t,e=n(e),W=r,e}function r(){return t.i?W&&t.u.forEach((n=>n())):e=t(),e}n.s=t,X(t),t(),r.$o=1}(n),()=>G(n.s)},rn.cleanup=function(n){return W&&W.l.push(n),n},rn.root=function(n){let e=W,t=()=>{};W=t,X(t);let r=n((()=>{G(t),W=void 0}));return W=e,r},rn.sample=function(n){let e=W;W=void 0;let t=n();return W=e,t},rn.hs=(...n)=>{let e=rn.s;rn.s=!0;let t=an(...n);return rn.s=e,t};let an=(...n)=>rn.h.apply(rn.h,n),sn=(...n)=>tn.apply(an,n);var cn,ln,dn=new Map,fn=function(n,e,t){void 0===t&&(t=!1);var r=dn.get(n)||[];t?r=[e]:r.push(e),dn.set(n,r)},vn=function(n,e){return dn.has(n)?dn.get(n).forEach((function(n){return n(e)})):void 0},hn=function(){return a(void 0,void 0,void 0,(function(){var n;return s(this,(function(e){switch(e.label){case 0:return[4,t.join()];case 1:return(n=e.sent())?(i.forEach((function(e){return n.transaction([e],"readwrite").objectStore(e).clear()})),[2]):[2]}}))}))},pn=function(n){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return a(void 0,void 0,void 0,(function(){var r,i,o;return s(this,(function(u){switch(u.label){case 0:return[4,t.join()];case 1:return(r=u.sent())?(i=r.transaction([n],"readwrite"),o=i.objectStore(n),e.forEach((function(n){return o.delete(n).onerror=console.error})),[2]):[2]}}))}))},mn=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return a(void 0,void 0,void 0,(function(){var e;return s(this,(function(r){switch(r.label){case 0:return[4,t.join()];case 1:return(e=r.sent())?[4,En.apply(void 0,n)]:[2];case 2:return r.sent(),i=n,o=e.transaction(["_c"],"readwrite").objectStore("_c"),i.forEach((function(n){var e=IDBKeyRange.bound([n],[n,Number.MAX_VALUE]);o.delete(e).onerror=console.error})),function(n){var t=e.transaction(["_t"],"readwrite").objectStore("_t"),r=t.index("chanid");n.forEach((function(n){var e=IDBKeyRange.bound([n],[n,Number.MAX_VALUE]);r.openCursor(e).onsuccess=function(n){var e=n.target.result;e&&(t.delete(e.primaryKey).onerror=console.error,e.continue())}}))}(n.filter((function(n){return n>0}))),[2]}var i,o}))}))},gn=function(n){var e=n.id,r=n.dir;return a(void 0,void 0,void 0,(function(){var n,i;return s(this,(function(o){switch(o.label){case 0:return[4,t.join()];case 1:return(n=o.sent())?(i=c([0],r),function(n,e){var t=this;e.forEach((function(e){return a(t,void 0,void 0,(function(){var t;return s(this,(function(r){switch(r.label){case 0:return[4,Sn(e)];case 1:return(t=r.sent())&&t.includes(n)&&En(e),[2]}}))}))}))}(e,i),function(e,t){var r=n.transaction(["_c"],"readwrite").objectStore("_c");t.forEach((function(n){var t=IDBKeyRange.only([n,e]);r.delete(t).onerror=console.error}))}(e,i),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=n.transaction(["_t"],"readwrite").objectStore("_t");e.forEach((function(n){r.delete(n).onerror=console.error}))}(e),[2]):[2]}}))}))},bn=function(n){var e=n.id,r=n.dir;return a(void 0,void 0,void 0,(function(){var n,i;return s(this,(function(o){switch(o.label){case 0:return[4,t.join()];case 1:return(n=o.sent())?(function(n){var e=this;n.forEach((function(n){return a(e,void 0,void 0,(function(){return s(this,(function(e){return En(n),[2]}))}))}))}(i=c(c([0],r),[e])),function(e){var t=n.transaction(["_c"],"readwrite").objectStore("_c");e.forEach((function(n){var e=IDBKeyRange.bound([n],[n,Number.MAX_VALUE]);t.delete(e).onerror=console.error}))}(i),[2]):[2]}}))}))},yn=function(n,e){return a(void 0,void 0,void 0,(function(){var r,i,o;return s(this,(function(u){switch(u.label){case 0:return[4,t.join()];case 1:return(r=u.sent())?(console.log("add",n,e),i=r.transaction([n],"readwrite"),o=i.objectStore(n),[2,new Promise((function(n){var t=o.put(e);t.onsuccess=function(e){n(e.target.result)},t.onerror=console.error}))]):[2]}}))}))},wn=function(n,e){return a(void 0,void 0,void 0,(function(){var r,i,o;return s(this,(function(u){switch(u.label){case 0:return[4,t.join()];case 1:return(r=u.sent())?(i=r.transaction([n],"readwrite"),o=i.objectStore(n),e.forEach((function(n){"string"==typeof n.timestamp&&(n.timestamp=new Date(n.timestamp)),o.put(n).onerror=console.error})),[2]):[2]}}))}))},kn=function(n,e){return a(void 0,void 0,void 0,(function(){var r,i,o,u,a,c,l;return s(this,(function(s){switch(s.label){case 0:return[4,t.join()];case 1:return(r=s.sent())?0===e.length?[2,{value:[],missed:[]}]:(i=performance.now(),o=[],u=new Set,a=r.transaction([n],"readonly"),c=a.objectStore(n),l=0,[2,new Promise((function(t){e.forEach((function(r){var a=c.get(r);a.onerror=console.error,a.onsuccess=function(){if(a.result?o.push(a.result):u.add(r),++l===e.length){var s={value:o,missed:Array.from(u)};console.log("[db]","get "+n+" in",T(i),"ms",s),t(s)}}}))}))]):[2,{value:[],missed:e}]}}))}))},Cn=function(n,e,r){return a(void 0,void 0,void 0,(function(){var i,o,u,c;return s(this,(function(l){switch(l.label){case 0:return[4,t.join()];case 1:return(i=l.sent())?(o=i.transaction(["_r"],"readwrite"),u=o.objectStore("_r"),(c=u.get(n)).onerror=console.error,c.onsuccess=function(){return a(void 0,void 0,void 0,(function(){return s(this,(function(t){if(c.result){if(r)return[2,u.put([c.result[0],c.result[1],r],n).onerror=console.error];e[0]<c.result[0]&&(e[0]=c.result[0]),e[1]>c.result[0]&&(e[1]=c.result[1])}return u.put(e,n).onerror=console.error,[2]}))}))},[2]):[2]}}))}))},Sn=function(n){return _n(n,"_r")},En=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return a(void 0,void 0,void 0,(function(){return s(this,(function(e){return[2,pn.apply(void 0,c(["_r"],n))]}))}))},xn=function(n,e){return a(void 0,void 0,void 0,(function(){var r;return s(this,(function(i){switch(i.label){case 0:return[4,t.join()];case 1:return(r=i.sent())?(r.transaction(["_s"],"readwrite").objectStore("_s").put(e,n),[2]):[2]}}))}))},An=function(n){return _n(n,"_s")},_n=function(n,e){return a(void 0,void 0,void 0,(function(){var r,i,o;return s(this,(function(u){switch(u.label){case 0:return[4,t.join()];case 1:return(r=u.sent())?(i=r.transaction([e],"readonly"),o=i.objectStore(e),[2,new Promise((function(e){var t=o.get(n);t.onerror=console.error,t.onsuccess=function(){return e(t.result)}}))]):[2]}}))}))},Un=function(n,e,r){return a(void 0,void 0,void 0,(function(){var i;return s(this,(function(o){switch(o.label){case 0:return[4,t.join()];case 1:return(i=o.sent())?(i.transaction([n],"readwrite").objectStore(n).put(r,e),[2]):[2]}}))}))},Tn={},Mn=function(n){return n&&(Object.assign(Tn,n),vn("config",Tn)),Tn},Dn=Y(void 0),Ln={id:Y(0),name:Y(""),chans:Y([]),salt:new Uint8Array};function Pn(){return a(this,void 0,void 0,(function(){var n,e,t,r,i,o,u,a,c,l;return s(this,(function(s){switch(s.label){case 0:return[4,An("a")];case 1:return!(n=s.sent())||n.byteLength<54?[2]:(e=new Uint8Array(n,0,16),t=new Uint8Array(n,16,32),16===e.length&&(Ln.salt=e),32!==t.length?[3,3]:(r=Ln,[4,crypto.subtle.importKey("raw",t,"AES-GCM",!1,["encrypt","decrypt"])]));case 2:r.sskey=s.sent(),s.label=3;case 3:return i=new Uint8Array(n,48,4),o=new Uint8Array(n,52),u=new DataView(i.buffer).getInt32(48,!1),a=(new TextDecoder).decode(o),u&&a&&(Ln.id(u),Ln.name(a)),[4,An("c")];case 4:return(c=s.sent())&&c instanceof Array&&Ln.chans(c),console.log("[au]",Ln),(l=new Uint8Array(20)).set(e),l.set(i,16),setTimeout(y),[2,l]}}))}))}function On(n,e){return a(this,void 0,void 0,(function(){var t,r;return s(this,(function(i){switch(i.label){case 0:return[4,In((t=new TextEncoder).encode(n),t.encode(e))];case 1:return r=i.sent(),[4,crypto.subtle.exportKey("raw",r)];case 2:return[2,i.sent()]}}))}))}function jn(n,e){return a(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,In((new TextEncoder).encode(n),e)];case 1:return[2,t.sent()]}}))}))}function In(n,e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(r){switch(r.label){case 0:return[4,crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveBits","deriveKey"])];case 1:return t=r.sent(),[2,crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])]}}))}))}function Nn(n){var e=n.data,t=n.chans;return a(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return[4,Kn(e)];case 1:return n=r.sent(),yn("_e",n),Mn({d:!0}),Ln.chans(t),xn("c",t),[2]}}))}))}function Kn(n){return a(this,void 0,void 0,(function(){var e,t,r,i,o,u,a,c,l,d;return s(this,(function(s){switch(s.label){case 0:return e=new Uint8Array(n.slice(16,20)),t=new Uint8Array(n.slice(20)),r=new DataView(e.buffer).getInt32(0,!1),i=(new TextDecoder).decode(t),Ln.id(r),Ln.name(i),Ln.salt=new Uint8Array(n.slice(0,16)),o=Ln,[4,In(Dn(),Ln.salt)];case 1:return o.sskey=s.sent(),Dn(void 0),a=Uint8Array.bind,[4,crypto.subtle.exportKey("raw",Ln.sskey)];case 2:return u=new(a.apply(Uint8Array,[void 0,s.sent()])),c=Ln.salt.length,(l=new Uint8Array(c+u.length+e.length+t.length)).set(Ln.salt),l.set(u,c),l.set(e,c+u.length),l.set(t,c+u.length+e.length),xn("a",l.buffer),d=j(),[2,{id:r,name:i,tz:d}]}}))}))}!function(n){n.Shin=function(n){return{tag:"Shin",value:n}},n.Shan=function(n){return{tag:"Shan",value:n}},n.Tree=function(n){return{tag:"Tree",value:n}},n.NewChat=function(n){return{tag:"NewChat",value:n}},n.NewUser=function(n){return{tag:"NewUser",value:n}},n.Login=function(n){return{tag:"Login",value:n}},n.Logout=function(n){return{tag:"Logout",value:n}},n.Users=function(n){return{tag:"Users",value:n}},n.Chans=function(n){return{tag:"Chans",value:n}},n.Chats=function(n){return{tag:"Chats",value:n}},n.MuteChan=function(n){return{tag:"MuteChan",value:n}},n.UnmuteChan=function(n){return{tag:"UnmuteChan",value:n}},n.AddMems=function(n){return{tag:"AddMems",value:n}},n.DelChat=function(n){return{tag:"DelChat",value:n}},n.DelChan=function(n){return{tag:"DelChan",value:n}},n.EditChat=function(n){return{tag:"EditChat",value:n}},n.EditChan=function(n){return{tag:"EditChan",value:n}},n.Mems=function(n){return{tag:"Mems",value:n}},n.FindUsers=function(n){return{tag:"FindUsers",value:n}},n.FindMems=function(n){return{tag:"FindMems",value:n}},n.PushSubs=function(n){return{tag:"PushSubs",value:n}},n.Ons=function(n){return{tag:"Ons",value:n}},n.Unpack=function(n){return{tag:"Unpack",value:n}},n.Tz=function(n){return{tag:"Tz",value:n}},n.Profile={tag:"Profile"},n.EditProfile=function(n){return{tag:"EditProfile",value:n}},n.Pwd=function(n){return{tag:"Pwd",value:n}},n.Email=function(n){return{tag:"Email",value:n}},n.Au=function(n){return{tag:"Au",value:n}},n.Signup=function(n){return{tag:"Signup",value:n}},n.Fp=function(n){return{tag:"Fp",value:n}},n.EditStatus=function(n){return{tag:"EditStatus",value:n}},n.Status=function(n){return{tag:"Status",value:n}},n.ChatThread=function(n){return{tag:"ChatThread",value:n}},n.ChatList=function(n){return{tag:"ChatList",value:n}},n.Star=function(n){return{tag:"Star",value:n}},n.Sdp=function(n){return{tag:"Sdp",value:n}}}(cn||(cn={})),function(n){n.Shin=function(n){return{tag:"Shin",value:n}},n.Shan=function(n){return{tag:"Shan",value:n}},n.Tree=function(n){return{tag:"Tree",value:n}},n.Treeid=function(n){return{tag:"Treeid",value:n}},n.Chats=function(n){return{tag:"Chats",value:n}},n.Chans=function(n){return{tag:"Chans",value:n}},n.Users=function(n){return{tag:"Users",value:n}},n.Chat=function(n){return{tag:"Chat",value:n}},n.Login=function(n){return{tag:"Login",value:n}},n.MuteChan=function(n){return{tag:"MuteChan",value:n}},n.UnmuteChan=function(n){return{tag:"UnmuteChan",value:n}},n.DelChan=function(n){return{tag:"DelChan",value:n}},n.Update=function(n){return{tag:"Update",value:n}},n.Updates=function(n){return{tag:"Updates",value:n}},n.ChanUpdates=function(n){return{tag:"ChanUpdates",value:n}},n.MemUpdates=function(n){return{tag:"MemUpdates",value:n}},n.On=function(n){return{tag:"On",value:n}},n.Ons=function(n){return{tag:"Ons",value:n}},n.Mems=function(n){return{tag:"Mems",value:n}},n.Err=function(n){return{tag:"Err",value:n}},n.NewChan=function(n){return{tag:"NewChan",value:n}},n.FindUsers=function(n){return{tag:"FindUsers",value:n}},n.FindMems=function(n){return{tag:"FindMems",value:n}},n.Logout=function(n){return{tag:"Logout",value:n}},n.AddMems=function(n){return{tag:"AddMems",value:n}},n.Unpack=function(n){return{tag:"Unpack",value:n}},n.Profile=function(n){return{tag:"Profile",value:n}},n.Pwd=function(n){return{tag:"Pwd",value:n}},n.Name=function(n){return{tag:"Name",value:n}},n.Signup=function(n){return{tag:"Signup",value:n}},n.Typing=function(n){return{tag:"Typing",value:n}},n.Status=function(n){return{tag:"Status",value:n}},n.ChatThread=function(n){return{tag:"ChatThread",value:n}},n.ChatList=function(n){return{tag:"ChatList",value:n}},n.Sdp=function(n){return{tag:"Sdp",value:n}}}(ln||(ln={}));const Fn=(n,e=0,t=!0)=>({pos:e,littleEndian:t,view:new DataView(n)}),zn=(n,e)=>{const{view:{buffer:t},pos:r}=n,i=t.byteLength;if(i-r>e)return n;const o=Math.max(2*i,i+e),u=new Uint8Array(o);return u.set(new Uint8Array(t)),Fn(u.buffer,r,n.littleEndian)},qn=(n,e)=>{n=zn(n,1);const{view:t,pos:r}=n;return t.setUint8(r,e),n.pos+=1,n},Rn=(n,e)=>{n=zn(n,4);const{view:t,pos:r,littleEndian:i}=n;return t.setUint32(r,e,i),n.pos+=4,n},Bn=(n,e)=>{n=zn(n,2);const{view:t,pos:r,littleEndian:i}=n;return t.setUint16(r,e,i),n.pos+=2,n};function Hn(n,e){const{view:t,pos:r,littleEndian:i}=n;return t.setUint32(i?r:r+4,e,i),t.setUint32(i?r+4:r,0,i),n.pos+=8,n}const Vn=(n,e)=>{n=zn(n,4);const{view:t,pos:r,littleEndian:i}=n;return t.setInt32(r,e,i),n.pos+=4,n},Wn=new TextEncoder,$n="encodeInto"in Wn?(n,e)=>Wn.encodeInto(n,e).written:(n,e)=>{const t=Wn.encode(n);return e.set(t),t.length},Yn=(n,e)=>{n=zn(n,3*e.length+8);const t=$n(e,new Uint8Array(n.view.buffer,n.pos+8));return(n=Hn(n,t)).pos+=t,n},Gn=(n,e)=>qn(n,e?1:0),Xn=n=>(e,t)=>t.reduce(n,((n,e)=>Hn(zn(n,8),e))(e,t.length)),Zn=n=>(e,t)=>null===t?qn(e,0):n(qn(e,1),t),Jn=n=>{const{pos:e,view:t}=n;return n.pos+=1,t.getUint8(e)},Qn=n=>{const{pos:e,view:t,littleEndian:r}=n;return n.pos+=2,t.getUint16(e,r)},ne=n=>{const{pos:e,view:t,littleEndian:r}=n;return n.pos+=4,t.getUint32(e,r)},ee=n=>{const{view:e,pos:t,littleEndian:r}=n;return n.pos+=8,e.getUint32(r?t:t+4,r)},te=n=>{const{pos:e,view:t,littleEndian:r}=n;return n.pos+=4,t.getInt32(e,r)},re=n=>1===Jn(n),ie=n=>e=>1===Jn(e)?n(e):null,oe=n=>e=>{const t=ee(e),r=new Array;for(let i=0;i<t;i++)r.push(n(e));return r},ue=new TextDecoder,ae=n=>{const e=ee(n),{pos:t,view:{buffer:r}}=n,i=ue.decode(new Uint8Array(r,t,e));return n.pos+=e,i};var se=Xn(Vn),ce=Zn(Yn),le=Zn(se),de=Zn(Vn),fe=Zn(Gn),ve=Zn((function(n,e){var t=e.id,r=e.lo;return Vn(Vn(n,t),r)})),he=Xn(Yn),pe=Zn(he),me=Xn(qn),ge=Zn(((n,e)=>{n=zn(n,8);const{view:t,pos:r,littleEndian:i}=n;return t.setFloat64(r,e,i),n.pos+=8,n})),be=Zn(me),ye=Zn(Bn),we=function(n,e){var t=e.id,r=e.txt,i=e.by,o=e.chanid,u=e.dir,a=e.timestamp,s=e.men,c=e.re,l=e.nor,d=e.star;return fe(de(de(le(Yn(se(Vn(Vn(Yn(Vn(n,t),r),i),o),u),a),s),c),l),d)},ke=(Xn(we),Xn((function(n,e){var t=e.id,r=e.fullname,i=e.mom,o=e.by,u=e.dir,a=e.md,s=e.timestamp,c=e.chatid,l=e.about,d=e.to,f=e.re;return de(le(ce(Vn(Yn(Bn(se(Vn(Vn(Yn(Vn(n,t),r),i),o),u),a),s),c),l),d),f)})),function(n,e){var t=e.id,r=e.name,i=e.online;return Gn(Yn(Vn(n,t),r),i)}),Ce=Xn(ke),Se=(Zn((function(n,e){var t=e.data,r=e.chans;return se(me(n,t),r)})),function(n,e){var t=e.id,r=e.action,i=e.chatid,o=e.txt;return ce(Vn(Bn(Vn(n,t),r),i),o)}),Ee=(Xn(Se),Xn((function(n,e){var t=e.id,r=e.action,i=e.chanid,o=e.name,u=e.about,a=e.md;return ye(ce(ce(Vn(Bn(Vn(n,t),r),i),o),u),a)})),Xn((function(n,e){var t=e.id,r=e.action,i=e.chanid,o=e.by;return Vn(Vn(Bn(Vn(n,t),r),i),o)})),Xn((function(n,e){var t=e.chanid,r=e.users;return Ce(Vn(n,t),r)})),function(n,e){var t=e.email,r=e.fullname,i=e.about;return ce(ce(ce(n,t),r),i)}),xe=function(n,e){var t=e.i,r=e.ub,i=e.lb,o=e.kw;return ce(de(de(Vn(n,t),r),i),o)},Ae=function(n,e){var t=e.fr,r=e.to,i=e.offer,o=e.sd,u=e.ca;return he(me(fe(de(de(n,t),r),i),o),u)},_e=function(n,e){var t=e.txt;return Yn(n,t)},Ue=function(n,e){var t=e.st,r=e.tz;return ce(ce(n,t),r)},Te=function(n,e){switch(e.tag){case"Shin":return function(n,e){var t=e.chanid,r=e.kw,i=e.lu,o=e.cu,u=e.mu,a=e.ub,s=e.lb;return de(de(de(de(ve(ce(de(n,t),r),i),o),u),a),s)}(Rn(n,0),e.value);case"Shan":return function(n,e){var t=e.chanid,r=e.kw,i=e.cu,o=e.mu,u=e.ub,a=e.lb;return de(de(de(de(ce(Vn(n,t),r),i),o),u),a)}(Rn(n,1),e.value);case"Tree":return function(n,e){var t=e.kw,r=e.reload;return fe(ce(n,t),r)}(Rn(n,2),e.value);case"NewChat":return function(n,e){var t=e.txt,r=e.chanid,i=e.re,o=e.chname,u=e.men,a=e.to,s=e.emails;return pe(le(le(ce(de(Vn(Yn(n,t),r),i),o),u),a),s)}(Rn(n,3),e.value);case"NewUser":return function(n,e){var t=e.name,r=e.key,i=e.tz,o=e.tgid,u=e.tgname,a=e.tgfn,s=e.tgln;return ce(ce(ce(ge(ce(me(Yn(n,t),r),i),o),u),a),s)}(Rn(n,4),e.value);case"Login":return function(n,e){var t=e.name,r=e.key,i=e.tz;return ce(me(Yn(n,t),r),i)}(Rn(n,5),e.value);case"Logout":return me(Rn(n,6),e.value);case"Users":return se(Rn(n,7),e.value);case"Chans":return se(Rn(n,8),e.value);case"Chats":return se(Rn(n,9),e.value);case"MuteChan":return Vn(Rn(n,10),e.value);case"UnmuteChan":return Vn(Rn(n,11),e.value);case"AddMems":return function(n,e){var t=e.chanid,r=e.userids,i=e.emails;return pe(le(Vn(n,t),r),i)}(Rn(n,12),e.value);case"DelChat":return Vn(Rn(n,13),e.value);case"DelChan":return Vn(Rn(n,14),e.value);case"EditChat":return function(n,e){var t=e.id,r=e.txt;return Yn(Vn(n,t),r)}(Rn(n,15),e.value);case"EditChan":return function(n,e){var t=e.id,r=e.name,i=e.about,o=e.md;return ye(ce(ce(Vn(n,t),r),i),o)}(Rn(n,16),e.value);case"Mems":return se(Rn(n,17),e.value);case"FindUsers":return Yn(Rn(n,18),e.value);case"FindMems":return function(n,e){var t=e.chanid,r=e.kw;return Yn(Vn(n,t),r)}(Rn(n,19),e.value);case"PushSubs":return function(n,e){var t=e.endpoint,r=e.auth,i=e.p256dh;return Yn(Yn(Yn(n,t),r),i)}(Rn(n,20),e.value);case"Ons":return se(Rn(n,21),e.value);case"Unpack":return Yn(Rn(n,22),e.value);case"Tz":return Yn(Rn(n,23),e.value);case"Profile":return Rn(n,24);case"EditProfile":return Ee(Rn(n,25),e.value);case"Pwd":return function(n,e){var t=e.key,r=e.okey;return be(me(n,t),r)}(Rn(n,26),e.value);case"Email":return Yn(Rn(n,27),e.value);case"Au":return Yn(Rn(n,28),e.value);case"Signup":return Yn(Rn(n,29),e.value);case"Fp":return Yn(Rn(n,30),e.value);case"EditStatus":return Ue(Rn(n,31),e.value);case"Status":return Vn(Rn(n,32),e.value);case"ChatThread":return xe(Rn(n,33),e.value);case"ChatList":return xe(Rn(n,34),e.value);case"Star":return Vn(Rn(n,35),e.value);case"Sdp":return Ae(Rn(n,36),e.value)}},Me=oe(te),De=ie(ae),Le=ie(Me),Pe=ie(te),Oe=ie(re),je=(ie((function(n){return{id:te(n),lo:te(n)}})),oe(ae)),Ie=(ie(je),oe(Jn)),Ne=(ie((n=>{const{pos:e,view:t,littleEndian:r}=n;return n.pos+=8,t.getFloat64(e,r)})),ie(Ie)),Ke=ie(Qn),Fe=function(n){return{id:te(n),txt:ae(n),by:te(n),chanid:te(n),dir:Me(n),timestamp:ae(n),men:Le(n),re:Pe(n),nor:Pe(n),star:Oe(n)}},ze=oe(Fe),qe=oe((function(n){return{id:te(n),fullname:ae(n),mom:te(n),by:te(n),dir:Me(n),md:Qn(n),timestamp:ae(n),chatid:te(n),about:De(n),to:Le(n),re:Pe(n)}})),Re=function(n){return{id:te(n),name:ae(n),online:re(n)}},Be=oe(Re),He=ie((function(n){return{data:Ie(n),chans:Me(n)}})),Ve=function(n){return{id:te(n),action:Qn(n),chatid:te(n),txt:De(n)}},We=oe(Ve),$e=oe((function(n){return{id:te(n),action:Qn(n),chanid:te(n),name:De(n),about:De(n),md:Ke(n)}})),Ye=oe((function(n){return{id:te(n),action:Qn(n),chanid:te(n),by:te(n)}})),Ge=oe((function(n){return{chanid:te(n),users:Be(n)}})),Xe=function(n){return{email:De(n),fullname:De(n),about:De(n)}},Ze=function(n){return{fr:Pe(n),to:Pe(n),offer:Oe(n),sd:Ie(n),ca:je(n)}},Je=function(n){return{txt:ae(n)}},Qe=function(n){return{st:De(n),tz:De(n)}},nt=function(n){switch(ne(n)){case 0:return ln.Shin(function(n){return{chats:ze(n),chans:qe(n),users:Be(n)}}(n));case 1:return ln.Shan(Me(n));case 2:return ln.Tree(qe(n));case 3:return ln.Treeid(Me(n));case 4:return ln.Chats(ze(n));case 5:return ln.Chans(qe(n));case 6:return ln.Users(Be(n));case 7:return ln.Chat(Fe(n));case 8:return ln.Login(He(n));case 9:return ln.MuteChan(Pe(n));case 10:return ln.UnmuteChan(Pe(n));case 11:return ln.DelChan(te(n));case 12:return ln.Update(Ve(n));case 13:return ln.Updates(We(n));case 14:return ln.ChanUpdates($e(n));case 15:return ln.MemUpdates(Ye(n));case 16:return ln.On(Re(n));case 17:return ln.Ons(Me(n));case 18:return ln.Mems(Ge(n));case 19:return ln.Err(Qn(n));case 20:return ln.NewChan(te(n));case 21:return ln.FindUsers(Be(n));case 22:return ln.FindMems(Be(n));case 23:return ln.Logout(re(n));case 24:return ln.AddMems(re(n));case 25:return ln.Unpack(De(n));case 26:return ln.Profile(Xe(n));case 27:return ln.Pwd(Ne(n));case 28:return ln.Name(De(n));case 29:return ln.Signup(Qn(n));case 30:return ln.Typing(function(n){return{by:Pe(n),dir:Me(n),key:De(n),keyCode:Ke(n),anchor:Qn(n),focus:Qn(n),txt:De(n),chname:De(n),re:Pe(n)}}(n));case 31:return ln.Status(Qe(n));case 32:return ln.ChatThread(Me(n));case 33:return ln.ChatList(Me(n));case 34:return ln.Sdp(Ze(n))}throw new Error("bad variant index for Response")},et=Fn(new ArrayBuffer(512)),tt=function(n,e){return et.pos=0,et=e(et,n),new Uint8Array(et.view.buffer).slice(0,et.pos)},rt=function(n,e){return e(Fn(n))},it=function(n){return rt(n.buffer,nt)},ot=function(n){return tt(n,Te)},ut=function(n){return tt(n,_e)},at=function(n){return rt(n.buffer,Je)};const st=n=>new Zlib.RawInflate(n).decompress(),ct=n=>new Zlib.RawDeflate(n).compress();var lt,dt,ft=0,vt=0;function ht(n,e){return a(this,void 0,void 0,(function(){var t,r,i,o,u,a,c,l,d,f,v,h;return s(this,(function(s){switch(s.label){case 0:return ft++,console.groupCollapsed("[ax]","-> [nr] pack",ft,n),function(n,e){if(!n.length&&!n.byteLength)return console.log(n);console.log(e,"Length",n.length||n.byteLength,"bytes"),console.log((Object(n).buffer instanceof ArrayBuffer?n:"string"==typeof n?(new TextEncoder).encode(n):new Uint8ClampedArray(n)).reduce((function(n,e,t,r){return n+(t%16==0?t.toString(16).padStart(6,0)+"  ":" ")+e.toString(16).padStart(2,0)+(t===r.length-1||t%16==15?" ".repeat(3*(15-t%16))+Array.from(r).splice(t-t%16,16).reduce((function(n,e){return n+(e>31&&e<127||e>159?String.fromCharCode(e):".")}),"  ")+"\n":"")}),""))}(t=ot(n)),console.groupEnd(),r=Mn(),i=r.z,o=r.c,u=r.d,i&&(t=ct(t)),o?(d=crypto.getRandomValues(new Uint8Array(12)),w(t,d),a=U,c=[d],l=Uint8Array.bind,[4,H(t,e,d)]):[3,2];case 1:t=a.apply(void 0,c.concat([new(l.apply(Uint8Array,[void 0,s.sent()]))])),s.label=2;case 2:return u?(d=crypto.getRandomValues(new Uint8Array(12)),w(t,d),f=U,v=[d],h=Uint8Array.bind,[4,H(t,Ln.sskey,d)]):[3,4];case 3:t=f.apply(void 0,v.concat([new(h.apply(Uint8Array,[void 0,s.sent()]))])),s.label=4;case 4:return lt=performance.now(),[2,t]}}))}))}function pt(n,e){return a(this,void 0,void 0,(function(){var t,r,i,o,u,a,c,l,d;return s(this,(function(s){switch(s.label){case 0:return t=new Uint8Array(n),r=t.length,vt++,console.log("[ax]","<- [nr]",vt,r,"bytes in",T(lt),"ms"),i=Mn(),o=i.z,u=i.c,i.d?(c=t.subarray(0,12),a=Uint8Array.bind,[4,V(t.subarray(12),Ln.sskey,c)]):[3,2];case 1:t=new(a.apply(Uint8Array,[void 0,s.sent()])),w(t,c),s.label=2;case 2:return u?(c=t.subarray(0,12),l=Uint8Array.bind,[4,V(t.subarray(12),e,c)]):[3,4];case 3:t=new(l.apply(Uint8Array,[void 0,s.sent()])),w(t,c),s.label=4;case 4:return o&&(t=st(t)),d=(100*r/t.length).toFixed(2),console.log("[ax] unpacked",vt,r+" / "+t.length+" bytes "+d+"% in "+T(lt)+" ms"),[2,mt(t)]}}))}))}function mt(n){var e=it(n);return console.groupCollapsed("[ax]","<- [nr] decode",vt,e),console.table(e.value),console.groupEnd(),e}var gt=document.location.hash.substr(1).match(/^ip\/(?<ip>[\:\.\d]+)$/),bt=gt?null===(dt=gt.groups)||void 0===dt?void 0:dt.ip:"mx.hyze.io:9898";console.warn(bt);var yt,wt,kt,Ct=e(),St=performance.now(),Et=!1,xt=500,At=0,_t=function(n){},Ut={recv:function(n){return _t=n},send:function(n){return a(this,void 0,void 0,(function(){var e,t;return s(this,(function(r){switch(r.label){case 0:return[4,Ct.join()];case 1:return r.sent(),t=(e=yt).send,[4,ht(n,kt)];case 2:return t.apply(e,[r.sent()]),[2]}}))}))}};function Tt(){Et=!0,At++,xt+=_(0,At<16?200:3e3),console.groupEnd(),console.groupEnd(),console.group("[ws]","retry "+At+" in "+(xt/1e3).toFixed(2)+" sec"),setTimeout(Mt,xt)}function Mt(){return a(this,void 0,void 0,(function(){var n,e=this;return s(this,(function(t){switch(t.label){case 0:return[4,Pt()];case 1:return n=t.sent(),(yt=new WebSocket("wss://"+bt)).binaryType="arraybuffer",yt.onopen=function(){return a(e,void 0,void 0,(function(){return s(this,(function(e){return console.log("[ws] open in "+T(St)+" ms"),yt.send(n),console.log("[ws] -> send offer"),[2]}))}))},yt.onmessage=Dt,yt.onerror=console.error,yt.onclose=Tt,[2]}}))}))}function Dt(n){var e=n.data;return a(this,void 0,void 0,(function(){var n,t,r;return s(this,(function(i){switch(i.label){case 0:return console.log("[ws] <- received answer in "+T(St)+" ms"),n=new Uint8Array(e),t=Mn(function(n){var e=new h(n);return{z:e.get(0),c:e.get(1),d:e.get(2)}}(n)),console.log(t),[4,R(n.slice(1))];case 1:return r=i.sent(),[4,q(wt.privateKey,r)];case 2:return kt=i.sent(),yt.onmessage=Lt,Ct.complete(),Et&&vn("reconnected"),Et=!1,[2]}}))}))}function Lt(n){var e=n.data;return a(this,void 0,void 0,(function(){var n;return s(this,(function(t){switch(t.label){case 0:return n=_t,[4,pt(e,kt)];case 1:return n.apply(void 0,[t.sent()]),[2]}}))}))}function Pt(){return a(this,void 0,void 0,(function(){var n,e=this;return s(this,(function(t){switch(t.label){case 0:return[4,(r=function(){return a(e,void 0,void 0,(function(){var n;return s(this,(function(e){switch(e.label){case 0:return[4,B()];case 1:return wt=e.sent(),[4,crypto.subtle.exportKey("raw",wt.publicKey)];case 2:return n=e.sent(),[2,new Uint8Array(n)]}}))}))},i=Pn,a(void 0,void 0,void 0,(function(){var n,e,t;return s(this,(function(o){switch(o.label){case 0:return[4,Promise.all([r(),i()])];case 1:return n=o.sent(),e=n[0],(t=n[1])?[2,S(e,t)]:[2,M(e,64,24)]}}))})))];case 1:return n=t.sent(),console.log("[ws] offer in "+T(St)+" ms"),[2,n]}var r,i}))}))}console.groupCollapsed("[ws]","starting..."),Mt();for(var Ot="0VMZYpdgCGL3iKAzDHwocTt97e1hasO2mJNjExq4PvR6XyWSFbIn-5B_8fUukQlr",jt=Ot.split(""),It=new Array(123),Nt=0;Nt<Ot.length;Nt++)It[Ot.charCodeAt(Nt)]=Nt;var Kt=function(n){if(n<0)return"-"+Kt(-n);for(var e=n>>>0,t=n/4294967296>>>0,r="";t>0;)r=jt[63&e]+r,e>>>=6,e|=(63&t)<<26,t>>>=6;var i="";do{i=jt[63&e]+i,e>>>=6}while(e>0);return i+r},Ft={ntob:Kt,bton:function(n){for(var e=0,t=0;t<n.length;t++)e=64*e+It[n.charCodeAt(t)];return e}},zt=[];function qt(){!function(n){for(var e=0,t=zt;e<t.length;e++)(0,t[e])(n)}(document.location.hash.substr(1))}function Rt(n){return function(e){return void 0===e?n:n.get(e)}}function Bt(){var n=Y([]);return n.add=function(e){return n().indexOf(e)<0?n(c(c([],n()),[e])):n()},n.delete=function(e){n().splice(n().indexOf(e),1),n(n())},n.last=function(){return n()[n().length-1]},n.pop=function(){var e=n().pop();return n(n()),e},n}function Ht(n){return{id:n.id,by:n.by,chanid:n.chanid,dir:n.dir,timestamp:new Date(n.timestamp),men:n.men,re:n.re,txt:Y(n.txt),star:Y(n.star),first:Y(!1),last:Y(!1),firstre:Y(!1),lastre:Y(!1),showby:Y(!1),nor:Y(n.nor)}}window.addEventListener("hashchange",qt),setTimeout(qt);var Vt=function(n,e){return n.reduce((function(n,e){return n.has(e.id)||n.set(e.id,Ht(e)),n}),e)},Wt=function(n,e){return n.reduce((function(n,e){return n.has(e.id)?"online"in e&&n.get(e.id).online(e.online):n.set(e.id,{id:e.id,name:e.name,online:Y(e.online),tz:Y(""),st:Y("")}),delete e.online,n}),e)},$t=function(n,e){return n.reduce((function(n,e){if(n.has(e.id)){var t=n.get(e.id);t.fullname(e.fullname),t.about(e.about),t.md(e.md)}else n.set(e.id,function(n){return{id:n.id,mom:n.mom,by:n.by,dir:n.dir,timestamp:new Date(n.timestamp),chatid:n.chatid,to:n.to,re:n.re,fullname:Y(n.fullname),about:Y(n.about),md:Y(n.md)}}(e));return n}),e)};var Yt=function(){var n={},e={};return{create:function(t,r){return e[t]=new Promise((function(e){return n[t]=e}))},complete:function(e,t){return n[e]?n[e](t):null},join:function(n){return e[n]},joinall:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Promise.all(n.map((function(n){return e[n]})))},select:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Promise.race(n.map((function(n){return e[n]})))}}}(),Gt=30,Xt=Y([]),Zt=Y([]),Jt=Y(0),Qt=Y(0),nr=Y(0),er=Y(0),tr=Y(""),rr=Y(""),ir=Y(null),or=Y(!1),ur=Y(!1),ar=Rt(new Map),sr=Rt(new Map),cr=Rt(new Map),lr={id:0,childids:Y([]),childs:Rt(new Map),open:function(){return!0}},dr=Rt(new Map([[0,lr]])),fr=Y([]),vr=Bt(),hr=Bt(),pr=Y([]),mr=Y([]),gr=Y(0),br=Y(null),yr=Y(!1),wr=Y(""),kr=Y(!1),Cr=Bt(),Sr=Bt(),Er=Bt(),xr=Y(!0),Ar=Y(!1),_r=Y(!1);Y(""),Y("");var Ur,Tr=Y(0),Mr=Y(0),Dr=Y(0),Lr=Y(null),Pr=Y(location.hash.substr(1)),Or=Y(0),jr=Bt(),Ir=Rt(new Map),Nr=Bt(),Kr=Y(!1),Fr={content:null},zr=function(){switch(Dr()){case 1:return"please login first";case 2:return"invalid login name or password";case 3:return"email existed";case 4:return"username existed";case 5:return"please select a topic";case 6:return"topic is empty";case 7:return"invalid email address";case 8:return"error adding people";case 9:return"error signing up";case 10:return"invalid name";case 11:return"invalid input";case 12:return"password too short";case 13:return"invalid password";case 14:return"new password is the same with old password";case 15:return"peer offline";case 16:return"You are behind a NAT or firewall, can not create a direct connection to peer"}};function qr(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.includes(Dr())}var Rr,Br,Hr,Vr,Wr,$r,Yr,Gr,Xr,Zr,Jr,Qr,ni=function(n){Dr(n),clearTimeout(Ur),Ur=setTimeout((function(){return Dr(0)}),5e3)},ei=function(n){Lr(n),clearTimeout(Ur),Ur=setTimeout((function(){return Lr(null)}),5e3)},ti=new Map;function ri(n,e){return a(this,void 0,void 0,(function(){var t,r,i;return s(this,(function(o){switch(o.label){case 0:return ti.has(n)?(r=ti.get(n),[3,3]):[3,1];case 1:return[4,Yt.create("name",Ut.send(cn.Email(n)))];case 2:r=o.sent(),o.label=3;case 3:return t=r,ti.set(n,t),t?[4,ii(t)]:[2,ni(2)];case 4:return i=o.sent(),oi(t,e,i),[2]}}))}))}function ii(n){return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return Ut.send(cn.Au(n)),ei("a secret 6-digits otp code has been sent to your registered email"),[4,Yt.create("enterotp",vi())];case 1:return[2,e.sent()]}}))}))}function oi(n,e,t){return a(this,void 0,void 0,(function(){var r,i,o,u,a,c,l,d,f;return s(this,(function(s){switch(s.label){case 0:return console.groupEnd(),console.groupCollapsed("[au]","login",n),ar().clear(),sr().clear(),cr().clear(),fr([]),[4,hn()];case 1:return s.sent(),r=crypto.getRandomValues(new Uint8Array(12)),[4,jn(t,r)];case 2:return i=s.sent(),[4,On(e,n)];case 3:return o=s.sent(),a=U,c=[r],l=Uint8Array.bind,[4,H(o,i,r)];case 4:return u=a.apply(void 0,c.concat([new(l.apply(Uint8Array,[void 0,s.sent()]))])),d=j(),f={name:n,key:u,tz:d},Dn(o),Ut.send(cn.Login(f)),[2]}}))}))}function ui(n,e,t,r){return void 0===r&&(r=null),a(this,void 0,void 0,(function(){var i,o,u,a,c,l,d,f,v,h;return s(this,(function(s){switch(s.label){case 0:return i=crypto.getRandomValues(new Uint8Array(12)),[4,jn(e,i)];case 1:return o=s.sent(),r?(c=Uint8Array.bind,[4,On(r,n)]):[3,3];case 2:return a=new(c.apply(Uint8Array,[void 0,s.sent()])),[3,4];case 3:a=null,s.label=4;case 4:return u=a,[4,On(t,n)];case 5:return l=s.sent(),f=U,v=[i],h=Uint8Array.bind,[4,H(l,o,i)];case 6:return d=f.apply(void 0,v.concat([new(h.apply(Uint8Array,[void 0,s.sent()]))])),Dn(l),[2,Yt.create("pwd",Ut.send(cn.Pwd({key:d,okey:u})))]}}))}))}function ai(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var r=n.apply(void 0,e);return!r||ni(r)}function si(){Fr.content=sn(Br||(Br=l(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Sign up</div>\n                <div class="sub">We will send a sign up invitation to your email</div>\n                <form onsubmit=',">\n                    ",'\n                    <input\n                        type="text"\n                        name="m"\n                        placeholder="Your email address"\n                        onkeypress=',"\n                        onkeyup=",'\n                        required\n                        autocomplete="on"\n                        class=','\n                    />\n                    <div class="bn"><button type="submit">Sign up</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Sign up</div>\n                <div class="sub">We will send a sign up invitation to your email</div>\n                <form onsubmit=',">\n                    ",'\n                    <input\n                        type="text"\n                        name="m"\n                        placeholder="Your email address"\n                        onkeypress=',"\n                        onkeyup=",'\n                        required\n                        autocomplete="on"\n                        class=','\n                    />\n                    <div class="bn"><button type="submit">Sign up</button></div>\n                </form>\n            </div>\n        </div>\n    '])),(function(n){return a(this,void 0,void 0,(function(){var e,t,r;return s(this,(function(i){switch(i.label){case 0:return n.preventDefault(),e=n.target.m,L(t=e.value.trim())?[4,Yt.create("signup",Ut.send(cn.Signup(t)))]:[3,2];case 1:return(r=i.sent())?[2,ni(r)]:(ei("an invite code has been sent to "+t+", it should arrive shortly, you might have to check your spam folder"),Kr(!1),[3,3]);case 2:ni(7),i.label=3;case 3:return[2]}}))}))}),(function(){return qr(3,7)&&sn(Rr||(Rr=l(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),zr())}),I,K,(function(){return qr(3,7)&&"er"})),Kr(!0)}function ci(n,e){var t=Y("Log in Telegram"),r={};Fr.content=sn(Vr||(Vr=l(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Sign up</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input\n                        id="username"\n                        type="text"\n                        name="n"\n                        placeholder="Username"\n                        onkeypress=',"\n                        onkeyup=",'\n                        required\n                        autocomplete="on"\n                        class=','\n                    />\n                    <input\n                        type="password"\n                        name="p"\n                        placeholder="Password"\n                        required\n                        autocomplete="on"\n                        class=','\n                    />\n                    <script async src="https://telegram.org/js/telegram-widget.js?15"><\/script>\n                    <div><button onclick=',">",'</button></div>\n                    <div class="bn"><button type="submit">Sign up</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Sign up</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input\n                        id="username"\n                        type="text"\n                        name="n"\n                        placeholder="Username"\n                        onkeypress=',"\n                        onkeyup=",'\n                        required\n                        autocomplete="on"\n                        class=','\n                    />\n                    <input\n                        type="password"\n                        name="p"\n                        placeholder="Password"\n                        required\n                        autocomplete="on"\n                        class=','\n                    />\n                    <script async src="https://telegram.org/js/telegram-widget.js?15"><\/script>\n                    <div><button onclick=',">",'</button></div>\n                    <div class="bn"><button type="submit">Sign up</button></div>\n                </form>\n            </div>\n        </div>\n    '])),n,(function(t){t.preventDefault();var i=t.target,o=i.n,u=i.p,c=o.value.trim();ai(P,c)&&ai(F,u.value)&&function(n,e,t,r,i){a(this,void 0,void 0,(function(){var o,u,a,c,l,d,f,v,h;return s(this,(function(s){switch(s.label){case 0:return console.groupEnd(),console.groupCollapsed("[au]","register",n,e),[4,hn()];case 1:return s.sent(),o=crypto.getRandomValues(new Uint8Array(12)),[4,jn(r,o)];case 2:return u=s.sent(),[4,On(t,e)];case 3:return a=s.sent(),l=U,d=[o],f=Uint8Array.bind,[4,H(a,u,o)];case 4:return c=l.apply(void 0,d.concat([new(f.apply(Uint8Array,[void 0,s.sent()]))])),v=j(),h={name:e,key:c,tz:v,tgid:i.id||null,tgname:i.username||null,tgfn:i.first_name||null,tgln:i.last_name||null},Dn(a),Ut.send(cn.NewUser(h)),[2]}}))}))}(n,c,u.value,e,r)}),(function(){return qr(4,10,12)&&sn(Hr||(Hr=l(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),zr())}),N,K,(function(){return qr(4,10)&&"er"}),(function(){return qr(12)&&"er"}),(function(n){n.preventDefault()(window).Telegram.Login.auth({bot_id:"1850607378",request_access:!0},(function(n){n&&(b("username").value=n.username,t("Log in as "+n.first_name),r=n)}))}),t),Kr(!0)}function li(){Fr.content=sn($r||($r=l(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Log in</div>\n                <div class="sub"></div>\n                <form onsubmit=',">\n                    ",'\n                    <input\n                        type="text"\n                        name="m"\n                        placeholder="Username or email"\n                        onkeypress=',"\n                        onkeyup=",'\n                        required\n                        autocomplete="on"\n                        class=','\n                    />\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" />\n                    <div class="lf fp"><a onclick=','>Forgot password</a></div>\n                    <div class="bn">\n                        <button type="submit">Log in</button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Log in</div>\n                <div class="sub"></div>\n                <form onsubmit=',">\n                    ",'\n                    <input\n                        type="text"\n                        name="m"\n                        placeholder="Username or email"\n                        onkeypress=',"\n                        onkeyup=",'\n                        required\n                        autocomplete="on"\n                        class=','\n                    />\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" />\n                    <div class="lf fp"><a onclick=','>Forgot password</a></div>\n                    <div class="bn">\n                        <button type="submit">Log in</button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    '])),(function(n){return a(this,void 0,void 0,(function(){var e,t,r,i,o;return s(this,(function(u){switch(u.label){case 0:return n.preventDefault(),e=n.target,t=e.m,r=e.p,L(i=t.value.trim())?[2,ri(i,r.value)]:ai(P,i)?[4,ii(i)]:[3,2];case 1:o=u.sent(),oi(i,r.value,o),u.label=2;case 2:return[2]}}))}))}),(function(){return qr(7,10)&&sn(Wr||(Wr=l(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),zr())}),I,K,(function(){return qr(7,10)&&"er"}),di),Kr(!0)}function di(){Fr.content=sn(Gr||(Gr=l(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Forgot password</div>\n                <div class="sub">We will send a password reset link to your email</div>\n                <form onsubmit=',">\n                    ",'\n                    <input\n                        type="text"\n                        name="m"\n                        placeholder="Your email address"\n                        onkeypress=',"\n                        onkeyup=",'\n                        required\n                        autocomplete="on"\n                        class=','\n                    />\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Forgot password</div>\n                <div class="sub">We will send a password reset link to your email</div>\n                <form onsubmit=',">\n                    ",'\n                    <input\n                        type="text"\n                        name="m"\n                        placeholder="Your email address"\n                        onkeypress=',"\n                        onkeyup=",'\n                        required\n                        autocomplete="on"\n                        class=','\n                    />\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '])),(function(n){return a(this,void 0,void 0,(function(){var e,t;return s(this,(function(r){return n.preventDefault(),e=n.target.m,L(t=e.value.trim())?(Yt.create("forgotpwd",Ut.send(cn.Fp(t))),ei("a password reset link has been sent to "+t+", it should arrive shortly, you might have to check your spam folder"),Kr(!1)):ni(7),[2]}))}))}),(function(){return qr(7)&&sn(Yr||(Yr=l(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),zr())}),I,K,(function(){return qr(7)&&"er"})),Kr(!0)}function fi(n,e,t){Fr.content=sn(Zr||(Zr=l(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Reset password</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input\n                        type="password"\n                        name="p"\n                        placeholder="Password"\n                        required\n                        autocomplete="on"\n                        class=','\n                    />\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Reset password</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input\n                        type="password"\n                        name="p"\n                        placeholder="Password"\n                        required\n                        autocomplete="on"\n                        class=','\n                    />\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '])),e,(function(e){return a(this,void 0,void 0,(function(){var r,i;return s(this,(function(o){switch(o.label){case 0:return e.preventDefault(),ai(F,(r=e.target.p).value)?[4,ui(n,t,r.value)]:[3,2];case 1:if(i=o.sent())return[2,ni(i)];ei("password updated"),Kr(!1),location.hash="#",o.label=2;case 2:return[2]}}))}))}),(function(){return qr(12)&&sn(Xr||(Xr=l(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),zr())}),(function(){return qr(12)&&"er"})),Kr(!0)}function vi(){var n=c([],Array(6)).map((function(){return sn(Jr||(Jr=l(['<input class="ot" type="tel" autocomplete="chrome-off" />'],['<input class="ot" type="tel" autocomplete="chrome-off" />'])))})),e=n[0];e.addEventListener("input",i),setTimeout((function(){return e.focus()}));for(var t=function(e){var t=n[e];t.addEventListener("keypress",(function(r){r.keyCode>47&&r.keyCode<58&&(t.value=r.key,e!==n.length-1&&n[e+1].focus()),r.preventDefault()})),t.addEventListener("keydown",(function(r){"Backspace"===r.key&&(t.value="",0!==e&&n[e-1].focus())})),t.addEventListener("keyup",(function(e){if(16!==e.keyCode&&9!=e.keyCode&&224!=e.keyCode&&18!=e.keyCode&&17!=e.keyCode){e.target.value.length>1&&i(e);var t=n.map((function(n){return n.value})).join("");t.length===n.length&&Yt.complete("enterotp",t)}}))},r=0;r<n.length;r++)t(r);function i(n){var e=n.data||n.target.value;e&&1!==e.length&&o(n.target,e)}function o(n,e){n.focus(),n.value=e[0],e=e.substring(1),n.nextElementSibling&&e.length&&o(n.nextElementSibling,e)}Fr.content=sn(Qr||(Qr=l(['\n        <div class="pi">\n            <div class="su otp">\n                <div class="head">Enter OTP code</div>\n                <div class="sub">Please enter the 6-digits code sent to your email</div>\n                <div id="otp">',"</div>\n            </div>\n        </div>\n    "],['\n        <div class="pi">\n            <div class="su otp">\n                <div class="head">Enter OTP code</div>\n                <div class="sub">Please enter the 6-digits code sent to your email</div>\n                <div id="otp">',"</div>\n            </div>\n        </div>\n    "])),n),Kr(!0)}var hi,pi,mi,gi=function(n,e,r,i,o,u,c){return void 0===c&&(c="prev"),a(void 0,void 0,void 0,(function(){var a,l,d,f,v,h,p,m;return s(this,(function(s){switch(s.label){case 0:return[4,t.join()];case 1:return(a=s.sent())?(l=performance.now(),d=[],f=a.transaction([n],"readonly"),v=e?e(f.objectStore(n),r,o,u):[f.objectStore(n),null],h=v[0],p=v[1],m=0,[2,new Promise((function(e){h.openCursor(p,c).onsuccess=function(t){var u=t.target.result;if(u){if(d.push(u.value),i&&++m===i)return console.log("[db] scan",n,r,o||"",i,"in",T(l),"ms",{value:d}),e(d);u.continue()}else console.log("[db] scan",n,r,o||"",i,"in",T(l),"ms",{value:d}),e(d)}}))]):[2,[]]}}))}))},bi=function(n,e,t,r){var i=t?IDBKeyRange.upperBound(t,r):null;if(!e)return[n,i];var o=t||Number.MAX_VALUE;return[n=n.index("room"),i=IDBKeyRange.bound([e.value],[e.value,o],!1,r)]},yi=function(n,e,t,r){var i=t?IDBKeyRange.upperBound(t,r):null;if(!e)return[n,i];var o=t||Number.MAX_VALUE;return[n,i=IDBKeyRange.bound([e.value],[e.value,o],!1,r)]},wi=function(n,e,t,r){return void 0===t&&(t=30),void 0===r&&(r=!0),a(void 0,void 0,void 0,(function(){return s(this,(function(i){switch(i.label){case 0:return[4,gi("_c",yi,{value:n},t,e,r,"prev")];case 1:return[2,i.sent().map((function(n){return n.chatid}))]}}))}))},ki={i:0,mom:null,fullname:"⛩",id:0},Ci=(hi=Y(ki),pi=Y([ki]),mi=function(n){var e=pi();e[n.i]!==n&&(e[n.i]=n),e.splice(n.i+1),pi(e),hi(n),location.hash=n.i>0?Ft.ntob(n.id):""},{path:function(){return hi()},i:function(){return hi().i},id:function(){return hi().id},paths:pi,len:function(){return pi().length},same:function(n){return n===hi()},cd:mi,update:function(n){pi(c([ki],n)),hi(n[n.length-1]||ki)},ishome:function(){return hi()===ki},home:function(){return mi(ki)}});function Si(n){for(var e=(n+"=".repeat((4-n.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(e),r=new Uint8Array(t.length),i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}function Ei(){return a(this,void 0,void 0,(function(){var n,e,t;return s(this,(function(r){switch(r.label){case 0:return[4,navigator.serviceWorker.ready];case 1:return[4,r.sent().pushManager.getSubscription()];case 2:return(n=r.sent())?[3,3]:(console.log("no valid subscription"),navigator.serviceWorker.getRegistration().then((function(n){null==n||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Si("BIm2PpzmeMy3pe_VkzyP8Yq-iqG8ay0qLBGcJZNXnq5lOKu1fAyY9xQ2PK2KQjzWulmKu8IzBLmut276h4tIw5k")}).then((function(n){console.log("push subscription",n)}),(function(n){console.log("error getting push permission",n)}))})),[3,5]);case 3:return e=JSON.parse(JSON.stringify(n)),[4,An("s")];case 4:if((t=r.sent())instanceof ArrayBuffer&&(new TextDecoder).decode(t)==e.keys.auth)return[2];xn("s",(new TextEncoder).encode(e.keys.auth).buffer),vn("subs",e),r.label=5;case 5:return[2]}}))}))}"serviceWorker"in navigator&&(navigator.serviceWorker.register("sw.js").then((function(){console.log("[sw] registered")})),navigator.serviceWorker.addEventListener("message",(function(n){n.data.reload&&location.reload()}),!1));var xi=function(){return Zt().length>0?Zt()[Zt().length-1]:0};var Ai=function(n,e){return a(void 0,void 0,void 0,(function(){var t,r,i,o,u,a,c,l,d,f,v;return s(this,(function(s){switch(s.label){case 0:return[4,_i(n)];case 1:return s.sent(),t=n[0],r=new Set,i=new Set,o=Zt(),u="re"===e?new Set:new Set(o),n=n.filter((function(n){var e=sr(n);if(!e)return!1;cr().has(e.by)||r.add(e.by),e.men&&e.men.forEach((function(n){cr().has(n)||r.add(n)})),e.dir.forEach((function(n){ar().has(n)||i.add(n)}));var t=u.has(n);return t&&console.error("duplicated id in keys",n),u.add(n),!t})),[4,Ti(r,i)];case 2:switch(s.sent(),n.reverse(),e){case"re":Zt(n);break;case"pre":Zt(o.concat(n));break;default:Zt(n.concat(o))}for(a=Zt(),c=0;c<a.length;c++)l=sr(a[c-1]),d=sr(a[c+1]),(f=sr(a[c])).showby(f.by!==(null==l?void 0:l.by)),f.first(f.chanid!==(null==l?void 0:l.chanid)),f.last(f.chanid!==(null==d?void 0:d.chanid)),f.firstre(null!==f.re&&f.re!==(null==l?void 0:l.re)&&f.re!=(null==l?void 0:l.id)),f.lastre(null!==f.re&&f.re!==(null==d?void 0:d.re));return io(),t&&(null===(v=b(Ft.ntob(t)+"_"))||void 0===v||v.scrollIntoView()),[2]}}))}))},_i=function(n){return a(void 0,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,Ui(n)];case 1:return n=t.sent(),e=n.map((function(n){var e;return null===(e=sr(n))||void 0===e?void 0:e.re})).filter((function(n){return n&&n>0&&!sr().has(n)})),Ui(Array.from(new Set(e))),[2]}}))}))},Ui=function(n){return a(void 0,void 0,void 0,(function(){var e,t,r,i;return s(this,(function(o){switch(o.label){case 0:return 0===(n=n.filter((function(n){return!sr().has(n)}))).length?[2,n]:[4,kn("_t",n)];case 1:return e=o.sent(),t=e.value,r=e.missed,Vt(t,sr()),r.length>0?[4,Yt.create("chats",Ut.send(cn.Chats(r)))]:[3,3];case 2:i=o.sent(),Vt(i,sr()),o.label=3;case 3:return[2,n]}}))}))},Ti=function(n,e){return a(void 0,void 0,void 0,(function(){var t,r,i,o,u;return s(this,(function(a){switch(a.label){case 0:return[4,kn("_e",Array.from(n))];case 1:return t=a.sent(),[4,kn("_h",Array.from(e))];case 2:return r=a.sent(),t.value.length&&Ut.send(cn.Ons(t.value.filter((function(n){return n.id!=Ln.id()})).map((function(n){return n.id})))),Wt(t.value,cr()),$t(r.value,ar()),t.missed.length>0&&Yt.create("users",Ut.send(cn.Users(t.missed))),r.missed.length>0&&Yt.create("chans",Ut.send(cn.Chans(r.missed))),[4,Yt.joinall("users","chans")];case 3:return i=a.sent(),o=i[0],u=i[1],o&&Wt(o,cr()),u&&$t(u,ar()),[2]}}))}))},Mi=function(n){var e=n.map((function(n,e){var t=ar(n);return{i:e+1,mom:t.mom,fullname:t.fullname,id:n}}));Ci.update(e)},Di=function(n){return a(void 0,void 0,void 0,(function(){var e,t,r,i;return s(this,(function(o){switch(o.label){case 0:return 0===(n=n.filter((function(n){return!ar().has(n)}))).length?[2]:[4,kn("_h",n)];case 1:return e=o.sent(),t=e.value,r=e.missed,console.log("[chans] gets",{value:t,missed:r}),$t(t,ar()),r.length>0?[4,Yt.create("chans",Ut.send(cn.Chans(r)))]:[3,3];case 2:i=o.sent(),$t(i,ar()),o.label=3;case 3:return[2]}}))}))},Li=function(n,e,t,r,i,o){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),r&&rr(r);var u=cn.Shan({chanid:n,kw:r,ub:i,lb:o,cu:e,mu:t});return Yt.create("chanscan",Ut.send(u))};function Pi(){return a(this,void 0,void 0,(function(){var n;return s(this,(function(e){switch(e.label){case 0:return[4,gi("_h",(function(n){return[n.index("chatid"),null]}))];case 1:return n=e.sent(),console.log("[chans] load tree",n),$t(n,ar()),[2,n.map((function(n){return n.id}))]}}))}))}function Oi(n,e){return void 0===n&&(n=null),void 0===e&&(e=null),a(this,void 0,void 0,(function(){var t,r,i;return s(this,(function(o){switch(o.label){case 0:return 0===lr.childids().length||n?(console.log("[dir]","load tree",n||"",e||""),t=performance.now(),e?(i=[],[3,3]):[3,1]):[3,6];case 1:return[4,Pi()];case 2:i=o.sent(),o.label=3;case 3:return(r=i).length<1?[4,qi(n,e)]:[3,5];case 4:r=o.sent(),o.label=5;case 5:Ii(r),console.log("[dir]","tree loaded",e||"","in",T(t),"ms"),o.label=6;case 6:return[2]}}))}))}var ji=function(n,e,t){return void 0===e&&(e=null),void 0===t&&(t=null),a(void 0,void 0,void 0,(function(){var r,i,o,u,a;return s(this,(function(s){switch(s.label){case 0:return console.groupEnd(),console.log("[dir]","list",n,"ub",t,e?'"'+e+'"':""),r=performance.now(),Oi(null,e),[4,_n(n,"_d")];case 1:return i=s.sent()||null,[4,_n(n,"_m")];case 2:return o=s.sent()||null,[4,Li(n,i,o,e,t)];case 3:return u=s.sent(),t?0===u.length?console.warn("no more result"):Xt(Xt().concat(u)):(0!==u.length||e||vn("nochan"),Xt(u)),(a=Ni(n))&&(Ki(Xt(),a.childs()),a.childids(Xt())),console.log("[dir]","chans load",n,"ub",t,e?'"'+e+'"':"","in",T(r),"ms"),console.groupEnd(),[2]}}))}))};function Ii(n,e){var t;void 0===e&&(e=0);var r=n.filter((function(n){var t;return(null===(t=ar(n))||void 0===t?void 0:t.mom)==e})),i=Ni(e);i&&((Jt()==e||Jt()&&ar(Jt())&&(null===(t=ar(Jt()))||void 0===t?void 0:t.dir.includes(e)))&&i.open(!0),Ki(r,i.childs()),i.childids(r));for(var o=0,u=r;o<u.length;o++){Ii(n,u[o])}}function Ni(n){var e,t,r,i,o=n&&ar(n)?c(c([0],null!==(t=null===(e=ar(n))||void 0===e?void 0:e.dir)&&void 0!==t?t:[]),[n]):[0],u=dr();for(i=0;i<o.length;i++){var a=o[i];u.has(a)&&(r=u.get(a),u=r.childs())}return r}function Ki(n,e){return n.reduce((function(n,e){return n.has(e)||n.set(e,{id:e,childids:Y([]),childs:Rt(new Map),open:Y(!1)}),n}),e)}var Fi=function(n){return void 0===n&&(n=null),ji(Ci.id(),n)},zi=function(n){void 0===n&&(n=null),ir(n),Zi(n)};function qi(n,e){return void 0===n&&(n=null),void 0===e&&(e=null),a(this,void 0,void 0,(function(){return s(this,(function(t){return e&&rr(e),[2,Yt.create("scantree",Ut.send(cn.Tree({kw:e,reload:n})))]}))}))}var Ri=function(n){var e=n.id,t=n.mom,r=n.fullname;return a(void 0,void 0,void 0,(function(){return s(this,(function(n){return e===Jt()||Ci.cd({i:Ci.i()+1,mom:t,fullname:r,id:e}),[2]}))}))},Bi=function(n){return a(void 0,void 0,void 0,(function(){return s(this,(function(e){return Ut.send(cn.MuteChan(n)),[2]}))}))},Hi=function(n){return a(void 0,void 0,void 0,(function(){return s(this,(function(e){return Ut.send(cn.UnmuteChan(n)),[2]}))}))},Vi=function(n,e,t){return a(void 0,void 0,void 0,(function(){var r;return s(this,(function(i){switch(i.label){case 0:return[4,Yt.create("addmems",Ut.send(cn.AddMems({chanid:n,userids:e,emails:t})))];case 1:return r=i.sent(),eo(n),[2,r]}}))}))};function Wi(n){return a(this,void 0,void 0,(function(){var e,t,r;return s(this,(function(i){switch(i.label){case 0:return(e=ar(n))&&ar().delete(n),[4,_n(n,"_h")];case 1:return(e=i.sent())?[4,bn(e)]:[3,3];case 2:i.sent(),i.label=3;case 3:return t=Xt(),(r=t.indexOf(n))>-1&&(t.splice(r,1),Xt(t)),[2,e]}}))}))}var $i=function(n,e,t){void 0===n&&(n=null),void 0===e&&(e=null),void 0===t&&(t=null);var r=cn.Shin({chanid:Jt(),kw:n,ub:e,lb:t,lu:null,cu:null,mu:null});return Yt.create("chatscan",Ut.send(r))},Yi=function(n,e,t,r,i,o){void 0===n&&(n=null),void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null);var u=cn.Shin({chanid:Jt(),kw:r,ub:i,lb:o,lu:n,cu:e,mu:t});return Yt.create("chatscan",Ut.send(u))},Gi=function(n){return a(void 0,void 0,void 0,(function(){var e,t,r,i,o,u;return s(this,(function(a){switch(a.label){case 0:return e=ir()||null,t=Jt(),console.groupEnd(),console.groupCollapsed("[store]","⬆ load more",t,"ub",n,"kw",e),r=performance.now(),[4,Sn(t)];case 1:return(i=a.sent()||[])[2]&&n===i[1]?(or(!0),console.log("[store] top chat reached"),[2]):(or(!1),e?[3,4]:[4,wi(t,n,Gt)]);case 2:return o=a.sent(),i[2]||o.length===Gt?[4,Ai(o)]:[3,4];case 3:return a.sent(),console.log("[store]","scan more",t,"ub",n,"in",T(r),"ms"),[2];case 4:return[4,$i(e,n)];case 5:return(u=a.sent()).length>0?[4,Ai(u)]:[3,7];case 6:a.sent(),a.label=7;case 7:return console.log("[store]","update more",t,"ub",n,"kw",e,"in",T(r),"ms"),console.groupEnd(),[2]}}))}))},Xi={cb:null};function Zi(n){return void 0===n&&(n=null),a(this,void 0,void 0,(function(){var e,t,r,i,o,u,a,c,l,d,f;return s(this,(function(s){switch(s.label){case 0:return Xi.cb=null,or(!1),nr(0),e=Jt(),console.groupEnd(),console.groupCollapsed("[store]","⟳ reload",e),t=performance.now(),[4,Sn(e)];case 1:return r=s.sent()||[],i=void 0,o=n?null:r[0]||null,[4,wi(e,i,Gt)];case 2:return u=s.sent(),[4,Ai(u,"re")];case 3:return s.sent(),Xi.cb=Gi,console.log("[store]","chats reload",e,"in",T(t),"ms"),f={},[4,_n(e,"_u")];case 4:return f.id=s.sent()||0,f.lo=r[1]||0,a=f,[4,_n(e,"_d")];case 5:return c=s.sent()||null,[4,_n(e,"_m")];case 6:return l=s.sent()||null,[4,Yi(a,c,l,n,i,o)];case 7:return d=s.sent()||[],[4,Ai(d,d.length!==Gt&&0!==u.length&&o?"pre":"re")];case 8:return s.sent(),console.log("[store]","updated",e,"in",T(t),"ms"),console.groupEnd(),[2]}}))}))}function Ji(n){return a(this,void 0,void 0,(function(){var e,t,r,i,o;return s(this,(function(u){switch(u.label){case 0:return(e=n.filter((function(n){return!cr().has(n)}))).length?[4,kn("_e",e)]:[3,4];case 1:return t=u.sent(),r=t.value,i=t.missed,Wt(r,cr()),i.length>0?[4,Yt.create("users",Ut.send(cn.Users(i)))]:[3,3];case 2:(o=u.sent())&&Wt(o,cr()),u.label=3;case 3:Ut.send(cn.Ons(e.filter((function(n){return n!=Ln.id()})))),u.label=4;case 4:return[2]}}))}))}function Qi(n,e){var t,r=e.action,i=e.chatid,o=e.txt;return a(this,void 0,void 0,(function(){var e,u;return s(this,(function(a){switch(a.label){case 0:switch(r){case 1:return[3,1];case 2:return[3,5]}return[3,7];case 1:return null===(t=sr(i))||void 0===t||t.txt(o),[4,_n(i,"_t")];case 2:return(e=a.sent())?(e.txt=null!=o?o:"",[4,yn("_t",e)]):[3,4];case 3:a.sent(),e.dir.forEach((function(e){return n.add(e)})),a.label=4;case 4:return[3,7];case 5:return[4,no(i)];case 6:return(u=a.sent())&&u.dir.forEach((function(e){return n.add(e)})),[3,7];case 7:return[2]}}))}))}function no(n){return a(this,void 0,void 0,(function(){var e,t,r;return s(this,(function(i){switch(i.label){case 0:return(e=sr(n))&&sr().delete(n),[4,_n(n,"_t")];case 1:return(e=i.sent())?[4,gn(e)]:[3,3];case 2:i.sent(),i.label=3;case 3:return t=Zt(),(r=t.indexOf(n))>-1&&(t.splice(r,1),Zt(t)),io(),[2,e]}}))}))}function eo(n){var e,t,r,i;return a(this,void 0,void 0,(function(){var o,u,a,l,d,f,v,h,p,m,g;return s(this,(function(s){switch(s.label){case 0:return n?(o=null===(t=null===(e=ar(n))||void 0===e?void 0:e.md())||void 0===t||t?c(c([],null!==(i=null===(r=ar(n))||void 0===r?void 0:r.dir)&&void 0!==i?i:[]),[n]):[n],[4,kn("_n",o)]):[2,fr([])];case 1:return u=s.sent(),a=u.value,l=u.missed,d=[],l.length?[4,Yt.create("memlist",Ut.send(cn.Mems(l)))]:[3,3];case 2:for(f=s.sent(),v=0,h=f;v<h.length;v++)p=h[v],Wt(p.users,cr()),wn("_e",p.users),m=p.users.map((function(n){return n.id})),Un("_n",p.chanid,m),d=c(c([],d),m);s.label=3;case 3:return[4,Ji(g=Array.from(new Set(c(c([],a.flat()),d))))];case 4:return s.sent(),g.sort((function(n){var e;return(null===(e=cr(n))||void 0===e?void 0:e.online())?-1:0})),fr(g),[2]}}))}))}function to(n){return a(this,void 0,void 0,(function(){var e,t,r;return s(this,(function(i){switch(i.label){case 0:return[4,Yt.create("findusers",Ut.send(cn.FindUsers(n)))];case 1:return e=i.sent(),pr(e),(t=e.find((function(e){return e.name===n})))?gr(e.indexOf(t)):(r=e.find((function(e){return e.name.startsWith(n)})),gr(r?e.indexOf(r):0)),[2,e.length]}}))}))}function ro(n){return a(this,void 0,void 0,(function(){var e,t,r;return s(this,(function(i){switch(i.label){case 0:return[4,Yt.create("findmems",Ut.send(cn.FindMems({chanid:er()||Jt(),kw:n})))];case 1:return e=i.sent(),mr(e),(t=e.find((function(e){return e.name===n})))?gr(e.indexOf(t)):(r=e.find((function(e){return e.name.startsWith(n)})),gr(r?e.indexOf(r):0)),[2,e.length]}}))}))}function io(){if(b("cs")){var n=window.innerHeight-b("cs").offsetHeight-(Ln.id()?96:64)-(kr()&&yr()?56:kr()?32:yr()?24:0);b("cs").childElementCount>2&&(n-=5),b("os").style.height=n>0?n+"px":"0"}}function oo(){var n=Ln.id(),e=cr(n);e?e.online(!0):cr().set(n,{id:n,name:Ln.name(),online:Y(!0),tz:Y(j()),st:Y("")})}window.onresize=io,fn("reconnected",(function(){Zi(),ji(Ci.id())})),fn("config",(function(n){var e=n.d;return a(void 0,void 0,void 0,(function(){var n;return s(this,(function(t){switch(t.label){case 0:return e?(oo(),Ei(),[3,3]):[3,1];case 1:return Ln.id()?(er(0),cr(Ln.id())&&(null===(n=cr(Ln.id()))||void 0===n||n.online(!1)),Ln.id(0),Ln.name(""),Ln.chans([]),delete Ln.sskey,Ln.salt=new Uint8Array,[4,hn()]):[3,3];case 2:t.sent(),lr.childids([]),Ci.ishome()?(Zi(),Oi()):Ci.home(),t.label=3;case 3:return[2]}}))}))})),fn("subs",(function(n){Ut.send(cn.PushSubs({endpoint:n.endpoint,auth:n.keys.auth,p256dh:n.keys.p256dh}))}));var uo=function(n){er()!==n?er(n):er(0),eo(er()||Jt()),nr(0)};function ao(n){return a(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return Xi.cb=null,[4,Yt.create("thread",Ut.send(cn.ChatThread({i:n,kw:null,ub:null,lb:null})))];case 1:return e=t.sent(),[4,Ai(e,"re")];case 2:return t.sent(),Xi.cb=function(e){return function(n,e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(r){switch(r.label){case 0:return[4,Yt.create("thread",Ut.send(cn.ChatThread({i:n,kw:null,ub:e,lb:null})))];case 1:return t=r.sent(),[2,Ai(t)]}}))}))}(n,e)},[2]}}))}))}function so(n){return a(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return Xi.cb=null,[4,Yt.create("list",Ut.send(cn.ChatList({i:n,kw:null,ub:null,lb:null})))];case 1:return e=t.sent(),[4,Ai(e,"re")];case 2:return t.sent(),Xi.cb=function(e){return function(n,e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(r){switch(r.label){case 0:return[4,Yt.create("list",Ut.send(cn.ChatList({i:n,kw:null,ub:e,lb:null})))];case 1:return t=r.sent(),[2,Ai(t)]}}))}))}(n,e)},[2]}}))}))}var co=function(n){return a(void 0,void 0,void 0,(function(){var e,t,r;return s(this,(function(i){switch(i.label){case 0:return(e=sr(n))&&e.nor(e.nor()+1),[4,_n(n,"_t")];case 1:return(t=i.sent())?(t.nor=null!==(r=null==e?void 0:e.nor())&&void 0!==r?r:null,[4,yn("_t",t)]):[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))};function lo(n){return a(this,void 0,void 0,(function(){return s(this,(function(e){return[2,Yt.create("status",Ut.send(cn.Status(n)))]}))}))}var fo=[];function vo(){return a(this,void 0,void 0,(function(){var n,e;return s(this,(function(t){switch(t.label){case 0:return[4,B()];case 1:return n=t.sent(),[4,crypto.subtle.exportKey("raw",n.publicKey)];case 2:return e=t.sent(),[2,{keypair:n,pub:new Uint8Array(e)}]}}))}))}function ho(n){return a(this,void 0,void 0,(function(){var e,t,r,i,o,u,a,c,l,d,f,v,h,p,m,g,b,y;return s(this,(function(s){switch(s.label){case 0:return e=Yt.create("ice"),[4,po(n)];case 1:return[4,(t=s.sent()).createOffer()];case 2:return r=s.sent(),[4,t.setLocalDescription(r)];case 3:return s.sent(),i=ct((new TextEncoder).encode(t.localDescription.sdp)),[4,vo()];case 4:return o=s.sent(),u=o.keypair,a=o.pub,i=k(i,a),[4,e];case 5:return s.sent(),[4,Yt.create("offer",Ut.send(cn.Sdp({fr:null,to:n,sd:i,ca:fo,offer:!0})))];case 6:return c=s.sent(),l=C(new Uint8Array(c.sd)),d=l.a,f=l.k,[4,R(f)];case 7:return v=s.sent(),h=t,[4,q(u.privateKey,v)];case 8:h.sharedkey=s.sent(),p=(new TextDecoder).decode(st(d)),t.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:p})),m=0,g=c.ca,s.label=9;case 9:return m<g.length?(b=g[m],y=new RTCIceCandidate({candidate:b,sdpMid:"0",sdpMLineIndex:0}),[4,t.addIceCandidate(y)]):[3,12];case 10:s.sent(),s.label=11;case 11:return m++,[3,9];case 12:return[2]}}))}))}function po(n){return a(this,void 0,void 0,(function(){var e,t,r=this;return s(this,(function(i){switch(i.label){case 0:return[4,Ji([n])];case 1:return i.sent(),e=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]}),Ir().has(n)||jr.add(n),Ir().set(n,e),e.onicecandidate=function(n){n.candidate?fo.push(n.candidate.candidate):Yt.complete("ice",fo)},e.onconnectionstatechange=function(n){console.log("[peer]",e.connectionState),e.connectionState},(t=e.createDataChannel("p",{negotiated:!0,id:1})).binaryType="arraybuffer",t.onopen=function(e){console.log("dc",n,"open",e)},t.onmessage=function(t){var i=t.data;return a(r,void 0,void 0,(function(){var t,r,o,u,a,c,l;return s(this,(function(s){switch(s.label){case 0:return t=O(),r=new Uint8Array(i),o=r.subarray(0,12),u=Uint8Array.bind,[4,V(r.subarray(12),e.sharedkey,o)];case 1:return r=new(u.apply(Uint8Array,[void 0,s.sent()])),w(r,o),a=at(st(r)),c={id:0,txt:a.txt,by:n,ts:new Date,room:n,showby:!1},Nr.last().by!=n&&(c.showby=!0),l=c,[4,yn("_p",c)];case 2:return l.id=s.sent(),Or()==n&&Nr.add(c),t&&setTimeout(y),io(),[2]}}))}))},t.onclose=function(e){var t,r;console.log("dc",n,"close",e),setTimeout((function(){var e;if(null===(e=cr(n))||void 0===e?void 0:e.online())return ho(n)}),(t=1e3,r=5e3,Math.random()*(r-t)+t))},t.onerror=function(e){console.warn("dc",n,"error",e)},e.send=function(n){return a(r,void 0,void 0,(function(){var r,i,o,u,a;return s(this,(function(s){switch(s.label){case 0:return r=ct(ut(n)),i=crypto.getRandomValues(new Uint8Array(12)),w(r,i),o=U,u=[i],a=Uint8Array.bind,[4,H(r,e.sharedkey,i)];case 1:return r=o.apply(void 0,u.concat([new(a.apply(Uint8Array,[void 0,s.sent()]))])),t.send(r),[2]}}))}))},e.open=function(){return"open"===t.readyState},[2,e]}}))}))}function mo(n,e){var t=n.id;if(!t||nr()===t)return nr(0);e.focus(),nr(t)}function go(n){return a(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,(r=n,void 0===u&&(u=!0),a(void 0,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,gi("_p",bi,{value:r},o,i,u,"prev")];case 1:return[2,n.sent()]}}))})))];case 1:return e=t.sent(),Nr(e.reverse()),[2]}var r,i,o,u}))}))}function bo(n,e,t){const{root:r,subscribe:i,sample:o,cleanup:u}=rn;null==t&&(t=!e.$t);let a=rn.h([]),s=rn.add(a,""),c=new Map,l=new Map,d=new Set;function f(n,i){if(null==n)return;let o=l.get(n);return 1===i?(d.delete(n),o||(o=t?r((t=>(c.set(n,t),e(n.$v||n)))):e(n.$v||n),11===o.nodeType&&(o=(n=>{const{childNodes:e}=n,{length:t}=e;if(t<2)return e[0];let r=Array.from(e);return{nodeType:111,t:r[0],o:r[t-1],l(){if(e.length!==t){let e=0;for(;e<t;)n.appendChild(r[e++])}return n}}})(o)||o),l.set(n,o))):-1===i&&d.add(n),((n,e)=>111===n.nodeType?1/e<0?e?rn.rm(n.t.parentNode,n.t.nextSibling,n.o.nextSibling)||n.t:n.o:e?n.l():n.t:n)(o,i)}function v(n){let e=c.get(n);e&&(e(),c.delete(n)),l.delete(n)}return u(i((e=>{let t=n();return o((()=>{d.clear();let n=Array.from(function(n,e,t,r,i){let o,u,a=new Map,s=new Map;for(o=0;o<e.length;o++)a.set(e[o],o);for(o=0;o<t.length;o++)s.set(t[o],o);for(o=u=0;o!==e.length||u!==t.length;){var c=e[o],l=t[u];if(null===c)o++;else if(t.length<=u)n.removeChild(r(e[o],-1)),o++;else if(e.length<=o)n.insertBefore(r(l,1),r(e[o],0)||i),u++;else if(c===l)o++,u++;else{var d=s.get(c),f=a.get(l);void 0===d?(n.removeChild(r(e[o],-1)),o++):void 0===f?(n.insertBefore(r(l,1),r(e[o],0)||i),u++):(n.insertBefore(r(e[f],1),r(e[o],0)||i),e[f]=null,f>o+1&&o++,u++)}}return t}(s.parentNode,e||[],t,f,s));return d.forEach(v),n}))}))),u((function(){c.forEach((n=>n())),c.clear(),l.clear(),d.clear()})),a}!function(n){zt.push(n)}((function(n){return a(void 0,void 0,void 0,(function(){var e,t,r,i,o,u,a,l,d,f,v,h,p,m,g,b;return s(this,(function(s){switch(s.label){case 0:return Pr(n),Or(0),e=jr(),Ln.id()>0&&(e=c(c([],e),[Ln.id()])),[4,Ji(e)];case 1:return s.sent(),"$"!==n[0]?[3,4]:(t=n.slice(1).split("/"),r=t[0],i=t[1],o=t[2],i.length<50?(location.hash="#",[2,Kr(!1)]):[4,Yt.create("unpack",Ut.send(cn.Unpack(i)))]);case 2:return(u=s.sent())?[4,Yt.create("name",Ut.send(cn.Email(u)))]:(location.hash="#",[2,Kr(!1)]);case 3:switch(a=s.sent(),r){case"i":if(!a)return ci(u,o),[2,fn("login",(function(n){return n?location.hash="#":null}))];break;case"f":if(a&&(a==Ln.name()||!Ln.id()))return[2,fi(a,u,o)]}return location.hash="#",[2,Kr(!1)];case 4:return"/"!==n[0]?[3,6]:(l=Ft.bton(n.slice(1)),Qt(l),Zt([]),ao(l),io(),[4,Oi()]);case 5:return s.sent(),[2];case 6:return"&"!==n[0]?[3,10]:(d=Ft.bton(n.slice(1)))==Ln.id()?[2,location.hash="#"]:(Jt(0),Qt(0),eo(0),er(0),Mi([]),Zt([]),[4,Ji([d])]);case 7:return s.sent(),Or(d),[4,go(d)];case 8:return s.sent(),[4,Oi()];case 9:return s.sent(),!Ir().has(d)&&(null===(p=cr(d))||void 0===p?void 0:p.online())&&ho(d),setTimeout((function(){io(),y()}),100),[2];case 10:return(f=["!","@","*"].indexOf(n[0]))>-1?(Jt(0),er(0),Qt(0),Zt([]),so(f),io(),[4,Oi()]):[3,12];case 11:return s.sent(),[2];case 12:return"%"===n[0]?[2,location.hash="#"+Ft.ntob(Number(n.slice(1)))]:n&&Ot.includes(n[0])?[3,14]:(Jt(0),Qt(0),eo(0),er(0),Mi([]),[4,Oi()]);case 13:return s.sent(),Zi(),document.title="hyze - micro chat for team",[2];case 14:return v=Ft.bton(n),[4,Oi()];case 15:return s.sent(),Jt(v),er(0),Qt(0),Zi(),ar(v)?(h=null!==(g=null===(m=ar(v))||void 0===m?void 0:m.dir)&&void 0!==g?g:[],Mi(c(c([],h),[v])),eo(v),document.title=(null===(b=ar(Jt()))||void 0===b?void 0:b.fullname())+" - hyze",[2]):[2]}}))}))})),Ut.recv((function(n){var e=n.tag,t=n.value;return a(void 0,void 0,void 0,(function(){var n,r,i,o,u,l,d,f,v,h,p,m,g,b,w,S,E,x,A,_,U,T,M;return s(this,(function(D){switch(D.label){case 0:switch(e){case"Err":return[3,1];case"Unpack":return[3,2];case"AddMems":return[3,3];case"Logout":return[3,4];case"NewChan":return[3,5];case"Shin":return[3,6];case"Update":return[3,7];case"Updates":return[3,8];case"ChanUpdates":return[3,9];case"MemUpdates":return[3,10];case"Login":return[3,11];case"Pwd":return[3,13];case"Users":return[3,16];case"Chans":return[3,17];case"Chat":return[3,18];case"Chats":return[3,19];case"Shan":return[3,20];case"Tree":return[3,24];case"Treeid":return[3,25];case"MuteChan":return[3,28];case"UnmuteChan":return[3,31];case"DelChan":return[3,34];case"Mems":return[3,35];case"FindUsers":return[3,36];case"FindMems":return[3,37];case"On":return[3,38];case"Ons":return[3,39];case"Profile":return[3,40];case"Name":return[3,41];case"Signup":return[3,42];case"ChatThread":return[3,43];case"ChatList":return[3,44];case"Status":return[3,45];case"Sdp":return[3,46]}return[3,47];case 1:return ni(t),[3,47];case 2:return Yt.complete("unpack",t),[3,47];case 3:return Yt.complete("addmems",t),[3,47];case 4:return Mn({d:!1}),[3,47];case 5:return er(t),y(),[3,47];case 6:return Vt((n=t).chats,sr()),Wt(n.users,cr()),$t(n.chans,ar()),wn("_t",n.chats),wn("_h",n.chans),wn("_e",n.users),function(n){a(this,void 0,void 0,(function(){var e,t,r;return s(this,(function(i){return e=n||[],t=Jt(),0===e.length?(or(!0),Cn(t,[],!0),console.log("top chat reached"),Yt.complete("chatscan",e),[2]):(or(!1),Cn(t,[e[0],e[e.length-1]]),r=e.map((function(n){return{chanid:t,chatid:n}})),wn("_c",r),Yt.complete("chatscan",e),[2])}))}))}(n.chats.map((function(n){return n.id}))),[3,47];case 7:return r=t,Qi(i=new Set([Jt()]),r),i.forEach((function(n){return Un("_u",n,r.id)})),[3,47];case 8:return(o=t).length&&function(n){a(this,void 0,void 0,(function(){var e,t,r,i;return s(this,(function(o){for(e=new Set([Jt()]),t=0,r=n;t<r.length;t++)i=r[t],Qi(e,i);return e.forEach((function(e){return Un("_u",e,n[n.length-1].id)})),[2]}))}))}(o),[3,47];case 9:return(u=t).length&&function(n){a(this,void 0,void 0,(function(){var e,t,r,i,o,u,a,c,l,d,f,v;return s(this,(function(s){switch(s.label){case 0:e=new Set([Jt()]),t=0,r=n,s.label=1;case 1:if(!(t<r.length))return[3,9];switch(i=r[t],o=i.action,u=i.chanid,a=i.name,c=i.about,l=i.md,o){case 1:return[3,2];case 2:return[3,6]}return[3,8];case 2:return(d=ar(u))&&(null!==a&&d.fullname(a),null!==c&&d.about(c),null!==l&&d.md(l)),[4,_n(u,"_h")];case 3:return(f=s.sent())?(null!==a&&(f.fullname=a),null!==c&&(f.about=c),null!==l&&(f.md=l),[4,yn("_h",f)]):[3,5];case 4:s.sent(),f.dir.forEach((function(n){return e.add(n)})),s.label=5;case 5:return[3,8];case 6:return[4,Wi(u)];case 7:return(v=s.sent())&&v.dir.forEach((function(n){return e.add(n)})),[3,8];case 8:return t++,[3,1];case 9:return e.forEach((function(e){return Un("_d",e,n[n.length-1].id)})),[2]}}))}))}(u),[3,47];case 10:return(l=t).length&&function(n){a(this,void 0,void 0,(function(){var e,t,r,i,o,u,a,l,d,f,v,h,p,m,g,b;return s(this,(function(y){switch(y.label){case 0:for(e=new Set([Jt()]),t=new Map,r=0,i=n;r<i.length;r++)switch(o=i[r],u=o.action,a=o.chanid,l=o.by,u){case 1:t.has(a)?t.get(a).adds.push(l):t.set(a,{adds:[l],rms:[]});break;case 0:t.has(a)?t.get(a).rms.push(l):t.set(a,{adds:[],rms:[l]})}d=function(n,t,r){var i;return s(this,(function(o){switch(o.label){case 0:return[4,_n(n,"_n")];case 1:return(i=o.sent())&&(i=i.filter((function(n){return r.indexOf(n)<0})),Un("_n",n,Array.from(new Set(c(c([],t),i))))),e.add(n),[2]}}))},f=0,v=t.entries(),y.label=1;case 1:return f<v.length?(h=v[f],p=h[0],m=h[1],g=m.adds,b=m.rms,[5,d(p,g,b)]):[3,4];case 2:y.sent(),y.label=3;case 3:return f++,[3,1];case 4:return eo(er()||Jt()),e.forEach((function(e){return Un("_m",e,n[n.length-1].id)})),[2]}}))}))}(l),[3,47];case 11:return console.groupEnd(),t?[4,Nn(t)]:(ni(2),Dn(void 0),vn("login",!1),[2]);case 12:return D.sent(),oo(),vn("login",!0),Kr(!1),er(0),lr.childids([]),Zi(),Oi(),[3,47];case 13:return t?Ln.id()?[4,Kn(t)]:[3,15]:(Dn(void 0),Yt.complete("pwd",13),[2]);case 14:D.sent(),D.label=15;case 15:return Yt.complete("pwd"),[3,47];case 16:return wn("_e",t),Yt.complete("users",t),[3,47];case 17:return wn("_h",t),Yt.complete("chans",t),[3,47];case 18:return function(n){a(this,void 0,void 0,(function(){var e,t,r,i,o,u,l,d,f=this;return s(this,(function(v){switch(v.label){case 0:return(e=Zt()).includes(n.id)?[2]:(t=!ar(n.chanid),r=O(),[4,yn("_t",n)]);case 1:return v.sent(),i=Jt()?n.dir:c([0],n.dir),o=i.map((function(e){return Cn(e,[n.id,n.id]),{chanid:e,chatid:n.id}})),wn("_c",o),u=new Set(cr().has(n.by)?[]:[n.by]),n.men&&n.men.forEach((function(n){cr().has(n)||u.add(n)})),l=n.dir.filter((function(n){return!ar(n)})),d=new Set(l),[4,Ti(u,d)];case 2:return v.sent(),n.re&&co(n.re),sr(xi()),sr().set(n.id,Ht(n)),e.push(n.id),Zt(e),t&&Oi(!0),r&&y(),"ontouchstart"in document.documentElement||io(),n.dir.forEach((function(e){return a(f,void 0,void 0,(function(){var t;return s(this,(function(r){switch(r.label){case 0:return(t=ar(e))&&(t.chatid=n.id),[4,_n(e,"_h")];case 1:return(t=r.sent())?(t.chatid=n.id,[4,yn("_h",t)]):[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))})),[2]}}))}))}(t),[3,47];case 19:return wn("_t",d=t),Yt.complete("chats",d),[3,47];case 20:return(f=t).length>0?(ur(!1),[4,Di(f)]):[3,22];case 21:return D.sent(),[3,23];case 22:ur(!0),D.label=23;case 23:return Yt.complete("chanscan",f),[3,47];case 24:return(v=t).length>0&&(wn("_h",v),$t(v,ar())),Yt.complete("scantree",v.map((function(n){return n.id}))),[3,47];case 25:return(h=t).length>0?[4,Di(h)]:[3,27];case 26:D.sent(),D.label=27;case 27:return Yt.complete("scantree",t),[3,47];case 28:return t?(w=t,(p=Ln.chans()).includes(w)?[2]:(p.push(w),Ln.chans(p),[4,xn("c",p)])):[2];case 29:return D.sent(),[4,mn.apply(void 0,c([0,w],null!==(_=null===(A=ar(w))||void 0===A?void 0:A.dir)&&void 0!==_?_:[]))];case 30:return D.sent(),Zi(),ji(Ci.id()),[3,47];case 31:return t?(w=t,(m=Ln.chans()).includes(w)?((g=m.indexOf(w))>-1&&m.splice(g,1),Ln.chans(m),[4,xn("c",m)]):[2]):[2];case 32:return D.sent(),[4,mn.apply(void 0,c([0,w],null!==(T=null===(U=ar(w))||void 0===U?void 0:U.dir)&&void 0!==T?T:[]))];case 33:return D.sent(),Zi(),ji(Ci.id()),[3,47];case 34:return Wi(t),[3,47];case 35:return Yt.complete("memlist",t),[3,47];case 36:return Wt(E=t,cr()),wn("_e",E),Yt.complete("findusers",E),[3,47];case 37:return Wt(E=t,cr()),wn("_e",E),Yt.complete("findmems",E),[3,47];case 38:return w=(b=t).id,S=b.online,w?(null===(M=cr(w))||void 0===M||M.online(S),[3,47]):[2];case 39:return(E=t).forEach((function(n){var e;return null===(e=cr(n))||void 0===e?void 0:e.online(!0)})),[3,47];case 40:return Yt.complete("profile",t),[3,47];case 41:return Yt.complete("name",t),[3,47];case 42:return Yt.complete("signup",t),[3,47];case 43:return Yt.complete("thread",t),[3,47];case 44:return Yt.complete("list",t),[3,47];case 45:return Yt.complete("status",t),[3,47];case 46:return(x=t).offer?function(n){var e=n.fr,t=n.sd,r=n.ca;a(this,void 0,void 0,(function(){var n,i,o,u,a,c,l,d,f,v,h,p,m,g,b,y,w,S;return s(this,(function(s){switch(s.label){case 0:return n=Yt.create("ice"),[4,po(e)];case 1:return i=s.sent(),o=C(new Uint8Array(t)),u=o.a,a=o.k,[4,vo()];case 2:return c=s.sent(),l=c.keypair,d=c.pub,[4,R(a)];case 3:return f=s.sent(),v=i,[4,q(l.privateKey,f)];case 4:return v.sharedkey=s.sent(),h=(new TextDecoder).decode(st(u)),[4,i.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:h}))];case 5:return s.sent(),[4,i.createAnswer()];case 6:return p=s.sent(),[4,i.setLocalDescription(p)];case 7:s.sent(),m=0,g=r,s.label=8;case 8:return m<g.length?(b=g[m],y=new RTCIceCandidate({candidate:b,sdpMid:"0",sdpMLineIndex:0}),[4,i.addIceCandidate(y)]):[3,11];case 9:s.sent(),s.label=10;case 10:return m++,[3,8];case 11:return w=ct((new TextEncoder).encode(i.localDescription.sdp)),S=k(w,d),[4,n];case 12:return s.sent(),Ut.send(cn.Sdp({fr:null,to:e,sd:S,ca:fo,offer:null})),[2]}}))}))}(x):Yt.complete("offer",x),[3,47];case 47:return[2]}}))}))}));var yo=function(){var n=document.createElement("div");n.contentEditable="true",n.className="s-c",n.oninput=p((function(){var e=n.textContent;e&&e.length>50||(Fi(e),zi(e))}),200),n.onkeydown=function(n){"Enter"!==n.key||n.shiftKey||n.preventDefault()};var e=document.createElement("div");return setTimeout((function(){new IntersectionObserver((function(e){if(!(e[0].intersectionRatio<=0)){var t=Ni(Jt()).childids(),r=t[t.length-1];if(!(!r||ur()||t.length<Gt)){var i=n.textContent||null;i&&i.length>50||setTimeout((function(){return ji(Ci.id(),i,r)}))}}}),{}).observe(e)})),an("div",{class:"cn"},an("div",{class:"s"},n),an("div",{class:"tbl"},an("table",null,an("tbody",null,(function(){return bo(Ni(Jt()).childids,(function(n){var e=ar(n);return an("tr",{onClick:function(){return Ri(e)}},an("td",null,an("button",{onClick:function(e){return function(n,e){if(n.stopPropagation(),!Ln.id())return li();Ln.chans().includes(e)?Hi(e):Bi(e)}(e,n)}},(function(){return Ln.chans().includes(n)?"➕":"➖"}))),an("td",null,e.fullname))}))}),e))))},wo="formatBlock",ko=function(n,e){return n.appendChild(e)},Co=function(n){return document.createElement(n)},So=function(n){return document.queryCommandState(n)},Eo=function(n,e){return document.execCommand(n,!1,e)},xo=[{icon:"<b>B</b>",title:"Bold",state:function(){return So("bold")},result:function(){return Eo("bold")}},{icon:"<i>I</i>",title:"Italic",state:function(){return So("italic")},result:function(){return Eo("italic")}},{icon:"<u>U</u>",title:"Underline",state:function(){return So("underline")},result:function(){return Eo("underline")}},{icon:"<strike>S</strike>",title:"Strike-through",state:function(){return So("strikeThrough")},result:function(){return Eo("strikeThrough")}},{icon:"&#8220&#8221;",title:"Quote",result:function(){return Eo(wo,"<blockquote>")}},{icon:"&lt;&gt;",title:"Code",result:function(){return Eo(wo,"<pre>")}},{icon:"&#128279;",title:"Link",class:" lk",result:function(){var n=window.prompt("Enter the link URL");n&&Eo("createLink",n)}},{icon:"🌁",title:"Image",class:" im",result:function(){var n=window.prompt("Enter the image URL");n&&Eo("insertImage",n)}},{icon:"⏎",title:"Enter to send",class:" en se",result:function(n){return xr()?xr(!1):xr(!0),xr()?n.classList.add("se"):n.classList.remove("se"),!0}}],Ao="e-b",_o="e-bs",Uo="",To=0,Mo=!1,Do=Y(!1),Lo=function(){return b("tp")},Po=function(){return b("pm")},Oo=function(){return b("mb")},jo=function(n){To=g();var e=n.textContent,t=e.indexOf(" ",To);-1==t&&(t=e.length);var r=/[\S]+$/.exec(e.slice(0,t));return r?r[0]:""},Io=function(n){var e=n.id,t=n.name;mr([]),gr(0);var r=br();if(r.spellcheck=!1,r===Oo()){var i=Uo?"@"+t:t;r.textContent=Uo?function(n,e){var t=n.textContent,r=t.indexOf(" ",To);-1==r&&(r=t.length);var i=t.slice(0,r).replace(/\S+$/,e);return To=i.length,i+t.slice(r)}(r,i):r.textContent+i,r.focus(),Uo?function(n,e){var t=document.createRange(),r=window.getSelection();t.setStart(n.childNodes[0],e),t.collapse(!0),null==r||r.removeAllRanges(),null==r||r.addRange(t)}(r,To):m(),Do(!1),e&&Er.add(e)}else e?Cr.add(e):Sr.add(Uo),r.textContent="",Po().focus()},No=function(){return an("div",{id:"uls",class:function(){return"uls"+(br()===Oo()&&kr()?" ms":"")}},an("ul",null,bo(mr,(function(n){return an("li",{id:n.id.toString(),tabIndex:-1,class:function(){return mr()[gr()]===n?"se":""},onClick:function(){return Io(n)},onMouseOver:function(){return Mo||gr(mr().indexOf(n))}},n.id?an("i",{class:function(){var e;return"dot"+((null===(e=cr(n.id))||void 0===e?void 0:e.online())?" on":"")}}):null,n.name)}))))},Ko=function(){return an("div",{class:function(){return"em sel"+(kr()?" sh":"")},onClick:function(){return Po().focus()}},bo(Sr,(function(n){return an("div",{class:"tg ie"},n,an("i",{onClick:function(){return Sr.delete(n)}},"✕"))})),bo(Cr,(function(n){var e;return an("div",{class:function(){var e;return(null===(e=cr(n))||void 0===e?void 0:e.online())?"tg on":"tg"}},null===(e=cr(n))||void 0===e?void 0:e.name,an("i",{onClick:function(){return Cr.delete(n)}},"✕"))})),an("div",{class:"wp"},an("div",{id:"pm",class:"e-m"+(Sr().length+Cr().length===0?" to":""),onKeyDown:Fo,onInput:Ro,contentEditable:!0}),(function(){return br()===Po()&&kr()&&mr().length>0&&No})))};function Fo(n){var e;if(!zo(n)){if(8!=n.keyCode||(null===(e=Po().textContent)||void 0===e?void 0:e.length)||(Cr.pop(),Po().focus()),32!==n.keyCode&&!/^[a-zA-Z0-9\_@\.]+$/.test(n.key))return n.preventDefault(),!1;"Enter"!==n.key&&"Tab"!==n.key||(Oo().focus(),n.preventDefault())}}function zo(n){var e,t;return!!mr().length&&("Enter"===n.key||"Tab"===n.key||32===n.keyCode?(Io(mr()[gr()]),n.preventDefault(),!0):27==n.keyCode?(mr([]),gr(),Do(!1),!0):(38==n.keyCode&&(0===gr()?gr(mr().length-1):gr(gr()-1),null===(e=b(mr()[gr()].id))||void 0===e||e.focus(),n.preventDefault(),Mo=!0,setTimeout((function(){return Mo=!1}),300)),40==n.keyCode&&(gr()===mr().length-1?gr(0):gr(gr()+1),null===(t=b(mr()[gr()].id))||void 0===t||t.focus(),n.preventDefault(),Mo=!0,setTimeout((function(){return Mo=!1}),300)),n.target.focus(),!0))}var qo=p((function(n){return a(void 0,void 0,void 0,(function(){var e,t,r,i;return s(this,(function(o){switch(o.label){case 0:return(Uo=jo(n.target).toLowerCase()).length>50?[2]:[4,ro(Uo)];case 1:return e=o.sent(),t=ar(er()||Jt()),r=void 0!==t&&(null!==(i=t.md())&&void 0!==i?i:0)<2,!e&&L(Uo)&&r&&mr([{id:0,name:"✉️ Invite "+Uo,online:!1}]),[2]}}))}))}),100);function Ro(n){br(Po()),qo(n)}var Bo=function(){var n;if(!Ln.id())return null;if(xi()&&sr(xi())&&er()==(null===(n=sr(xi()))||void 0===n?void 0:n.chanid))return null;var e=ar(er());if(!e)return null;O()&&setTimeout(y,50);var t=function(){return c(c([],e.dir.slice(Ci.len()-2)),[e.id])};return t().length>0&&an("div",{class:"dr",style:function(){return"background:"+D(e.id)}},bo(t,(function(n){var e;return an("span",null,an("a",{href:"#"+Ft.ntob(n)},null===(e=ar(n))||void 0===e?void 0:e.fullname))})))},Ho=function(){return an("div",{id:"tp",class:function(){return"e-t"+(yr()?" sh":"")},onKeyUp:Wo,onKeyDown:Vo,contentEditable:!0})},Vo=function(n){n.target.spellcheck=!1,"Enter"===n.key&&n.preventDefault()},Wo=function(n){wr(n.target.textContent),"Enter"===n.key&&(Oo().focus(),n.preventDefault())},$o=function(){return!(er()||Jt()||kr()||yr())},Yo=function(){return an(Array.prototype,null,an("style",null,".e-c[contenteditable]:empty::before { content: '"+function(){var n,e="Send a "+(kr()?"private ":"")+"message ";return er()?n=ar(er()):Jt()&&(n=ar(Jt())),n?e+(yr()?"on new topic "+(wr()?'"'+wr()+'" ':"")+'in "'+n.fullname()+'"':'in "'+n.fullname()+'"'):yr()?e+"on new topic "+(wr()?'"'+wr()+'"':""):e+"..."}()+"'; }"),(function(){return br()===Oo()&&Do()&&mr().length>0&&No}),an("div",{id:"mb",class:"e-c",onKeyDown:Xo,onInput:Zo,onFocus:Go,contentEditable:!0}))},Go=function(){if(0!==Zt().length)return $o()?(er(sr(xi()).chanid),void eo(er())):er()||kr()||yr()?void 0:(er(sr(xi()).chanid),void eo(er()))},Xo=function(n){if(br(Oo()),"@"===n.key&&Do(!0),!zo(n)&&"Enter"===n.key){if(n.preventDefault(),xr()&&!n.shiftKey)return void function(n,e){var t;a(this,void 0,void 0,(function(){var r,i,o,u,a,c,l,d,f,v,h;return s(this,(function(s){switch(s.label){case 0:return Ln.id()?n.innerHTML.length>120||e.innerHTML.length>4e3?[2,ni(11)]:e.innerHTML.trim()?Or()?(null===(t=cr(Or()))||void 0===t?void 0:t.online())?Ir(Or()).open()?(r={txt:e.innerHTML.trim()},Ir(Or()).send(r),i={id:0,txt:r.txt,by:Ln.id(),ts:new Date,room:Or(),showby:!1},(null==(o=Nr.last())?void 0:o.by)!=Ln.id()&&(i.showby=!0),u=i,[4,yn("_p",i)]):[2,ni(16)]:[2,ni(15)]:[3,2]:[2]:[2,ni(1)];case 1:return u.id=s.sent(),Nr.add(i),e.textContent="",io(),[2];case 2:return a=er()||Jt(),c=nr()||Qt()||null,l=null,n.textContent===tr()||(null==(l=n.textContent)?void 0:l.trim().length)?a||kr()||l&&l.trim().length?(d=e.innerHTML.trim(),f=null,v=null,h=null,kr()&&(Cr().length>0&&(f=Cr.add(Ln.id()).sort((function(n,e){return n-e}))),Sr().length>0&&(v=Sr())),Er().length>0&&(h=Er().filter((function(n){var e;return d.indexOf("@"+(null===(e=cr(n))||void 0===e?void 0:e.name))>-1}))),Ut.send(cn.NewChat({txt:d,chanid:a,re:c,chname:l,men:h,to:f,emails:v})),yr(!1),kr(!1),n.textContent="",e.textContent="",wr(""),tr(""),mo({},e),[2]):[2,ni(5)]:[2,ni(6)]}}))}))}(Lo(),Oo());n.target.textContent+="\n\n",m()}},Zo=function(n){Oo().spellcheck=!1,Do()&&Jo(n)},Jo=p((function(n){(Uo=jo(n.target).toLowerCase()).startsWith("@")?(Uo=Uo.replace(/[@'";:,.\/?\\-]/,"")).length>50||ro(Uo):Do(!1)}),100),Qo=an("div",{class:"e-a"});xo.forEach((function(n){var e,t,r=Co("button");if(r.className=Ao+" eb",n.class&&(r.className+=n.class),r.innerHTML=n.icon,r.title=n.title,r.setAttribute("type","button"),r.onclick=function(e){return n.result(r)&&Oo().focus()},n.state){e="click",t=function(){return r.classList[n.state()?"add":"remove"](_o)},r.addEventListener(e,t)}ko(Qo,r)}));var nu=Co("button");nu.className=Ao+" md",nu.innerHTML="👤",nu.title="Private message",nu.setAttribute("type","button");var eu=function(){if(!Ln.id())return li();var n=O();nu.classList.add("se"),kr(!0),n&&setTimeout(y),io(),"ontouchstart"in document.documentElement||Po().focus()};nu.onclick=function(){return kr()?(nu.classList.remove("se"),kr(!1),void io()):eu()};var tu=Co("button");tu.className="ntb",tu.innerHTML="✏️ New Topic",tu.title="New topic",tu.setAttribute("type","button"),tu.onclick=function(){if(!Ln.id())return li();var n=O();yr()?yr(!1):yr(!0),n&&yr()&&setTimeout(y),function(n,e){if(yr(n),io(),n?tu.classList.add("se"):tu.classList.remove("se"),"ontouchstart"in document.documentElement)return;n&&Lo().focus();e&&(Lo().innerText=e,wr(e))}(yr())},ko(Qo,tu),ko(Qo,nu),Eo("defaultParagraphSeparator","div");var ru=function(){return an("div",{class:function(){return"e"+(Ln.id()?$o()?" ds":"":" hd")}},(function(){var n,e;return nr()?an("div",{class:"re",style:function(){return"color:"+D(nr())}},an("i",null,"→"),an("b",null,null===(n=cr(sr(nr()).by))||void 0===n?void 0:n.name),an("a",{href:"#/"+Ft.ntob(nr())},null===(e=sr(nr()))||void 0===e?void 0:e.txt)):null}),Bo," ",Ho," ",Ko," ",Yo," ",Qo)},iu=function(n,e){var t,r=null===(t=b(n+"_"))||void 0===t?void 0:t.querySelector(".ct");if("true"===r.contentEditable)return r.contentEditable="false",r.classList.remove("ce"),r.innerHTML=e.txt(),void(r.onclick=function(){return!1});r.spellcheck=!1,r.contentEditable="true",r.classList.add("ce"),r.focus(),r.onclick=function(n){"true"===r.contentEditable&&n.stopPropagation()},r.onkeydown=function(n){if("Tab"===n.key)return document.execCommand("insertHTML",!1,"&#09"),n.preventDefault();if("Escape"===n.key)return r.contentEditable="false",r.classList.remove("ce"),void(r.innerHTML=e.txt());if("Enter"===n.key){var t=r.innerHTML.trim();n.shiftKey||(n.preventDefault(),r.contentEditable="false",r.classList.remove("ce"),t!==e.txt()&&(i=e.id,o=t,Ut.send(cn.EditChat({id:i,txt:o}))))}var i,o}};var ou="f94f6f6",uu="0.0.340";function au(n){var e=n.name;return a(this,void 0,void 0,(function(){function n(n){var e,t,o;n.preventDefault();var u=n.target.n,a=u.value.trim()==r?null:u.value.trim(),s=null!==(o=null===(t=null===(e=b("ab"))||void 0===e?void 0:e.textContent)||void 0===t?void 0:t.trim())&&void 0!==o?o:null,c=function(n,e){return n&&n.length<2?10:e&&e.length>1e3?11:0}(a,s=s==(i||"")?null:s);0===c?(!function(n,e,t){void 0===t&&(t=null),Ut.send(cn.EditProfile({fullname:n,about:e,email:t}))}(a,s),Kr(!1)):ni(c)}var t,r,i;return s(this,(function(o){switch(o.label){case 0:return[4,Yt.create("profile",Ut.send(cn.Profile))];case 1:return t=o.sent(),r=t.fullname,i=t.about,Fr.content=an("div",{class:"pi"},an("div",{class:"su"},an("div",{class:"head"},"Profile"),an("div",{class:"sub"},e),an("form",{onSubmit:function(e){return n(e)}},(function(){return qr(10,11)&&an("div",{class:"erm"},zr())}),an("input",{value:null!=r?r:"",type:"text",name:"n",placeholder:"Full name",required:!0,class:function(){return qr(10)?"er":""}}),an("div",{id:"ab",class:"ab",contentEditable:!0},i),an("div",{class:"bn"},an("button",{type:"submit"},"Save"))))),Kr(!0),[2]}}))}))}var su,cu=function(n,e){return a(void 0,void 0,void 0,(function(){function t(n){var t=n.target.textContent;if(t&&t.length>50)return ni(11);var r=j(),i=t&&t.trim().length?t:null;cr(e).tz(r),cr(e).st(null!=i?i:""),function(n){Ut.send(cn.EditStatus(n))}({tz:r,st:i})}var r,i,o,u,c,l,d,f,v;return s(this,(function(h){switch(h.label){case 0:return Ln.id()?(n.stopPropagation(),(null===(u=cr(e))||void 0===u?void 0:u.tz())?[3,2]:[4,lo(e)]):[2];case 1:r=h.sent(),i=r.st,o=r.tz,Ln.id()==e&&(o=j()),cr(e).tz(null!=o?o:""),cr(e).st(null!=i?i:""),h.label=2;case 2:return Fr.content=an("div",{class:"pi"},an("div",{class:"ui"},an("div",{class:"un"},an("i",{class:function(){var n;return"do"+((null===(n=cr(e))||void 0===n?void 0:n.online())?" on":"")}}),an("b",{style:function(){var n,t;return(null===(n=cr(e))||void 0===n?void 0:n.online())?"color:"+D(null===(t=cr(e))||void 0===t?void 0:t.name):""}},null===(c=cr(e))||void 0===c?void 0:c.name)),e!==Ln.id()?an("div",{style:"font-size:12px"},null===(l=cr(e))||void 0===l?void 0:l.st()):an("div",{class:"st",contentEditable:!0,onBlur:t},null===(d=cr(e))||void 0===d?void 0:d.st)),an("hr",null),(function(){var n,t;return(null===(n=cr(e))||void 0===n?void 0:n.tz())?an("div",{class:"sub"},an("i",null,"🕑")," Local time ",function(n){return(new Date).toLocaleTimeString(Intl.DateTimeFormat().resolvedOptions().locale,{timeZone:n,hour:"numeric",minute:"2-digit"})}(null===(t=cr(e))||void 0===t?void 0:t.tz())):null}),e!==Ln.id()?an(Array.prototype,null,an("div",{class:"bt"},an("i",{class:"fl"},"💬")," ",an("a",{onClick:function(){return function(n){Kr(!1),eu(),Cr([n]),nr(0)}(e)}},"Send private message")),an("div",{class:"bt"},an("i",null,"@")," ",an("a",{onClick:function(){return function(n){var e;if(Kr(!1),!Ln.id())return li();Oo().innerHTML+="@"+(null===(e=cr(n))||void 0===e?void 0:e.name),Oo().focus(),m(),Er.add(n)}(e)}},"Mention ",an("b",null,null===(f=cr(e))||void 0===f?void 0:f.name))),(null===(v=cr(e))||void 0===v?void 0:v.online())?an("div",{class:"bt"},an("i",{class:"fl"},"↔"),an("a",{onClick:function(){Kr(!1),location.hash="#&"+Ft.ntob(e)}},"Send direct p2p message")):null):an(Array.prototype,null,an("div",{class:"bt",onClick:function(){return au(cr(e))}},an("i",null,"✏️")," ",an("a",null,"Edit profile")),an("div",{class:"bt",onClick:function(){return function(n){var e=n.name;Fr.content=an("div",{class:"pi"},an("div",{class:"su"},an("div",{class:"head"},"Change Password"),an("div",{class:"sub"},e),an("form",{onSubmit:function(n){return a(this,void 0,void 0,(function(){var t,r,i,o,u;return s(this,(function(a){switch(a.label){case 0:return n.preventDefault(),t=n.target,r=t.o,ai(F,(i=t.p).value,r.value)?[4,ii(e)]:[3,3];case 1:return o=a.sent(),[4,ui(e,o,i.value,r.value)];case 2:if(u=a.sent())return[2,ni(u)];ei("password updated"),Kr(!1),a.label=3;case 3:return[2]}}))}))}},(function(){return qr(12,13,14)&&an("div",{class:"erm"},zr())}),an("input",{type:"password",name:"o",placeholder:"Old password",required:!0,autocomplete:"true",class:function(){return qr(13)?"er":""}}),an("input",{type:"password",name:"p",placeholder:"New password",required:!0,autocomplete:"true",class:function(){return qr(12,14)?"er":""}}),an("div",{class:"bn"},an("button",{type:"submit"},"Submit"))))),Kr(!0)}(cr(e))}},an("i",null,"🔒")," ",an("a",null,"Change password")),an("div",{class:"bt",onClick:function(){return function(){var n;return a(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return console.groupEnd(),console.groupCollapsed("[au]","logout"),er(0),fr([]),null===(n=cr(Ln.id()))||void 0===n||n.online(!1),ar().clear(),sr().clear(),[4,Ut.send(cn.Logout(Ln.salt))];case 1:return e.sent(),[4,hn()];case 2:return e.sent(),Mn({d:!1}),console.groupEnd(),Kr(!1),vn("logout"),[2]}}))}))}()}},an("i",null,"🚪")," ",an("a",null,"Sign out")),an("div",{class:"v"},uu," ",ou))),Kr(!0),[2]}}))}))},lu=function(n,e){var t,r,i,o=function(n){n.preventDefault(),n.stopPropagation();var t=O();mo(e,Oo()),nr()===e.id?er(e.chanid):er(0),t&&setTimeout(y)};return an(Array.prototype,null,an("div",{class:"ts"},(t=e.timestamp,r=6e4,(i=(new Date).getTime()-t.getTime())<r?Math.round(i/1e3)+"s":i<36e5?Math.round(i/r)+"m":t.toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale,{hour:"numeric",minute:"2-digit"}))),an("div",{class:"pm pr",title:"reply",onTouchEnd:o,onClick:o},an("i",null,"→"),an("div",{class:"pu"},an("div",null,"reply"))),an("div",{class:"pm",onClick:function(n){return n.stopPropagation()}},an("i",{class:"i"},"..."),an("div",{class:"pu"},an("div",{onClick:function(){return function(n){return a(void 0,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return n.star(!n.star()),Ut.send(cn.Star(n.id)),[4,_n(n.id,"_t")];case 1:return(e=t.sent())?(e.star=n.star(),[4,yn("_t",e)]):[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))}(e)}},"⭐ ",e.star()?"unstar":"star"),an("div",{onClick:function(){return iu(n,e)}},"✏️ edit"),an("div",{onClick:function(){return du(e)}},"🗑️ trash"))))},du=function(n){var e=n.id,t=n.txt;confirm('Do you want to delete this chat? \n"'+t()+'"')&&function(n){Ut.send(cn.DelChat(n)),no(n)}(e)},fu=Y(0),vu=Y(0),hu=!1,pu=function(n){var e=n.id,t=n.txt,r=n.by,i=n.chanid,o=n.star,u=n.men,a=n.timestamp,s=n.showby,c=n.first,d=n.firstre,f=n.last,v=n.lastre,h=n.re,p=n.nor,m=Ft.ntob(e);function g(){return["ct"].join(" ")}return setTimeout((function(){var n,e;null===(n=b("cs"))||void 0===n||n.addEventListener("touchstart",(function(){return hu=!1}),{passive:!0}),null===(e=b("cs"))||void 0===e||e.addEventListener("touchmove",(function(){return hu=!0}),{passive:!0})})),an("div",{id:m+"_",class:function(){return"c"+(nr()===e||vu()==e?" cur":"")+(er()>0&&er()!==i?" bl":"")+(((new Date).getTime()-a.getTime())/1e3<60?" nc":"")+(h||p()?" r":"")+(c()||d()&&h!=Qt()?" fr":"")+(f()||v()&&h!=Qt()?" lr":"")},onClick:function(e){return function(n,e){"ontouchstart"in document.documentElement||uo(e.chanid)}(0,n)},onTouchEnd:function(e){return function(n,e){hu||uo(e.chanid)}(0,n)},onMouseOver:function(){return fu()!==e&&fu(e)},style:function(){return"border-color:"+D(h||(p()?e:i))}},(function(){var n,t;return d()&&h!=Qt()&&sr(h)?an("div",{class:"re",style:function(){return h||p()?"color:"+D(h||e):""},onMouseOver:function(){return vu()!==h&&vu(h)},onMouseOut:function(){return vu(0)}},an("i",null,"→"),an("b",null,null===(n=cr(sr(h).by))||void 0===n?void 0:n.name),an("a",{href:"#/"+Ft.ntob(h),onClick:function(n){return n.stopPropagation()}},null===(t=sr(h))||void 0===t?void 0:t.txt)):null}),(function(){var n;return s()||c()||d()?an("div",null,an("a",{class:function(){var n;return"by"+((null===(n=cr(r))||void 0===n?void 0:n.online())?" on":"")},style:function(){var n,e;return(null===(n=cr(r))||void 0===n?void 0:n.online())?"color:"+D(null===(e=cr(r))||void 0===e?void 0:e.name):""},onClick:function(n){return cu(n,r)}},null===(n=cr(r))||void 0===n?void 0:n.name)):null}),an("div",{class:function(){return o()?" star":""},style:function(){return p()?"color:"+D(e):""}},(function(){var n,e,r,i=t();if(u&&u.length)for(var o=0,a=u;o<a.length;o++){var s=a[o],c=null===(n=cr(s))||void 0===n?void 0:n.name,d=Ln.id()==s?"j":(null===(e=cr(s))||void 0===e?void 0:e.online())?"k":"i",f=(null===(r=cr(s))||void 0===r?void 0:r.online())?'style="color:'+D(c)+'"':"";i=i.replaceAll("@"+c,'<b onclick="b('+s+')" class="'+d+'" '+f+">@"+c+"</b>")}return sn(su||(su=l(["<div class="," innerHTML="," />"],["<div class="," innerHTML="," />"])),g,i)}),(function(){var n;return p()&&e!=Qt()?an("p",{class:"mr"},an("i",null,"→"),an("a",{href:"#/"+m,onClick:function(n){return n.stopPropagation()}},p()+(null!==(n=p())&&void 0!==n&&n?" replies":" reply"))):null})),(function(){return fu()===e&&Ln.id()?lu(m,n):null}))},mu=function(n,e){if(n.shiftKey)return function(n,e){var t=screen.width/2-300,r=screen.height/2-300;window.open(n,e,"toolbar=yes,location=yes,status=no,menubar=yes,scrollbars=yes,resizable=yes,width=600,height=600,top="+r+",left="+t)}("#"+Ft.ntob(e),e.toString()),n.preventDefault();uo(e),n.stopPropagation()},gu=function(){var n=document.createElement("div");return setTimeout((function(){new IntersectionObserver((function(n){n[0].intersectionRatio<=0||Xi.cb&&(!Zt()[0]||or()||Zt().length<Gt||setTimeout((function(){if(Xi.cb){var n=Zt()[0];!n||or()||Zt().length<Gt||Xi.cb(n)}})))}),{}).observe(n)})),an(Array.prototype,null,an("div",{id:"os"}),an("div",{id:"cs"},n,(function(){var n=[],e=0,t=null;return Zt().reduce((function(n,r){return z(sr(r).timestamp,t)?sr(r).chanid!=e?(e=sr(r).chanid,n.push(Y([r])),n):(n[n.length-1]().push(r),n):(t=sr(r).timestamp,n.push(Y(t)),e=sr(r).chanid,n.push(Y([r])),n)}),n),bo(Y(n),(function(n){var e=n();if(e instanceof Date)return an("div",{class:"date"},(t=e,r=new Date,z(t,r)?"Today":(r.setDate(r.getDate()-1),z(t,r)?"Yesterday":t.toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale,{month:"short",day:"numeric"}))));var t,r,i=sr(n()[0]);return an("div",null,an("div",{class:"tn"},(function(){return function(n){var e=ar(n);if(!e)return null;var t=function(){return c(c([],e.dir.slice(Ci.len()-2)),[e.id])};return t().length>0&&an("div",{class:"dr",style:function(){return"background:"+D(n)}},bo(t,(function(n){var e;return an("span",null,an("a",{href:"#"+Ft.ntob(n),onClick:function(e){return mu(e,n)}},null===(e=ar(n))||void 0===e?void 0:e.fullname))})))}(i.chanid)}),an("div",{class:"ts"},function(n){return n.toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale,{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}(i.timestamp))),bo(n,(function(n){return pu(sr(n))})))}))}),(function(){return cr(Or())?function(){var n;return an("div",null,an("div",{class:"tn"},an("div",{class:"dr",style:function(){var n;return"background:"+D(null===(n=cr(Or()))||void 0===n?void 0:n.name)}},an("span",null,an("a",null,"↔ ",null===(n=cr(Or()))||void 0===n?void 0:n.name)))),bo(Nr,(function(n){var e=n.by,t=n.txt,r=n.showby;return cr(e)?an("div",{class:"c",style:function(){var n;return"border-color:"+D(null===(n=cr(Or()))||void 0===n?void 0:n.name)}},(function(){var n;return r?an("div",null,an("a",{class:function(){var n;return"by"+((null===(n=cr(e))||void 0===n?void 0:n.online())?" on":"")},style:function(){var n,t;return(null===(n=cr(e))||void 0===n?void 0:n.online())?"color:"+D(null===(t=cr(e))||void 0===t?void 0:t.name):""},onClick:function(n){return cu(n,e)}},null===(n=cr(e))||void 0===n?void 0:n.name)):null}),an("div",null,t)):an("div",null)})))}():null})),ru)},bu=[["","All messages"],["!","Private messages"],["@","Mentions"],["*","Stars"]],yu=function(){var n=document.createElement("div");n.contentEditable="true",n.className="s-c",n.oninput=p((function(){var e=n.textContent;e&&e.length>50||(Fi(e),zi(e))}),200),n.onkeydown=function(n){"Enter"!==n.key||n.shiftKey||n.preventDefault()};var e=function(n){return an("ul",null,bo(n.childids,(function(t){var r,i=n.childs(t);return an(Array.prototype,null,an("li",{class:function(){return function(n){return[Ln.chans().includes(n)?"":"on",n==Jt()?"se":""].join(" ")}(t)},onClick:function(){return function(n,e){n.open(!n.open()),Ri(e)}(i,ar(t))}},an("div",{class:"sb"},an("i",null,(function(){return i.childids().length?i.open()?"▼":"▶":""}))),an("div",{class:"lb"},(function(){return function(n){var e,t,r;return(null===(e=ar(n))||void 0===e?void 0:e.md)&&null!==(r=null===(t=ar(n))||void 0===t?void 0:t.md())&&void 0!==r&&r?"🔒":""}(t)})," ",null===(r=ar(t))||void 0===r?void 0:r.fullname),an("div",{class:"dot",onClick:function(n){return function(n,e){if(n.stopPropagation(),!Ln.id())return li();Ln.chans().includes(e)?Hi(e):Bi(e)}(n,t)}})),(function(){return i.open()&&i.childids().length?e(i):null}))})))};return an(Array.prototype,null,an("div",{class:"dn n"},an("i",{onClick:function(){return vn("lnclose")}},"✕")),an("div",{class:"s"},n),Ln.id()?an("ul",{class:"hm"},(function(){return bu.map((function(n){return an("li",{class:(Pr()[0]||"")==n[0]?"se":"",onClick:function(){return location.hash=n[0]}},n[1])}))})):null,bo(jr,(function(n){var e;return an("div",null,an("div",{class:"tn"},an("div",{class:"dr",style:function(){var e;return"background:"+D(null===(e=cr(n))||void 0===e?void 0:e.name)}},an("span",null,an("a",{href:"#&"+Ft.ntob(n)},"↔ ",null===(e=cr(n))||void 0===e?void 0:e.name)))))})),an("div",{class:"nt"},(function(){return lr.childids().length?e(lr):null})))},wu="",ku=0,Cu=!1,Su=function(){var n=p((function(n){return a(void 0,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return(wu=function(n){ku=g();var e=n.textContent,t=e.indexOf(" ",ku);-1==t&&(t=e.length);var r=/[\S]+$/.exec(e.slice(0,t));return r?r[0]:""}(n.target).toLowerCase())&&wu.length>50?[2]:[4,to(wu)];case 1:return!e.sent()&&L(wu)&&pr([{id:0,name:"✉️ Invite "+wu,online:!1}]),[2]}}))}))}),100),e=an("div",{class:"am",contentEditable:!0,onKeyDown:function(n){if(br(e),r(n))return;8!=n.keyCode||e.textContent.length||(vr.pop(),e.focus());if(32!==n.keyCode&&!/^[a-zA-Z0-9\_@\.]+$/.test(n.key))return void n.preventDefault();"Enter"!==n.key&&"Tab"!==n.key||n.preventDefault()},onInput:n});function t(n){var t=n.id;pr([]),gr(0),t?vr.add(t):hr.add(wu),e.textContent="",e.spellcheck=!1,e.focus()}function r(n){var e,r;return!!pr().length&&("Enter"===n.key||"Tab"===n.key||32===n.keyCode?(t(pr()[gr()]),n.preventDefault(),!0):27==n.keyCode?(pr([]),gr(),!0):(38==n.keyCode&&(0===gr()?gr(pr().length-1):gr(gr()-1),null===(e=b(pr()[gr()].id))||void 0===e||e.focus(),n.preventDefault(),Cu=!0,setTimeout((function(){return Cu=!1}),300)),40==n.keyCode&&(gr()===pr().length-1?gr(0):gr(gr()+1),null===(r=b(pr()[gr()].id))||void 0===r||r.focus(),n.preventDefault(),Cu=!0,setTimeout((function(){return Cu=!1}),300)),n.target.focus(),!0))}var i=function(){return an("div",{class:"uls adm"},an("ul",null,bo(pr,(function(n){return an("li",{id:n.id.toString(),tabIndex:-1,class:function(){return pr()[gr()]===n?"se":""},onClick:function(){return t(n)},onMouseOver:function(){return function(n){Cu||gr(n)}(pr().indexOf(n))}},n.id?an("i",{class:function(){var e;return null===(e=cr(n.id))||void 0===e||e.online()," on"}}):null," ",n.name)}))))},o=an("div",{class:"sel",onClick:function(){return e.focus()}},bo(hr,(function(n){return an("div",{class:"tg ie"},n,an("i",{onClick:function(){return hr.delete(n)}},"✕"))})),bo(vr,(function(n){var e;return an("div",{class:function(){var e;return(null===(e=cr(n))||void 0===e?void 0:e.online())?"tg on":"tg"}},null===(e=cr(n))||void 0===e?void 0:e.name,an("i",{onClick:function(){return vr.delete(n)}},"✕"))})),e,(function(){return br()===e&&pr().length>0&&i}));return o.focus=function(){return e.focus()},o},Eu=function(){var n=["Public","Internal"],e=function(){return er()?ar(er()):ar(Jt())};var t=function(n,e){var t;n.stopPropagation(),window.confirm("Do you want to delete this channel?\n"+e.fullname())&&(t=e.id,a(void 0,void 0,void 0,(function(){return s(this,(function(n){return Ut.send(cn.DelChan(t)),[2]}))})))},r=function(){var n;return(null===(n=e())||void 0===n?void 0:n.by)===Ln.id()};function i(){var n=vr().length+hr().length;return n>0?" "+n+(n>1?" people":" person"):""}var o=function(n){var e=n.id,t=n.fullname,r=Su();Fr.content=an("div",{class:"pi"},an("div",{class:"amb"},an("div",{class:"head"},"Add people"),an("div",{class:"sub"},t),r,an("div",{class:"bn"},an("button",{onClick:function(){return function(n,e){return a(void 0,void 0,void 0,(function(){var t,r;return s(this,(function(o){switch(o.label){case 0:return t=vr().length?vr():null,r=hr().length?hr():null,t||r?[4,Vi(n,t,r)]:[2];case 1:return o.sent()?(ei("added"+i()+" to "+e()),Kr(!1)):ni(8),[2]}}))}))}(e,t)}},"Add",i)))),Kr(!0),r.focus()};function u(n,e){var t,r,i,o=e.id,u=e.fullname,a=e.about,s=e.md;n.preventDefault();var c=n.target,l=c.n,d=c.m,f=l.value.trim()==u()?null:l.value.trim(),v=d&&Number(d.value)!=s()?Number(d.value):null,h=null!==(i=null===(r=null===(t=b("ab"))||void 0===t?void 0:t.textContent)||void 0===r?void 0:r.trim())&&void 0!==i?i:null,p=function(n,e,t){return n&&0===n.length?10:t&&(t>2||t<0)||e&&e.length>1e3?11:0}(f,h=h==(a()||"")?null:h,v);0===p?(!function(n){Ut.send(cn.EditChan(n))}({id:o,name:f,about:h,md:v}),Kr(!1)):ni(p)}return an(Array.prototype,null,an("div",{class:"dn"},an("i",{onClick:function(){return vn("rnclose")}},"✕")),an("div",{class:"ub"},(function(){return e()&&r()&&an("div",{title:"edit",onClick:function(){return function(e){var t;Fr.content=an("div",{class:"pi"},an("div",{class:"su et"},an("div",{class:"head"},"About"),an("div",{class:"sub"},e.fullname),an("form",{onSubmit:function(n){return u(n,e)}},(function(){return qr(10,11)&&an("div",{class:"erm"},zr())}),an("input",{value:e.fullname,type:"text",name:"n",placeholder:"topic name",required:!0,class:function(){return qr(10)?"er":""}}),an("div",{id:"ab",class:"ab",contentEditable:!0},e.about),1!=Ln.id()||null!==(t=null==e?void 0:e.md())&&void 0!==t&&!t?null:an("select",{name:"m"},n.map((function(n,t){return an("option",{selected:function(){return e.md()==t},value:t},n)}))),an("div",{class:"bn"},an("button",{type:"submit"},"Save"))))),Kr(!0)}(e())},class:"ed"},"✎")}),an("div",{class:"head"},"About"),an("div",{class:"sub b"},(function(){var n;return null===(n=e())||void 0===n?void 0:n.fullname})),an("div",{class:"sub"},(function(){var n;return null===(n=e())||void 0===n?void 0:n.about}))),an("div",{class:"ub"},an("div",{class:"he"},"Settings"),an("div",{class:"sub"},(function(){return e()?c(c([],n),["Private"])[e().md()]:""}))),an("div",{class:"ft"},an("div",{class:"ub lf"},an("div",{class:"he"},"Members")),(function(){return Ln.id()>0&&an("div",{class:"rt"},(function(){return e()&&an("button",{title:"add members",onClick:function(){return o(e())}},"👤")}))})),an("div",{class:"uls mem"},an("ul",null,bo(fr,(function(n){var e;return an("li",{id:n.toString(),tabIndex:-1,style:function(){var e,t;return(null===(e=cr(n))||void 0===e?void 0:e.online())?"color:"+D(null===(t=cr(n))||void 0===t?void 0:t.name):""},onClick:function(e){return cu(e,n)}},n?an("i",{class:function(){var e;return"dot"+((null===(e=cr(n))||void 0===e?void 0:e.online())?" on":"")}}):null,null===(e=cr(n))||void 0===e?void 0:e.name)})))),(function(){return e()&&r()&&an("div",{class:"ft dt"},an("div",{class:"ub lf"},an("div",{class:"he"},"Delete")),an("div",{class:"rt"},an("button",{title:"delete topic",onClick:function(n){return t(n,e())}},"🗑️")))}))},xu=function(){return Ar()?Number(localStorage.getItem("w")||185):0},Au=function(){return _r()?Number(localStorage.getItem("e")||185):0};function _u(){var n=localStorage.getItem("l"),e=null!==n&&"0"!==n&&window.innerWidth>650;Ar(e);var t="1"==localStorage.getItem("r")&&window.innerWidth>650;_r(t),Tr(xu()),Mr(Au())}function Uu(){Ar(!Ar()),Tr(xu()),localStorage.setItem("l",Ar()?"1":"0")}function Tu(){_r(!_r()),Mr(Au()),localStorage.setItem("r",_r()?"1":"0")}_u(),setTimeout(_u,100);var Mu=function(){return null},Du=Y(Mu);function Lu(){return an("div",{onMouseDown:function(){document.onmousemove=function(n){Tr(n.clientX+2)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,localStorage.setItem("w",Tr().toString())}},class:"dw"})}function Pu(){return an("div",{onMouseDown:function(){document.onmousemove=function(n){Mr(document.documentElement.offsetWidth-n.clientX+2)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,localStorage.setItem("e",Mr().toString())}},class:"de"})}document.querySelector("body").append(function(){fn("nochan",(function(){return Du(Mu)})),fn("rnclose",Tu),fn("lnclose",Uu);return an(Array.prototype,null,an("div",{class:"ma",style:function(){return"left:"+(Ar()&&window.innerWidth>650?Tr():0)+"px;right:"+(_r()&&window.innerWidth>650?Mr():0)+"px"}},an("div",{class:"n"},an("div",null,an("ol",{class:"bc"},(function(){return bo(Ci.paths,(function(n){return an("li",null,an("a",{onClick:function(){return function(n){n.i===Ci.len()-1?Du()===yo?Du(Mu):Du(yo):Ci.cd(n)}(n)}},n.fullname))}))})),(function(){return Ln.id()?an(Array.prototype,null,an("div",{onClick:Uu,class:"av mv"},an("i",null,"☰")),an("div",{onClick:Tu,class:"av iv"},an("i",null,"ⓘ")),an("div",{onClick:function(n){return cu(n,Ln.id())},class:"av"},an("i",null,"👨🏻‍💻"))):an(Array.prototype,null,an("div",{class:"u"},an("a",{onClick:si},"sign up")),an("div",{class:"m"},an("a",{onClick:li},"log in")))})),Du),gu),(function(){return Ar()&&an("div",{class:"ln",style:"width:"+Tr()+"px"},yu,Lu)}),(function(){return _r()&&an("div",{class:"rn",style:"width:"+Mr()+"px"},Eu,Pu)}),(function(){return Dr()>0&&an("div",{class:"err"},zr())}),(function(){return Lr()&&an("div",{class:"inf"},Lr())}),(function(){return Kr()&&an("div",{id:"mod",class:"mod",onClick:function(){return Kr(!1)}},an("div",{class:"pop",onClick:function(n){return n.stopPropagation()}},Fr.content))}))}())}();
