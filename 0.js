!function(){"use strict";function n(n,e,t,r){return new(t||(t=Promise))((function(i,o){function u(n){try{s(r.next(n))}catch(n){o(n)}}function a(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(u,a)}s((r=r.apply(n,e||[])).next())}))}function e(n,e){var t,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(n,u)}catch(n){o=[6,n],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function t(n,e){for(var t=0,r=e.length,i=n.length;t<r;t++,i++)n[i]=e[t];return n}function r(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var i={};function o(n){var e=n>>3;return n%8!=0&&e++,e}Object.defineProperty(i,"__esModule",{value:!0});var u=function(){function n(n,e){void 0===n&&(n=0);var t=null==e?void 0:e.grow;this.grow=t&&isFinite(t)&&o(t)||t||0,this.buffer="number"==typeof n?new Uint8Array(o(n)):n}return n.prototype.get=function(n){var e=n>>3;return e<this.buffer.length&&!!(this.buffer[e]&128>>n%8)},n.prototype.set=function(n,e){void 0===e&&(e=!0);var t=n>>3;if(e){if(this.buffer.length<t+1){var r=Math.max(t+1,Math.min(2*this.buffer.length,this.grow));if(r<=this.grow){var i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}this.buffer[t]|=128>>n%8}else t<this.buffer.length&&(this.buffer[t]&=~(128>>n%8))},n.prototype.forEach=function(n,e,t){void 0===e&&(e=0),void 0===t&&(t=8*this.buffer.length);for(var r=e,i=r>>3,o=128>>r%8,u=this.buffer[i];r<t;r++)n(!!(u&o),r),o=1===o?(u=this.buffer[++i],128):o>>1},n}(),a=i.default=u;function s(n,e,t){var r,i=this;return void 0===t&&(t=!1),function(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];r&&clearTimeout(r),t&&!r&&n.apply(i,o),r=setTimeout((function(){r=null,t||n.apply(i,o)}),e)}}function c(){var n;document.execCommand("selectAll",!1,void 0),null===(n=document.getSelection())||void 0===n||n.collapseToEnd()}function l(){var n=document.getSelection();return console.warn(n),n.focusOffset}var d=function(n){return document.getElementById(n)};function f(){window.scrollTo(0,document.documentElement.scrollHeight)}var v=function(n,e){for(var t=0,r=0;t<n.length;)r>=e.length&&(r=0),n.set([n[t]^e[r]],t),t++,r++},h=function(n,e){return S(m(n,e),64,24)},p=function(n){var e=g(n).a;return g(e)},m=function(n,e){return v(n,e),y(n,e)},g=function(n){var e=b(n),t=e.a,r=e.k;return v(t,r),{a:t,k:r}},b=function(n){var e=n[0],t=n.subarray(1,e+1);return{a:n.subarray(e+1),k:t}},y=function(n,e){var t=new Uint8Array(1+e.length+n.length);return t[0]=e.length,t.set(e,1),t.set(n,1+e.length),t},w=function(n,e){return n=Math.ceil(n),Math.floor(Math.random()*(Math.floor(e)-n)+n)},C=function(n,e){var t=new Uint8Array(n.length+e.length);return t.set(n,0),t.set(e,n.length),t},k=function(n){return(performance.now()-n).toFixed(2)},S=function(n,e,t){return void 0===e&&(e=64),void 0===t&&(t=8),m(n,crypto.getRandomValues(new Uint8Array(w(t,e))))},E=function(n){return function(n){return"hsl("+n%360+",100%,30%)"}(function(n){var e=0;if(0==n.length)return e;for(var t=0;t<n.length;t++)e=n.charCodeAt(t)+((e<<5)-e),e&=e;return e}(n+"#"))};function x(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)&&n.length<70}function A(n){return n.length<2||n.length>30?10:/^[0-9a-z_]+$/.test(n)?0:10}function _(){return window.scrollY+window.innerHeight===document.documentElement.scrollHeight}function U(){return Intl.DateTimeFormat().resolvedOptions().timeZone}function T(n){if(!/^[a-z0-9\_@\.]+$/.test(n.key))return n.preventDefault(),!1}function M(n){if(!/^[a-z0-9\_]+$/.test(n.key))return n.preventDefault(),!1}function D(n){n.target.value=n.target.value.toLowerCase().replace(/\s/g,"")}function L(n,e){return n.length<6?12:e&&n==e?14:void 0}function P(n,e){return!!e&&(n.getFullYear()===e.getFullYear()&&n.getMonth()===e.getMonth()&&n.getDate()===e.getDate())}const O=()=>{let n,e=new Promise((e=>n=e));return{complete:e=>n(e),join:()=>e}},j=O(),I="s",N=["_t","_p","_e","_h","_r","_c","_s","_u","_n","_d","_m"];let K,F=indexedDB.open(I,1);function z(n){var e=window.indexedDB.deleteDatabase(n);e.onerror=n=>{},e.onsuccess=n=>{}}F.onsuccess=n=>{K=F.result,function(n){let e=n.objectStoreNames;if(e.length!==N.length)return void z(I);for(const n of N)if(!e.contains(n))return void z(I)}(K),j.complete(K),F.open?F.open():F.open=!0},F.onerror=n=>{z(I),location.reload()},F.onblocked=n=>{},F.onupgradeneeded=n=>{K=F.result;let e=K.objectStoreNames;if(e.contains("_s")||K.createObjectStore("_s"),e.contains("_r")||K.createObjectStore("_r"),e.contains("_e")||K.createObjectStore("_e",{keyPath:"id"}),!e.contains("_t")){let n=K.createObjectStore("_t",{keyPath:"id"});n.createIndex("chanid",["chanid","id"],{unique:!1}),n.createIndex("re",["re","id"],{unique:!1}),n.createIndex("by",["by","id"],{unique:!1}),n.createIndex("dir","dir",{unique:!1})}if(!e.contains("_p")){K.createObjectStore("_p",{keyPath:"id",autoIncrement:!0}).createIndex("room",["room","id"],{unique:!1})}if(!e.contains("_h")){let n=K.createObjectStore("_h",{keyPath:"id"});n.createIndex("mom",["mom","id"],{unique:!1}),n.createIndex("dir","dir",{unique:!1}),n.createIndex("chatid","chatid",{unique:!1})}e.contains("_c")||K.createObjectStore("_c",{keyPath:["chanid","chatid"]}),e.contains("_u")||K.createObjectStore("_u"),e.contains("_n")||K.createObjectStore("_n"),e.contains("_d")||K.createObjectStore("_d"),e.contains("_m")||K.createObjectStore("_m");for(const n of N)K.objectStoreNames.contains(n)||K.createObjectStore(n)};const q=async(n,e)=>{let t=await j.join();t&&t.transaction(["_s"],"readwrite").objectStore("_s").put(e,n)},R=async()=>{let n=await j.join();n&&N.forEach((e=>n.transaction([e],"readwrite").objectStore(e).clear()))},B=async(n,e)=>{let t=await j.join();if(!t)return;let r=t.transaction([n],"readwrite").objectStore(n);e.forEach((n=>{"string"==typeof n.timestamp&&(n.timestamp=new Date(n.timestamp)),r.put(n).onerror=console.error}))},H=async(...n)=>{let e=await j.join();e&&(await tn(...n),function(n){let t=e.transaction(["_c"],"readwrite").objectStore("_c");n.forEach((n=>{let e=IDBKeyRange.bound([n],[n,Number.MAX_VALUE]);t.delete(e).onerror=console.error}))}(n),function(n){let t=e.transaction(["_t"],"readwrite").objectStore("_t"),r=t.index("chanid");n.forEach((n=>{let e=IDBKeyRange.bound([n],[n,Number.MAX_VALUE]);r.openCursor(e).onsuccess=n=>{var e=n.target.result;e&&(t.delete(e.primaryKey).onerror=console.error,e.continue())}}))}(n.filter((n=>n>0))))},W=async({id:n,dir:e})=>{let t=await j.join();if(!t)return;let r=[0,...e];!function(n,e){e.forEach((async e=>{let t=await en(e);t&&t.includes(n)&&tn(e)}))}(n,r),function(n,e){let r=t.transaction(["_c"],"readwrite").objectStore("_c");e.forEach((e=>{let t=IDBKeyRange.only([e,n]);r.delete(t).onerror=console.error}))}(n,r),function(...n){let e=t.transaction(["_t"],"readwrite").objectStore("_t");n.forEach((n=>{e.delete(n).onerror=console.error}))}(n)},V=async({id:n,dir:e})=>{let t=await j.join();if(!t)return;let r=[0,...e,n];!function(n){n.forEach((async n=>{tn(n)}))}(r),function(n){let e=t.transaction(["_c"],"readwrite").objectStore("_c");n.forEach((n=>{let t=IDBKeyRange.bound([n],[n,Number.MAX_VALUE]);e.delete(t).onerror=console.error}))}(r)},$=async(n,e)=>{let t=await j.join();if(!t)return;let r=t.transaction([n],"readwrite").objectStore(n);return new Promise((n=>{let t=r.put(e);t.onsuccess=e=>{n(e.target.result)},t.onerror=console.error}))},Y=async(n,e)=>{let t=await j.join();if(!t)return{value:[],missed:e};if(0===e.length)return{value:[],missed:[]};performance.now();let r=[],i=new Set,o=t.transaction([n],"readonly").objectStore(n),u=0;return new Promise((n=>{e.forEach((t=>{let a=o.get(t);a.onerror=console.error,a.onsuccess=o=>{if(a.result?r.push(a.result):i.add(t),++u===e.length){let e={value:r,missed:Array.from(i)};n(e)}}}))}))},G=async(n,e,t,r,i,o,u="prev")=>{let a=await j.join();if(!a)return;performance.now();let s=[],c=a.transaction([n],"readonly"),[l,d]=e?e(c.objectStore(n),t,i,o):[c.objectStore(n),null],f=0;return new Promise((n=>{l.openCursor(d,u).onsuccess=e=>{var t=e.target.result;if(t){if(s.push(t.value),r&&++f===r)return n(s);t.continue()}else n(s)}}))},X=(n,e,t,r)=>{let i=t?IDBKeyRange.upperBound(t,r):null;if(!e)return[n,i];let o=t||Number.MAX_VALUE;return n=n.index("room"),i=IDBKeyRange.bound([e.value],[e.value,o],!1,r),[n,i]},Z=(n,e,t,r)=>{let i=t?IDBKeyRange.upperBound(t,r):null;if(!e)return[n,i];let o=t||Number.MAX_VALUE;return i=IDBKeyRange.bound([e.value],[e.value,o],!1,r),[n,i]},J=async(n,e,t,r=!0)=>{let i={value:n};return await G("_p",X,i,t,e,r,"prev")},Q=async(n,e,t=30,r=!0)=>{let i={value:n};return(await G("_c",Z,i,t,e,r,"prev")).map((n=>n.chatid))},nn=async(n,e,t)=>{let r=await j.join();if(!r)return;let i=r.transaction(["_r"],"readwrite").objectStore("_r"),o=i.get(n);o.onerror=console.error,o.onsuccess=async r=>{if(o.result){if(t)return i.put([o.result[0],o.result[1],t],n).onerror=console.error;e[0]<o.result[0]&&(e[0]=o.result[0]),e[1]>o.result[0]&&(e[1]=o.result[1])}i.put(e,n).onerror=console.error}},en=n=>on(n,"_r"),tn=async(...n)=>an("_r",...n),rn=n=>on(n,"_s"),on=async(n,e)=>{let t=await j.join();if(!t)return;let r=t.transaction([e],"readonly").objectStore(e);return new Promise((e=>{let t=r.get(n);t.onerror=console.error,t.onsuccess=n=>e(t.result)}))},un=async(n,e,t)=>{let r=await j.join();r&&r.transaction([n],"readwrite").objectStore(n).put(t,e)},an=async(n,...e)=>{let t=await j.join();if(!t)return;let r=t.transaction([n],"readwrite").objectStore(n);e.forEach((n=>r.delete(n).onerror=console.error))};var sn=function(n,e){return crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:e},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])},cn=function(n){return crypto.subtle.importKey("raw",n,{name:"ECDH",namedCurve:"P-256"},!0,[])},ln=function(){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return console.log("[sec] generating key pairs"),[4,crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"])];case 1:return[2,n.sent()]}}))}))},dn=function(t,r,i){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return[4,crypto.subtle.encrypt({name:"AES-GCM",iv:i},r,t)];case 1:return[2,n.sent()]}}))}))},fn=function(t,r,i){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return[4,crypto.subtle.decrypt({name:"AES-GCM",iv:i},r,t)];case 1:return[2,n.sent()]}}))}))};let vn,hn=[];function pn(n){function e(t){if(0===arguments.length)return vn&&!e.__o.has(vn)&&(e.__o.add(vn),vn.u.push(e)),n;n=t;let r=vn;return vn=void 0,e.o=new Set(e.__o),e.o.forEach((n=>n.i=!1)),e.o.forEach((n=>{n.i||n()})),vn=r,n}return e.$o=1,e.__o=new Set,e.t=hn,e}function mn(n){n.__c.forEach(mn),n.u.forEach((e=>{e.__o.delete(n),e.o&&e.o.delete(n)})),n.l.forEach((n=>n())),gn(n)}function gn(n){n.u=[],n.__c=[],n.l=[]}let bn=(n,e,t,r)=>{let i={};for(let o=1;o<e.length;o++){let u=e[o],a="number"==typeof u?t[u]:u,s=e[++o];if(1===s)r[0]=a;else if(3===s)r[1]=Object.assign(r[1]||{},a);else if(5===s)(r[1]=r[1]||{})[e[++o]]=a;else if(6===s){let n=e[++o],t=(r[1]=r[1]||{})[n],u=i[n];u||"function"!=typeof a&&"function"!=typeof t||(u=t&&[t]||[],r[1][n]=function(){let n="";for(var e=0;e<u.length;e++)n+="function"==typeof u[e]?u[e].call(this):u[e];return n}),u?u.push(a):r[1][n]+=a+""}else if(s){let e=()=>n.apply(null,bn(n,a,t,["",null]));r.push("function"==typeof r[0]?e:e())}else r.push(a)}return r},yn=function(n){let e,t,r=1,i="",o="",u=[0],a=n=>{1===r&&(n||(i=i.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?u.push(n||i,0):3===r&&(n||i)?(u.push(n||i,1),r=2):2===r&&"..."===i&&n?u.push(n,3):2===r&&i&&!n?u.push(!0,5,i):r>=5&&((i||!n&&5===r)&&(u.push(i,r,t),r=6),n&&(u.push(n,r,t),r=6)),i=""};for(let s=0;s<n.length;s++){s&&(1===r&&a(),a(s));for(let c=0;c<n[s].length;c++)e=n[s][c],1===r?"<"===e?(a(),u=[u],r=3):i+=e:4===r?"--"===i&&">"===e?(r=1,i=""):i=e+i[0]:o?e===o?o="":i+=e:'"'===e||"'"===e?o=e:">"===e?(a(),r=1):r&&("="===e?(r=5,t=i,i=""):"/"===e&&(r<5||">"===n[s][c+1])?(a(),3===r&&(u=u[0]),r=u,(u=u[0]).push(r,2),r=0):" "===e||"\t"===e||"\n"===e||"\r"===e?(a(),r=2):i+=e),3===r&&"!--"===i&&(r=4,u=u[0])}return a(),u},wn=new Map,Cn=function(n){let e=wn.get(this);return e||(e=new Map,wn.set(this,e)),e=bn(this,e.get(n)||(e.set(n,e=yn(n)),e),arguments,[]),e.length>1?e:e[0]},kn=function(){let n=Cn.apply(this,arguments);if(n)return Array.isArray(n)?this(n):"object"==typeof n?n:this([n])};function Sn(){let n=kn.bind(this);return(this.wrap||n).apply(n,arguments)}let En={},xn=[];function An(n){return this.t&&this.t[n.type](n)}En.h=(...n)=>{let e,t=r=>{if(null==r);else if("string"==typeof r)e?En.add(e,r):e=En.s?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r);else if(Array.isArray(r))e||(e=document.createDocumentFragment()),r.forEach(t);else if(r instanceof Node)e?En.add(e,r):e=r;else if("object"==typeof r)En.property(e,r,null,En.s);else if("function"==typeof r)if(e){let n=En.add(e,"");En.insert(e,r,n)}else e=r.apply(null,n.splice(1));else En.add(e,""+r)};return n.forEach(t),e},En.insert=(n,e,t,r,i)=>(n=t&&t.parentNode||n,i=i||r instanceof Node&&r,e===r||(r&&"string"!=typeof r||!("string"==typeof e||"number"==typeof e&&(e+=""))?"function"==typeof e?En.subscribe((()=>{r=En.insert(n,e.call({el:n,endMark:t}),t,r,i)})):(t?r&&(i||(i=r.o&&r.o.nextSibling||t.previousSibling),En.rm(n,i,t)):n.textContent="",r=null,e&&!0!==e&&(r=En.add(n,e,t))):(null!=r&&n.firstChild?t?(t.previousSibling||n.lastChild).data=e:n.firstChild.data=e:t?En.add(n,e,t):n.textContent=e,r=e)),r),En.property=(n,e,t,r,i)=>{if(null!=e)if(!t||"attrs"===t&&(r=!0))for(t in e)En.property(n,e[t],t,r,i);else"o"!==t[0]||"n"!==t[1]||e.$o?"function"==typeof e?En.subscribe((()=>{En.property(n,e.call({el:n,name:t}),t,r,i)})):i?n.style.setProperty(t,e):r||"data-"===t.slice(0,5)||"aria-"===t.slice(0,5)?n.setAttribute(t,e):"style"===t?"string"==typeof e?n.style.cssText=e:En.property(n,e,null,r,!0):("class"===t&&(t+="Name"),n[t]=e):((n,e,t)=>{e=e.slice(2).toLowerCase(),t?n.addEventListener(e,An):n.removeEventListener(e,An),(n.t||(n.t={}))[e]=t})(n,t,e)},En.add=(n,e,t)=>{let r=(n=>{const{childNodes:e}=n;if(e&&11===n.nodeType)return e.length<2?e[0]:{o:En.add(n,"",e[0])}})(e=(n=>"string"==typeof n?document.createTextNode(n):n instanceof Node?n:En.h(xn,n))(e))||e;return n.insertBefore(e,t&&t.parentNode&&t),r},En.rm=(n,e,t)=>{for(;e&&e!==t;){let t=e.nextSibling;n===e.parentNode&&n.removeChild(e),e=t}},En.subscribe=function(n){return function(n,e){function t(){let r=vn;return vn&&vn.__c.push(t),mn(t),t.i=!0,vn=t,e=n(e),vn=r,e}function r(){return t.i?vn&&t.u.forEach((n=>n())):e=t(),e}n.s=t,gn(t),t(),r.$o=1}(n),()=>mn(n.s)},En.cleanup=function(n){return vn&&vn.l.push(n),n},En.root=function(n){let e=vn,t=()=>{};vn=t,gn(t);let r=n((()=>{mn(t),vn=void 0}));return vn=e,r},En.sample=function(n){let e=vn;vn=void 0;let t=n();return vn=e,t},En.hs=(...n)=>{let e=En.s;En.s=!0;let t=_n(...n);return En.s=e,t};let _n=(...n)=>En.h.apply(En.h,n),Un=(...n)=>Sn.apply(_n,n);var Tn,Mn,Dn=new Map,Ln=function(n,e,t){void 0===t&&(t=!1);var r=Dn.get(n)||[];t?r=[e]:r.push(e),Dn.set(n,r)},Pn=function(n,e){return Dn.has(n)?Dn.get(n).forEach((function(n){return n(e)})):void 0},On={},jn=function(n){return n&&(Object.assign(On,n),Pn("config",On)),On},In=pn(void 0),Nn={id:pn(0),name:pn(""),chans:pn([]),salt:new Uint8Array};function Kn(){return n(this,void 0,void 0,(function(){var n,t,r,i,o,u,a,s,c,l;return e(this,(function(e){switch(e.label){case 0:return[4,rn("a")];case 1:return!(n=e.sent())||n.byteLength<54?[2]:(t=new Uint8Array(n,0,16),r=new Uint8Array(n,16,32),16===t.length&&(Nn.salt=t),32!==r.length?[3,3]:(i=Nn,[4,crypto.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt","decrypt"])]));case 2:i.sskey=e.sent(),e.label=3;case 3:return o=new Uint8Array(n,48,4),u=new Uint8Array(n,52),a=new DataView(o.buffer).getInt32(48,!1),s=(new TextDecoder).decode(u),a&&s&&(Nn.id(a),Nn.name(s)),[4,rn("c")];case 4:return(c=e.sent())&&c instanceof Array&&Nn.chans(c),console.log("[au]",Nn),(l=new Uint8Array(20)).set(t),l.set(o,16),setTimeout(f),[2,l]}}))}))}function Fn(t,r){return n(this,void 0,void 0,(function(){var n,i;return e(this,(function(e){switch(e.label){case 0:return[4,qn((n=new TextEncoder).encode(t),n.encode(r))];case 1:return i=e.sent(),[4,crypto.subtle.exportKey("raw",i)];case 2:return[2,e.sent()]}}))}))}function zn(t,r){return n(this,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return[4,qn((new TextEncoder).encode(t),r)];case 1:return[2,n.sent()]}}))}))}function qn(t,r){return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"])];case 1:return n=e.sent(),[2,crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])]}}))}))}function Rn(t){var r=t.data,i=t.chans;return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,Bn(r)];case 1:return n=e.sent(),$("_e",n),jn({d:!0}),Nn.chans(i),q("c",i),[2]}}))}))}function Bn(t){return n(this,void 0,void 0,(function(){var n,r,i,o,u,a,s,c,l,d;return e(this,(function(e){switch(e.label){case 0:return n=new Uint8Array(t.slice(16,20)),r=new Uint8Array(t.slice(20)),i=new DataView(n.buffer).getInt32(0,!1),o=(new TextDecoder).decode(r),Nn.id(i),Nn.name(o),Nn.salt=new Uint8Array(t.slice(0,16)),u=Nn,[4,qn(In(),Nn.salt)];case 1:return u.sskey=e.sent(),In(void 0),s=Uint8Array.bind,[4,crypto.subtle.exportKey("raw",Nn.sskey)];case 2:return a=new(s.apply(Uint8Array,[void 0,e.sent()])),c=Nn.salt.length,(l=new Uint8Array(c+a.length+n.length+r.length)).set(Nn.salt),l.set(a,c),l.set(n,c+a.length),l.set(r,c+a.length+n.length),q("a",l.buffer),d=U(),[2,{id:i,name:o,tz:d}]}}))}))}!function(n){n.Shin=function(n){return{tag:"Shin",value:n}},n.Shan=function(n){return{tag:"Shan",value:n}},n.Tree=function(n){return{tag:"Tree",value:n}},n.NewChat=function(n){return{tag:"NewChat",value:n}},n.NewUser=function(n){return{tag:"NewUser",value:n}},n.Login=function(n){return{tag:"Login",value:n}},n.Logout=function(n){return{tag:"Logout",value:n}},n.Users=function(n){return{tag:"Users",value:n}},n.Chans=function(n){return{tag:"Chans",value:n}},n.Chats=function(n){return{tag:"Chats",value:n}},n.MuteChan=function(n){return{tag:"MuteChan",value:n}},n.UnmuteChan=function(n){return{tag:"UnmuteChan",value:n}},n.AddMems=function(n){return{tag:"AddMems",value:n}},n.DelChat=function(n){return{tag:"DelChat",value:n}},n.DelChan=function(n){return{tag:"DelChan",value:n}},n.EditChat=function(n){return{tag:"EditChat",value:n}},n.EditChan=function(n){return{tag:"EditChan",value:n}},n.Mems=function(n){return{tag:"Mems",value:n}},n.FindUsers=function(n){return{tag:"FindUsers",value:n}},n.FindMems=function(n){return{tag:"FindMems",value:n}},n.PushSubs=function(n){return{tag:"PushSubs",value:n}},n.Ons=function(n){return{tag:"Ons",value:n}},n.Unpack=function(n){return{tag:"Unpack",value:n}},n.Tz=function(n){return{tag:"Tz",value:n}},n.Profile={tag:"Profile"},n.EditProfile=function(n){return{tag:"EditProfile",value:n}},n.Pwd=function(n){return{tag:"Pwd",value:n}},n.Email=function(n){return{tag:"Email",value:n}},n.Au=function(n){return{tag:"Au",value:n}},n.Signup=function(n){return{tag:"Signup",value:n}},n.Fp=function(n){return{tag:"Fp",value:n}},n.EditStatus=function(n){return{tag:"EditStatus",value:n}},n.Status=function(n){return{tag:"Status",value:n}},n.ChatThread=function(n){return{tag:"ChatThread",value:n}},n.ChatList=function(n){return{tag:"ChatList",value:n}},n.Star=function(n){return{tag:"Star",value:n}},n.Sdp=function(n){return{tag:"Sdp",value:n}}}(Tn||(Tn={})),function(n){n.Shin=function(n){return{tag:"Shin",value:n}},n.Shan=function(n){return{tag:"Shan",value:n}},n.Tree=function(n){return{tag:"Tree",value:n}},n.Treeid=function(n){return{tag:"Treeid",value:n}},n.Chats=function(n){return{tag:"Chats",value:n}},n.Chans=function(n){return{tag:"Chans",value:n}},n.Users=function(n){return{tag:"Users",value:n}},n.Chat=function(n){return{tag:"Chat",value:n}},n.Login=function(n){return{tag:"Login",value:n}},n.MuteChan=function(n){return{tag:"MuteChan",value:n}},n.UnmuteChan=function(n){return{tag:"UnmuteChan",value:n}},n.DelChan=function(n){return{tag:"DelChan",value:n}},n.Update=function(n){return{tag:"Update",value:n}},n.Updates=function(n){return{tag:"Updates",value:n}},n.ChanUpdates=function(n){return{tag:"ChanUpdates",value:n}},n.MemUpdates=function(n){return{tag:"MemUpdates",value:n}},n.On=function(n){return{tag:"On",value:n}},n.Ons=function(n){return{tag:"Ons",value:n}},n.Mems=function(n){return{tag:"Mems",value:n}},n.Err=function(n){return{tag:"Err",value:n}},n.NewChan=function(n){return{tag:"NewChan",value:n}},n.FindUsers=function(n){return{tag:"FindUsers",value:n}},n.FindMems=function(n){return{tag:"FindMems",value:n}},n.Logout=function(n){return{tag:"Logout",value:n}},n.AddMems=function(n){return{tag:"AddMems",value:n}},n.Unpack=function(n){return{tag:"Unpack",value:n}},n.Profile=function(n){return{tag:"Profile",value:n}},n.Pwd=function(n){return{tag:"Pwd",value:n}},n.Name=function(n){return{tag:"Name",value:n}},n.Signup=function(n){return{tag:"Signup",value:n}},n.Typing=function(n){return{tag:"Typing",value:n}},n.Status=function(n){return{tag:"Status",value:n}},n.ChatThread=function(n){return{tag:"ChatThread",value:n}},n.ChatList=function(n){return{tag:"ChatList",value:n}},n.Sdp=function(n){return{tag:"Sdp",value:n}}}(Mn||(Mn={}));const Hn=(n,e=0,t=!0)=>({pos:e,littleEndian:t,view:new DataView(n)}),Wn=(n,e)=>{const{view:{buffer:t},pos:r}=n,i=t.byteLength;if(i-r>e)return n;const o=Math.max(2*i,i+e),u=new Uint8Array(o);return u.set(new Uint8Array(t)),Hn(u.buffer,r,n.littleEndian)},Vn=(n,e)=>{n=Wn(n,1);const{view:t,pos:r}=n;return t.setUint8(r,e),n.pos+=1,n},$n=(n,e)=>{n=Wn(n,4);const{view:t,pos:r,littleEndian:i}=n;return t.setUint32(r,e,i),n.pos+=4,n},Yn=(n,e)=>{n=Wn(n,2);const{view:t,pos:r,littleEndian:i}=n;return t.setUint16(r,e,i),n.pos+=2,n};function Gn(n,e){const{view:t,pos:r,littleEndian:i}=n;return t.setUint32(i?r:r+4,e,i),t.setUint32(i?r+4:r,0,i),n.pos+=8,n}const Xn=(n,e)=>{n=Wn(n,4);const{view:t,pos:r,littleEndian:i}=n;return t.setInt32(r,e,i),n.pos+=4,n},Zn=new TextEncoder,Jn="encodeInto"in Zn?(n,e)=>Zn.encodeInto(n,e).written:(n,e)=>{const t=Zn.encode(n);return e.set(t),t.length},Qn=(n,e)=>{n=Wn(n,3*e.length+8);const t=Jn(e,new Uint8Array(n.view.buffer,n.pos+8));return(n=Gn(n,t)).pos+=t,n},ne=(n,e)=>Vn(n,e?1:0),ee=n=>(e,t)=>t.reduce(n,((n,e)=>Gn(Wn(n,8),e))(e,t.length)),te=n=>(e,t)=>null===t?Vn(e,0):n(Vn(e,1),t),re=n=>{const{pos:e,view:t}=n;return n.pos+=1,t.getUint8(e)},ie=n=>{const{pos:e,view:t,littleEndian:r}=n;return n.pos+=2,t.getUint16(e,r)},oe=n=>{const{pos:e,view:t,littleEndian:r}=n;return n.pos+=4,t.getUint32(e,r)},ue=n=>{const{view:e,pos:t,littleEndian:r}=n;return n.pos+=8,e.getUint32(r?t:t+4,r)},ae=n=>{const{pos:e,view:t,littleEndian:r}=n;return n.pos+=4,t.getInt32(e,r)},se=n=>1===re(n),ce=n=>e=>1===re(e)?n(e):null,le=n=>e=>{const t=ue(e),r=new Array;for(let i=0;i<t;i++)r.push(n(e));return r},de=new TextDecoder,fe=n=>{const e=ue(n),{pos:t,view:{buffer:r}}=n,i=de.decode(new Uint8Array(r,t,e));return n.pos+=e,i};var ve=ee(Xn),he=te(Qn),pe=te(ve),me=te(Xn),ge=te(ne),be=te((function(n,e){var t=e.id,r=e.lo;return Xn(Xn(n,t),r)})),ye=ee(Qn),we=te(ye),Ce=ee(Vn),ke=te(((n,e)=>{n=Wn(n,8);const{view:t,pos:r,littleEndian:i}=n;return t.setFloat64(r,e,i),n.pos+=8,n})),Se=te(Ce),Ee=te(Yn),xe=function(n,e){var t=e.id,r=e.txt,i=e.by,o=e.chanid,u=e.dir,a=e.timestamp,s=e.men,c=e.re,l=e.nor,d=e.star;return ge(me(me(pe(Qn(ve(Xn(Xn(Qn(Xn(n,t),r),i),o),u),a),s),c),l),d)},Ae=(ee(xe),ee((function(n,e){var t=e.id,r=e.fullname,i=e.mom,o=e.by,u=e.dir,a=e.md,s=e.timestamp,c=e.chatid,l=e.about,d=e.to,f=e.re;return me(pe(he(Xn(Qn(Yn(ve(Xn(Xn(Qn(Xn(n,t),r),i),o),u),a),s),c),l),d),f)})),function(n,e){var t=e.id,r=e.name,i=e.online;return ne(Qn(Xn(n,t),r),i)}),_e=ee(Ae),Ue=(te((function(n,e){var t=e.data,r=e.chans;return ve(Ce(n,t),r)})),function(n,e){var t=e.id,r=e.action,i=e.chatid,o=e.txt;return he(Xn(Yn(Xn(n,t),r),i),o)}),Te=(ee(Ue),ee((function(n,e){var t=e.id,r=e.action,i=e.chanid,o=e.name,u=e.about,a=e.md;return Ee(he(he(Xn(Yn(Xn(n,t),r),i),o),u),a)})),ee((function(n,e){var t=e.id,r=e.action,i=e.chanid,o=e.by;return Xn(Xn(Yn(Xn(n,t),r),i),o)})),ee((function(n,e){var t=e.chanid,r=e.users;return _e(Xn(n,t),r)})),function(n,e){var t=e.email,r=e.fullname,i=e.about;return he(he(he(n,t),r),i)}),Me=function(n,e){var t=e.i,r=e.ub,i=e.lb,o=e.kw;return he(me(me(Xn(n,t),r),i),o)},De=function(n,e){var t=e.fr,r=e.to,i=e.offer,o=e.sd,u=e.ca;return ye(Ce(ge(me(me(n,t),r),i),o),u)},Le=function(n,e){var t=e.txt;return Qn(n,t)},Pe=function(n,e){var t=e.st,r=e.tz;return he(he(n,t),r)},Oe=function(n,e){switch(e.tag){case"Shin":return function(n,e){var t=e.chanid,r=e.kw,i=e.lu,o=e.cu,u=e.mu,a=e.ub,s=e.lb;return me(me(me(me(be(he(me(n,t),r),i),o),u),a),s)}($n(n,0),e.value);case"Shan":return function(n,e){var t=e.chanid,r=e.kw,i=e.cu,o=e.mu,u=e.ub,a=e.lb;return me(me(me(me(he(Xn(n,t),r),i),o),u),a)}($n(n,1),e.value);case"Tree":return function(n,e){var t=e.kw,r=e.reload;return ge(he(n,t),r)}($n(n,2),e.value);case"NewChat":return function(n,e){var t=e.txt,r=e.chanid,i=e.re,o=e.chname,u=e.men,a=e.to,s=e.emails;return we(pe(pe(he(me(Xn(Qn(n,t),r),i),o),u),a),s)}($n(n,3),e.value);case"NewUser":return function(n,e){var t=e.name,r=e.key,i=e.tz,o=e.tgid,u=e.tgname,a=e.tgfn,s=e.tgln;return he(he(he(ke(he(Ce(Qn(n,t),r),i),o),u),a),s)}($n(n,4),e.value);case"Login":return function(n,e){var t=e.name,r=e.key,i=e.tz;return he(Ce(Qn(n,t),r),i)}($n(n,5),e.value);case"Logout":return Ce($n(n,6),e.value);case"Users":return ve($n(n,7),e.value);case"Chans":return ve($n(n,8),e.value);case"Chats":return ve($n(n,9),e.value);case"MuteChan":return Xn($n(n,10),e.value);case"UnmuteChan":return Xn($n(n,11),e.value);case"AddMems":return function(n,e){var t=e.chanid,r=e.userids,i=e.emails;return we(pe(Xn(n,t),r),i)}($n(n,12),e.value);case"DelChat":return Xn($n(n,13),e.value);case"DelChan":return Xn($n(n,14),e.value);case"EditChat":return function(n,e){var t=e.id,r=e.txt;return Qn(Xn(n,t),r)}($n(n,15),e.value);case"EditChan":return function(n,e){var t=e.id,r=e.name,i=e.about,o=e.md;return Ee(he(he(Xn(n,t),r),i),o)}($n(n,16),e.value);case"Mems":return ve($n(n,17),e.value);case"FindUsers":return Qn($n(n,18),e.value);case"FindMems":return function(n,e){var t=e.chanid,r=e.kw;return Qn(Xn(n,t),r)}($n(n,19),e.value);case"PushSubs":return function(n,e){var t=e.endpoint,r=e.auth,i=e.p256dh;return Qn(Qn(Qn(n,t),r),i)}($n(n,20),e.value);case"Ons":return ve($n(n,21),e.value);case"Unpack":return Qn($n(n,22),e.value);case"Tz":return Qn($n(n,23),e.value);case"Profile":return $n(n,24);case"EditProfile":return Te($n(n,25),e.value);case"Pwd":return function(n,e){var t=e.key,r=e.okey;return Se(Ce(n,t),r)}($n(n,26),e.value);case"Email":return Qn($n(n,27),e.value);case"Au":return Qn($n(n,28),e.value);case"Signup":return Qn($n(n,29),e.value);case"Fp":return Qn($n(n,30),e.value);case"EditStatus":return Pe($n(n,31),e.value);case"Status":return Xn($n(n,32),e.value);case"ChatThread":return Me($n(n,33),e.value);case"ChatList":return Me($n(n,34),e.value);case"Star":return Xn($n(n,35),e.value);case"Sdp":return De($n(n,36),e.value)}},je=le(ae),Ie=ce(fe),Ne=ce(je),Ke=ce(ae),Fe=ce(se),ze=(ce((function(n){return{id:ae(n),lo:ae(n)}})),le(fe)),qe=(ce(ze),le(re)),Re=(ce((n=>{const{pos:e,view:t,littleEndian:r}=n;return n.pos+=8,t.getFloat64(e,r)})),ce(qe)),Be=ce(ie),He=function(n){return{id:ae(n),txt:fe(n),by:ae(n),chanid:ae(n),dir:je(n),timestamp:fe(n),men:Ne(n),re:Ke(n),nor:Ke(n),star:Fe(n)}},We=le(He),Ve=le((function(n){return{id:ae(n),fullname:fe(n),mom:ae(n),by:ae(n),dir:je(n),md:ie(n),timestamp:fe(n),chatid:ae(n),about:Ie(n),to:Ne(n),re:Ke(n)}})),$e=function(n){return{id:ae(n),name:fe(n),online:se(n)}},Ye=le($e),Ge=ce((function(n){return{data:qe(n),chans:je(n)}})),Xe=function(n){return{id:ae(n),action:ie(n),chatid:ae(n),txt:Ie(n)}},Ze=le(Xe),Je=le((function(n){return{id:ae(n),action:ie(n),chanid:ae(n),name:Ie(n),about:Ie(n),md:Be(n)}})),Qe=le((function(n){return{id:ae(n),action:ie(n),chanid:ae(n),by:ae(n)}})),nt=le((function(n){return{chanid:ae(n),users:Ye(n)}})),et=function(n){return{email:Ie(n),fullname:Ie(n),about:Ie(n)}},tt=function(n){return{fr:Ke(n),to:Ke(n),offer:Fe(n),sd:qe(n),ca:ze(n)}},rt=function(n){return{txt:fe(n)}},it=function(n){return{st:Ie(n),tz:Ie(n)}},ot=function(n){switch(oe(n)){case 0:return Mn.Shin(function(n){return{chats:We(n),chans:Ve(n),users:Ye(n)}}(n));case 1:return Mn.Shan(je(n));case 2:return Mn.Tree(Ve(n));case 3:return Mn.Treeid(je(n));case 4:return Mn.Chats(We(n));case 5:return Mn.Chans(Ve(n));case 6:return Mn.Users(Ye(n));case 7:return Mn.Chat(He(n));case 8:return Mn.Login(Ge(n));case 9:return Mn.MuteChan(Ke(n));case 10:return Mn.UnmuteChan(Ke(n));case 11:return Mn.DelChan(ae(n));case 12:return Mn.Update(Xe(n));case 13:return Mn.Updates(Ze(n));case 14:return Mn.ChanUpdates(Je(n));case 15:return Mn.MemUpdates(Qe(n));case 16:return Mn.On($e(n));case 17:return Mn.Ons(je(n));case 18:return Mn.Mems(nt(n));case 19:return Mn.Err(ie(n));case 20:return Mn.NewChan(ae(n));case 21:return Mn.FindUsers(Ye(n));case 22:return Mn.FindMems(Ye(n));case 23:return Mn.Logout(se(n));case 24:return Mn.AddMems(se(n));case 25:return Mn.Unpack(Ie(n));case 26:return Mn.Profile(et(n));case 27:return Mn.Pwd(Re(n));case 28:return Mn.Name(Ie(n));case 29:return Mn.Signup(ie(n));case 30:return Mn.Typing(function(n){return{by:Ke(n),dir:je(n),key:Ie(n),keyCode:Be(n),anchor:ie(n),focus:ie(n),txt:Ie(n),chname:Ie(n),re:Ke(n)}}(n));case 31:return Mn.Status(it(n));case 32:return Mn.ChatThread(je(n));case 33:return Mn.ChatList(je(n));case 34:return Mn.Sdp(tt(n))}throw new Error("bad variant index for Response")},ut=Hn(new ArrayBuffer(512)),at=function(n,e){return ut.pos=0,ut=e(ut,n),new Uint8Array(ut.view.buffer).slice(0,ut.pos)},st=function(n,e){return e(Hn(n))},ct=function(n){return st(n.buffer,ot)},lt=function(n){return at(n,Oe)},dt=function(n){return at(n,Le)},ft=function(n){return st(n.buffer,rt)};const vt=n=>new Zlib.RawInflate(n).decompress(),ht=n=>new Zlib.RawDeflate(n).compress();var pt,mt,gt=0,bt=0;function yt(t,r){return n(this,void 0,void 0,(function(){var n,i,o,u,a,s,c,l,d,f,h,p;return e(this,(function(e){switch(e.label){case 0:return gt++,console.groupCollapsed("[ax]","-> [nr] pack",gt,t),function(n,e){if(!n.length&&!n.byteLength)return console.log(n);console.log(e,"Length",n.length||n.byteLength,"bytes"),console.log((Object(n).buffer instanceof ArrayBuffer?n:"string"==typeof n?(new TextEncoder).encode(n):new Uint8ClampedArray(n)).reduce((function(n,e,t,r){return n+(t%16==0?t.toString(16).padStart(6,0)+"  ":" ")+e.toString(16).padStart(2,0)+(t===r.length-1||t%16==15?" ".repeat(3*(15-t%16))+Array.from(r).splice(t-t%16,16).reduce((function(n,e){return n+(e>31&&e<127||e>159?String.fromCharCode(e):".")}),"  ")+"\n":"")}),""))}(n=lt(t)),console.groupEnd(),i=jn(),o=i.z,u=i.c,a=i.d,o&&(n=ht(n)),u?(d=crypto.getRandomValues(new Uint8Array(12)),v(n,d),s=C,c=[d],l=Uint8Array.bind,[4,dn(n,r,d)]):[3,2];case 1:n=s.apply(void 0,c.concat([new(l.apply(Uint8Array,[void 0,e.sent()]))])),e.label=2;case 2:return a?(d=crypto.getRandomValues(new Uint8Array(12)),v(n,d),f=C,h=[d],p=Uint8Array.bind,[4,dn(n,Nn.sskey,d)]):[3,4];case 3:n=f.apply(void 0,h.concat([new(p.apply(Uint8Array,[void 0,e.sent()]))])),e.label=4;case 4:return pt=performance.now(),[2,n]}}))}))}function wt(t,r){return n(this,void 0,void 0,(function(){var n,i,o,u,a,s,c,l,d;return e(this,(function(e){switch(e.label){case 0:return n=new Uint8Array(t),i=n.length,bt++,console.log("[ax]","<- [nr]",bt,i,"bytes in",k(pt),"ms"),o=jn(),u=o.z,a=o.c,o.d?(c=n.subarray(0,12),s=Uint8Array.bind,[4,fn(n.subarray(12),Nn.sskey,c)]):[3,2];case 1:n=new(s.apply(Uint8Array,[void 0,e.sent()])),v(n,c),e.label=2;case 2:return a?(c=n.subarray(0,12),l=Uint8Array.bind,[4,fn(n.subarray(12),r,c)]):[3,4];case 3:n=new(l.apply(Uint8Array,[void 0,e.sent()])),v(n,c),e.label=4;case 4:return u&&(n=vt(n)),d=(100*i/n.length).toFixed(2),console.log("[ax] unpacked",bt,i+" / "+n.length+" bytes "+d+"% in "+k(pt)+" ms"),[2,Ct(n)]}}))}))}function Ct(n){var e=ct(n);return console.groupCollapsed("[ax]","<- [nr] decode",bt,e),console.table(e.value),console.groupEnd(),e}var kt=document.location.hash.substr(1).match(/^ip\/(?<ip>[\:\.\d]+)$/),St=kt?null===(mt=kt.groups)||void 0===mt?void 0:mt.ip:"mx.hyze.io:9898";console.warn(St);var Et,xt,At,_t,Ut=O(),Tt=!1,Mt=500,Dt=0,Lt=function(n){},Pt={recv:function(n){return Lt=n},send:function(t){return n(this,void 0,void 0,(function(){var n,r;return e(this,(function(e){switch(e.label){case 0:return[4,Ut.join()];case 1:return e.sent(),r=(n=xt).send,[4,yt(t,_t)];case 2:return r.apply(n,[e.sent()]),[2]}}))}))}};function Ot(){Tt=!0,Dt++,Mt+=w(0,Dt<16?200:3e3),console.groupEnd(),console.groupEnd(),console.group("[ws]","retry "+Dt+" in "+(Mt/1e3).toFixed(2)+" sec"),setTimeout(jt,Mt)}function jt(){return n(this,void 0,void 0,(function(){var t,r=this;return e(this,(function(i){switch(i.label){case 0:return[4,Kt()];case 1:return t=i.sent(),Et=performance.now(),(xt=new WebSocket("wss://"+St)).binaryType="arraybuffer",xt.onopen=function(){return n(r,void 0,void 0,(function(){return e(this,(function(n){return console.log("[ws] open in "+k(Et)+" ms"),xt.send(t),console.log("[ws] -> send offer"),[2]}))}))},xt.onmessage=It,xt.onerror=console.error,xt.onclose=Ot,[2]}}))}))}function It(t){var r=t.data;return n(this,void 0,void 0,(function(){var n,t,i;return e(this,(function(e){switch(e.label){case 0:return console.log("[ws] <- received answer in "+k(Et)+" ms"),n=new Uint8Array(r),t=jn(function(n){var e=new a(n);return{z:e.get(0),c:e.get(1),d:e.get(2)}}(n)),console.log(t),[4,cn(n.slice(1))];case 1:return i=e.sent(),[4,sn(At.privateKey,i)];case 2:return _t=e.sent(),xt.onmessage=Nt,Ut.complete(),Tt&&Pn("reconnected"),Tt=!1,[2]}}))}))}function Nt(t){var r=t.data;return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return n=Lt,[4,wt(r,_t)];case 1:return n.apply(void 0,[e.sent()]),[2]}}))}))}function Kt(){return n(this,void 0,void 0,(function(){var t,r=this;return e(this,(function(i){switch(i.label){case 0:return[4,(o=function(){return n(r,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,ln()];case 1:return At=e.sent(),[4,crypto.subtle.exportKey("raw",At.publicKey)];case 2:return n=e.sent(),[2,new Uint8Array(n)]}}))}))},u=Kn,n(void 0,void 0,void 0,(function(){var n,t,r;return e(this,(function(e){switch(e.label){case 0:return[4,Promise.all([o(),u()])];case 1:return n=e.sent(),t=n[0],(r=n[1])?[2,m(t,r)]:[2,S(t,64,24)]}}))})))];case 1:return t=i.sent(),console.log("[ws] offer in "+k(Et)+" ms"),[2,t]}var o,u}))}))}console.groupCollapsed("[ws]","starting..."),jt();function Ft(n){for(var e=(n+"=".repeat((4-n.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(e),r=new Uint8Array(t.length),i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}function zt(){return n(this,void 0,void 0,(function(){var n,t,r;return e(this,(function(e){switch(e.label){case 0:return[4,navigator.serviceWorker.ready];case 1:return[4,e.sent().pushManager.getSubscription()];case 2:return(n=e.sent())?[3,3]:(console.log("no valid subscription"),navigator.serviceWorker.getRegistration().then((function(n){null==n||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ft("BIm2PpzmeMy3pe_VkzyP8Yq-iqG8ay0qLBGcJZNXnq5lOKu1fAyY9xQ2PK2KQjzWulmKu8IzBLmut276h4tIw5k")}).then((function(n){console.log("push subscription",n)}),(function(n){console.log("error getting push permission",n)}))})),[3,5]);case 3:return t=JSON.parse(JSON.stringify(n)),[4,rn("s")];case 4:if((r=e.sent())instanceof ArrayBuffer&&(new TextDecoder).decode(r)==t.keys.auth)return[2];q("s",(new TextEncoder).encode(t.keys.auth).buffer),Pn("subs",t),e.label=5;case 5:return[2]}}))}))}function qt(n,e,t){const{root:r,subscribe:i,sample:o,cleanup:u}=En;null==t&&(t=!e.$t);let a=En.h([]),s=En.add(a,""),c=new Map,l=new Map,d=new Set;function f(n,i){if(null==n)return;let o=l.get(n);return 1===i?(d.delete(n),o||(o=t?r((t=>(c.set(n,t),e(n.$v||n)))):e(n.$v||n),11===o.nodeType&&(o=(n=>{const{childNodes:e}=n,{length:t}=e;if(t<2)return e[0];let r=Array.from(e);return{nodeType:111,t:r[0],o:r[t-1],l(){if(e.length!==t){let e=0;for(;e<t;)n.appendChild(r[e++])}return n}}})(o)||o),l.set(n,o))):-1===i&&d.add(n),((n,e)=>111===n.nodeType?1/e<0?e?En.rm(n.t.parentNode,n.t.nextSibling,n.o.nextSibling)||n.t:n.o:e?n.l():n.t:n)(o,i)}function v(n){let e=c.get(n);e&&(e(),c.delete(n)),l.delete(n)}return u(i((e=>{let t=n();return o((()=>{d.clear();let n=Array.from(function(n,e,t,r,i){let o,u,a=new Map,s=new Map;for(o=0;o<e.length;o++)a.set(e[o],o);for(o=0;o<t.length;o++)s.set(t[o],o);for(o=u=0;o!==e.length||u!==t.length;){var c=e[o],l=t[u];if(null===c)o++;else if(t.length<=u)n.removeChild(r(e[o],-1)),o++;else if(e.length<=o)n.insertBefore(r(l,1),r(e[o],0)||i),u++;else if(c===l)o++,u++;else{var d=s.get(c),f=a.get(l);void 0===d?(n.removeChild(r(e[o],-1)),o++):void 0===f?(n.insertBefore(r(l,1),r(e[o],0)||i),u++):(n.insertBefore(r(e[f],1),r(e[o],0)||i),e[f]=null,f>o+1&&o++,u++)}}return t}(s.parentNode,e||[],t,f,s));return d.forEach(v),n}))}))),u((function(){c.forEach((n=>n())),c.clear(),l.clear(),d.clear()})),a}"serviceWorker"in navigator&&(navigator.serviceWorker.register("sw.js").then((function(){console.log("[sw] registered")})),navigator.serviceWorker.addEventListener("message",(function(n){n.data.reload&&location.reload()}),!1));for(var Rt="0VMZYpdgCGL3iKAzDHwocTt97e1hasO2mJNjExq4PvR6XyWSFbIn-5B_8fUukQlr",Bt=Rt.split(""),Ht=new Array(123),Wt=0;Wt<Rt.length;Wt++)Ht[Rt.charCodeAt(Wt)]=Wt;var Vt=function(n){if(n<0)return"-"+Vt(-n);for(var e=n>>>0,t=n/4294967296>>>0,r="";t>0;)r=Bt[63&e]+r,e>>>=6,e|=(63&t)<<26,t>>>=6;var i="";do{i=Bt[63&e]+i,e>>>=6}while(e>0);return i+r},$t={ntob:Vt,bton:function(n){for(var e=0,t=0;t<n.length;t++)e=64*e+Ht[n.charCodeAt(t)];return e}};const Yt=[0,null,"⛩",0],Gt=(()=>{let n=pn(Yt);const e=pn([n]),t=e=>n(e),r=n=>{let r=e();r[n[0]]!==n&&(r[n[0]]=n),r.splice(n[0]+1),e(r),t(n),location.hash=n[0]>0?$t.ntob(n[3]):""};return{path:e=>n()[e],paths:e,len:()=>e().length,setpath:t,same:e=>e===n(),cd:r,update:n=>{e([Yt,...n]),t(n[n.length-1]||Yt)},ishome:()=>n()===Yt,home:()=>r(Yt)}})();var Xt=[];function Zt(){!function(n){for(var e=0,t=Xt;e<t.length;e++)(0,t[e])(n)}(document.location.hash.substr(1))}window.addEventListener("hashchange",Zt),setTimeout(Zt);var Jt=30;function Qt(n){return function(e){return void 0===e?n:n.get(e)}}function nr(n){var e=pn(n);return e.add=function(n){return e().indexOf(n)<0?e(t(t([],e()),[n])):e()},e.delete=function(n){e().splice(e().indexOf(n),1),e(e())},e.last=function(){return e()[e().length-1]},e.pop=function(){var n=e().pop();return e(e()),n},e}function er(n){return{id:n.id,by:n.by,chanid:n.chanid,dir:n.dir,timestamp:new Date(n.timestamp),men:n.men,re:n.re,txt:pn(n.txt),star:pn(n.star),first:pn(!1),last:pn(!1),firstre:pn(!1),lastre:pn(!1),showby:pn(!1),nor:pn(n.nor)}}var tr=function(n,e){return n.reduce((function(n,e){return n.has(e.id)||n.set(e.id,er(e)),n}),e)},rr=function(n,e){return n.reduce((function(n,e){return n.has(e.id)?"online"in e&&n.get(e.id).online(e.online):n.set(e.id,{id:e.id,name:e.name,online:pn(e.online),tz:pn(""),st:pn("")}),delete e.online,n}),e)},ir=function(n,e){return n.reduce((function(n,e){if(n.has(e.id)){var t=n.get(e.id);t.fullname(e.fullname),t.about(e.about),t.md(e.md)}else n.set(e.id,function(n){return{id:n.id,mom:n.mom,by:n.by,dir:n.dir,timestamp:new Date(n.timestamp),chatid:n.chatid,to:n.to,re:n.re,fullname:pn(n.fullname),about:pn(n.about),md:pn(n.md)}}(e));return n}),e)};var or=pn([]),ur=pn([]),ar=pn(0),sr=pn(0),cr=pn(0),lr=pn(0),dr=pn(""),fr=pn(""),vr=pn(null),hr=pn(!1),pr=pn(!1),mr=Qt(new Map),gr=Qt(new Map),br=Qt(new Map),yr={id:0,childids:pn([]),childs:Qt(new Map),open:function(){return!0}},wr=Qt(new Map([[0,yr]])),Cr=pn([]),kr=nr([]),Sr=nr([]),Er=pn([]),xr=pn([]),Ar=pn(0),_r=pn(null),Ur=pn(!1),Tr=pn(""),Mr=pn(!1),Dr=nr([]),Lr=nr([]),Pr=nr([]),Or=pn(!0),jr=pn(!1),Ir=pn(!1);pn(""),pn("");var Nr,Kr=pn(0),Fr=pn(0),zr=pn(0),qr=pn(null),Rr=pn(location.hash.substr(1)),Br=pn(0),Hr=nr([]),Wr=Qt(new Map),Vr=nr([]),$r=pn(!1),Yr=function(){return ur().length>0?ur()[ur().length-1]:0},Gr=(()=>{const n={},e={};return{create:t=>e[t]=new Promise((e=>n[t]=e)),complete:(e,t)=>n[e]?n[e](t):null,join:n=>e[n],joinall:(...n)=>Promise.all(n.map((n=>e[n]))),select:(...n)=>Promise.race(n.map((n=>e[n])))}})(),Xr={content:null},Zr=function(){switch(zr()){case 1:return"please login first";case 2:return"invalid login name or password";case 3:return"email existed";case 4:return"username existed";case 5:return"please select a topic";case 6:return"topic is empty";case 7:return"invalid email address";case 8:return"error adding people";case 9:return"error signing up";case 10:return"invalid name";case 11:return"invalid input";case 12:return"password too short";case 13:return"invalid password";case 14:return"new password is the same with old password";case 15:return"peer offline";case 16:return"You are behind a NAT or firewall, can not create a direct connection to peer"}};function Jr(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.includes(zr())}var Qr=function(n){zr(n),clearTimeout(Nr),Nr=setTimeout((function(){return zr(0)}),5e3)},ni=function(n){qr(n),clearTimeout(Nr),Nr=setTimeout((function(){return qr(null)}),5e3)};s((function(n,e){var t,r,i;t=n+" is "+(e?"on":"off")+"line",r=void 0,i="useron","Notification"in window&&("granted"===Notification.permission?new Notification(t,{body:r,icon:"/icon-256.png",tag:i}):"denied"!==Notification.permission&&Notification.requestPermission().then((function(n){"granted"===n&&new Notification(t,{body:r,icon:"/icon-256.png",tag:i})})))}),500),Pt.recv((function(r){var i=r.tag,o=r.value;return n(void 0,void 0,void 0,(function(){var r,u,a,s,c,l,d,v,m,g,b,y,w,C,k,S,E,x,A,U,T,M,D;return e(this,(function(L){switch(L.label){case 0:switch(i){case"Err":return[3,1];case"Unpack":return[3,2];case"AddMems":return[3,3];case"Logout":return[3,4];case"NewChan":return[3,5];case"Shin":return[3,6];case"Update":return[3,7];case"Updates":return[3,8];case"ChanUpdates":return[3,9];case"MemUpdates":return[3,10];case"Login":return[3,11];case"Pwd":return[3,13];case"Users":return[3,16];case"Chans":return[3,17];case"Chat":return[3,18];case"Chats":return[3,19];case"Shan":return[3,20];case"Tree":return[3,24];case"Treeid":return[3,25];case"MuteChan":return[3,28];case"UnmuteChan":return[3,31];case"DelChan":return[3,34];case"Mems":return[3,35];case"FindUsers":return[3,36];case"FindMems":return[3,37];case"On":return[3,38];case"Ons":return[3,39];case"Profile":return[3,40];case"Name":return[3,41];case"Signup":return[3,42];case"ChatThread":return[3,43];case"ChatList":return[3,44];case"Status":return[3,45];case"Sdp":return[3,46]}return[3,47];case 1:return Qr(o),[3,47];case 2:return Gr.complete("unpack",o),[3,47];case 3:return Gr.complete("addmems",o),[3,47];case 4:return jn({d:!1}),[3,47];case 5:return lr(o),f(),[3,47];case 6:return tr((r=o).chats,gr()),rr(r.users,br()),ir(r.chans,mr()),B("_t",r.chats),B("_h",r.chans),B("_e",r.users),function(t){n(this,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){return n=t||[],r=ar(),0===n.length?(hr(!0),nn(r,null,!0),console.log("top chat reached"),Gr.complete("chatscan",n),[2]):(hr(!1),nn(r,[n[0],n[n.length-1]]),i=n.map((function(n){return{chanid:r,chatid:n}})),B("_c",i),Gr.complete("chatscan",n),[2])}))}))}(r.chats.map((function(n){return n.id}))),[3,47];case 7:return u=o,Ui(a=new Set([ar()]),u),a.forEach((function(n){return un("_u",n,u.id)})),[3,47];case 8:return(s=o).length&&function(t){n(this,void 0,void 0,(function(){var n,r,i,o;return e(this,(function(e){for(n=new Set([ar()]),r=0,i=t;r<i.length;r++)o=i[r],Ui(n,o);return n.forEach((function(n){return un("_u",n,t[t.length-1].id)})),[2]}))}))}(s),[3,47];case 9:return(c=o).length&&function(t){n(this,void 0,void 0,(function(){var n,r,i,o,u,a,s,c,l,d,f,v;return e(this,(function(e){switch(e.label){case 0:n=new Set([ar()]),r=0,i=t,e.label=1;case 1:if(!(r<i.length))return[3,9];switch(o=i[r],u=o.action,a=o.chanid,s=o.name,c=o.about,l=o.md,u){case 1:return[3,2];case 2:return[3,6]}return[3,8];case 2:return(d=mr(a))&&(null!==s&&d.fullname(s),null!==c&&d.about(c),null!==l&&d.md(l)),[4,on(a,"_h")];case 3:return(f=e.sent())?(null!==s&&(f.fullname=s),null!==c&&(f.about=c),null!==l&&(f.md=l),[4,$("_h",f)]):[3,5];case 4:e.sent(),f.dir.forEach((function(e){return n.add(e)})),e.label=5;case 5:return[3,8];case 6:return[4,Ci(a)];case 7:return(v=e.sent())&&v.dir.forEach((function(e){return n.add(e)})),[3,8];case 8:return r++,[3,1];case 9:return n.forEach((function(n){return un("_d",n,t[t.length-1].id)})),[2]}}))}))}(c),[3,47];case 10:return(l=o).length&&function(r){n(this,void 0,void 0,(function(){var n,i,o,u,a,s,c,l,d,f,v,h,p,m,g,b;return e(this,(function(y){switch(y.label){case 0:for(n=new Set([ar()]),i=new Map,o=0,u=r;o<u.length;o++)switch(a=u[o],s=a.action,c=a.chanid,l=a.by,s){case 1:i.has(c)?i.get(c).adds.push(l):i.set(c,{adds:[l],rms:[]});break;case 0:i.has(c)?i.get(c).rms.push(l):i.set(c,{adds:[],rms:[l]})}d=function(r,i,o){var u;return e(this,(function(e){switch(e.label){case 0:return[4,on(r,"_n")];case 1:return(u=e.sent())&&(u=u.filter((function(n){return o.indexOf(n)<0})),un("_n",r,Array.from(new Set(t(t([],i),u))))),n.add(r),[2]}}))},f=0,v=i.entries(),y.label=1;case 1:return f<v.length?(h=v[f],p=h[0],m=h[1],g=m.adds,b=m.rms,[5,d(p,g,b)]):[3,4];case 2:y.sent(),y.label=3;case 3:return f++,[3,1];case 4:return Mi(lr()||ar()),n.forEach((function(n){return un("_m",n,r[r.length-1].id)})),[2]}}))}))}(l),[3,47];case 11:return console.groupEnd(),o?[4,Rn(o)]:(Qr(2),In(void 0),Pn("login",!1),[2]);case 12:return L.sent(),Oi(),Pn("login",!0),$r(!1),lr(0),yr.childids([]),Ai(),ci(),[3,47];case 13:return o?Nn.id()?[4,Bn(o)]:[3,15]:(In(void 0),Gr.complete("pwd",13),[2]);case 14:L.sent(),L.label=15;case 15:return Gr.complete("pwd"),[3,47];case 16:return B("_e",o),Gr.complete("users",o),[3,47];case 17:return B("_h",o),Gr.complete("chans",o),[3,47];case 18:return function(r){n(this,void 0,void 0,(function(){var i,o,u,a,s,c,l,d,v=this;return e(this,(function(h){switch(h.label){case 0:return(i=ur()).includes(r.id)?[2]:(o=!mr(r.chanid),u=_(),[4,$("_t",r)]);case 1:return h.sent(),a=ar()?r.dir:t([0],r.dir),s=a.map((function(n){return nn(n,[r.id,r.id]),{chanid:n,chatid:r.id}})),B("_c",s),c=new Set(br().has(r.by)?[]:[r.by]),r.men&&r.men.forEach((function(n){br().has(n)||c.add(n)})),l=r.dir.filter((function(n){return!mr(n)})),d=new Set(l),[4,ii(c,d)];case 2:return h.sent(),r.re&&$i(r.re),gr(Yr()),gr().set(r.id,er(r)),i.push(r.id),ur(i),o&&ci(!0),u&&f(),"ontouchstart"in document.documentElement||Pi(),r.dir.forEach((function(t){return n(v,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return(n=mr(t))&&(n.chatid=r.id),[4,on(t,"_h")];case 1:return(n=e.sent())?(n.chatid=r.id,[4,$("_h",n)]):[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))})),[2]}}))}))}(o),[3,47];case 19:return(d=o).length>0&&B("_t",d),Gr.complete("chats",d),[3,47];case 20:return(v=o).length>0?(pr(!1),[4,ui(v)]):[3,22];case 21:return L.sent(),[3,23];case 22:pr(!0),L.label=23;case 23:return Gr.complete("chanscan",v),[3,47];case 24:return(m=o).length>0&&(B("_h",m),ir(m,mr())),Gr.complete("scantree",m.map((function(n){return n.id}))),[3,47];case 25:return(g=o).length>0?[4,ui(g)]:[3,27];case 26:L.sent(),L.label=27;case 27:return Gr.complete("scantree",o),[3,47];case 28:return o?(k=o,(b=Nn.chans()).includes(k)?[2]:(b.push(k),Nn.chans(b),[4,q("c",b)])):[2];case 29:return L.sent(),[4,H.apply(void 0,t([0,k],null!==(U=null===(A=mr(k))||void 0===A?void 0:A.dir)&&void 0!==U?U:[]))];case 30:return L.sent(),Ai(),li(Gt.path(3)),[3,47];case 31:return o?(k=o,(y=Nn.chans()).includes(k)?((w=y.indexOf(k))>-1&&y.splice(w,1),Nn.chans(y),[4,q("c",y)]):[2]):[2];case 32:return L.sent(),[4,H.apply(void 0,t([0,k],null!==(M=null===(T=mr(k))||void 0===T?void 0:T.dir)&&void 0!==M?M:[]))];case 33:return L.sent(),Ai(),li(Gt.path(3)),[3,47];case 34:return Ci(o),[3,47];case 35:return Gr.complete("memlist",o),[3,47];case 36:return rr(E=o,br()),B("_e",E),Gr.complete("findusers",E),[3,47];case 37:return rr(E=o,br()),B("_e",E),Gr.complete("findmems",E),[3,47];case 38:return k=(C=o).id,S=C.online,k?(null===(D=br(k))||void 0===D||D.online(S),[3,47]):[2];case 39:return(E=o).forEach((function(n){var e;return null===(e=br(n))||void 0===e?void 0:e.online(!0)})),[3,47];case 40:return Gr.complete("profile",o),[3,47];case 41:return Gr.complete("name",o),[3,47];case 42:return Gr.complete("signup",o),[3,47];case 43:return Gr.complete("thread",o),[3,47];case 44:return Gr.complete("list",o),[3,47];case 45:return Gr.complete("status",o),[3,47];case 46:return(x=o).offer?function(t){var r=t.fr,i=t.sd,o=t.ca;n(this,void 0,void 0,(function(){var n,t,u,a,s,c,l,d,f,v,m,g,b,y,w,C,k,S;return e(this,(function(e){switch(e.label){case 0:return n=Gr.create("ice"),[4,lo(r)];case 1:return t=e.sent(),u=p(new Uint8Array(i)),a=u.a,s=u.k,[4,so()];case 2:return c=e.sent(),l=c.keypair,d=c.pub,[4,cn(s)];case 3:return f=e.sent(),v=t,[4,sn(l.privateKey,f)];case 4:return v.sharedkey=e.sent(),m=(new TextDecoder).decode(vt(a)),[4,t.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:m}))];case 5:return e.sent(),[4,t.createAnswer()];case 6:return g=e.sent(),[4,t.setLocalDescription(g)];case 7:e.sent(),b=0,y=o,e.label=8;case 8:return b<y.length?(w=y[b],C=new RTCIceCandidate({candidate:w,sdpMid:"0",sdpMLineIndex:0}),[4,t.addIceCandidate(C)]):[3,11];case 9:e.sent(),e.label=10;case 10:return b++,[3,8];case 11:return k=ht((new TextEncoder).encode(t.localDescription.sdp)),S=h(k,d),[4,n];case 12:return e.sent(),Pt.send(Tn.Sdp({fr:null,to:r,sd:S,ca:ao,offer:null})),[2]}}))}))}(x):Gr.complete("offer",x),[3,47];case 47:return[2]}}))}))})),function(n){Xt.push(n)}((function(i){return n(void 0,void 0,void 0,(function(){var o,u,a,s,c,l,v,h,p,m,g,b,y,w,k,S;return e(this,(function(E){switch(E.label){case 0:return Rr(i),Br(0),o=Hr(),Nn.id()>0&&(o=t(t([],o),[Nn.id()])),[4,_i(o)];case 1:return E.sent(),"$"!==i[0]?[3,4]:(u=i.slice(1).split("/"),a=u[0],s=u[1],c=u[2],s.length<50?(location.hash="#",[2,$r(!1)]):[4,Gr.create("unpack",Pt.send(Tn.Unpack(s)))]);case 2:return(l=E.sent())?[4,Gr.create("name",Pt.send(Tn.Email(l)))]:(location.hash="#",[2,$r(!1)]);case 3:switch(v=E.sent(),a){case"i":if(!v)return function(t,i){var o=pn("Log in Telegram"),u={};function a(r){r.preventDefault();var o=r.target,a=o.n,s=o.p,c=a.value.trim();zi(A,c)&&zi(L,s.value)&&function(t,r,i,o,u){n(this,void 0,void 0,(function(){var n,a,s,c,l,d,f,v,h;return e(this,(function(e){switch(e.label){case 0:return console.groupEnd(),console.groupCollapsed("[au]","register",t,r),[4,R()];case 1:return e.sent(),n=crypto.getRandomValues(new Uint8Array(12)),[4,zn(o,n)];case 2:return a=e.sent(),[4,Fn(i,r)];case 3:return s=e.sent(),l=C,d=[n],f=Uint8Array.bind,[4,dn(s,a,n)];case 4:return c=l.apply(void 0,d.concat([new(f.apply(Uint8Array,[void 0,e.sent()]))])),v=U(),h={name:r,key:c,tz:v,tgid:u.id||null,tgname:u.username||null,tgfn:u.first_name||null,tgln:u.last_name||null},In(s),Pt.send(Tn.NewUser(h)),[2]}}))}))}(t,c,s.value,i,u)}function s(n){n.preventDefault()(window).Telegram.Login.auth({bot_id:"1850607378",request_access:!0},(function(n){n&&(d("username").value=n.username,o("Log in as "+n.first_name),u=n)}))}Xr.content=Un(Ji||(Ji=r(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Sign up</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input id="username" type="text" name="n" placeholder="Username" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" class=','/>\n                    <script async src="https://telegram.org/js/telegram-widget.js?15"><\/script>\n                    <div><button onclick=',">",'</button></div>\n                    <div class="bn"><button type="submit">Sign up</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Sign up</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input id="username" type="text" name="n" placeholder="Username" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" class=','/>\n                    <script async src="https://telegram.org/js/telegram-widget.js?15"><\/script>\n                    <div><button onclick=',">",'</button></div>\n                    <div class="bn"><button type="submit">Sign up</button></div>\n                </form>\n            </div>\n        </div>\n    '])),t,a,(function(){return Jr(4,10,12)&&Un(Zi||(Zi=r(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),Zr())}),M,D,(function(){return Jr(4,10)&&"er"}),(function(){return Jr(12)&&"er"}),s,o),$r(!0)}(l,c),[2,Ln("login",(function(n){return n?location.hash="#":null}))];break;case"f":if(v&&(v==Nn.name()||!Nn.id()))return[2,Hi(v,l,c)]}return location.hash="#",[2,$r(!1)];case 4:return"/"!==i[0]?[3,6]:(h=$t.bton(i.slice(1)),sr(h),ur([]),function(t){n(this,void 0,void 0,(function(){var r;return e(this,(function(i){switch(i.label){case 0:return xi.cb=null,[4,Gr.create("thread",Pt.send(Tn.ChatThread({i:t,kw:null,ub:null,lb:null})))];case 1:return r=i.sent(),[4,ei(r,"re")];case 2:return i.sent(),xi.cb=function(r){return function(t,r){return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,Gr.create("thread",Pt.send(Tn.ChatThread({i:t,kw:null,ub:r,lb:null})))];case 1:return n=e.sent(),[2,ei(n)]}}))}))}(t,r)},[2]}}))}))}(h),Pi(),[4,ci()]);case 5:return E.sent(),[2];case 6:return"&"!==i[0]?[3,10]:(p=$t.bton(i.slice(1)))==Nn.id()?[2,location.hash="#"]:(ar(0),sr(0),Mi(0),lr(0),oi([]),ur([]),[4,_i([p])]);case 7:return E.sent(),Br(p),[4,vo(p)];case 8:return E.sent(),[4,ci()];case 9:return E.sent(),!Wr().has(p)&&(null===(y=br(p))||void 0===y?void 0:y.online())&&co(p),setTimeout((function(){Pi(),f()}),100),[2];case 10:return(m=["!","@","*"].indexOf(i[0]))>-1?(ar(0),lr(0),sr(0),ur([]),function(t){n(this,void 0,void 0,(function(){var r;return e(this,(function(i){switch(i.label){case 0:return xi.cb=null,[4,Gr.create("list",Pt.send(Tn.ChatList({i:t,kw:null,ub:null,lb:null})))];case 1:return r=i.sent(),[4,ei(r,"re")];case 2:return i.sent(),xi.cb=function(r){return function(t,r){return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,Gr.create("list",Pt.send(Tn.ChatList({i:t,kw:null,ub:r,lb:null})))];case 1:return n=e.sent(),[2,ei(n)]}}))}))}(t,r)},[2]}}))}))}(m),Pi(),[4,ci()]):[3,12];case 11:return E.sent(),[2];case 12:return"%"===i[0]?[2,location.hash="#"+$t.ntob(Number(i.slice(1)))]:i&&Rt.includes(i[0])?[3,14]:(ar(0),sr(0),Mi(0),lr(0),oi([]),[4,ci()]);case 13:return E.sent(),Ai(),document.title="hyze - micro chat for team",[2];case 14:return g=$t.bton(i),[4,ci()];case 15:return E.sent(),ar(g),lr(0),sr(0),Ai(),mr(g)?(b=null!==(k=null===(w=mr(g))||void 0===w?void 0:w.dir)&&void 0!==k?k:[],oi(t(t([],b),[g])),Mi(g),document.title=(null===(S=mr(ar()))||void 0===S?void 0:S.fullname())+" - hyze",[2]):[2]}}))}))}));var ei=function(t,r){return n(void 0,void 0,void 0,(function(){var n,i,o,u,a,s,c,l,f,v,h;return e(this,(function(e){switch(e.label){case 0:return[4,ti(t)];case 1:return e.sent(),n=t[0],i=new Set,o=new Set,u=ur(),a="re"===r?new Set:new Set(u),t=t.filter((function(n){var e=gr(n);if(!e)return!1;br().has(e.by)||i.add(e.by),e.men&&e.men.forEach((function(n){br().has(n)||i.add(n)})),e.dir.forEach((function(n){mr().has(n)||o.add(n)}));var t=a.has(n);return t&&console.error("duplicated id in keys",n),a.add(n),!t})),[4,ii(i,o)];case 2:switch(e.sent(),t.reverse(),r){case"re":ur(t);break;case"pre":ur(u.concat(t));break;default:ur(t.concat(u))}for(s=ur(),c=0;c<s.length;c++)l=gr(s[c-1]),f=gr(s[c+1]),(v=gr(s[c])).showby(v.by!==(null==l?void 0:l.by)),v.first(v.chanid!==(null==l?void 0:l.chanid)),v.last(v.chanid!==(null==f?void 0:f.chanid)),v.firstre(null!==v.re&&v.re!==(null==l?void 0:l.re)&&v.re!=(null==l?void 0:l.id)),v.lastre(null!==v.re&&v.re!==(null==f?void 0:f.re));return Pi(),n&&(null===(h=d($t.ntob(n)+"_"))||void 0===h||h.scrollIntoView()),[2]}}))}))},ti=function(t){return n(void 0,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,ri(t)];case 1:return t=e.sent(),n=t.map((function(n){var e;return null===(e=gr(n))||void 0===e?void 0:e.re})).filter((function(n){return n&&n>0&&!gr().has(n)})),ri(Array.from(new Set(n))),[2]}}))}))},ri=function(t){return n(void 0,void 0,void 0,(function(){var n,r,i,o;return e(this,(function(e){switch(e.label){case 0:return 0===(t=t.filter((function(n){return!gr().has(n)}))).length?[2,t]:[4,Y("_t",t)];case 1:return n=e.sent(),r=n.value,i=n.missed,tr(r,gr()),i.length>0?[4,Gr.create("chats",Pt.send(Tn.Chats(i)))]:[3,3];case 2:o=e.sent(),tr(o,gr()),e.label=3;case 3:return[2,t]}}))}))},ii=function(t,r){return n(void 0,void 0,void 0,(function(){var n,i,o,u,a;return e(this,(function(e){switch(e.label){case 0:return[4,Y("_e",Array.from(t))];case 1:return n=e.sent(),[4,Y("_h",Array.from(r))];case 2:return i=e.sent(),n.value.length&&Pt.send(Tn.Ons(n.value.filter((function(n){return n.id!=Nn.id()})).map((function(n){return n.id})))),rr(n.value,br()),ir(i.value,mr()),n.missed.length>0&&Gr.create("users",Pt.send(Tn.Users(n.missed))),i.missed.length>0&&Gr.create("chans",Pt.send(Tn.Chans(i.missed))),[4,Gr.joinall("users","chans")];case 3:return o=e.sent(),u=o[0],a=o[1],u&&rr(u,br()),a&&ir(a,mr()),[2]}}))}))},oi=function(n){var e=n.map((function(n,e){var t=mr(n);return[e+1,null==t?void 0:t.mom,null==t?void 0:t.fullname,n]}));Gt.update(e)},ui=function(t){return n(void 0,void 0,void 0,(function(){var n,r,i,o;return e(this,(function(e){switch(e.label){case 0:return 0===(t=t.filter((function(n){return!mr().has(n)}))).length?[2]:[4,Y("_h",t)];case 1:return n=e.sent(),r=n.value,i=n.missed,console.log("[chans] gets",{value:r,missed:i}),ir(r,mr()),i.length>0?[4,Gr.create("chans",Pt.send(Tn.Chans(i)))]:[3,3];case 2:o=e.sent(),ir(o,mr()),e.label=3;case 3:return[2]}}))}))},ai=function(n,e,t,r,i,o){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),r&&fr(r);var u=Tn.Shan({chanid:n,kw:r,ub:i,lb:o,cu:e,mu:t});return Gr.create("chanscan",Pt.send(u))};function si(){return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,G("_h",(function(n){return[n.index("chatid"),null]}))];case 1:return n=e.sent(),console.log("[chans] load tree",n),ir(n,mr()),[2,n.map((function(n){return n.id}))]}}))}))}function ci(t,r){return void 0===t&&(t=null),void 0===r&&(r=null),n(this,void 0,void 0,(function(){var n,i,o;return e(this,(function(e){switch(e.label){case 0:return 0===yr.childids().length||t?(console.log("[dir]","load tree",t||"",r||""),n=performance.now(),r?(o=[],[3,3]):[3,1]):[3,6];case 1:return[4,si()];case 2:o=e.sent(),e.label=3;case 3:return(i=o).length<1?[4,mi(t,r)]:[3,5];case 4:i=e.sent(),e.label=5;case 5:di(i),console.log("[dir]","tree loaded",r||"","in",k(n),"ms"),e.label=6;case 6:return[2]}}))}))}var li=function(t,r,i){return void 0===r&&(r=null),void 0===i&&(i=null),n(void 0,void 0,void 0,(function(){var n,o,u,a,s;return e(this,(function(e){switch(e.label){case 0:return console.groupEnd(),console.log("[dir]","list",t,"ub",i,r?'"'+r+'"':""),n=performance.now(),ci(null,r),[4,on(t,"_d")];case 1:return o=e.sent()||null,[4,on(t,"_m")];case 2:return u=e.sent()||null,[4,ai(t,o,u,r,i)];case 3:return a=e.sent(),i?0===a.length?console.warn("no more result"):or(or().concat(a)):(0!==a.length||r||Pn("nochan"),or(a)),(s=fi(t))&&(vi(or(),s.childs()),s.childids(or())),console.log("[dir]","chans load",t,"ub",i,r?'"'+r+'"':"","in",k(n),"ms"),console.groupEnd(),[2]}}))}))};function di(n,e){var t;void 0===e&&(e=0);var r=n.filter((function(n){var t;return(null===(t=mr(n))||void 0===t?void 0:t.mom)==e})),i=fi(e);i&&((ar()==e||ar()&&mr(ar())&&(null===(t=mr(ar()))||void 0===t?void 0:t.dir.includes(e)))&&i.open(!0),vi(r,i.childs()),i.childids(r));for(var o=0,u=r;o<u.length;o++){di(n,u[o])}}function fi(n){var e,r,i,o,u=n&&mr(n)?t(t([0],null!==(r=null===(e=mr(n))||void 0===e?void 0:e.dir)&&void 0!==r?r:[]),[n]):[0],a=wr();for(o=0;o<u.length;o++){var s=u[o];a.has(s)&&(i=a.get(s),a=i.childs())}return i}function vi(n,e){return n.reduce((function(n,e){return n.has(e)||n.set(e,{id:e,childids:pn([]),childs:Qt(new Map),open:pn(!1)}),n}),e)}var hi=function(n){return void 0===n&&(n=null),li(Gt.path(3),n)},pi=function(n){void 0===n&&(n=null),vr(n),Ai(n)};function mi(t,r){return void 0===t&&(t=null),void 0===r&&(r=null),n(this,void 0,void 0,(function(){return e(this,(function(n){return r&&fr(r),[2,Gr.create("scantree",Pt.send(Tn.Tree({kw:r,reload:t})))]}))}))}var gi=function(t){var r=t.id,i=t.mom,o=t.fullname;return n(void 0,void 0,void 0,(function(){return e(this,(function(n){return r===ar()||Gt.cd([Gt.path(0)+1,i,o,r]),[2]}))}))},bi=function(t){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){return Pt.send(Tn.MuteChan(t)),[2]}))}))},yi=function(t){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){return Pt.send(Tn.UnmuteChan(t)),[2]}))}))},wi=function(t,r,i){return n(void 0,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,Gr.create("addmems",Pt.send(Tn.AddMems({chanid:t,userids:r,emails:i})))];case 1:return n=e.sent(),Mi(t),[2,n]}}))}))};function Ci(t){return n(this,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){switch(e.label){case 0:return(n=mr(t))&&mr().delete(t),[4,on(t,"_h")];case 1:return(n=e.sent())?[4,V(n)]:[3,3];case 2:e.sent(),e.label=3;case 3:return r=or(),(i=r.indexOf(t))>-1&&(r.splice(i,1),or(r)),[2,n]}}))}))}var ki=function(n,e,t){void 0===n&&(n=null),void 0===e&&(e=null),void 0===t&&(t=null);var r=Tn.Shin({chanid:ar(),kw:n,ub:e,lb:t,lu:null,cu:null,mu:null});return Gr.create("chatscan",Pt.send(r))},Si=function(n,e,t,r,i,o){void 0===n&&(n=null),void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null);var u=Tn.Shin({chanid:ar(),kw:r,ub:i,lb:o,lu:n,cu:e,mu:t});return Gr.create("chatscan",Pt.send(u))},Ei=function(t){return n(void 0,void 0,void 0,(function(){var n,r,i,o,u,a;return e(this,(function(e){switch(e.label){case 0:return n=vr()||null,r=ar(),console.groupEnd(),console.groupCollapsed("[store]","⬆ load more",r,"ub",t,"kw",n),i=performance.now(),[4,en(r)];case 1:return(o=e.sent()||[])[2]&&t===o[1]?(hr(!0),console.log("[store] top chat reached"),[2]):(hr(!1),n?[3,4]:[4,Q(r,t,Jt)]);case 2:return u=e.sent(),o[2]||u.length===Jt?[4,ei(u)]:[3,4];case 3:return e.sent(),console.log("[store]","scan more",r,"ub",t,"in",k(i),"ms"),[2];case 4:return[4,ki(n,t)];case 5:return(a=e.sent()).length>0?[4,ei(a)]:[3,7];case 6:e.sent(),e.label=7;case 7:return console.log("[store]","update more",r,"ub",t,"kw",n,"in",k(i),"ms"),console.groupEnd(),[2]}}))}))},xi={cb:null};function Ai(t){return void 0===t&&(t=null),n(this,void 0,void 0,(function(){var n,r,i,o,u,a,s,c,l,d,f;return e(this,(function(e){switch(e.label){case 0:return xi.cb=null,hr(!1),cr(0),n=ar(),console.groupEnd(),console.groupCollapsed("[store]","⟳ reload",n),r=performance.now(),[4,en(n)];case 1:return i=e.sent()||[],o=null,u=t?null:i[0]||null,[4,Q(n,o,Jt)];case 2:return a=e.sent(),[4,ei(a,"re")];case 3:return e.sent(),xi.cb=Ei,console.log("[store]","chats reload",n,"in",k(r),"ms"),f={},[4,on(n,"_u")];case 4:return f.id=e.sent()||0,f.lo=i[1]||0,s=f,[4,on(n,"_d")];case 5:return c=e.sent()||null,[4,on(n,"_m")];case 6:return l=e.sent()||null,[4,Si(s,c,l,t,o,u)];case 7:return d=e.sent()||[],[4,ei(d,d.length!==Jt&&0!==a.length&&u?"pre":"re")];case 8:return e.sent(),console.log("[store]","updated",n,"in",k(r),"ms"),console.groupEnd(),[2]}}))}))}function _i(t){return n(this,void 0,void 0,(function(){var n,r,i,o,u;return e(this,(function(e){switch(e.label){case 0:return(n=t.filter((function(n){return!br().has(n)}))).length?[4,Y("_e",n)]:[3,4];case 1:return r=e.sent(),i=r.value,o=r.missed,rr(i,br()),o.length>0?[4,Gr.create("users",Pt.send(Tn.Users(o)))]:[3,3];case 2:(u=e.sent())&&rr(u,br()),e.label=3;case 3:Pt.send(Tn.Ons(n.filter((function(n){return n!=Nn.id()})))),e.label=4;case 4:return[2]}}))}))}function Ui(t,r){var i,o=r.action,u=r.chatid,a=r.txt;return n(this,void 0,void 0,(function(){var n,r;return e(this,(function(e){switch(e.label){case 0:switch(o){case 1:return[3,1];case 2:return[3,5]}return[3,7];case 1:return null===(i=gr(u))||void 0===i||i.txt(a),[4,on(u,"_t")];case 2:return(n=e.sent())?(n.txt=a,[4,$("_t",n)]):[3,4];case 3:e.sent(),n.dir.forEach((function(n){return t.add(n)})),e.label=4;case 4:return[3,7];case 5:return[4,Ti(u)];case 6:return(r=e.sent())&&r.dir.forEach((function(n){return t.add(n)})),[3,7];case 7:return[2]}}))}))}function Ti(t){return n(this,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){switch(e.label){case 0:return(n=gr(t))&&gr().delete(t),[4,on(t,"_t")];case 1:return(n=e.sent())?[4,W(n)]:[3,3];case 2:e.sent(),e.label=3;case 3:return r=ur(),(i=r.indexOf(t))>-1&&(r.splice(i,1),ur(r)),Pi(),[2,n]}}))}))}function Mi(r){var i,o,u,a;return n(this,void 0,void 0,(function(){var n,s,c,l,d,f,v,h,p,m,g;return e(this,(function(e){switch(e.label){case 0:return r?(n=null===(o=null===(i=mr(r))||void 0===i?void 0:i.md())||void 0===o||o?t(t([],null!==(a=null===(u=mr(r))||void 0===u?void 0:u.dir)&&void 0!==a?a:[]),[r]):[r],[4,Y("_n",n)]):[2,Cr([])];case 1:return s=e.sent(),c=s.value,l=s.missed,d=[],l.length?[4,Gr.create("memlist",Pt.send(Tn.Mems(l)))]:[3,3];case 2:for(f=e.sent(),v=0,h=f;v<h.length;v++)p=h[v],rr(p.users,br()),B("_e",p.users),m=p.users.map((function(n){return n.id})),un("_n",p.chanid,m),d=t(t([],d),m);e.label=3;case 3:return[4,_i(g=Array.from(new Set(t(t([],c.flat()),d))))];case 4:return e.sent(),g.sort((function(n){var e;return(null===(e=br(n))||void 0===e?void 0:e.online())?-1:0})),Cr(g),[2]}}))}))}function Di(t){return n(this,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){switch(e.label){case 0:return[4,Gr.create("findusers",Pt.send(Tn.FindUsers(t)))];case 1:return n=e.sent(),Er(n),(r=n.find((function(n){return n.name===t})))?Ar(n.indexOf(r)):(i=n.find((function(n){return n.name.startsWith(t)})),Ar(i?n.indexOf(i):0)),[2,n.length]}}))}))}function Li(t){return n(this,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){switch(e.label){case 0:return[4,Gr.create("findmems",Pt.send(Tn.FindMems({chanid:lr()||ar(),kw:t})))];case 1:return n=e.sent(),xr(n),(r=n.find((function(n){return n.name===t})))?Ar(n.indexOf(r)):(i=n.find((function(n){return n.name.startsWith(t)})),Ar(i?n.indexOf(i):0)),[2,n.length]}}))}))}function Pi(){if(d("cs")){var n=window.innerHeight-d("cs").offsetHeight-(Nn.id()?96:64)-(Mr()&&Ur()?56:Mr()?32:Ur()?24:0);d("cs").childElementCount>2&&(n-=5),d("os").style.height=n>0?n+"px":"0"}}function Oi(){var n=Nn.id(),e=br(n);e?e.online(!0):br().set(n,{id:n,name:Nn.name(),online:pn(!0),tz:pn(U()),st:pn("")})}window.onresize=Pi,Ln("reconnected",(function(){Ai(),li(Gt.path(3))}));var ji=new Map;function Ii(t,r){return n(this,void 0,void 0,(function(){var n,i,o;return e(this,(function(e){switch(e.label){case 0:return ji.has(t)?(i=ji.get(t),[3,3]):[3,1];case 1:return[4,Gr.create("name",Pt.send(Tn.Email(t)))];case 2:i=e.sent(),e.label=3;case 3:return n=i,ji.set(t,n),n?[4,Ni(n)]:[2,Qr(2)];case 4:return o=e.sent(),Ki(n,r,o),[2]}}))}))}function Ni(t){return n(this,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return Pt.send(Tn.Au(t)),ni("a secret 6-digits otp code has been sent to your registered email"),[4,Gr.create("enterotp",Wi())];case 1:return[2,n.sent()]}}))}))}function Ki(t,r,i){return n(this,void 0,void 0,(function(){var n,o,u,a,s,c,l,d,f;return e(this,(function(e){switch(e.label){case 0:return console.groupEnd(),console.groupCollapsed("[au]","login",t),mr().clear(),gr().clear(),br().clear(),Cr([]),[4,R()];case 1:return e.sent(),n=crypto.getRandomValues(new Uint8Array(12)),[4,zn(i,n)];case 2:return o=e.sent(),[4,Fn(r,t)];case 3:return u=e.sent(),s=C,c=[n],l=Uint8Array.bind,[4,dn(u,o,n)];case 4:return a=s.apply(void 0,c.concat([new(l.apply(Uint8Array,[void 0,e.sent()]))])),d=U(),f={name:t,key:a,tz:d},In(u),Pt.send(Tn.Login(f)),[2]}}))}))}function Fi(t,r,i,o){return void 0===o&&(o=null),n(this,void 0,void 0,(function(){var n,u,a,s,c,l,d,f,v,h;return e(this,(function(e){switch(e.label){case 0:return n=crypto.getRandomValues(new Uint8Array(12)),[4,zn(r,n)];case 1:return u=e.sent(),o?(c=Uint8Array.bind,[4,Fn(o,t)]):[3,3];case 2:return s=new(c.apply(Uint8Array,[void 0,e.sent()])),[3,4];case 3:s=null,e.label=4;case 4:return a=s,[4,Fn(i,t)];case 5:return l=e.sent(),f=C,v=[n],h=Uint8Array.bind,[4,dn(l,u,n)];case 6:return d=f.apply(void 0,v.concat([new(h.apply(Uint8Array,[void 0,e.sent()]))])),In(l),[2,Gr.create("pwd",Pt.send(Tn.Pwd({key:d,okey:a})))]}}))}))}function zi(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var r=n.apply(void 0,e);return!r||Qr(r)}function qi(){Xr.content=Un(Xi||(Xi=r(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Sign up</div>\n                <div class="sub">We will send a sign up invitation to your email</div>\n                <form onsubmit=',">\n                    ",'\n                    <input type="text" name="m" placeholder="Your email address" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <div class="bn"><button type="submit">Sign up</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Sign up</div>\n                <div class="sub">We will send a sign up invitation to your email</div>\n                <form onsubmit=',">\n                    ",'\n                    <input type="text" name="m" placeholder="Your email address" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <div class="bn"><button type="submit">Sign up</button></div>\n                </form>\n            </div>\n        </div>\n    '])),(function(t){return n(this,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){switch(e.label){case 0:return t.preventDefault(),n=t.target.m,x(r=n.value.trim())?[4,Gr.create("signup",Pt.send(Tn.Signup(r)))]:[3,2];case 1:return(i=e.sent())?[2,Qr(i)]:(ni("an invite code has been sent to "+r+", it should arrive shortly, you might have to check your spam folder"),$r(!1),[3,3]);case 2:Qr(7),e.label=3;case 3:return[2]}}))}))}),(function(){return Jr(3,7)&&Un(Gi||(Gi=r(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),Zr())}),T,D,(function(){return Jr(3,7)&&"er"})),$r(!0)}function Ri(){Xr.content=Un(no||(no=r(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Log in</div>\n                <div class="sub"></div>\n                <form onsubmit=',">\n                    ",'\n                    <input type="text" name="m" placeholder="Username or email" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" />\n                    <div class="lf fp"><a onclick=','>Forgot password</a></div>\n                    <div class="bn">\n                        <button type="submit">Log in</button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Log in</div>\n                <div class="sub"></div>\n                <form onsubmit=',">\n                    ",'\n                    <input type="text" name="m" placeholder="Username or email" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" />\n                    <div class="lf fp"><a onclick=','>Forgot password</a></div>\n                    <div class="bn">\n                        <button type="submit">Log in</button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    '])),(function(t){return n(this,void 0,void 0,(function(){var n,r,i,o,u;return e(this,(function(e){switch(e.label){case 0:return t.preventDefault(),n=t.target,r=n.m,i=n.p,x(o=r.value.trim())?[2,Ii(o,i.value)]:zi(A,o)?[4,Ni(o)]:[3,2];case 1:u=e.sent(),Ki(o,i.value,u),e.label=2;case 2:return[2]}}))}))}),(function(){return Jr(7,10)&&Un(Qi||(Qi=r(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),Zr())}),T,D,(function(){return Jr(7,10)&&"er"}),Bi),$r(!0)}function Bi(){Xr.content=Un(to||(to=r(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Forgot password</div>\n                <div class="sub">We will send a password reset link to your email</div>\n                <form onsubmit=',">\n                    ",'\n                    <input type="text" name="m" placeholder="Your email address" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Forgot password</div>\n                <div class="sub">We will send a password reset link to your email</div>\n                <form onsubmit=',">\n                    ",'\n                    <input type="text" name="m" placeholder="Your email address" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '])),(function(t){return n(this,void 0,void 0,(function(){var n,r;return e(this,(function(e){return t.preventDefault(),n=t.target.m,x(r=n.value.trim())?(Gr.create("forgotpwd",Pt.send(Tn.Fp(r))),ni("a password reset link has been sent to "+r+", it should arrive shortly, you might have to check your spam folder"),$r(!1)):Qr(7),[2]}))}))}),(function(){return Jr(7)&&Un(eo||(eo=r(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),Zr())}),T,D,(function(){return Jr(7)&&"er"})),$r(!0)}function Hi(t,i,o){Xr.content=Un(io||(io=r(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Reset password</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" class=','/>\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Reset password</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" class=','/>\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '])),i,(function(r){return n(this,void 0,void 0,(function(){var n,i;return e(this,(function(e){switch(e.label){case 0:return r.preventDefault(),zi(L,(n=r.target.p).value)?[4,Fi(t,o,n.value)]:[3,2];case 1:if(i=e.sent())return[2,Qr(i)];ni("password updated"),$r(!1),location.hash="#",e.label=2;case 2:return[2]}}))}))}),(function(){return Jr(12)&&Un(ro||(ro=r(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),Zr())}),(function(){return Jr(12)&&"er"})),$r(!0)}function Wi(){var n=t([],Array(6)).map((function(n){return Un(oo||(oo=r(['<input class="ot" type="tel" autocomplete="chrome-off"/>'],['<input class="ot" type="tel" autocomplete="chrome-off"/>'])))})),e=n[0];e.addEventListener("input",u),setTimeout((function(){return e.focus()}));for(var i=function(e){var t=n[e];t.addEventListener("keypress",(function(r){r.keyCode>47&&r.keyCode<58&&(t.value=r.key,e!==n.length-1&&n[e+1].focus()),r.preventDefault()})),t.addEventListener("keydown",(function(r){"Backspace"===r.key&&(t.value="",0!==e&&n[e-1].focus())})),t.addEventListener("keyup",(function(e){if(16!==e.keyCode&&9!=e.keyCode&&224!=e.keyCode&&18!=e.keyCode&&17!=e.keyCode){e.target.value.length>1&&u(e);var t=n.map((function(n){return n.value})).join("");t.length===n.length&&Gr.complete("enterotp",t)}}))},o=0;o<n.length;o++)i(o);function u(n){var e=n.data||n.target.value;e&&1!==e.length&&a(n.target,e)}function a(n,e){n.focus(),n.value=e[0],e=e.substring(1),n.nextElementSibling&&e.length&&a(n.nextElementSibling,e)}Xr.content=Un(uo||(uo=r(['\n        <div class="pi">\n            <div class="su otp">\n                <div class="head">Enter OTP code</div>\n                <div class="sub">Please enter the 6-digits code sent to your email</div>\n                <div id="otp">',"</div>\n            </div>\n        </div>\n    "],['\n        <div class="pi">\n            <div class="su otp">\n                <div class="head">Enter OTP code</div>\n                <div class="sub">Please enter the 6-digits code sent to your email</div>\n                <div id="otp">',"</div>\n            </div>\n        </div>\n    "])),n),$r(!0)}Ln("config",(function(t){var r=t.d;return n(void 0,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return r?(Oi(),zt(),[3,3]):[3,1];case 1:return Nn.id()?(lr(0),br(Nn.id())&&(null===(n=br(Nn.id()))||void 0===n||n.online(!1)),Nn.id(0),Nn.name(""),Nn.chans([]),delete Nn.sskey,Nn.salt=new Uint8Array,[4,R()]):[3,3];case 2:e.sent(),yr.childids([]),Gt.ishome()?(Ai(),ci()):Gt.home(),e.label=3;case 3:return[2]}}))}))})),Ln("subs",(function(n){Pt.send(Tn.PushSubs({endpoint:n.endpoint,auth:n.keys.auth,p256dh:n.keys.p256dh}))}));var Vi=function(n){lr()!==n?lr(n):lr(0),Mi(lr()||ar()),cr(0)};var $i=function(t){return n(void 0,void 0,void 0,(function(){var n,r;return e(this,(function(e){switch(e.label){case 0:return(n=gr(t))&&n.nor(n.nor()+1),[4,on(t,"_t")];case 1:return(r=e.sent())?(r.nor=null==n?void 0:n.nor(),[4,$("_t",r)]):[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))};function Yi(t){return n(this,void 0,void 0,(function(){return e(this,(function(n){return[2,Gr.create("status",Pt.send(Tn.Status(t)))]}))}))}var Gi,Xi,Zi,Ji,Qi,no,eo,to,ro,io,oo,uo,ao=[];function so(){return n(this,void 0,void 0,(function(){var n,t;return e(this,(function(e){switch(e.label){case 0:return[4,ln()];case 1:return n=e.sent(),[4,crypto.subtle.exportKey("raw",n.publicKey)];case 2:return t=e.sent(),[2,{keypair:n,pub:new Uint8Array(t)}]}}))}))}function co(t){return n(this,void 0,void 0,(function(){var n,r,i,o,u,a,s,c,l,d,f,v,m,g,b,y,w,C;return e(this,(function(e){switch(e.label){case 0:return n=Gr.create("ice"),[4,lo(t)];case 1:return[4,(r=e.sent()).createOffer()];case 2:return i=e.sent(),[4,r.setLocalDescription(i)];case 3:return e.sent(),o=ht((new TextEncoder).encode(r.localDescription.sdp)),[4,so()];case 4:return u=e.sent(),a=u.keypair,s=u.pub,o=h(o,s),[4,n];case 5:return e.sent(),[4,Gr.create("offer",Pt.send(Tn.Sdp({fr:null,to:t,sd:o,ca:ao,offer:!0})))];case 6:return c=e.sent(),l=p(new Uint8Array(c.sd)),d=l.a,f=l.k,[4,cn(f)];case 7:return v=e.sent(),m=r,[4,sn(a.privateKey,v)];case 8:m.sharedkey=e.sent(),g=(new TextDecoder).decode(vt(d)),r.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:g})),b=0,y=c.ca,e.label=9;case 9:return b<y.length?(w=y[b],C=new RTCIceCandidate({candidate:w,sdpMid:"0",sdpMLineIndex:0}),[4,r.addIceCandidate(C)]):[3,12];case 10:e.sent(),e.label=11;case 11:return b++,[3,9];case 12:return[2]}}))}))}function lo(t){return n(this,void 0,void 0,(function(){var r,i,o=this;return e(this,(function(u){switch(u.label){case 0:return[4,_i([t])];case 1:return u.sent(),r=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]}),Wr().has(t)||Hr.add(t),Wr().set(t,r),r.onicecandidate=function(n){n.candidate?ao.push(n.candidate.candidate):Gr.complete("ice",ao)},r.onconnectionstatechange=function(n){console.log("[peer]",r.connectionState),r.connectionState},(i=r.createDataChannel("p",{negotiated:!0,id:1})).binaryType="arraybuffer",i.onopen=function(n){console.log("dc",t,"open",n)},i.onmessage=function(i){var u=i.data;return n(o,void 0,void 0,(function(){var n,i,o,a,s,c;return e(this,(function(e){switch(e.label){case 0:return n=_(),i=new Uint8Array(u),o=i.subarray(0,12),a=Uint8Array.bind,[4,fn(i.subarray(12),r.sharedkey,o)];case 1:return i=new(a.apply(Uint8Array,[void 0,e.sent()])),v(i,o),(s=ft(vt(i))).by=t,s.ts=new Date,s.room=t,Vr.last().by!=t&&(s.showby=!0),c=s,[4,$("_p",s)];case 2:return c.id=e.sent(),Br()==t&&Vr.add(s),n&&setTimeout(f),Pi(),[2]}}))}))},i.onclose=function(n){var e,r;console.log("dc",t,"close",n),setTimeout((function(){var n;if(null===(n=br(t))||void 0===n?void 0:n.online())return co(t)}),(e=1e3,r=5e3,Math.random()*(r-e)+e))},i.onerror=function(n){console.warn("dc",t,"error",n)},r.send=function(t){return n(o,void 0,void 0,(function(){var n,o,u,a,s;return e(this,(function(e){switch(e.label){case 0:return n=ht(dt(t)),o=crypto.getRandomValues(new Uint8Array(12)),v(n,o),u=C,a=[o],s=Uint8Array.bind,[4,dn(n,r.sharedkey,o)];case 1:return n=u.apply(void 0,a.concat([new(s.apply(Uint8Array,[void 0,e.sent()]))])),i.send(n),[2]}}))}))},r.open=function(){return"open"===i.readyState},[2,r]}}))}))}function fo(n,e){var t=n.id;if(!t||cr()===t)return cr(0);e.focus(),cr(t)}function vo(t){return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,J(t)];case 1:return n=e.sent(),Vr(n.reverse()),[2]}}))}))}var ho=function(){var n=document.createElement("div");n.contentEditable="true",n.className="s-c",n.oninput=s((function(){var e=n.textContent;e&&e.length>50||(hi(e),pi(e))}),200),n.onkeydown=function(n){"Enter"!==n.key||n.shiftKey||n.preventDefault()};var e=document.createElement("div");return setTimeout((function(){new IntersectionObserver((function(e){if(!(e[0].intersectionRatio<=0)){var t=fi(ar()).childids(),r=t[t.length-1];if(!(!r||pr()||t.length<Jt)){var i=n.textContent||null;i&&i.length>50||setTimeout((function(){return li(Gt.path(3),i,r)}))}}}),{}).observe(e)})),_n("div",{class:"cn"},_n("div",{class:"s"},n),_n("div",{class:"tbl"},_n("table",null,_n("tbody",null,(function(){return qt(fi(ar()).childids,(function(n){var e=mr(n);return _n("tr",{onClick:function(){return gi(e)}},_n("td",null,_n("button",{onClick:function(e){return function(n,e){if(n.stopPropagation(),!Nn.id())return Ri();Nn.chans().includes(e)?yi(e):bi(e)}(e,n)}},(function(){return Nn.chans().includes(n)?"➕":"➖"}))),_n("td",null,e.fullname))}))}),e))))},po="formatBlock",mo=function(n,e){return n.appendChild(e)},go=function(n){return document.createElement(n)},bo=function(n){return document.queryCommandState(n)},yo=function(n,e){return document.execCommand(n,!1,e)},wo=[{icon:"<b>B</b>",title:"Bold",state:function(){return bo("bold")},result:function(){return yo("bold")}},{icon:"<i>I</i>",title:"Italic",state:function(){return bo("italic")},result:function(){return yo("italic")}},{icon:"<u>U</u>",title:"Underline",state:function(){return bo("underline")},result:function(){return yo("underline")}},{icon:"<strike>S</strike>",title:"Strike-through",state:function(){return bo("strikeThrough")},result:function(){return yo("strikeThrough")}},{icon:"&#8220&#8221;",title:"Quote",result:function(){return yo(po,"<blockquote>")}},{icon:"&lt;&gt;",title:"Code",result:function(){return yo(po,"<pre>")}},{icon:"&#128279;",title:"Link",class:" lk",result:function(){var n=window.prompt("Enter the link URL");n&&yo("createLink",n)}},{icon:"🌁",title:"Image",class:" im",result:function(){var n=window.prompt("Enter the image URL");n&&yo("insertImage",n)}},{icon:"⏎",title:"Enter to send",class:" en se",result:function(n){return Or()?Or(!1):Or(!0),Or()?n.classList.add("se"):n.classList.remove("se"),!0}}],Co="e-b",ko="e-bs",So="",Eo=0,xo=!1,Ao=pn(!1),_o=function(){return d("tp")},Uo=function(){return d("pm")},To=function(){return d("mb")},Mo=function(n){Eo=l();var e=n.textContent,t=e.indexOf(" ",Eo);-1==t&&(t=e.length);var r=/[\S]+$/.exec(e.slice(0,t));return r?r[0]:""},Do=function(n){var e=n.id,t=n.name;xr([]),Ar(0);var r=_r();if(r.spellcheck=!1,r===To()){var i=So?"@"+t:t;r.textContent=So?function(n,e){var t=n.textContent,r=t.indexOf(" ",Eo);-1==r&&(r=t.length);var i=t.slice(0,r).replace(/\S+$/,e);return Eo=i.length,i+t.slice(r)}(r,i):r.textContent+i,r.focus(),So?function(n,e){var t=document.createRange(),r=window.getSelection();t.setStart(n.childNodes[0],e),t.collapse(!0),null==r||r.removeAllRanges(),null==r||r.addRange(t)}(r,Eo):c(),Ao(!1),e&&Pr.add(e)}else e?Dr.add(e):Lr.add(So),r.textContent="",Uo().focus()},Lo=function(){return _n("div",{id:"uls",class:function(){return"uls"+(_r()===To()&&Mr()?" ms":"")}},_n("ul",null,qt(xr,(function(n){return _n("li",{id:n.id.toString(),tabIndex:-1,class:function(){return xr()[Ar()]===n?"se":""},onClick:function(){return Do(n)},onMouseOver:function(){return xo||Ar(xr().indexOf(n))}},n.id?_n("i",{class:function(){var e;return"dot"+((null===(e=br(n.id))||void 0===e?void 0:e.online())?" on":"")}}):null,n.name)}))))},Po=function(){return _n("div",{class:function(){return"em sel"+(Mr()?" sh":"")},onClick:function(){return Uo().focus()}},qt(Lr,(function(n){return _n("div",{class:"tg ie"},n,_n("i",{onClick:function(){return Lr.delete(n)}},"✕"))})),qt(Dr,(function(n){var e;return _n("div",{class:function(){var e;return(null===(e=br(n))||void 0===e?void 0:e.online())?"tg on":"tg"}},null===(e=br(n))||void 0===e?void 0:e.name,_n("i",{onClick:function(){return Dr.delete(n)}},"✕"))})),_n("div",{class:"wp"},_n("div",{id:"pm",class:"e-m"+(Lr().length+Dr().length===0?" to":""),onKeyDown:Oo,onInput:No,contentEditable:!0}),(function(){return _r()===Uo()&&Mr()&&xr().length>0&&Lo})))};function Oo(n){var e;if(!jo(n)){if(8!=n.keyCode||(null===(e=Uo().textContent)||void 0===e?void 0:e.length)||(Dr.pop(),Uo().focus()),32!==n.keyCode&&!/^[a-zA-Z0-9\_@\.]+$/.test(n.key))return n.preventDefault(),!1;"Enter"!==n.key&&"Tab"!==n.key||(To().focus(),n.preventDefault())}}function jo(n){var e,t;return!!xr().length&&("Enter"===n.key||"Tab"===n.key||32===n.keyCode?(Do(xr()[Ar()]),n.preventDefault(),!0):27==n.keyCode?(xr([]),Ar(),Ao(!1),!0):(38==n.keyCode&&(0===Ar()?Ar(xr().length-1):Ar(Ar()-1),null===(e=d(xr()[Ar()].id))||void 0===e||e.focus(),n.preventDefault(),xo=!0,setTimeout((function(){return xo=!1}),300)),40==n.keyCode&&(Ar()===xr().length-1?Ar(0):Ar(Ar()+1),null===(t=d(xr()[Ar()].id))||void 0===t||t.focus(),n.preventDefault(),xo=!0,setTimeout((function(){return xo=!1}),300)),n.target.focus(),!0))}var Io=s((function(t){return n(void 0,void 0,void 0,(function(){var n,r,i,o;return e(this,(function(e){switch(e.label){case 0:return(So=Mo(t.target).toLowerCase()).length>50?[2]:[4,Li(So)];case 1:return n=e.sent(),r=mr(lr()||ar()),i=void 0!==r&&(null!==(o=r.md())&&void 0!==o?o:0)<2,!n&&x(So)&&i&&xr([{id:0,name:"✉️ Invite "+So,online:!1}]),[2]}}))}))}),100);function No(n){_r(Uo()),Io(n)}var Ko=function(){var n;if(!Nn.id())return null;if(Yr()&&gr(Yr())&&lr()==(null===(n=gr(Yr()))||void 0===n?void 0:n.chanid))return null;var e=mr(lr());if(!e)return null;_()&&setTimeout(f,50);var r=function(){return t(t([],e.dir.slice(Gt.len()-2)),[e.id])};return r().length>0&&_n("div",{class:"dr",style:function(){return"background:"+E(e.id)}},qt(r,(function(n){var e;return _n("span",null,_n("a",{href:"#"+$t.ntob(n)},null===(e=mr(n))||void 0===e?void 0:e.fullname))})))},Fo=function(){return _n("div",{id:"tp",class:function(){return"e-t"+(Ur()?" sh":"")},onKeyUp:qo,onKeyDown:zo,contentEditable:!0})},zo=function(n){n.target.spellcheck=!1,"Enter"===n.key&&n.preventDefault()},qo=function(n){Tr(n.target.textContent),"Enter"===n.key&&(To().focus(),n.preventDefault())},Ro=function(){return!(lr()||ar()||Mr()||Ur())},Bo=function(){return _n(Array.prototype,null,_n("style",null,".e-c[contenteditable]:empty::before { content: '"+function(){var n,e="Send a "+(Mr()?"private ":"")+"message ";return lr()?n=mr(lr()):ar()&&(n=mr(ar())),n?e+(Ur()?"on new topic "+(Tr()?'"'+Tr()+'" ':"")+'in "'+n.fullname()+'"':'in "'+n.fullname()+'"'):Ur()?e+"on new topic "+(Tr()?'"'+Tr()+'"':""):e+"..."}()+"'; }"),(function(){return _r()===To()&&Ao()&&xr().length>0&&Lo}),_n("div",{id:"mb",class:"e-c",onKeyDown:Wo,onInput:Vo,onFocus:Ho,contentEditable:!0}))},Ho=function(){if(0!==ur().length)return Ro()?(lr(gr(Yr()).chanid),void Mi(lr())):lr()||Mr()||Ur()?void 0:(lr(gr(Yr()).chanid),void Mi(lr()))},Wo=function(t){if(_r(To()),"@"===t.key&&Ao(!0),!jo(t)&&"Enter"===t.key){if(t.preventDefault(),Or()&&!t.shiftKey)return void function(t,r){var i;n(this,void 0,void 0,(function(){var n,o,u,a,s,c,l,d,f,v;return e(this,(function(e){switch(e.label){case 0:return Nn.id()?t.innerHTML.length>120||r.innerHTML.length>4e3?[2,Qr(11)]:r.innerHTML.trim()?Br()?(null===(i=br(Br()))||void 0===i?void 0:i.online())?Wr(Br()).open()?(n={txt:r.innerHTML.trim()},Wr(Br()).send(n),n.by=Nn.id(),n.ts=new Date,n.room=Br(),(null==(o=Vr.last())?void 0:o.by)!=Nn.id()&&(n.showby=!0),u=n,[4,$("_p",n)]):[2,Qr(16)]:[2,Qr(15)]:[3,2]:[2]:[2,Qr(1)];case 1:return u.id=e.sent(),Vr.add(n),r.textContent="",Pi(),[2];case 2:return a=lr()||ar(),s=cr()||sr()||null,c=null,t.textContent===dr()||(null==(c=t.textContent)?void 0:c.trim().length)?a||Mr()||c&&c.trim().length?(l=r.innerHTML.trim(),d=null,f=null,v=null,Mr()&&(Dr().length>0&&(d=Dr.add(Nn.id()).sort((function(n,e){return n-e}))),Lr().length>0&&(f=Lr())),Pr().length>0&&(v=Pr().filter((function(n){var e;return l.indexOf("@"+(null===(e=br(n))||void 0===e?void 0:e.name))>-1}))),Pt.send(Tn.NewChat({txt:l,chanid:a,re:s,chname:c,men:v,to:d,emails:f})),Ur(!1),Mr(!1),t.textContent="",r.textContent="",Tr(""),dr(""),fo({},r),[2]):[2,Qr(5)]:[2,Qr(6)]}}))}))}(_o(),To());t.target.textContent+="\n\n",c()}},Vo=function(n){To().spellcheck=!1,Ao()&&$o(n)},$o=s((function(n){(So=Mo(n.target).toLowerCase()).startsWith("@")?(So=So.replace(/[@'";:,.\/?\\-]/,"")).length>50||Li(So):Ao(!1)}),100),Yo=_n("div",{class:"e-a"});wo.forEach((function(n){var e,t,r=go("button");if(r.className=Co+" eb",n.class&&(r.className+=n.class),r.innerHTML=n.icon,r.title=n.title,r.setAttribute("type","button"),r.onclick=function(e){return n.result(r)&&To().focus()},n.state){e="click",t=function(){return r.classList[n.state()?"add":"remove"](ko)},r.addEventListener(e,t)}mo(Yo,r)}));var Go=go("button");Go.className=Co+" md",Go.innerHTML="👤",Go.title="Private message",Go.setAttribute("type","button");var Xo=function(){if(!Nn.id())return Ri();var n=_();Go.classList.add("se"),Mr(!0),n&&setTimeout(f),Pi(),"ontouchstart"in document.documentElement||Uo().focus()};Go.onclick=function(){return Mr()?(Go.classList.remove("se"),Mr(!1),void Pi()):Xo()};var Zo=go("button");Zo.className="ntb",Zo.innerHTML="✏️ New Topic",Zo.title="New topic",Zo.setAttribute("type","button"),Zo.onclick=function(n){if(!Nn.id())return Ri();var e=_();Ur()?Ur(!1):Ur(!0),e&&Ur()&&setTimeout(f),function(n,e){if(Ur(n),Pi(),n?Zo.classList.add("se"):Zo.classList.remove("se"),"ontouchstart"in document.documentElement)return;n&&_o().focus();e&&(_o().innerText=e,Tr(e))}(Ur())},mo(Yo,Zo),mo(Yo,Go),yo("defaultParagraphSeparator","div");var Jo=function(){return _n("div",{class:function(){return"e"+(Nn.id()?Ro()?" ds":"":" hd")}},(function(){var n,e;return cr()?_n("div",{class:"re",style:function(){return"color:"+E(cr())}},_n("i",null,"→"),_n("b",null,null===(n=br(gr(cr()).by))||void 0===n?void 0:n.name),_n("a",{href:"#/"+$t.ntob(cr())},null===(e=gr(cr()))||void 0===e?void 0:e.txt)):null}),Ko," ",Fo," ",Po," ",Bo," ",Yo)},Qo=function(n,e){var t,r=null===(t=d(n+"_"))||void 0===t?void 0:t.querySelector(".ct");if("true"===r.contentEditable)return r.contentEditable=!1,r.classList.remove("ce"),r.innerHTML=e.txt(),void(r.onclick=function(){return!1});r.spellcheck=!1,r.contentEditable=!0,r.classList.add("ce"),r.focus(),r.onclick=function(n){"true"===r.contentEditable&&n.stopPropagation()},r.onkeydown=function(n){if("Tab"===n.key)return document.execCommand("insertHTML",!1,"&#09"),n.preventDefault();if("Escape"===n.key)return r.contentEditable=!1,r.classList.remove("ce"),void(r.innerHTML=e.txt());if("Enter"===n.key){var t=r.innerHTML.trim();n.shiftKey||(n.preventDefault(),r.contentEditable=!1,r.classList.remove("ce"),t!==e.txt()&&(i=e.id,o=t,Pt.send(Tn.EditChat({id:i,txt:o}))))}var i,o}};var nu="c0a91d3",eu="0.0.333";function tu(t){var r=t.name;return n(this,void 0,void 0,(function(){function n(n){var e,t,r;n.preventDefault();var u=n.target.n,a=u.value.trim()==i?null:u.value.trim(),s=null!==(r=null===(t=null===(e=d("ab"))||void 0===e?void 0:e.textContent)||void 0===t?void 0:t.trim())&&void 0!==r?r:null,c=function(n,e){return n&&n.length<2?10:e&&e.length>1e3?11:0}(a,s=s==(o||"")?null:s);0===c?(!function(n,e,t){void 0===t&&(t=null),Pt.send(Tn.EditProfile({fullname:n,about:e,email:t}))}(a,s),$r(!1)):Qr(c)}var t,i,o;return e(this,(function(e){switch(e.label){case 0:return[4,Gr.create("profile",Pt.send(Tn.Profile))];case 1:return t=e.sent(),i=t.fullname,o=t.about,Xr.content=_n("div",{class:"pi"},_n("div",{class:"su"},_n("div",{class:"head"},"Profile"),_n("div",{class:"sub"},r),_n("form",{onSubmit:function(e){return n(e)}},(function(){return Jr(10,11)&&_n("div",{class:"erm"},Zr())}),_n("input",{value:null!=i?i:"",type:"text",name:"n",placeholder:"Full name",required:!0,class:function(){return Jr(10)?"er":""}}),_n("div",{id:"ab",class:"ab",contentEditable:!0},o),_n("div",{class:"bn"},_n("button",{type:"submit"},"Save"))))),$r(!0),[2]}}))}))}var ru,iu=function(t,r){return n(void 0,void 0,void 0,(function(){function i(n){var e=n.target.textContent;if(e&&e.length>50)return Qr(11);var t=U(),i=e&&e.trim().length?e:null;br(r).tz(t),br(r).st(null!=i?i:""),function(n){Pt.send(Tn.EditStatus(n))}({tz:t,st:i})}var o,u,a,s,l,d,f,v,h;return e(this,(function(p){switch(p.label){case 0:return Nn.id()?(t.stopPropagation(),(null===(s=br(r))||void 0===s?void 0:s.tz())?[3,2]:[4,Yi(r)]):[2];case 1:o=p.sent(),u=o.st,a=o.tz,Nn.id()==r&&(a=U()),br(r).tz(null!=a?a:""),br(r).st(null!=u?u:""),p.label=2;case 2:return Xr.content=_n("div",{class:"pi"},_n("div",{class:"ui"},_n("div",{class:"un"},_n("i",{class:function(){var n;return"do"+((null===(n=br(r))||void 0===n?void 0:n.online())?" on":"")}}),_n("b",{style:function(){var n,e;return(null===(n=br(r))||void 0===n?void 0:n.online())?"color:"+E(null===(e=br(r))||void 0===e?void 0:e.name):""}},null===(l=br(r))||void 0===l?void 0:l.name)),r!==Nn.id()?_n("div",{style:"font-size:12px"},null===(d=br(r))||void 0===d?void 0:d.st()):_n("div",{class:"st",contentEditable:!0,onBlur:i},null===(f=br(r))||void 0===f?void 0:f.st)),_n("hr",null),(function(){var n,e;return(null===(n=br(r))||void 0===n?void 0:n.tz())?_n("div",{class:"sub"},_n("i",null,"🕑")," Local time ",function(n){return(new Date).toLocaleTimeString(Intl.DateTimeFormat().resolvedOptions().locale,{timeZone:n,hour:"numeric",minute:"2-digit"})}(null===(e=br(r))||void 0===e?void 0:e.tz())):null}),r!==Nn.id()?_n(Array.prototype,null,_n("div",{class:"bt"},_n("i",{class:"fl"},"💬")," ",_n("a",{onClick:function(){return function(n){$r(!1),Xo(),Dr([n]),cr(0)}(r)}},"Send private message")),_n("div",{class:"bt"},_n("i",null,"@")," ",_n("a",{onClick:function(){return function(n){var e;if($r(!1),!Nn.id())return Ri();To().innerHTML+="@"+(null===(e=br(n))||void 0===e?void 0:e.name),To().focus(),c(),Pr.add(n)}(r)}},"Mention ",_n("b",null,null===(v=br(r))||void 0===v?void 0:v.name))),(null===(h=br(r))||void 0===h?void 0:h.online())?_n("div",{class:"bt"},_n("i",{class:"fl"},"↔"),_n("a",{onClick:function(){$r(!1),location.hash="#&"+$t.ntob(r)}},"Send direct p2p message")):null):_n(Array.prototype,null,_n("div",{class:"bt",onClick:function(){return tu(br(r))}},_n("i",null,"✏️")," ",_n("a",null,"Edit profile")),_n("div",{class:"bt",onClick:function(){return function(t){var r=t.name;Xr.content=_n("div",{class:"pi"},_n("div",{class:"su"},_n("div",{class:"head"},"Change Password"),_n("div",{class:"sub"},r),_n("form",{onSubmit:function(t){return n(this,void 0,void 0,(function(){var n,i,o,u,a;return e(this,(function(e){switch(e.label){case 0:return t.preventDefault(),n=t.target,i=n.o,zi(L,(o=n.p).value,i.value)?[4,Ni(r)]:[3,3];case 1:return u=e.sent(),[4,Fi(r,u,o.value,i.value)];case 2:if(a=e.sent())return[2,Qr(a)];ni("password updated"),$r(!1),e.label=3;case 3:return[2]}}))}))}},(function(){return Jr(12,13,14)&&_n("div",{class:"erm"},Zr())}),_n("input",{type:"password",name:"o",placeholder:"Old password",required:!0,autocomplete:"true",class:function(){return Jr(13)?"er":""}}),_n("input",{type:"password",name:"p",placeholder:"New password",required:!0,autocomplete:"true",class:function(){return Jr(12,14)?"er":""}}),_n("div",{class:"bn"},_n("button",{type:"submit"},"Submit"))))),$r(!0)}(br(r))}},_n("i",null,"🔒")," ",_n("a",null,"Change password")),_n("div",{class:"bt",onClick:function(){return function(){var t;return n(this,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return console.groupEnd(),console.groupCollapsed("[au]","logout"),lr(0),Cr([]),null===(t=br(Nn.id()))||void 0===t||t.online(!1),mr().clear(),gr().clear(),[4,Pt.send(Tn.Logout(Nn.salt))];case 1:return n.sent(),[4,R()];case 2:return n.sent(),jn({d:!1}),console.groupEnd(),$r(!1),Pn("logout"),[2]}}))}))}()}},_n("i",null,"🚪")," ",_n("a",null,"Sign out")),_n("div",{class:"v"},eu," ",nu))),$r(!0),[2]}}))}))},ou=function(n,e){if(n.shiftKey)return function(n,e){var t=screen.width/2-300,r=screen.height/2-300;window.open(n,e,"toolbar=yes,location=yes,status=no,menubar=yes,scrollbars=yes,resizable=yes,width=600,height=600,top="+r+",left="+t)}("#"+$t.ntob(e),e.toString()),n.preventDefault();Vi(e),n.stopPropagation()},uu=function(){var i=pn(0),o=pn(0),u=!1,a=function(n){var e=n.id,t=n.txt,a=n.by,c=n.chanid,l=n.star,d=n.men,f=n.timestamp,v=n.showby,h=n.first,p=n.firstre,m=n.last,g=n.lastre,b=n.re,y=n.nor,w=$t.ntob(e);function C(){return["ct"].join(" ")}return _n("div",{id:w+"_",class:function(){return"c"+(cr()===e||o()==e?" cur":"")+(lr()>0&&lr()!==c?" bl":"")+(((new Date).getTime()-f.getTime())/1e3<60?" nc":"")+(b||y()?" r":"")+(h()||p()&&b!=sr()?" fr":"")+(m()||g()&&b!=sr()?" lr":"")},onClick:function(e){return function(n,e){"ontouchstart"in document.documentElement||Vi(e.chanid)}(0,n)},onTouchEnd:function(e){return function(n,e){u||Vi(e.chanid)}(0,n)},onMouseOver:function(){return i()!==e&&i(e)},style:function(){return"border-color:"+E(b||(y()?e:c))}},(function(){var n,t;return p()&&b!=sr()&&gr(b)?_n("div",{class:"re",style:function(){return b||y()?"color:"+E(b||e):""},onMouseOver:function(){return o()!==b&&o(b)},onMouseOut:function(){return o(0)}},_n("i",null,"→"),_n("b",null,null===(n=br(gr(b).by))||void 0===n?void 0:n.name),_n("a",{href:"#/"+$t.ntob(b),onClick:function(n){return n.stopPropagation()}},null===(t=gr(b))||void 0===t?void 0:t.txt)):null}),(function(){var n;return v()||h()||p()?_n("div",null,_n("a",{class:function(){var n;return"by"+((null===(n=br(a))||void 0===n?void 0:n.online())?" on":"")},style:function(){var n,e;return(null===(n=br(a))||void 0===n?void 0:n.online())?"color:"+E(null===(e=br(a))||void 0===e?void 0:e.name):""},onClick:function(n){return iu(n,a)}},null===(n=br(a))||void 0===n?void 0:n.name)):null}),_n("div",{class:function(){return l()?" star":""},style:function(){return y()?"color:"+E(e):""}},(function(){var n,e,i,o=t();if(d&&d.length)for(var u=0,a=d;u<a.length;u++){var s=a[u],c=null===(n=br(s))||void 0===n?void 0:n.name,l=Nn.id()==s?"j":(null===(e=br(s))||void 0===e?void 0:e.online())?"k":"i",f=(null===(i=br(s))||void 0===i?void 0:i.online())?'style="color:'+E(c)+'"':"";o=o.replaceAll("@"+c,'<b onclick="b('+s+')" class="'+l+'" '+f+">@"+c+"</b>")}return Un(ru||(ru=r(["<div class="," innerHTML="," />"],["<div class="," innerHTML="," />"])),C,o)}),(function(){var n;return y()&&e!=sr()?_n("p",{class:"mr"},_n("i",null,"→"),_n("a",{href:"#/"+w,onClick:function(n){return n.stopPropagation()}},y()+(null!==(n=y())&&void 0!==n&&n?" replies":" reply"))):null})),(function(){return i()===e&&Nn.id()?s(w,n):null}))},s=function(t,r){var i,o,u,a=function(n){n.preventDefault(),n.stopPropagation();var e=_();fo(r,To()),cr()===r.id?lr(r.chanid):lr(0),e&&setTimeout(f)};return _n(Array.prototype,null,_n("div",{class:"ts"},(i=r.timestamp,o=6e4,(u=(new Date).getTime()-i.getTime())<o?Math.round(u/1e3)+"s":u<36e5?Math.round(u/o)+"m":i.toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale,{hour:"numeric",minute:"2-digit"}))),_n("div",{class:"pm pr",title:"reply",onTouchEnd:a,onClick:a},_n("i",null,"→"),_n("div",{class:"pu"},_n("div",null,"reply"))),_n("div",{class:"pm",onClick:function(n){return n.stopPropagation()}},_n("i",{class:"i"},"..."),_n("div",{class:"pu"},_n("div",{onClick:function(t){return function(t){return n(void 0,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return t.star(!t.star()),Pt.send(Tn.Star(t.id)),[4,on(t.id,"_t")];case 1:return(n=e.sent())?(n.star=t.star(),[4,$("_t",n)]):[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))}(r)}},"⭐ ",r.star()?"unstar":"star"),_n("div",{onClick:function(n){return Qo(t,r)}},"✏️ edit"),_n("div",{onClick:function(n){return c(r)}},"🗑️ trash"))))},c=function(n){var e=n.id,t=n.txt;confirm('Do you want to delete this chat? \n"'+t()+'"')&&function(n){Pt.send(Tn.DelChat(n)),Ti(n)}(e)},l=document.createElement("div");return setTimeout((function(){new IntersectionObserver((function(n){n[0].intersectionRatio<=0||xi.cb&&(!ur()[0]||hr()||ur().length<Jt||setTimeout((function(){if(xi.cb){var n=ur()[0];!n||hr()||ur().length<Jt||xi.cb(n)}})))}),{}).observe(l)})),setTimeout((function(){var n,e;null===(n=d("cs"))||void 0===n||n.addEventListener("touchstart",(function(){return u=!1}),{passive:!0}),null===(e=d("cs"))||void 0===e||e.addEventListener("touchmove",(function(){return u=!0}),{passive:!0})})),_n(Array.prototype,null,_n("div",{id:"os"}),_n("div",{id:"cs"},l,(function(){var n=[],e=0,r=null;return ur().reduce((function(n,t){return P(gr(t).timestamp,r)?gr(t).chanid!=e?(e=gr(t).chanid,n.push(pn([t])),n):(n[n.length-1]().push(t),n):(r=gr(t).timestamp,n.push(pn(r)),e=gr(t).chanid,n.push(pn([t])),n)}),n),qt(pn(n),(function(n){var e=n();if(e instanceof Date)return _n("div",{class:"date"},(r=e,i=new Date,P(r,i)?"Today":(i.setDate(i.getDate()-1),P(r,i)?"Yesterday":r.toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale,{month:"short",day:"numeric"}))));var r,i,o=gr(n()[0]);return _n("div",null,_n("div",{class:"tn"},(function(){return function(n){var e=mr(n);if(!e)return null;var r=function(){return t(t([],e.dir.slice(Gt.len()-2)),[e.id])};return r().length>0&&_n("div",{class:"dr",style:function(){return"background:"+E(n)}},qt(r,(function(n){var e;return _n("span",null,_n("a",{href:"#"+$t.ntob(n),onClick:function(e){return ou(e,n)}},null===(e=mr(n))||void 0===e?void 0:e.fullname))})))}(o.chanid)}),_n("div",{class:"ts"},function(n){return n.toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale,{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}(o.timestamp))),qt(n,(function(n){return a(gr(n))})))}))}),(function(){var n;return br(Br())?_n("div",null,_n("div",{class:"tn"},_n("div",{class:"dr",style:function(){var n;return"background:"+E(null===(n=br(Br()))||void 0===n?void 0:n.name)}},_n("span",null,_n("a",null,"↔ ",null===(n=br(Br()))||void 0===n?void 0:n.name)))),qt(Vr,(function(n){var e=n.by,t=n.txt,r=n.showby;return br(e)?_n("div",{class:"c",style:function(){var n;return"border-color:"+E(null===(n=br(Br()))||void 0===n?void 0:n.name)}},(function(){var n;return r?_n("div",null,_n("a",{class:function(){var n;return"by"+((null===(n=br(e))||void 0===n?void 0:n.online())?" on":"")},style:function(){var n,t;return(null===(n=br(e))||void 0===n?void 0:n.online())?"color:"+E(null===(t=br(e))||void 0===t?void 0:t.name):""},onClick:function(n){return iu(n,e)}},null===(n=br(e))||void 0===n?void 0:n.name)):null}),_n("div",null,t)):_n("div",null)}))):null})),Jo)},au=[["","All messages"],["!","Private messages"],["@","Mentions"],["*","Stars"]],su=function(){var n=document.createElement("div");n.contentEditable="true",n.className="s-c",n.oninput=s((function(){var e=n.textContent;e&&e.length>50||(hi(e),pi(e))}),200),n.onkeydown=function(n){"Enter"!==n.key||n.shiftKey||n.preventDefault()};var e=function(n){return _n("ul",null,qt(n.childids,(function(t){var r,i=n.childs(t);return _n(Array.prototype,null,_n("li",{class:function(){return function(n){return[Nn.chans().includes(n)?"":"on",n==ar()?"se":""].join(" ")}(t)},onClick:function(){return function(n,e){n.open(!n.open()),gi(e)}(i,mr(t))}},_n("div",{class:"sb"},_n("i",null,(function(){return i.childids().length?i.open()?"▼":"▶":""}))),_n("div",{class:"lb"},(function(){return function(n){var e,t,r;return(null===(e=mr(n))||void 0===e?void 0:e.md)&&null!==(r=null===(t=mr(n))||void 0===t?void 0:t.md())&&void 0!==r&&r?"🔒":""}(t)})," ",null===(r=mr(t))||void 0===r?void 0:r.fullname),_n("div",{class:"dot",onClick:function(n){return function(n,e){if(n.stopPropagation(),!Nn.id())return Ri();Nn.chans().includes(e)?yi(e):bi(e)}(n,t)}})),(function(){return i.open()&&i.childids().length?e(i):null}))})))};return _n(Array.prototype,null,_n("div",{class:"dn n"},_n("i",{onClick:function(){return Pn("lnclose")}},"✕")),_n("div",{class:"s"},n),Nn.id()?_n("ul",{class:"hm"},(function(){return au.map((function(n){return _n("li",{class:(Rr()[0]||"")==n[0]?"se":"",onClick:function(){return location.hash=n[0]}},n[1])}))})):null,qt(Hr,(function(n){var e;return _n("div",null,_n("div",{class:"tn"},_n("div",{class:"dr",style:function(){var e;return"background:"+E(null===(e=br(n))||void 0===e?void 0:e.name)}},_n("span",null,_n("a",{href:"#&"+$t.ntob(n)},"↔ ",null===(e=br(n))||void 0===e?void 0:e.name)))))})),_n("div",{class:"nt"},(function(){return yr.childids().length?e(yr):null})))},cu="",lu=0,du=!1,fu=function(){var t=s((function(t){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return(cu=function(n){lu=l();var e=n.textContent,t=e.indexOf(" ",lu);-1==t&&(t=e.length);var r=/[\S]+$/.exec(e.slice(0,t));return r?r[0]:""}(t.target).toLowerCase())&&cu.length>50?[2]:[4,Di(cu)];case 1:return!n.sent()&&x(cu)&&Er([{id:0,name:"✉️ Invite "+cu,online:!1}]),[2]}}))}))}),100),r=_n("div",{class:"am",contentEditable:!0,onKeyDown:function(n){if(_r(r),o(n))return;8!=n.keyCode||r.textContent.length||(kr.pop(),r.focus());if(32!==n.keyCode&&!/^[a-zA-Z0-9\_@\.]+$/.test(n.key))return void n.preventDefault();"Enter"!==n.key&&"Tab"!==n.key||n.preventDefault()},onInput:t});function i(n){var e=n.id;Er([]),Ar(0),e?kr.add(e):Sr.add(cu),r.textContent="",r.spellcheck=!1,r.focus()}function o(n){var e,t;return!!Er().length&&("Enter"===n.key||"Tab"===n.key||32===n.keyCode?(i(Er()[Ar()]),n.preventDefault(),!0):27==n.keyCode?(Er([]),Ar(),!0):(38==n.keyCode&&(0===Ar()?Ar(Er().length-1):Ar(Ar()-1),null===(e=d(Er()[Ar()].id))||void 0===e||e.focus(),n.preventDefault(),du=!0,setTimeout((function(){return du=!1}),300)),40==n.keyCode&&(Ar()===Er().length-1?Ar(0):Ar(Ar()+1),null===(t=d(Er()[Ar()].id))||void 0===t||t.focus(),n.preventDefault(),du=!0,setTimeout((function(){return du=!1}),300)),n.target.focus(),!0))}var u=function(){return _n("div",{class:"uls adm"},_n("ul",null,qt(Er,(function(n){return _n("li",{id:n.id.toString(),tabIndex:-1,class:function(){return Er()[Ar()]===n?"se":""},onClick:function(){return i(n)},onMouseOver:function(){return function(n){du||Ar(n)}(Er().indexOf(n))}},n.id?_n("i",{class:function(){var e;return null===(e=br(n.id))||void 0===e||e.online()," on"}}):null," ",n.name)}))))},a=_n("div",{class:"sel",onClick:function(){return r.focus()}},qt(Sr,(function(n){return _n("div",{class:"tg ie"},n,_n("i",{onClick:function(){return Sr.delete(n)}},"✕"))})),qt(kr,(function(n){var e;return _n("div",{class:function(){var e;return(null===(e=br(n))||void 0===e?void 0:e.online())?"tg on":"tg"}},null===(e=br(n))||void 0===e?void 0:e.name,_n("i",{onClick:function(){return kr.delete(n)}},"✕"))})),r,(function(){return _r()===r&&Er().length>0&&u}));return a.focus=function(){return r.focus()},a},vu=function(){var r=["Public","Internal"],i=function(){return lr()?mr(lr()):mr(ar())};var o=function(t,r){var i;t.stopPropagation(),window.confirm("Do you want to delete this channel?\n"+r.fullname())&&(i=r.id,n(void 0,void 0,void 0,(function(){return e(this,(function(n){return Pt.send(Tn.DelChan(i)),[2]}))})))},u=function(){var n;return(null===(n=i())||void 0===n?void 0:n.by)===Nn.id()};function a(){var n=kr().length+Sr().length;return n>0?" "+n+(n>1?" people":" person"):""}var s=function(t){var r=t.id,i=t.fullname,o=fu();Xr.content=_n("div",{class:"pi"},_n("div",{class:"amb"},_n("div",{class:"head"},"Add people"),_n("div",{class:"sub"},i),o,_n("div",{class:"bn"},_n("button",{onClick:function(){return function(t,r){return n(void 0,void 0,void 0,(function(){var n,i;return e(this,(function(e){switch(e.label){case 0:return n=kr().length?kr():null,i=Sr().length?Sr():null,n||i?[4,wi(t,n,i)]:[2];case 1:return e.sent()?(ni("added"+a()+" to "+r()),$r(!1)):Qr(8),[2]}}))}))}(r,i)}},"Add",a)))),$r(!0),o.focus()};function c(n,e){var t,r,i,o=e.id,u=e.fullname,a=e.about,s=e.md;n.preventDefault();var c=n.target,l=c.n,f=c.m,v=l.value.trim()==u()?null:l.value.trim(),h=f&&Number(f.value)!=s()?Number(f.value):null,p=null!==(i=null===(r=null===(t=d("ab"))||void 0===t?void 0:t.textContent)||void 0===r?void 0:r.trim())&&void 0!==i?i:null,m=function(n,e,t){return n&&0===n.length?10:t&&(t>2||t<0)||e&&e.length>1e3?11:0}(v,p=p==(a()||"")?null:p,h);0===m?(!function(n){Pt.send(Tn.EditChan(n))}({id:o,name:v,about:p,md:h}),$r(!1)):Qr(m)}return _n(Array.prototype,null,_n("div",{class:"dn"},_n("i",{onClick:function(){return Pn("rnclose")}},"✕")),_n("div",{class:"ub"},(function(){return i()&&u()&&_n("div",{title:"edit",onClick:function(){return function(n){var e;Xr.content=_n("div",{class:"pi"},_n("div",{class:"su et"},_n("div",{class:"head"},"About"),_n("div",{class:"sub"},n.fullname),_n("form",{onSubmit:function(e){return c(e,n)}},(function(){return Jr(10,11)&&_n("div",{class:"erm"},Zr())}),_n("input",{value:n.fullname,type:"text",name:"n",placeholder:"topic name",required:!0,class:function(){return Jr(10)?"er":""}}),_n("div",{id:"ab",class:"ab",contentEditable:!0},n.about),1!=Nn.id()||null!==(e=null==n?void 0:n.md())&&void 0!==e&&!e?null:_n("select",{name:"m"},r.map((function(e,t){return _n("option",{selected:function(){return n.md()==t},value:t},e)}))),_n("div",{class:"bn"},_n("button",{type:"submit"},"Save"))))),$r(!0)}(i())},class:"ed"},"✎")}),_n("div",{class:"head"},"About"),_n("div",{class:"sub b"},(function(){var n;return null===(n=i())||void 0===n?void 0:n.fullname})),_n("div",{class:"sub"},(function(){var n;return null===(n=i())||void 0===n?void 0:n.about}))),_n("div",{class:"ub"},_n("div",{class:"he"},"Settings"),_n("div",{class:"sub"},(function(){return i()?t(t([],r),["Private"])[i().md()]:""}))),_n("div",{class:"ft"},_n("div",{class:"ub lf"},_n("div",{class:"he"},"Members")),(function(){return Nn.id()>0&&_n("div",{class:"rt"},(function(){return i()&&_n("button",{title:"add members",onClick:function(){return s(i())}},"👤")}))})),_n("div",{class:"uls mem"},_n("ul",null,qt(Cr,(function(n){var e;return _n("li",{id:n.toString(),tabIndex:-1,style:function(){var e,t;return(null===(e=br(n))||void 0===e?void 0:e.online())?"color:"+E(null===(t=br(n))||void 0===t?void 0:t.name):""},onClick:function(e){return iu(e,n)}},n?_n("i",{class:function(){var e;return"dot"+((null===(e=br(n))||void 0===e?void 0:e.online())?" on":"")}}):null,null===(e=br(n))||void 0===e?void 0:e.name)})))),(function(){return i()&&u()&&_n("div",{class:"ft dt"},_n("div",{class:"ub lf"},_n("div",{class:"he"},"Delete")),_n("div",{class:"rt"},_n("button",{title:"delete topic",onClick:function(n){return o(n,i())}},"🗑️")))}))},hu=function(){return jr()?Number(localStorage.getItem("w")||185):0},pu=function(){return Ir()?Number(localStorage.getItem("e")||185):0};function mu(){var n=localStorage.getItem("l"),e=null!==n&&"0"!==n&&window.innerWidth>650;jr(e);var t="1"==localStorage.getItem("r")&&window.innerWidth>650;Ir(t),Kr(hu()),Fr(pu())}function gu(){jr(!jr()),Kr(hu()),localStorage.setItem("l",jr()?"1":"0")}function bu(){Ir(!Ir()),Fr(pu()),localStorage.setItem("r",Ir()?"1":"0")}mu(),setTimeout(mu,100);var yu=function(){return null},wu=pn(yu);function Cu(){return _n("div",{onMouseDown:function(n){document.onmousemove=function(n){Kr(n.clientX+2)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,localStorage.setItem("w",Kr().toString())}},class:"dw"})}function ku(){return _n("div",{onMouseDown:function(n){document.onmousemove=function(n){Fr(document.documentElement.offsetWidth-n.clientX+2)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,localStorage.setItem("e",Fr().toString())}},class:"de"})}document.querySelector("body").append(function(){Ln("nochan",(function(){return wu(yu)})),Ln("rnclose",bu),Ln("lnclose",gu);return _n(Array.prototype,null,_n("div",{class:"ma",style:function(){return"left:"+(jr()&&window.innerWidth>650?Kr():0)+"px;right:"+(Ir()&&window.innerWidth>650?Fr():0)+"px"}},_n("div",{class:"n"},_n("div",null,_n("ol",{class:"bc"},(function(){return qt(Gt.paths,(function(n){return _n("li",null,_n("a",{onClick:function(){return function(n){n[0]===Gt.len()-1?wu()===ho?wu(yu):wu(ho):Gt.cd(n)}(n)}},n[2]))}))})),(function(){return Nn.id()?_n(Array.prototype,null,_n("div",{onClick:gu,class:"av mv"},_n("i",null,"☰")),_n("div",{onClick:bu,class:"av iv"},_n("i",null,"ⓘ")),_n("div",{onClick:function(n){return iu(n,Nn.id())},class:"av"},_n("i",null,"👨🏻‍💻"))):_n(Array.prototype,null,_n("div",{class:"u"},_n("a",{onClick:qi},"sign up")),_n("div",{class:"m"},_n("a",{onClick:Ri},"log in")))})),wu),uu),(function(){return jr()&&_n("div",{class:"ln",style:"width:"+Kr()+"px"},su,Cu)}),(function(){return Ir()&&_n("div",{class:"rn",style:"width:"+Fr()+"px"},vu,ku)}),(function(){return zr()>0&&_n("div",{class:"err"},Zr())}),(function(){return qr()&&_n("div",{class:"inf"},qr())}),(function(){return $r()&&_n("div",{id:"mod",class:"mod",onClick:function(){return $r(!1)}},_n("div",{class:"pop",onClick:function(n){return n.stopPropagation()}},Xr.content))}))}())}();
