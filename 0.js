!function(){"use strict";const e=[];function t(t){let n={};return function(){const i=e.slice.call(arguments),o=i.map((e=>{if(r(e)||Array.isArray(e)){let t={};for(let n in e)t[n]=a(e[n]);return t}return a(e)})),s=JSON.stringify(o);let l=n[s];return void 0===l&&(l=t.apply(this,i),l&&11===l.nodeType&&(l=e.slice.call(l.childNodes)),n[s]=l),l}}let n=0;function a(e){return"function"==typeof e||e instanceof Node?(e.$m||(e.$m=++n),{$m:e.$m}):e}function r(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function o(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var s,l,c=o((function(e,t){function n(e){var t=e>>3;return e%8!=0&&t++,t}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){void 0===e&&(e=0);var a=null==t?void 0:t.grow;this.grow=a&&isFinite(a)&&n(a)||a||0,this.buffer="number"==typeof e?new Uint8Array(n(e)):e}return e.prototype.get=function(e){var t=e>>3;return t<this.buffer.length&&!!(this.buffer[t]&128>>e%8)},e.prototype.set=function(e,t){void 0===t&&(t=!0);var n=e>>3;if(t){if(this.buffer.length<n+1){var a=Math.max(n+1,Math.min(2*this.buffer.length,this.grow));if(a<=this.grow){var r=new Uint8Array(a);r.set(this.buffer),this.buffer=r}}this.buffer[n]|=128>>e%8}else n<this.buffer.length&&(this.buffer[n]&=~(128>>e%8))},e.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=8*this.buffer.length);for(var a=t,r=a>>3,i=128>>a%8,o=this.buffer[r];a<n;a++)e(!!(o&i),a),i=1===i?(o=this.buffer[++r],128):i>>1},e}();t.default=a}(l={path:s,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&l.path)}},l.exports),l.exports));let u,d=[];function h(e){let t=u,n=()=>{};u=n,m(n);let a=e((()=>{p(n),u=void 0}));return u=t,a}function f(e){function t(n){if(0===arguments.length)return u&&!t.__o.has(u)&&(t.__o.add(u),u.u.push(t)),e;e=n;let a=u;return u=void 0,t.o=new Set(t.__o),t.o.forEach((e=>e.i=!1)),t.o.forEach((e=>{e.i||e()})),u=a,e}return t.$o=1,t.__o=new Set,t.t=d,t}function p(e){e.__c.forEach(p),e.u.forEach((t=>{t.__o.delete(e),t.o&&t.o.delete(e)})),e.l.forEach((e=>e())),m(e)}function m(e){e.u=[],e.__c=[],e.l=[]}const w=(e,t)=>e.reduce(((e,t)=>(e.set(t.id,t),e)),t),y=()=>window.scrollTo(0,document.body.scrollHeight),g=t((e=>t(((t,n)=>h((()=>e(t,n))))))),v=e=>(t,...n)=>()=>g(e())(t,n),b=(e,t)=>{let n=0,a=0;for(;n<e.length;)a>=t.length&&(a=0),e.set([e[n]^t[a]],n),n++,a++},C=(e,t)=>(b(e,t),S(e,t)),E=e=>{let{a:t,k:n}=L(e);return b(t,n),{a:t,k:n}},L=e=>{let t=e[0],n=e.subarray(1,t+1);return{a:e.subarray(t+1),k:n}},S=(e,t)=>{let n=new Uint8Array(1+t.length+e.length);return n[0]=t.length,n.set(t,1),n.set(e,1+t.length),n},U=(e,t)=>(e=Math.ceil(e),Math.floor(Math.random()*(Math.floor(t)-e)+e)),A=(e,t)=>{let n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n},T=(e,t=64,n=8)=>C(e,crypto.getRandomValues(new Uint8Array(U(n,t)))),x=()=>{let e,t=new Promise((t=>e=t));return{complete:t=>e(t),join:()=>t}},k=window.openDatabase?openDatabase("sonic","1.0","sonic",1073741824):{transaction:()=>{}};function N(e,t){}function O(e,t){}k.transaction((e=>{e.executeSql("CREATE TABLE IF NOT EXISTS users (\n            id integer NOT NULL PRIMARY KEY,\n            name varchar(50) NOT NULL,\n            email varchar(70) NOT NULL\n        )",[],N,O),e.executeSql("CREATE TABLE IF NOT EXISTS userchans (\n            id integer NOT NULL PRIMARY KEY\n        )",[],N,O),e.executeSql("CREATE TABLE IF NOT EXISTS chans (\n            id integer NOT NULL PRIMARY KEY,\n            name varchar(50) NOT NULL,\n            fullname varchar(150) NOT NULL,\n            mom integer NOT NULL,\n            by integer NOT NULL,\n            dir text NOT NULL,\n            ispub boolean NOT NULL DEFAULT '0',\n            isprv boolean NOT NULL DEFAULT '0',\n            timestamp datetime NOT NULL DEFAULT CURRENT_TIMESTAMP\n        )",[],N,O),e.executeSql("CREATE TABLE IF NOT EXISTS chats (\n            id integer NOT NULL PRIMARY KEY,\n            txt text NOT NULL,\n            html text,\n            by integer NOT NULL,\n            re integer NOT NULL,\n            nor integer NOT NULL DEFAULT '0',\n            userid integer NOT NULL,\n            chanid integer NOT NULL,\n            dir text NOT NULL,\n            status integer NOT NULL DEFAULT '0',\n            mailid integer,\n            timestamp datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            star boolean\n        )",[],N,O),e.executeSql("CREATE TABLE IF NOT EXISTS chanchats (\n            chanid integer NOT NULL,\n            chatid integer NOT NULL,\n            PRIMARY KEY (chanid, chatid)\n        )",[],N,O)}));const j=()=>{k.transaction((e=>{e.executeSql("SELECT * FROM sqlite_master WHERE type = 'table' AND name NOT LIKE '\\_%' escape '\\'",[],((e,t)=>{var n,a,r;function i(){}for(a=(n=t.rows).length;a--;)r=n.item(a).name,e.executeSql("DROP TABLE "+r,[],i,console.error)}),console.error)}))};window._qd=j,window._q=(e,t=[])=>{k.transaction((n=>{n.executeSql(e,t,((e,t)=>{}),console.error)}))};var D={date:"1/19/2021, 3:55:02 PM",build:"e0fb810",ver:"0.0.67"};const I=x(),M="sonic",R=["session","chats","users","chans","ranges","chanchats","updates"];let _;localStorage.getItem("_")!==D.ver&&(localStorage.setItem("_",D.ver),K(M),j()),window._d=()=>K(M);let P=indexedDB.open(M,1);function K(e){var t=window.indexedDB.deleteDatabase(e);t.onerror=e=>{},t.onsuccess=e=>{}}P.onsuccess=e=>{_=P.result,function(e){let t=e.objectStoreNames;for(const e of R)if(!t.contains(e))return void K(M)}(_),I.complete(_),P.open?P.open():P.open=!0},P.onerror=e=>{I.complete()},P.onblocked=e=>{},P.onupgradeneeded=e=>{_=P.result;let t=_.objectStoreNames;if(!t.contains("session")){_.createObjectStore("session")}if(!t.contains("ranges")){_.createObjectStore("ranges")}if(!t.contains("chats")){let e=_.createObjectStore("chats",{keyPath:"id"});e.createIndex("chanid",["chanid","id"],{unique:!1}),e.createIndex("re",["re","id"],{unique:!1}),e.createIndex("by",["by","id"],{unique:!1})}if(!t.contains("users")){_.createObjectStore("users",{keyPath:"id"})}if(!t.contains("chans")){_.createObjectStore("chans",{keyPath:"id"}).createIndex("mom",["mom","id"],{unique:!1})}if(!t.contains("chanchats")){_.createObjectStore("chanchats",{keyPath:["chanid","chatid"]})}if(!t.contains("chanchats")){_.createObjectStore("updates")}for(const e of R)_.objectStoreNames.contains(e)||_.createObjectStore(e)};const B=async(e,t)=>{let n=await I.join();n&&n.transaction(["session"],"readwrite").objectStore("session").put(t,e)},q=async()=>{let e=await I.join();e&&(e.transaction(["session"],"readwrite").objectStore("session").clear(),e.transaction(["chans"],"readwrite").objectStore("chans").clear(),e.transaction(["chats"],"readwrite").objectStore("chats").clear(),e.transaction(["chanchats"],"readwrite").objectStore("chanchats").clear(),e.transaction(["ranges"],"readwrite").objectStore("ranges").clear(),e.transaction(["updates"],"readwrite").objectStore("updates").clear(),e.transaction(["users"],"readwrite").objectStore("users").clear())},H=async(e,t)=>{let n=await I.join();if(!n)return;let a=n.transaction([e],"readwrite").objectStore(e);t.forEach((e=>{"string"==typeof e.timestamp&&(e.timestamp=new Date(e.timestamp)),a.put(e).onerror=console.error})),k.transaction((n=>{t.forEach((t=>{let a=Object.keys(t),r=`INSERT OR REPLACE INTO ${e} (${a.join(",")}) VALUES (${Array(a.length).fill("?").join(",")})`;n.executeSql(r,Object.values(t).map((e=>"function"==typeof e?e():e)),N,O)}))}))},F=async(...e)=>{let t=await I.join();t&&(await G(...e),function(e){let n=t.transaction(["chanchats"],"readwrite").objectStore("chanchats");e.forEach((e=>{let t=IDBKeyRange.bound([e],[e,Number.MAX_VALUE]);n.delete(t).onerror=console.error}))}(e),function(e){let n=t.transaction(["chats"],"readwrite").objectStore("chats"),a=n.index("chanid");e.forEach((e=>{let t=IDBKeyRange.bound([e],[e,Number.MAX_VALUE]);a.openCursor(t).onsuccess=e=>{var t=e.target.result;t&&(n.delete(t.primaryKey).onerror=console.error,t.continue())}}))}(e.filter((e=>e>0))))},$=async({id:e,dir:t})=>{let n=await I.join();if(!n)return;let a=[0,...t];!function(e,t){t.forEach((async t=>{let n=await X(t);n&&n.includes(e)&&G(t)}))}(e,a),function(e,t){let a=n.transaction(["chanchats"],"readwrite").objectStore("chanchats");t.forEach((t=>{let n=IDBKeyRange.only([t,e]);a.delete(n).onerror=console.error}))}(e,a),function(...e){let t=n.transaction(["chats"],"readwrite").objectStore("chats");e.forEach((e=>{t.delete(e).onerror=console.error}))}(e)},z=async(e,t)=>{let n=await I.join();n&&(n.transaction([e],"readwrite").objectStore(e).put(t).onerror=console.error,k.transaction((n=>{let a=Object.keys(t),r=`INSERT OR REPLACE INTO ${e} (${a.join(",")}) VALUES (${Array(a.length).fill("?").join(",")})`;n.executeSql(r,Object.values(t).map((e=>"function"==typeof e?e():e)),N,O)})))},V=async(e,t)=>{let n=await I.join();if(!n)return{value:[],missed:t};if(0===t.length)return{value:[],missed:[]};performance.now();let a=[],r=new Set,i=n.transaction([e],"readonly").objectStore(e),o=0;return new Promise((e=>{t.forEach((n=>{let s=i.get(n);s.onerror=console.error,s.onsuccess=i=>{if(s.result?a.push(s.result):r.add(n),++o===t.length){let t={value:a,missed:Array.from(r)};e(t)}}}))}))},Y=(e,t,n,a)=>{let r=n?IDBKeyRange.upperBound(n,a):null;if(!t)return[e,r];let i=n||Number.MAX_VALUE;switch(t.tag){case"Chanid":r=IDBKeyRange.bound([t.value],[t.value,i],!1,a)}return[e,r]},J=async(e,t,n=30,a=!0)=>(await(async(e,t,n,a,r,i,o)=>{let s=await I.join();if(!s)return;performance.now();let l=[],c=s.transaction([e],"readonly"),[u,d]=i?i(c.objectStore(e),t,a,r):[c.objectStore(e),null],h=0;return new Promise((e=>{u.openCursor(d,o).onsuccess=t=>{var a=t.target.result;if(a){if(l.push(a.value),++h===n)return e(l);a.continue()}else e(l)}}))})("chanchats",e,n,t,a,Y,"prev")).map((e=>e.chatid)),W=async(e,t,n)=>{let a=await I.join();if(!a)return;let r=a.transaction(["ranges"],"readwrite").objectStore("ranges"),i=r.get(e);i.onerror=console.error,i.onsuccess=async a=>{if(i.result){if(n)return r.put([i.result[0],i.result[1],n],e).onerror=console.error;t[0]<i.result[0]&&(t[0]=i.result[0]),t[1]>i.result[0]&&(t[1]=i.result[1])}r.put(t,e).onerror=console.error}},X=e=>Q(e,"ranges"),G=async(...e)=>{let t=await I.join();if(!t)return;let n=t.transaction(["ranges"],"readwrite").objectStore("ranges");e.forEach((e=>n.delete(e).onerror=console.error))},Z=e=>Q(e,"session"),Q=async(e,t)=>{let n=await I.join();if(!n)return;let a=n.transaction([t],"readonly").objectStore(t);return new Promise((t=>{let n=a.get(e);n.onerror=console.error,n.onsuccess=e=>t(n.result)}))},ee=async(e,t,n)=>{let a=await I.join();a&&a.transaction([e],"readwrite").objectStore(e).put(n,t)};var te,ne,ae;!function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Chanid=function(e){return{tag:"Chanid",value:e}}}(te||(te={})),function(e){e.ChatScan=function(e){return{tag:"ChatScan",value:e}},e.ChanScan=function(e){return{tag:"ChanScan",value:e}},e.AddChat=function(e){return{tag:"AddChat",value:e}},e.AddUser=function(e){return{tag:"AddUser",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.Logout=function(e){return{tag:"Logout",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Chans=function(e){return{tag:"Chans",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.ChanJoin=function(e){return{tag:"ChanJoin",value:e}},e.ChanLeave=function(e){return{tag:"ChanLeave",value:e}},e.ChanAdd=function(e){return{tag:"ChanAdd",value:e}},e.DelChat=function(e){return{tag:"DelChat",value:e}},e.DelChan=function(e){return{tag:"DelChan",value:e}},e.EditChat=function(e){return{tag:"EditChat",value:e}},e.Update=function(e){return{tag:"Update",value:e}},e.Sink=function(e){return{tag:"Sink",value:e}}}(ne||(ne={})),function(e){e.ChatScan=function(e){return{tag:"ChatScan",value:e}},e.ChanScan=function(e){return{tag:"ChanScan",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.Chans=function(e){return{tag:"Chans",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Chat=function(e){return{tag:"Chat",value:e}},e.Chan=function(e){return{tag:"Chan",value:e}},e.User=function(e){return{tag:"User",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.ChanJoin=function(e){return{tag:"ChanJoin",value:e}},e.DelChat=function(e){return{tag:"DelChat",value:e}},e.DelChan=function(e){return{tag:"DelChan",value:e}},e.EditChat=function(e){return{tag:"EditChat",value:e}},e.Update=function(e){return{tag:"Update",value:e}},e.Updates=function(e){return{tag:"Updates",value:e}},e.UserOn=function(e){return{tag:"UserOn",value:e}},e.UserOff=function(e){return{tag:"UserOff",value:e}},e.OnlineUsers=function(e){return{tag:"OnlineUsers",value:e}},e.Sink=function(e){return{tag:"Sink",value:e}}}(ae||(ae={}));const re=(e,t=0,n=!0)=>({pos:t,littleEndian:n,view:new DataView(e)}),ie=(e,t)=>{const{view:{buffer:n},pos:a}=e,r=n.byteLength;if(r-a>t)return e;const i=Math.max(2*r,r+t),o=new Uint8Array(i);return o.set(new Uint8Array(n)),re(o.buffer,a,e.littleEndian)},oe=(e,t)=>{e=ie(e,1);const{view:n,pos:a}=e;return n.setUint8(a,t),e.pos+=1,e},se=(e,t)=>{e=ie(e,4);const{view:n,pos:a,littleEndian:r}=e;return n.setUint32(a,t,r),e.pos+=4,e},le=(e,t)=>{e=ie(e,2);const{view:n,pos:a,littleEndian:r}=e;return n.setUint16(a,t,r),e.pos+=2,e};function ce(e,t){const{view:n,pos:a,littleEndian:r}=e;return n.setUint32(r?a:a+4,t,r),n.setUint32(r?a+4:a,0,r),e.pos+=8,e}const ue=(e,t)=>{e=ie(e,4);const{view:n,pos:a,littleEndian:r}=e;return n.setInt32(a,t,r),e.pos+=4,e},de=new TextEncoder,he="encodeInto"in de?(e,t)=>de.encodeInto(e,t).written:(e,t)=>{const n=de.encode(e);return t.set(n),n.length},fe=(e,t)=>{e=ie(e,3*t.length+8);const n=he(t,new Uint8Array(e.view.buffer,e.pos+8));return(e=ce(e,n)).pos+=n,e},pe=(e,t)=>oe(e,t?1:0),me=e=>(t,n)=>n.reduce(e,((e,t)=>ce(ie(e,8),t))(t,n.length)),we=e=>(t,n)=>null===n?oe(t,0):e(oe(t,1),n),ye=e=>{const{pos:t,view:n}=e;return e.pos+=1,n.getUint8(t)},ge=e=>{const{pos:t,view:n,littleEndian:a}=e;return e.pos+=2,n.getUint16(t,a)},ve=e=>{const{pos:t,view:n,littleEndian:a}=e;return e.pos+=4,n.getUint32(t,a)},be=e=>{const{view:t,pos:n,littleEndian:a}=e;return e.pos+=8,t.getUint32(a?n:n+4,a)},Ce=e=>{const{pos:t,view:n,littleEndian:a}=e;return e.pos+=4,n.getInt32(t,a)},Ee=e=>1===ye(e),Le=e=>t=>1===ye(t)?e(t):null,Se=e=>t=>{const n=be(t),a=new Array;for(let r=0;r<n;r++)a.push(e(t));return a},Ue=new TextDecoder,Ae=e=>{const t=be(e),{pos:n,view:{buffer:a}}=e,r=Ue.decode(new Uint8Array(a,n,t));return e.pos+=t,r};var Te=me(ue),xe=we(fe),ke=we(ue),Ne=we((function(e,t){switch(t.tag){case"Id":return ue(se(e,0),t.value);case"Chanid":return ue(se(e,1),t.value)}})),Oe=we(oe),je=me(oe),De=function(e,t){var n=t.id,a=t.txt,r=t.html,i=t.by,o=t.re,s=t.nor,l=t.userid,c=t.chanid,u=t.dir,d=t.status,h=t.mailid,f=t.timestamp;return fe(ke(le(Te(ue(ue(ue(ue(ue(xe(fe(ue(e,n),a),r),i),o),s),l),c),u),d),h),f)},Ie=me(De),Me=function(e,t){var n=t.id,a=t.name,r=t.fullname,i=t.mom,o=t.by,s=t.dir,l=t.ispub,c=t.isprv,u=t.timestamp;return fe(pe(pe(Te(ue(ue(fe(fe(ue(e,n),a),r),i),o),s),l),c),u)},Re=me(Me),_e=me((function(e,t){var n=t.id,a=t.name,r=t.email;return fe(fe(ue(e,n),a),r)})),Pe=(we(Te),we(De),we(Me),we((function(e,t){var n=t.id,a=t.name,r=t.email,i=t.emailverified,o=t.fullname,s=t.key,l=t.timestamp;return fe(fe(fe(pe(fe(fe(ue(e,n),a),r),i),o),s),l)})),we((function(e,t){var n=t.data,a=t.chans;return Te(je(e,n),a)})),me((function(e,t){var n=t.id,a=t.action,r=t.chatid,i=t.txt;return xe(ue(le(ue(e,n),a),r),i)})),we((function(e,t){var n=t.chats,a=t.chans,r=t.users;return _e(Re(Ie(e,n),a),r)})),function(e,t){var n=t.filter,a=t.kw,r=t.ub,i=t.lb,o=t.limit;return Oe(ke(ke(xe(Ne(e,n),a),r),i),o)}),Ke=function(e,t){var n=t.id,a=t.txt;return fe(ue(e,n),a)},Be=function(e,t){switch(t.tag){case"ChatScan":return Pe(se(e,0),t.value);case"ChanScan":return Pe(se(e,1),t.value);case"AddChat":return function(e,t){var n=t.txt,a=t.re,r=t.chname;return xe(ke(fe(e,n),a),r)}(se(e,2),t.value);case"AddUser":return function(e,t){var n=t.email,a=t.name,r=t.key;return je(fe(fe(e,n),a),r)}(se(e,3),t.value);case"Login":return function(e,t){var n=t.email,a=t.key;return je(fe(e,n),a)}(se(e,4),t.value);case"Logout":return je(se(e,5),t.value);case"Users":return Te(se(e,6),t.value);case"Chans":return Te(se(e,7),t.value);case"Chats":return Te(se(e,8),t.value);case"ChanJoin":return ue(se(e,9),t.value);case"ChanLeave":return ue(se(e,10),t.value);case"ChanAdd":return function(e,t){var n=t.id,a=t.email;return fe(ue(e,n),a)}(se(e,11),t.value);case"DelChat":return ue(se(e,12),t.value);case"DelChan":return ue(se(e,13),t.value);case"EditChat":return Ke(se(e,14),t.value);case"Update":return function(e,t){var n=t.id,a=t.chanid,r=t.chatid;return ue(ue(ue(e,n),a),r)}(se(e,15),t.value);case"Sink":return Pe(se(e,16),t.value)}},qe=Se(Ce),He=Le(Ae),Fe=Le(Ce),$e=(Le((function(e){switch(ve(e)){case 0:return te.Id(Ce(e));case 1:return te.Chanid(Ce(e))}throw new Error("bad variant index for Filter")})),Le(ye),Se(ye)),ze=function(e){return{id:Ce(e),txt:Ae(e),html:He(e),by:Ce(e),re:Ce(e),nor:Ce(e),userid:Ce(e),chanid:Ce(e),dir:qe(e),status:ge(e),mailid:Fe(e),timestamp:Ae(e)}},Ve=Se(ze),Ye=function(e){return{id:Ce(e),name:Ae(e),fullname:Ae(e),mom:Ce(e),by:Ce(e),dir:qe(e),ispub:Ee(e),isprv:Ee(e),timestamp:Ae(e)}},Je=Se(Ye),We=Se((function(e){return{id:Ce(e),name:Ae(e),email:Ae(e)}})),Xe=Le(qe),Ge=Le(ze),Ze=Le(Ye),Qe=Le((function(e){return{id:Ce(e),name:Ae(e),email:Ae(e),emailverified:Ee(e),fullname:Ae(e),key:Ae(e),timestamp:Ae(e)}})),et=Le((function(e){return{data:$e(e),chans:qe(e)}})),tt=Se((function(e){return{id:Ce(e),action:ge(e),chatid:Ce(e),txt:He(e)}})),nt=Le((function(e){return{chats:Ve(e),chans:Je(e),users:We(e)}})),at=function(e){return{id:Ce(e),txt:Ae(e)}},rt=function(e){switch(ve(e)){case 0:return ae.ChatScan(Xe(e));case 1:return ae.ChanScan(Xe(e));case 2:return ae.Chats(Ve(e));case 3:return ae.Chans(Je(e));case 4:return ae.Users(We(e));case 5:return ae.Chat(Ge(e));case 6:return ae.Chan(Ze(e));case 7:return ae.User(Qe(e));case 8:return ae.Login(et(e));case 9:return ae.ChanJoin(Fe(e));case 10:return ae.DelChat(Ce(e));case 11:return ae.DelChan(Ce(e));case 12:return ae.EditChat(at(e));case 13:return ae.Update(Ce(e));case 14:return ae.Updates(tt(e));case 15:return ae.UserOn(Ce(e));case 16:return ae.UserOff(Ce(e));case 17:return ae.OnlineUsers(qe(e));case 18:return ae.Sink(nt(e))}throw new Error("bad variant index for Response")},it=re(new ArrayBuffer(512)),ot=function(e,t){return it.pos=0,it=t(it,e),new Uint8Array(it.view.buffer).slice(0,it.pos)},st=function(e,t){return t(re(e))},lt=function(e){return st(e.buffer,rt)},ct=function(e){return ot(e,Be)};const ut=e=>new Zlib.Inflate(e).decompress(),dt=e=>new Zlib.Deflate(e).compress(),ht=async(e,t,n)=>await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e),ft=async(e,t,n)=>await crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,e);let pt={},mt=[];function wt(e){return this.t&&this.t[e.type](e)}pt.h=(...e)=>{let t,n=a=>{if(null==a);else if("string"==typeof a)t?pt.add(t,a):t=pt.s?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a);else if(Array.isArray(a))t||(t=document.createDocumentFragment()),a.forEach(n);else if(a instanceof Node)t?pt.add(t,a):t=a;else if("object"==typeof a)pt.property(t,a,null,pt.s);else if("function"==typeof a)if(t){let e=pt.add(t,"");pt.insert(t,a,e)}else t=a.apply(null,e.splice(1));else pt.add(t,""+a)};return e.forEach(n),t},pt.insert=(e,t,n,a,r)=>(e=n&&n.parentNode||e,r=r||a instanceof Node&&a,t===a||(a&&"string"!=typeof a||!("string"==typeof t||"number"==typeof t&&(t+=""))?"function"==typeof t?pt.subscribe((()=>{a=pt.insert(e,t.call({el:e,endMark:n}),n,a,r)})):(n?a&&(r||(r=a.o&&a.o.nextSibling||n.previousSibling),pt.rm(e,r,n)):e.textContent="",a=null,t&&!0!==t&&(a=pt.add(e,t,n))):(null!=a&&e.firstChild?n?(n.previousSibling||e.lastChild).data=t:e.firstChild.data=t:n?pt.add(e,t,n):e.textContent=t,a=t)),a),pt.property=(e,t,n,a,r)=>{if(null!=t)if(!n||"attrs"===n&&(a=!0))for(n in t)pt.property(e,t[n],n,a,r);else"o"!==n[0]||"n"!==n[1]||t.$o?"function"==typeof t?pt.subscribe((()=>{pt.property(e,t.call({el:e,name:n}),n,a,r)})):r?e.style.setProperty(n,t):a||"data-"===n.slice(0,5)||"aria-"===n.slice(0,5)?e.setAttribute(n,t):"style"===n?"string"==typeof t?e.style.cssText=t:pt.property(e,t,null,a,!0):("class"===n&&(n+="Name"),e[n]=t):((e,t,n)=>{t=t.slice(2).toLowerCase(),n?e.addEventListener(t,wt):e.removeEventListener(t,wt),(e.t||(e.t={}))[t]=n})(e,n,t)},pt.add=(e,t,n)=>{let a=(e=>{const{childNodes:t}=e;if(t&&11===e.nodeType)return t.length<2?t[0]:{o:pt.add(e,"",t[0])}})(t=(e=>"string"==typeof e?document.createTextNode(e):e instanceof Node?e:pt.h(mt,e))(t))||t;return e.insertBefore(t,n&&n.parentNode&&n),a},pt.rm=(e,t,n)=>{for(;t&&t!==n;){let n=t.nextSibling;e===t.parentNode&&e.removeChild(t),t=n}},pt.subscribe=function(e){return function(e,t){function n(){let a=u;return u&&u.__c.push(n),p(n),n.i=!0,u=n,t=e(t),u=a,t}function a(){return n.i?u&&n.u.forEach((e=>e())):t=n(),t}e.s=n,m(n),n(),a.$o=1}(e),()=>p(e.s)},pt.cleanup=function(e){return u&&u.l.push(e),e},pt.root=h,pt.sample=function(e){let t=u;u=void 0;let n=e();return u=t,n},pt.hs=(...e)=>{let t=pt.s;pt.s=!0;let n=yt(...e);return pt.s=t,n};let yt=(...e)=>pt.h.apply(pt.h,e);const gt=new Map,vt=(e,t,n=!1)=>{let a=gt.get(e)||[];n?a=[t]:a.push(t),gt.set(e,a)},bt=(e,t)=>gt.has(e)?gt.get(e).forEach((e=>e(t))):void 0,Ct={},Et=e=>(e&&(Object.assign(Ct,e),bt("config",Ct)),Ct),Lt=f(void 0),St={id:f(0),name:f(""),chans:f([])};async function Ut(){let e=await Z("a");if(!e||e.byteLength<53)return;let t=new Uint8Array(e,0,16),n=new Uint8Array(e,16,32);t&&16===t.length&&(St.salt=t),n&&32===n.length&&(St.sskey=await crypto.subtle.importKey("raw",n,"AES-GCM",!1,["encrypt","decrypt"]));let a=new Uint8Array(e,48,4),r=new Uint8Array(e,52),i=new DataView(a.buffer).getInt32(48,!1),o=(new TextDecoder).decode(r);i&&o&&(St.id(i),St.name(o));let s=await Z("c");return s&&s instanceof Array&&St.chans(s),St.salt}async function At(e,t){let n=new TextEncoder,a=await Tt(n.encode(e),n.encode(t));return await crypto.subtle.exportKey("raw",a)}async function Tt(e,t){let n=await crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}const xt=document.location.hash.substr(1).match(/^ip\/(?<ip>[\:\.\d]+)$/),kt=xt?xt.groups.ip:"mx.hyze.io:443";let Nt="wss://"+kt;window._ws=e=>(e&&("string"==typeof e&&(Nt="wss://"+e),Yt(!0)),Nt),window._ws=()=>jt,window._pc=()=>Rt,window._dc=()=>qt;let Ot,jt,Dt,It,Mt,Rt,_t,Pt,Kt,Bt,qt,Ht=500,Ft=0,$t=new Set,zt={recv:e=>$t.add(e)};Yt(),Jt();const Vt=x();function Yt(e){Ot=performance.now(),jt=new WebSocket(Nt),jt.binaryType="arraybuffer",jt.onopen=()=>{e?Jt():Mt&&Zt()},jt.onmessage=async e=>{let t=new Uint8Array(e.data),{a:n,k:a}=E(t);Et((e=>{const t=new c(e);return{z:t.get(0),m:t.get(1),c:t.get(2),d:t.get(3)}})(n));var r,i,o;a=await(r=a,crypto.subtle.importKey("raw",r,{name:"ECDH",namedCurve:"P-256"},!0,[])),Bt=await(i=It.privateKey,o=a,crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:o},i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])),Kt=new Uint8Array(await crypto.subtle.exportKey("raw",Bt));let s=JSON.parse((e=>(new TextDecoder).decode(ut(e)))(n.slice(1))),l=s.answer?s.answer:s;if(await Rt.setRemoteDescription(new RTCSessionDescription(l)),s.candidates)for(const e of s.candidates){const t=new RTCIceCandidate({candidate:e,sdpMid:0,sdpMLineIndex:0});await Rt.addIceCandidate(t)}if(!s.candidate)return;const u=new RTCIceCandidate({candidate:s.candidate,sdpMid:0,sdpMLineIndex:0});await Rt.addIceCandidate(u)},jt.onclose=e=>{Ft++,Ht+=U(0,Ft<16?200:3e3),setTimeout((()=>{Yt(!0)}),Ht)},jt.onerror=e=>{}}function Jt(){_t=!1,Rt=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]}),Rt.onicecandidate=e=>{e.candidate},Rt.onconnectionstatechange=e=>{Rt.connectionState},Rt.oniceconnectionstatechange=e=>{Rt.iceConnectionState},qt=Rt.createDataChannel("cu",{}),qt.binaryType="arraybuffer",zt.send=Wt,qt.onopen=e=>{Vt.complete(qt)},qt.onmessage=Gt,qt.onclose=e=>{},qt.onerror=e=>{},async function(){const e=async()=>{let e=await Rt.createOffer();return await Rt.setLocalDescription(e),dt((new TextEncoder).encode(Rt.localDescription.sdp))},t=async()=>{if(Pt)return Pt;It=await(async()=>await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"]))();let e=await crypto.subtle.exportKey("raw",It.publicKey);return Pt=new Uint8Array(e),Pt};Mt=await(async(e,t,n)=>{let[a,r,i]=await Promise.all([e(),t(),n()]);return i?C(C(a,r),i):T(C(a,r),64,24)})(e,t,Ut),1===jt.readyState&&Zt()}()}async function Wt(e){await Vt.join(),(e=>{e.length||e.byteLength})(e=ct(e));let{z:t,m:n,c:a,d:r}=Et();if(t&&(e=dt(e)),n&&(e=T(e,e.length),b(e,Kt)),a){const t=crypto.getRandomValues(new Uint8Array(12));b(e,t),e=A(t,new Uint8Array(await ht(e,Bt,t)))}if(r){const t=crypto.getRandomValues(new Uint8Array(12));b(e,t),e=A(t,new Uint8Array(await ht(e,St.sskey,t)))}qt.send(e),Dt=performance.now()}let Xt;async function Gt(e){let t=new Uint8Array(e.data),n=t.length,a=new DataView(t.buffer).getUint16(0,!1);if(a>0){if(1===a){let e=new DataView(t.buffer).getUint32(2,!1);t=t.subarray(6),Xt={size:e,offset:0,data:new Uint8Array(e)}}else t=t.subarray(2);if(Xt.data.set(t,Xt.offset),Xt.offset+=t.length,Xt.offset!==Xt.size)return;t=Xt.data,Xt=null}else t=t.subarray(2);n=t.length;let{z:r,m:i,c:o,d:s}=Et();if(s){let e=t.subarray(0,12);t=new Uint8Array(await ft(t.subarray(12),St.sskey,e)),b(t,e)}if(o){let e=t.subarray(0,12);t=new Uint8Array(await ft(t.subarray(12),Bt,e)),b(t,e)}if(i){b(t,Kt);let{a:e}=E(t);t=new Uint8Array(e)}r&&(t=ut(t));(100*n/t.length).toFixed(2);let l=Qt(t);$t.forEach((e=>e(l)))}const Zt=()=>{_t||(jt.send(Mt),_t=!0)},Qt=e=>lt(e);function en(e,t,n){const{root:a,subscribe:r,sample:i,cleanup:o}=pt;null==n&&(n=!t.$t);let s=pt.h([]),l=pt.add(s,""),c=new Map,u=new Map,d=new Set;function h(e,r){if(null==e)return;let i=u.get(e);return 1===r?(d.delete(e),i||(i=n?a((n=>(c.set(e,n),t(e.$v||e)))):t(e.$v||e),11===i.nodeType&&(i=(e=>{const{childNodes:t}=e,{length:n}=t;if(n<2)return t[0];let a=Array.from(t);return{nodeType:111,t:a[0],o:a[n-1],l(){if(t.length!==n){let t=0;for(;t<n;)e.appendChild(a[t++])}return e}}})(i)||i),u.set(e,i))):-1===r&&d.add(e),((e,t)=>111===e.nodeType?1/t<0?t?pt.rm(e.t.parentNode,e.t.nextSibling,e.o.nextSibling)||e.t:e.o:t?e.l():e.t:e)(i,r)}function f(e){let t=c.get(e);t&&(t(),c.delete(e)),u.delete(e)}return o(r((t=>{let n=e();return i((()=>{d.clear();let e=Array.from(function(e,t,n,a,r){let i,o,s=new Map,l=new Map;for(i=0;i<t.length;i++)s.set(t[i],i);for(i=0;i<n.length;i++)l.set(n[i],i);for(i=o=0;i!==t.length||o!==n.length;){var c=t[i],u=n[o];if(null===c)i++;else if(n.length<=o)e.removeChild(a(t[i],-1)),i++;else if(t.length<=i)e.insertBefore(a(u,1),a(t[i],0)||r),o++;else if(c===u)i++,o++;else{var d=l.get(c),h=s.get(u);void 0===d?(e.removeChild(a(t[i],-1)),i++):void 0===h?(e.insertBefore(a(u,1),a(t[i],0)||r),o++):(e.insertBefore(a(t[h],1),a(t[i],0)||r),t[h]=null,h>i+1&&i++,o++)}}return n}(l.parentNode,t||[],n,h,l));return d.forEach(f),e}))}))),o((function(){c.forEach((e=>e())),c.clear(),u.clear(),d.clear()})),s}window._b=zt;const tn="0VMZYpdgCGL3iKAzDHwocTt97e1hasO2mJNjExq4PvR6XyWSFbIn-5B_8fUukQlr",nn=tn.split(""),an=new Array(123);for(let e=0;e<tn.length;e++)an[tn.charCodeAt(e)]=e;const rn=e=>{if(e<0)return"-"+rn(-e);let t=e>>>0,n=e/4294967296>>>0,a="";for(;n>0;)a=nn[63&t]+a,t>>>=6,t|=(63&n)<<26,n>>>=6;let r="";do{r=nn[63&t]+r,t>>>=6}while(t>0);return r+a};var on={ntob:rn,bton:e=>{let t=0;for(let n=0;n<e.length;n++)t=64*t+an[e.charCodeAt(n)];return t}};const sn=[0,null,"â›©",0],ln=(()=>{let e=f(sn);const t=f([e]),n=t=>e(t);return{path:t=>e()[t],paths:t,len:()=>t().length,setpath:n,same:t=>t===e(),cd:e=>{let a=t();a[e[0]]!==e&&(a[e[0]]=e),a.splice(e[0]+1),t(a),n(e),location.hash=e[0]>0?on.ntob(e[3]):""},update:e=>{t([sn,...e]),n(e[e.length-1]||sn)}}})(),cn=[];function un(){!function(e){for(const t of cn)t(e)}(document.location.hash.substr(1))}window.addEventListener("hashchange",un),setTimeout(un);const dn=30,hn=new Map,fn=new Map,pn=new Map,mn=e=>(t,n)=>{if(!t)return e;let a=e.get(t);return n?a?a[n]:void 0:a},wn=f([]),yn=f([]),gn=f(0),vn=f(0),bn=f(0),Cn=f(0),En=f(""),Ln=f(""),Sn=f(!1),Un=f(!1),An=mn(hn),Tn=mn(fn),xn=mn(pn),kn=(()=>{const e={},t={};return{create:n=>t[n]=new Promise((t=>e[n]=t)),complete:(t,n)=>e[t]?e[t](n):null,join:e=>t[e],joinall:(...e)=>Promise.all(e.map((e=>t[e]))),select:(...e)=>Promise.race(e.map((e=>t[e])))}})();async function Nn(e){let t=e||[],n=gn();if(0===t.length)return Sn(!0),W(n,null,!0),void kn.complete("chatscan",t);Sn(!1),W(n,[t[0],t[t.length-1]]);let a=t.map((e=>({chanid:n,chatid:e})));H("chanchats",a),kn.complete("chatscan",t)}zt.recv((async e=>{switch(e.tag){case"Sink":if(!e.value)return;w(e.value.chats,Tn()),w(e.value.users,xn()),w(e.value.chans,An()),H("chats",e.value.chats),H("chans",e.value.chans),H("users",e.value.users),Nn(e.value.chats.map((e=>e.id)).reverse());break;case"Update":ee("updates",gn(),e.value);break;case"Updates":kn.complete("updates",e.value);break;case"Login":if(!e.value)return Lt(void 0),void bt("login",!1);await async function({data:e,chans:t}){let n=new Uint8Array(e.slice(16,20)),a=new Uint8Array(e.slice(20)),r=new DataView(n.buffer).getInt32(0,!1),i=(new TextDecoder).decode(a);St.id(r),St.name(i),St.chans(t),St.salt=new Uint8Array(e.slice(0,16)),St.sskey=await Tt(Lt(),St.salt),Lt(void 0);let o=new Uint8Array(await crypto.subtle.exportKey("raw",St.sskey)),s=St.salt.length,l=new Uint8Array(s+o.length+n.length+a.length);l.set(St.salt),l.set(o,s),l.set(n,s+o.length),l.set(a,s+o.length+n.length),B("a",l.buffer),Et({d:!0}),B("c",t),z("users",{id:r,name:i})}(e.value),bt("login",!0);break;case"Users":H("users",e.value),kn.complete("users",e.value);break;case"Chans":H("chans",e.value),kn.complete("chans",e.value);break;case"Chat":let t=yn();if(t.includes(e.value.id))return;let n=window.scrollY+window.innerHeight===document.body.scrollHeight;await z("chats",e.value);let a=new Set(xn().has(e.value.by)?[]:[e.value.by]),r=e.value.dir.filter((e=>!An(e))),i=new Set(r);await In(a,i),e.value.nor=f(0),e.value.star=f(!1),e.value.txt=f(e.value.txt),Tn().set(e.value.id,e.value),t.push(e.value.id),yn(t),n&&y();let o=St.chans();if(o.includes(e.value.chanid))return;o.push(e.value.chanid),St.chans(o),await B("c",o);break;case"Chats":e.value.length>0&&H("chats",e.value),kn.complete("chats",e.value);break;case"ChatScan":Nn(e.value);break;case"ChanScan":let s=e.value||[];s.length>0?(Un(!1),await Rn(s)):Un(!0),kn.complete("chanscan",s);break;case"ChanJoin":kn.complete("chanjoin",e.value);break;case"DelChat":Fn(e.value);break;case"EditChat":let{id:l,txt:c}=e.value,u=Tn(l);u&&u.txt(c),u=await Q(l,"chats"),u&&(u.txt=c,await z("chats",u))}}));const On="/"+tn;(e=>{cn.push(e)})((async e=>{if(!e||!On.includes(e[0]))return gn(0),Mn([]),document.title="hyze",Hn(),void(document.getElementsByClassName("tbl").length>0&&Bn(0));if("/"===e[0]){let t=on.bton(e.slice(1));vn(t),await Dn([t]),Hn();let n=Tn(t).dir;return await Rn(n),Mn(n),void(document.title=An(gn(),"fullname")+" - hyze")}let t=on.bton(e);if(gn(t),Hn(),await Rn([t]),!An(t))return;let n=An(t).dir;await Rn(n),Mn([...n,t]),document.getElementsByClassName("tbl").length>0&&Bn(ln.path(3)),document.title=An(gn(),"fullname")+" - hyze"}));const jn=async(e,t=null)=>{await Dn(e);let n=e[0],a=new Set,r=new Set,i=yn(),o=new Set;switch(e.forEach((e=>{let t=Tn(e);"function"!=typeof t.txt&&(t.txt=f(t.txt),t.nor=f(t.nor),t.star=f(!1)),"string"==typeof t.timestamp&&(t.timestamp=new Date(t.timestamp)),xn().has(t.by)||a.add(t.by),t.dir.forEach((e=>{An().has(e)||r.add(e)})),o.has(e),o.add(e)})),await In(a,r),e.reverse(),t){case"re":yn(e);break;case"pre":yn(i.concat(e));break;default:yn(e.concat(i))}o=new Set,yn().forEach((e=>{o.has(e),o.add(e)})),n&&bt("keysloaded",n)},Dn=async e=>{if(0===(e=e.filter((e=>!Tn().has(e)))).length)return;let{value:t,missed:n}=await V("chats",e);if(w(t,Tn()),n.length>0){let e=await kn.create("chats",zt.send(ne.Chats(n)));w(e,Tn())}},In=async(e,t)=>{let n=await V("users",Array.from(e)),a=await V("chans",Array.from(t));w(n.value,xn()),w(a.value,An()),n.missed.length>0&&kn.create("users",zt.send(ne.Users(n.missed))),a.missed.length>0&&kn.create("chans",zt.send(ne.Chans(a.missed)));let[r,i]=await kn.joinall("users","chans");r&&w(r,xn()),i&&w(i,An())},Mn=e=>{let t=e.map(((e,t)=>{let n=An(e)||{};return[t+1,n.mom,n.fullname,e]}));ln.update(t)},Rn=async e=>{if(0===(e=e.filter((e=>!An().has(e)))).length)return;let{value:t,missed:n}=await V("chans",e);if(w(t,An()),n.length>0){let e=await kn.create("chans",zt.send(ne.Chans(n)));w(e,An())}};let _n=null;const Pn=async(e,t=null,n=null)=>{performance.now();let a=await((e,t=null,n=null,a=null,r=null)=>{t&&Ln(t);let i=ne.ChanScan({filter:Kn(e),kw:t,ub:n,lb:a,limit:r});return kn.create("chanscan",zt.send(i))})(e,t,n);n?0===a.length||wn(wn().concat(a)):(0!==a.length||t||bt("nochan"),wn(a))},Kn=e=>(_n=e,"number"==typeof e?te.Chanid(e):null),Bn=async e=>{_n!==e&&Pn(e)},qn=(e=null,t=null,n=null)=>{let a=ne.Sink({filter:vn()>0?te.Id(vn()):gn()>0?te.Chanid(gn()):null,kw:null,ub:e,lb:t,limit:n});return kn.create("chatscan",zt.send(a))};async function Hn(){Sn(!1),Cn(!1),bn(0);let e=gn();performance.now();let t=await X(e)||[],n=t[0]||null,a=await J(te.Chanid(e),null,dn);await jn(a,"re"),Cn(!0),bt("reloaded"),t[1]&&async function(e,t){let n=await Q(e,"updates");zt.send(ne.Update({id:n,chanid:e,chatid:t}));let a=await kn.create("updates");if(!a||0===a.length)return;let r=new Set([e]);for(const{action:e,chatid:t,txt:n}of a){let a=await Q(t,"chats");switch(a&&a.dir.forEach((e=>r.add(e))),e){case 2:a&&(a.txt=n,await z("chats",a)),a=Tn(t),a&&n&&a.txt(n);break;case 3:a&&await $(a),a=Tn(t),a&&fn.delete(t);let e=yn(),r=e.indexOf(t);r>-1&&(e.splice(r,1),yn(e))}}r.forEach((e=>ee("updates",e,a[0].id)))}(e,t[1]);let r=await qn(null,n)||[];await jn(r,r.length!==dn&&0!==a.length&&n?"pre":"re"),bt("reloaded")}async function Fn(e){let t=Tn(e);t&&fn.delete(e),t=await Q(e,"chats"),t&&await $(t);let n=yn(),a=n.indexOf(e);a>-1&&(n.splice(a,1),yn(n))}window._chn=()=>Array.from(hn.values()),window._ch=()=>Array.from(fn.values()),window._us=()=>Array.from(pn.values()),window._chns=()=>wn().map((e=>hn.get(e))),window._chs=()=>yn().map((e=>fn.get(e))),window._chnid=gn,window._chid=vn,window._curid=bn,window._curtxt=En,window._chnkw=Ln;const $n=()=>{const e=document.createElement("div");e.contentEditable=!0,e.className="s-c",e.oninput=({target:{firstChild:t}})=>{var n,a,r,i;(n=function(){let t=e.textContent;var n;t.length>50||(n=t,Pn(ln.path(3),n))},a=100,function(){var e=this,t=arguments,o=function(){i=null,r||n.apply(e,t)},s=r&&!i;clearTimeout(i),i=setTimeout(o,a),s&&n.apply(e,t)})()},e.onkeydown=e=>{"Enter"!==e.key||e.shiftKey||e.preventDefault()};const t=(e,t)=>{if(e.stopPropagation(),!St.id())return alert("you are not login!");St.chans().includes(t)?(async e=>{performance.now();let t=await kn.create("chanjoin",zt.send(ne.ChanLeave(e)));if(!t)return;let n=St.chans();if(!n.includes(t))return;const a=n.indexOf(t);a>-1&&n.splice(a,1),St.chans(n),await B("c",n),await F(0,e),Hn()})(t):(async e=>{performance.now();let t=await kn.create("chanjoin",zt.send(ne.ChanJoin(e)));if(!t)return;let n=St.chans();n.includes(t)||(n.push(t),St.chans(n),await B("c",n),await F(0),Hn())})(t)},n=(e,t)=>{e.stopPropagation();const n=window.prompt("Enter email to add").trim();n&&(async(e,t)=>{zt.send(ne.ChanAdd({id:e,email:t}))})(t,n)};let a=yt("div",null);setTimeout((function(){new IntersectionObserver((t=>{if(t[0].intersectionRatio<=0)return;let n=wn(),a=n[n.length-1];if(!a||Un()||n.length<dn)return;let r=e.textContent||null;r&&r.length>50||setTimeout((()=>Pn(ln.path(3),r,a)))}),{}).observe(a)}));return yt([yt("div",{class:"s"},e),yt("div",{class:"tbl"},yt("table",null,yt("tbody",null,en(wn,(e=>{let a=An(e);return yt("tr",{onclick:()=>(async({id:e,mom:t,name:n})=>{await Pn(e),ln.cd([ln.path(0)+1,t,n,e])})(a)},yt("td",null,yt("button",{onclick:n=>t(n,e)},(()=>St.chans().includes(e)?"âœ…":"âž•"))),yt("td",null,a.fullname),yt("td",null,yt("button",{onclick:t=>n(t,e)},"ðŸ‘¤âž•")))})),(()=>wn().length>0?null:yt("tr",null,yt("td",null,"no result"))),a))),yt("div",{class:"grid"},yt("div",{class:"container"},yt("ol",{class:"bc"},yt("li",null,yt("a",null,"#")," ",yt("a",null,(()=>ln.path(2)))))))])};let zn;async function Vn(){await zt.send(ne.Logout(Array.from(St.salt))),await q(),Et({d:!1}),St.id(0),St.name(""),St.chans([]),St.sskey=void 0,St.salt=void 0,location.hash="",Hn(),Pn(ln.path(3)),bt("logout")}vt("config",(({d:e})=>Xn(e?Wn:Jn))),vt("login",(e=>{e&&(Hn(),Pn(ln.path(3)))}));const Yn=()=>yt("div",{class:"login"},yt(v(Xn),null),yt("div",{class:"v"},D.ver," ",D.build)),Jn=()=>yt([yt("h2",null,"Login"),yt("form",{onsubmit:function(e){e.preventDefault();let{m:t,p:n}=e.target;!async function(e,t){zn=performance.now(),await q();let n=await At(t,e),a={email:e,key:Array.from(new Uint8Array(n))};Lt(n),zt.send(ne.Login(a))}(t.value,n.value)}},yt("input",{type:"text",name:"m",placeholder:"email",required:!0,autocomplete:"true"}),yt("input",{type:"password",name:"p",placeholder:"password",required:!0,autocomplete:"true"}),yt("button",{type:"submit"},"Login")),yt("h2",null,"Register"),yt("form",{onsubmit:function(e){e.preventDefault();let{m:t,n:n,p:a}=e.target;!async function(e,t,n){zn=performance.now(),await q();let a=await At(n,e),r={email:e,name:t,key:Array.from(new Uint8Array(a))};Lt(a),zt.send(ne.AddUser(r))}(t.value,n.value,a.value)}},yt("input",{type:"text",name:"m",placeholder:"email",required:!0,autocomplete:"true"}),yt("input",{type:"text",name:"n",placeholder:"name",required:!0,autocomplete:"true"}),yt("input",{type:"password",name:"p",placeholder:"password",required:!0,autocomplete:"true"}),yt("button",{type:"submit"},"Register"))]),Wn=()=>yt([yt("div",null,"You have logged in as ",yt("b",null,St.name)),yt("button",{onclick:Vn},"Logout")]),Xn=f((()=>null));window._v=()=>D;const Gn="defaultParagraphSeparator",Zn="formatBlock",Qn=(e,t,n)=>e.addEventListener(t,n),ea=(e,t)=>e.appendChild(t),ta=e=>document.createElement(e),na=e=>document.queryCommandState(e),aa=(e,t=null)=>document.execCommand(e,!1,t),ra=e=>{const t=document.createElement("div"),n=t.attachShadow({mode:"open"});var a=document.createElement("style");a.innerHTML="iframe { border: none; width: 100%; margin: 0;height: 1px}",n.appendChild(a);var r=yt("iframe",{src:"about:blank",frameborder:"0",scrolling:"no",onload:()=>function(e,t){e.contentWindow.document.write(t);var n=document.createElement("base");n.target="_blank",e.contentWindow.document.documentElement.appendChild(n);var a=document.createElement("style");a.innerHTML="html {font-family: -apple-system, BlinkMacSystemFont, sans-serif;font-size:85%;line-height: 1.5}\n    code {font-family: Menlo,SFMono-Regular,Consolas,Liberation Mono,Courier,monospace;font-size:87%; background:#eee; padding: .2em .4em;border-radius:5px}\n    table {height: unset !important;max-width:100vw}\n    td {max-width:100vw}\n    img {max-width:100vw;object-fit: contain !important}\n    img:not([width]):not([height]) {min-width:1px;min-height:1px}\n    img:not([width]):not([height]),\n    video:not([width]):not([height]) {max-width: 100vw;object-fit: contain !important}\n    ",e.contentWindow.document.documentElement.appendChild(a),ia(e),setTimeout((()=>ia(e)),100),setTimeout((()=>ia(e)),1e3)}(r,e)});return n.appendChild(r),t};function ia(e){let t=e.contentWindow.document.documentElement.scrollHeight;e.style.height=t+"px"}const oa={bold:{icon:"<b>B</b>",title:"Bold",state:()=>na("bold"),result:()=>aa("bold")},italic:{icon:"<i>I</i>",title:"Italic",state:()=>na("italic"),result:()=>aa("italic")},underline:{icon:"<u>U</u>",title:"Underline",state:()=>na("underline"),result:()=>aa("underline")},strikethrough:{icon:"<strike>S</strike>",title:"Strike-through",state:()=>na("strikeThrough"),result:()=>aa("strikeThrough")},heading1:{icon:"<b>H1</b>",title:"Heading 1",result:()=>aa(Zn,"<h1>")},heading2:{icon:"<b>H2</b>",title:"Heading 2",result:()=>aa(Zn,"<h2>")},quote:{icon:"&#8220;&#8221;",title:"Quote",result:()=>aa(Zn,"<blockquote>")},olist:{icon:"1.",title:"Ordered List",result:()=>aa("insertOrderedList")},ulist:{icon:"&#8226;",title:"Unordered List",result:()=>aa("insertUnorderedList")},code:{icon:"&lt;&gt;",title:"Code",result:()=>aa(Zn,"<pre>")},line:{icon:"&#8213;",title:"Horizontal Line",result:()=>aa("insertHorizontalRule")},link:{icon:"&#128279;",title:"Link",result:()=>{const e=window.prompt("Enter the link URL");e&&aa("createLink",e)}},image:{icon:"&#128247;",title:"Image",result:()=>{const e=window.prompt("Enter the image URL");e&&aa("insertImage",e)}}},sa={actionbar:"e-a",button:"e-b",content:"e-c",selected:"e-bs",topic:"e-t"};function la(){return window.scrollY+window.innerHeight===document.body.scrollHeight}const ca=({topic:e,content:t})=>{if(!St.id())return alert("you are not login!");if(!t.textContent.trim())return;let n=bn()||yn()[yn().length-1]||null,a=null;if(e.textContent!==En()){if(a=e.textContent,0===a.trim().length)return alert("topic should not be empty"),!1;n=null}let r=t.innerHTML.trim();zt.send(ne.AddChat({txt:r,re:n,chname:a})),t.textContent="",ua({},{topic:e})},ua=({id:e,txt:t},{topic:n})=>{if(!e||bn()===e)return n.textContent="",En(""),void bn(0);n.innerHTML=t(),n.textContent=n.textContent,En(n.textContent),bn(e)};vt("keysloaded",(e=>{document.getElementById(on.ntob(e)).scrollIntoView()})),vt("reloaded",(()=>{setTimeout((()=>{}))}));const da=()=>{const e=(e=>{const t=e.actions?e.actions.map((e=>"string"==typeof e?oa[e]:oa[e.name]?{...oa[e.name],...e}:e)):Object.keys(oa).map((e=>oa[e])),n={...sa,...e.classes},a=e.defaultParagraphSeparator||"div",r=e.element.topic=ta("div");r.contentEditable=!0,r.className=n.topic,r.onkeydown=e=>{"Enter"===e.key&&(i.focus(),e.preventDefault())},ea(e.element,r);const i=e.element.content=ta("div");i.contentEditable=!0,i.className=n.content,i.oninput=({target:{firstChild:t}})=>{e.oninput(i.innerHTML)},i.onkeydown=t=>{"Enter"===t.key&&(la()&&setTimeout((()=>y())),t.shiftKey||(e.onsend({topic:r,content:i}),t.preventDefault()))},ea(e.element,i);const o=ta("div");o.className=n.actionbar,ea(e.element,o),t.forEach((e=>{const t=ta("button");if(t.className=n.button,t.innerHTML=e.icon,t.title=e.title,t.setAttribute("type","button"),t.onclick=()=>e.result()&&i.focus(),e.state){const a=()=>t.classList[e.state()?"add":"remove"](n.selected);Qn(i,"keyup",a),Qn(i,"mouseup",a),Qn(t,"click",a)}ea(o,t)}));const s=ta("button");return s.className="ntb",s.innerHTML="New topic",s.title="New topic",s.setAttribute("type","button"),s.onclick=()=>{if(document.body.classList.contains("ed"))return void document.body.classList.remove("ed");let e=la();document.body.classList.add("ed"),e&&setTimeout((()=>y()))},ea(o,s),e.styleWithCSS&&aa("styleWithCSS"),aa(Gn,a),e.element})({element:yt("div",{class:"e"}),oninput:e=>{},onsend:ca}),t=f(0),n=e=>{let{id:n,txt:r,html:o,by:c,chanid:u,re:d,star:h,nor:p,mailid:m}=e,w=yn(),y=An(u);let g=w[w.indexOf(n)-1],v=Tn(g)||{},b=v.by!==c,C=!d||v.chanid!==u,E=on.ntob(n),L=on.ntob(y.id);o&&(o=o.replaceAll("[:path:]",kt+"/a"));const S=()=>{l("#/"+E,E)},U=(e,t)=>{l("#"+t,t),e.preventDefault()},A=f(!0),T=()=>r().length>400&&A(),x=e=>{A(!A())},k=()=>o&&!A(),N=r().replace(/\u200C/g,"").trim().replace(/\n+/g,"\n").replace(/(\r\n)+/g,"\n");return yt("div",{id:E,class:function(){return"c"+(()=>(h()?" star":"")+(C?" t":"")+(bn()===n?" cur":"")).call(this)},onclick:t=>((e,t)=>{if(e.x<18&&e.offsetY<22)return s(t);x()})(t,e),onmouseover:e=>t()!==n&&t(n)},C?yt("div",{class:"tn"+(d?" re":m?" ml":" ch")},yt("a",{href:function(){return"#"+("function"==typeof L?L.call(this):L)},onclick:e=>U(e,L),innerHTML:An(y.id,"fullname")}),yt("div",{class:"dr"},en((()=>[...y.dir.slice(ln.len()-1)]),(e=>{let t=on.ntob(e);return yt("span",null,yt("a",{href:function(){return"#"+("function"==typeof t?t.call(this):t)},onclick:e=>U(e,t),innerHTML:An(e,"name")}))})))):null,b||C?yt("div",null,yt("a",{class:"by"},xn(c).name)," ",yt("a",{class:"eml"},xn(c).email)):null,yt("div",{onclick:e=>e.stopPropagation()},(()=>{let e=p();if(1!==e||n!==Tn(yn()[i+1]).re)return e>0?yt([yt("span",{class:"rep",onclick:S},e," â†©ï¸")," "]):void 0}),yt("div",{class:function(){return"ct"+(()=>T()?" mo":"").call(this)+(()=>k()?"":" tx").call(this)}},(()=>k()?ra(o):N)),(()=>T()?yt("p",{onclick:x,class:"more"},yt("a",null,"read more...")):null)),(()=>t()===n?a(E,e):null))},a=(t,n)=>yt([yt("div",{class:"pm pr",onclick:t=>ua(n,e),title:"reply"},"â†©ï¸"),yt("div",{class:"pm"},"ðŸ’¬",yt("div",{class:"pu"},yt("div",{onclick:e=>r(t,n)},"âœï¸ edit"),yt("div",{onclick:e=>o(n)},"âŒ delete")))]),r=(e,t)=>{let n=document.getElementById(e).querySelector(".ct");if("true"==n.contentEditable)return n.contentEditable=!1,n.classList.remove("ce"),void(n.innerHTML=t.txt());n.contentEditable=!0,n.focus(),n.classList.add("ce"),n.oninput=e=>{},n.onkeydown=e=>{if("Escape"===e.key)return n.contentEditable=!1,n.classList.remove("ce"),void(n.innerHTML=t.txt());if("Enter"===e.key){let a=n.innerHTML.trim();e.shiftKey||(e.preventDefault(),n.contentEditable=!1,n.classList.remove("ce"),a!=t.txt()&&function(e,t){zt.send(ne.EditChat({id:e,txt:t}))}(t.id,a))}}},o=({id:e,txt:t})=>{confirm('Do you want to delete this chat? \n"'+t()+'"')&&function(e){zt.send(ne.DelChat(e)),Fn(e)}(e)},s=({id:e,star:t})=>{const n=yn().filter((t=>t===e))[0],a=Tn(n);a.star?a.star(!t()):a.star=f(!1)},l=(e,t)=>{let n=screen.width/2-300,a=screen.height/2-300;window.open(e,t,`toolbar=yes,location=yes,status=no,menubar=yes,scrollbars=yes,resizable=yes,width=600,height=600,top=${a}, left=${n}`)},c=yt("div",null);return setTimeout((function(){new IntersectionObserver((e=>{if(e[0].intersectionRatio<=0)return void(document.body.classList.contains("fx")&&(document.body.classList.remove("fx"),y()));if(!Cn())return;!yn()[0]||Sn()||yn().length<dn||setTimeout((()=>{if(!Cn())return;let e=yn()[0];!e||Sn()||yn().length<dn||(async e=>{let t=gn();performance.now();let n=await X(t)||[];if(n[2]&&e===n[1])return void Sn(!0);Sn(!1);let a=await J(te.Chanid(t),e,dn);if(n[2]||a.length===dn)return void await jn(a);let r=await qn(e);r.length>0&&await jn(r)})(e)}))}),{}).observe(c)})),yt([yt("div",{class:"cs"},c,en(yn,(e=>n(Tn(e))))),e])},ha=()=>{},fa=f(ha);var pa=document.createElement("base");pa.target="_blank",document.head.appendChild(pa),document.querySelector("body").append((()=>{vt("login",(e=>e&&fa(ha))),vt("logout",(()=>fa(ha))),vt("nochan",(()=>fa(ha)));return yt([yt("div",{class:"n"},yt("div",null,yt("ol",{class:"bc"},(()=>en(ln.paths,(e=>yt("li",null,yt("a",{onclick:t=>(e=>{fa()!==$n?e[0]===ln.len()-1?fa($n):ln.cd(e):ln.same(e)&&fa(ha),ln.setpath(e),fa()===$n&&Bn(e[3])})(e)},e[2])))))),yt("div",{class:"m"},yt("a",{onclick:e=>{fa()===Yn?fa(ha):fa(Yn)}},(()=>St.name()||"login")))),yt(v(fa),null)),da])})())}();
