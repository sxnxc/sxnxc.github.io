!function(){"use strict";var e,t,n,r,o;!function(e){e.None=function(e){return{tag:"None",value:e}},e.Id=function(e){return{tag:"Id",value:e}},e.TopicId=function(e){return{tag:"TopicId",value:e}},e.ChannelId=function(e){return{tag:"ChannelId",value:e}},e.GroupId=function(e){return{tag:"GroupId",value:e}},e.By=function(e){return{tag:"By",value:e}}}(e||(e={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Email=function(e){return{tag:"Email",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(t||(t={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(n||(n={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(r||(r={})),function(e){e.Id=function(e){return{tag:"Id",value:e}}}(o||(o={}));var i,a;!function(e){e.User=function(e){return{tag:"User",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Group=function(e){return{tag:"Group",value:e}},e.Groups=function(e){return{tag:"Groups",value:e}},e.Channel=function(e){return{tag:"Channel",value:e}},e.Channels=function(e){return{tag:"Channels",value:e}},e.Topic=function(e){return{tag:"Topic",value:e}},e.Topics=function(e){return{tag:"Topics",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}}}(i||(i={})),function(e){e.User=function(e){return{tag:"User",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Group=function(e){return{tag:"Group",value:e}},e.Groups=function(e){return{tag:"Groups",value:e}},e.Channel=function(e){return{tag:"Channel",value:e}},e.Channels=function(e){return{tag:"Channels",value:e}},e.Topic=function(e){return{tag:"Topic",value:e}},e.Topics=function(e){return{tag:"Topics",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}}}(a||(a={}));const l=(e,t=0,n=!0)=>({pos:t,littleEndian:n,view:new DataView(e)}),c=(e,t)=>{const{view:{buffer:n},pos:r}=e,o=n.byteLength;if(o-r>t)return e;const i=Math.max(2*o,o+t),a=new Uint8Array(i);return a.set(new Uint8Array(n)),l(a.buffer,r,e.littleEndian)},s=(e,t)=>{e=c(e,1);const{view:n,pos:r}=e;return n.setUint8(r,t),e.pos+=1,e},u=(e,t)=>{e=c(e,4);const{view:n,pos:r,littleEndian:o}=e;return n.setUint32(r,t,o),e.pos+=4,e},d=(e,t)=>{e=c(e,2);const{view:n,pos:r,littleEndian:o}=e;return n.setUint16(r,t,o),e.pos+=2,e};function p(e,t){const{view:n,pos:r,littleEndian:o}=e;return n.setUint32(o?r:r+4,t,o),n.setUint32(o?r+4:r,0,o),e.pos+=8,e}const f=(e,t)=>{e=c(e,4);const{view:n,pos:r,littleEndian:o}=e;return n.setInt32(r,t,o),e.pos+=4,e},h=new TextEncoder,g="encodeInto"in h?(e,t)=>h.encodeInto(e,t).written:(e,t)=>{const n=h.encode(e);return t.set(n),n.length},y=(e,t)=>{e=c(e,3*t.length+8);const n=g(t,new Uint8Array(e.view.buffer,e.pos+8));return(e=p(e,n)).pos+=n,e},m=(e,t)=>s(e,t?1:0),v=e=>(t,n)=>n.reduce(e,((e,t)=>p(c(e,8),t))(t,n.length)),b=e=>(t,n)=>null===n?s(t,0):e(s(t,1),n),w=e=>{const{pos:t,view:n}=e;return e.pos+=1,n.getUint8(t)},C=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getUint32(t,r)},I=e=>{const{view:t,pos:n,littleEndian:r}=e;return e.pos+=8,t.getUint32(r?n:n+4,r)},A=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getInt32(t,r)},k=e=>1===w(e),E=e=>t=>1===w(t)?e(t):null,T=e=>t=>{const n=I(t),r=new Array;for(let o=0;o<n;o++)r.push(e(t));return r},x=new TextDecoder,U=e=>{const t=I(e),{pos:n,view:{buffer:r}}=e,o=x.decode(new Uint8Array(r,n,t));return e.pos+=t,o};var S=b(y),$=b(m),_=y,L=b(_),N=(v((function(e,t){var n=t.id,r=t.txt,o=t.by,i=t.re,a=t.nor,l=t.topicId,c=t.channelId,s=t.groupId,u=t.createdAt,d=t.updatedAt;return _(_(f(f(f(f(f(f(y(f(e,n),r),o),i),a),l),c),s),u),d)})),v((function(e,t){var n=t.k,r=t.v;return y(f(e,n),r)})),function(e,t){var n=t.id,r=t.handle,o=t.email,i=t.emailVerified,a=t.name,l=t.picture,c=t.gender,s=t.lastLogin,u=t.createdAt,d=t.updatedAt;return _(_(L($(S(y(m(y(y(f(e,n),r),o),i),a),l),c),s),u),d)}),H=(v(N),function(e,t){var n=t.id,r=t.name,o=t.handle,i=t.by,a=t.createdAt,l=t.updatedAt;return _(_(f(y(y(f(e,n),r),o),i),a),l)}),M=(v(H),function(e,t){var n=t.id,r=t.name,o=t.handle,i=t.groupId,a=t.by,l=t.createdAt,c=t.updatedAt;return _(_(f(f(y(y(f(e,n),r),o),i),a),l),c)}),O=(v(M),function(e,t){var n=t.id,r=t.name,o=t.groupId,i=t.channelId,a=t.by,l=t.createdAt,c=t.updatedAt;return _(_(f(f(f(y(f(e,n),r),o),i),a),l),c)}),D=(v(O),function(e,t){var n=t.filter,r=t.limit,o=t.page;return d(d(function(e,t){switch(t.tag){case"None":return m(u(e,0),t.value);case"Id":return f(u(e,1),t.value);case"TopicId":return f(u(e,2),t.value);case"ChannelId":return f(u(e,3),t.value);case"GroupId":return f(u(e,4),t.value);case"By":return f(u(e,5),t.value)}}(e,n),r),o)}),G=function(e,t){switch(t.tag){case"User":return function(e,t){switch(t.tag){case"Id":return f(u(e,0),t.value);case"Email":return y(u(e,1),t.value);case"Handle":return y(u(e,2),t.value)}}(u(e,0),t.value);case"Users":return function(e,t){var n=t.name,r=t.email,o=t.handle,i=t.limit,a=t.page;return d(d(y(y(y(e,n),r),o),i),a)}(u(e,1),t.value);case"Group":return function(e,t){switch(t.tag){case"Id":return f(u(e,0),t.value);case"Handle":return y(u(e,1),t.value)}}(u(e,2),t.value);case"Groups":return function(e,t){var n=t.name,r=t.handle,o=t.by,i=t.limit,a=t.page;return d(d(f(y(y(e,n),r),o),i),a)}(u(e,3),t.value);case"Channel":return function(e,t){switch(t.tag){case"Id":return f(u(e,0),t.value);case"Handle":return y(u(e,1),t.value)}}(u(e,4),t.value);case"Channels":return function(e,t){var n=t.name,r=t.handle,o=t.group_id,i=t.by,a=t.limit,l=t.page;return d(d(f(f(y(y(e,n),r),o),i),a),l)}(u(e,5),t.value);case"Topic":return function(e,t){switch(t.tag){case"Id":return f(u(e,0),t.value)}}(u(e,6),t.value);case"Topics":return function(e,t){var n=t.name,r=t.group_id,o=t.channel_id,i=t.by,a=t.limit,l=t.page;return d(d(f(f(f(y(e,n),r),o),i),a),l)}(u(e,7),t.value);case"Chats":return D(u(e,8),t.value)}},P=E(U),j=E(k),R=U,B=E(R),K=T((function(e){return{id:A(e),txt:U(e),by:A(e),re:A(e),nor:A(e),topicId:A(e),channelId:A(e),groupId:A(e),createdAt:R(e),updatedAt:R(e)}})),q=T((function(e){return{k:A(e),v:U(e)}})),z=function(e){return{id:A(e),handle:U(e),email:U(e),emailVerified:k(e),name:U(e),picture:P(e),gender:j(e),lastLogin:B(e),createdAt:R(e),updatedAt:R(e)}},F=T(z),V=function(e){return{id:A(e),name:U(e),handle:U(e),by:A(e),createdAt:R(e),updatedAt:R(e)}},W=T(V),J=function(e){return{id:A(e),name:U(e),handle:U(e),groupId:A(e),by:A(e),createdAt:R(e),updatedAt:R(e)}},Z=T(J),Q=function(e){return{id:A(e),name:U(e),groupId:A(e),channelId:A(e),by:A(e),createdAt:R(e),updatedAt:R(e)}},Y=T(Q),X=function(e){switch(C(e)){case 0:return a.User(z(e));case 1:return a.Users(F(e));case 2:return a.Group(V(e));case 3:return a.Groups(W(e));case 4:return a.Channel(J(e));case 5:return a.Channels(Z(e));case 6:return a.Topic(Q(e));case 7:return a.Topics(Y(e));case 8:return a.Chats(function(e){return t=K(e),n=q(e),r=q(e),[t,n,r];var t,n,r}(e))}throw new Error("bad variant index for Response")},ee=l(new ArrayBuffer(512)),te=function(e,t){return ee.pos=0,ee=t(ee,e),new Uint8Array(ee.view.buffer).slice(0,ee.pos)},ne=function(e,t){return t(l(e))},re=function(e){return ne(e.buffer,X)},oe=function(e){return te(e,G)};const ie=e=>new Zlib.Inflate(e).decompress(),ae=e=>new Zlib.Deflate(e).compress(),le=[];function ce(e){let t={};return function(){const n=le.slice.call(arguments),r=n.map((e=>{if(de(e)||Array.isArray(e)){let t={};for(let n in e)t[n]=ue(e[n]);return t}return ue(e)})),o=JSON.stringify(r);let i=t[o];return void 0===i&&(i=e.apply(this,n),i&&11===i.nodeType&&(i=le.slice.call(i.childNodes)),t[o]=i),i}}let se=0;function ue(e){return"function"==typeof e||e instanceof Node?(e.$m||(e.$m=++se),{$m:e.$m}):e}function de(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function pe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var fe,he,ge=pe((function(e,t){function n(e){var t=e>>3;return e%8!=0&&t++,t}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===e&&(e=0);var r=null==t?void 0:t.grow;this.grow=r&&isFinite(r)&&n(r)||r||0,this.buffer="number"==typeof e?new Uint8Array(n(e)):e}return e.prototype.get=function(e){var t=e>>3;return t<this.buffer.length&&!!(this.buffer[t]&128>>e%8)},e.prototype.set=function(e,t){void 0===t&&(t=!0);var n=e>>3;if(t){if(this.buffer.length<n+1){var r=Math.max(n+1,Math.min(2*this.buffer.length,this.grow));if(r<=this.grow){var o=new Uint8Array(r);o.set(this.buffer),this.buffer=o}}this.buffer[n]|=128>>e%8}else n<this.buffer.length&&(this.buffer[n]&=~(128>>e%8))},e.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=8*this.buffer.length);for(var r=t,o=r>>3,i=128>>r%8,a=this.buffer[o];r<n;r++)e(!!(a&i),r),i=1===i?(a=this.buffer[++o],128):i>>1},e}();t.default=r}(he={path:fe,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&he.path)}},he.exports),he.exports));let ye,me=[];function ve(e){let t=ye,n=()=>{};ye=n,Ce(n);let r=e((()=>{we(n),ye=void 0}));return ye=t,r}function be(e){function t(n){if(0===arguments.length)return ye&&!t.__o.has(ye)&&(t.__o.add(ye),ye.u.push(t)),e;e=n;let r=ye;return ye=void 0,t.o=new Set(t.__o),t.o.forEach((e=>e.i=!1)),t.o.forEach((e=>{e.i||e()})),ye=r,e}return t.$o=1,t.__o=new Set,t.t=me,t}function we(e){e.__c.forEach(we),e.u.forEach((t=>{t.__o.delete(e),t.o&&t.o.delete(e)})),e.l.forEach((e=>e())),Ce(e)}function Ce(e){e.u=[],e.__c=[],e.l=[]}const Ie=()=>window.scrollTo(0,document.body.scrollHeight),Ae=ce((e=>ce(((t,n)=>ve((()=>e(t,n))))))),ke=e=>(t,...n)=>()=>Ae(e())(t,n),Ee=e=>{console.log("Length",e.length,"bytes"),console.log((Object(e).buffer instanceof ArrayBuffer?e:"string"==typeof e?new TextEncoder("utf-8").encode(e):new Uint8ClampedArray(e)).reduce(((e,t,n,r)=>e+(n%16==0?n.toString(16).padStart(6,0)+"  ":" ")+t.toString(16).padStart(2,0)+(n===r.length-1||n%16==15?" ".repeat(3*(15-n%16))+Array.from(r).splice(n-n%16,16).reduce(((e,t)=>e+(t>31&&t<127||t>159?String.fromCharCode(t):".")),"  ")+"\n":"")),""))},Te=(e,t)=>{let n=0,r=0;for(;n<e.length;)r>=t.length&&(r=0),e.set([e[n]^t[r]],n),n++,r++},xe=(e,t)=>(Te(e,t),$e(e,t)),Ue=e=>{let{a:t,k:n}=Se(e);return Te(t,n),{a:t,k:n}},Se=e=>{let t=e[0],n=e.subarray(1,t+1);return{a:e.subarray(t+1),k:n}},$e=(e,t)=>{let n=new Uint8Array(1+t.length+e.length);return n[0]=t.length,n.set(t,1),n.set(e,1+t.length),n},_e=(e,t)=>(e=Math.ceil(e),Math.floor(Math.random()*(Math.floor(t)-e)+e)),Le=e=>(performance.now()-e).toFixed(2),Ne=(e,t=64)=>xe(e,crypto.getRandomValues(new Uint8Array(_e(1,t)))),He=document.location.hash.substr(1).match(/^ip\/(?<ip>[\.\d]+)$/),Me=He?He.groups.ip:"192.168.1.3",Oe=`wss://${Me}:443`;let De,Ge,Pe,je,Re,Be,Ke,qe,ze,Fe,Ve,We,Je=500,Ze=0,Qe={ready:!1},Ye=0,Xe=1;function et(){Ke=!1,function(){Be=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]});let e=Xe++;Be.onicecandidate=e=>{e.candidate},Be.onconnectionstatechange=t=>{switch(Be.connectionState){case"failed":case"disconnected":console.log("[peer]",e,"restarting....")}},Be.oniceconnectionstatechange=e=>{switch(Be.iceConnectionState){case"disconnected":console.log("[ice] restarting....")}}}(),Ve=Be.createDataChannel("wu",{negotiated:!0,id:0}),Ve.binaryType="arraybuffer",Ye=0,Qe.send=tt,Ve.onopen=e=>{console.log(`[dc] open in ${Le(De)} ms`),console.groupEnd("[dc]"),Ye=0,Qe.ready=!0,Qe.open&&Qe.open(e)},Ve.onmessage=nt,Ve.onclose=e=>{console.log("[dc] close",e)},Ve.onerror=e=>{console.log("[dc] error:",e)},async function(){const e=async()=>{let e=await Be.createOffer();return await Be.setLocalDescription(e),ae((new TextEncoder).encode(Be.localDescription.sdp))},t=async()=>{if(qe)return qe;je=await(async()=>(console.log("[sec] generating key pairs"),await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"])))();let e=await crypto.subtle.exportKey("raw",je.publicKey);return qe=new Uint8Array(e),qe};Re=await(async(e,t)=>{let[n,r]=await Promise.all([e(),t()]);return Ne(xe(n,r))})(e,t),console.log(`[dc] sdp in ${Le(De)} ms`),1===Ge.readyState&&rt()}()}async function tt(e){if(Ye++,console.groupEnd("[dc]"),console.group("[dc]","-> sending packet",Ye,e),e=oe(e),Ee(e),We.z&&(e=ae(e)),We.m&&(e=Ne(e,e.length),Te(e,ze)),We.c){const t=crypto.getRandomValues(new Uint8Array(12));Te(e,t),e=((e,t)=>{let n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n})(t,new Uint8Array(await(async(e,t,n)=>(console.log("[sec] encrypting data"),await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e)))(e,Fe,t)))}Ee(e),Ve.send(e),Pe=performance.now()}async function nt(e){let t=new Uint8Array(e.data),n=t.length;if(We.c){let e=t.subarray(0,12);t=new Uint8Array(await(async(e,t,n)=>(console.log("[sec] decrypting data"),await crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,e)))(t.subarray(12),Fe,e)),Te(t,e)}if(We.m){Te(t,ze);let{a:e}=Ue(t);t=new Uint8Array(e)}We.z&&(t=ie(t));let r=(100*n/t.length).toFixed(2);console.log(`[dc] <- received ${n} / ${t.length} byte ${r}% in ${Le(Pe)} ms`);let o=ot(0,t);Qe.recv&&Qe.recv(o),console.groupEnd("[dc]")}console.group("[ws]","starting..."),function e(t){De=performance.now(),Ge=new WebSocket(Oe),Ge.binaryType="arraybuffer",Ge.onopen=()=>{console.log(`[ws] open in ${Le(De)} ms`),console.groupEnd("[ws]"),console.group("[dc]","opening..."),t?et():Re&&rt()},Ge.onmessage=async e=>{console.log(`[ws] <- received answer in ${Le(De)} ms`);let t=new Uint8Array(e.data),{a:n,k:r}=Ue(t);var o,i,a;We=(e=>{const t=new ge(e);return{z:t.get(0),m:t.get(1),c:t.get(2),d:t.get(3)?1:0}})(n),console.log(We),r=await(o=r,crypto.subtle.importKey("raw",o,{name:"ECDH",namedCurve:"P-256"},!0,[])),Fe=await(i=je.privateKey,a=r,crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:a},i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])),ze=new Uint8Array(await crypto.subtle.exportKey("raw",Fe));let l=JSON.parse((e=>(new TextDecoder).decode(ie(e)))(n.slice(1))),c=l.answer?l.answer:l;if(await Be.setRemoteDescription(new RTCSessionDescription(c)),!l.candidate)return;const s=new RTCIceCandidate({candidate:l.candidate,sdpMid:0,sdpMLineIndex:0});await Be.addIceCandidate(s)},Ge.onclose=t=>{Ze++,Je+=_e(0,Ze<16?200:3e3),console.log("[ws] closed",t),console.groupEnd("[ws]"),console.groupEnd("[ws]"),console.groupCollapsed("[ws]",`retry ${Ze} in ${(Je/1e3).toFixed(2)} sec`),setTimeout((()=>{e(!0)}),Je)},Ge.onerror=e=>{console.log("[ws] error",e)}}(),et();const rt=()=>{Ke||(console.log("[ws] -> sending offer"),Ge.send(Re),Ke=!0)},ot=(e,t)=>{switch(e){case 0:let e=re(t);return console.table(e.value),e}};let it={},at=[];function lt(e){return this.t&&this.t[e.type](e)}it.h=(...e)=>{let t,n=r=>{if(null==r);else if("string"==typeof r)t?it.add(t,r):t=it.s?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r);else if(Array.isArray(r))t||(t=document.createDocumentFragment()),r.forEach(n);else if(r instanceof Node)t?it.add(t,r):t=r;else if("object"==typeof r)it.property(t,r,null,it.s);else if("function"==typeof r)if(t){let e=it.add(t,"");it.insert(t,r,e)}else t=r.apply(null,e.splice(1));else it.add(t,""+r)};return e.forEach(n),t},it.insert=(e,t,n,r,o)=>(e=n&&n.parentNode||e,o=o||r instanceof Node&&r,t===r||(r&&"string"!=typeof r||!("string"==typeof t||"number"==typeof t&&(t+=""))?"function"==typeof t?it.subscribe((()=>{r=it.insert(e,t.call({el:e,endMark:n}),n,r,o)})):(n?r&&(o||(o=r.o&&r.o.nextSibling||n.previousSibling),it.rm(e,o,n)):e.textContent="",r=null,t&&!0!==t&&(r=it.add(e,t,n))):(null!=r&&e.firstChild?n?(n.previousSibling||e.lastChild).data=t:e.firstChild.data=t:n?it.add(e,t,n):e.textContent=t,r=t)),r),it.property=(e,t,n,r,o)=>{if(null!=t)if(!n||"attrs"===n&&(r=!0))for(n in t)it.property(e,t[n],n,r,o);else"o"!==n[0]||"n"!==n[1]||t.$o?"function"==typeof t?it.subscribe((()=>{it.property(e,t.call({el:e,name:n}),n,r,o)})):o?e.style.setProperty(n,t):r||"data-"===n.slice(0,5)||"aria-"===n.slice(0,5)?e.setAttribute(n,t):"style"===n?"string"==typeof t?e.style.cssText=t:it.property(e,t,null,r,!0):("class"===n&&(n+="Name"),e[n]=t):((e,t,n)=>{t=t.slice(2).toLowerCase(),n?e.addEventListener(t,lt):e.removeEventListener(t,lt),(e.t||(e.t={}))[t]=n})(e,n,t)},it.add=(e,t,n)=>{let r=(e=>{const{childNodes:t}=e;if(t&&11===e.nodeType)return t.length<2?t[0]:{o:it.add(e,"",t[0])}})(t=(e=>"string"==typeof e?document.createTextNode(e):e instanceof Node?e:it.h(at,e))(t))||t;return e.insertBefore(t,n&&n.parentNode&&n),r},it.rm=(e,t,n)=>{for(;t&&t!==n;){let n=t.nextSibling;e===t.parentNode&&e.removeChild(t),t=n}},it.subscribe=function(e){return function(e,t){function n(){let r=ye;return ye&&ye.__c.push(n),we(n),n.i=!0,ye=n,t=e(t),ye=r,t}function r(){return n.i?ye&&n.u.forEach((e=>e())):t=n(),t}e.s=n,Ce(n),n(),r.$o=1}(e),()=>we(e.s)},it.cleanup=function(e){return ye&&ye.l.push(e),e},it.root=ve,it.sample=function(e){let t=ye;ye=void 0;let n=e();return ye=t,n},it.hs=(...e)=>{let t=it.s;it.s=!0;let n=ct(...e);return it.s=t,n};let ct=(...e)=>it.h.apply(it.h,e);function st(e,t,n){const{root:r,subscribe:o,sample:i,cleanup:a}=it;null==n&&(n=!t.$t);let l=it.h([]),c=it.add(l,""),s=new Map,u=new Map,d=new Set;function p(e,o){if(null==e)return;let i=u.get(e);return 1===o?(d.delete(e),i||(i=n?r((n=>(s.set(e,n),t(e.$v||e)))):t(e.$v||e),11===i.nodeType&&(i=(e=>{const{childNodes:t}=e,{length:n}=t;if(n<2)return t[0];let r=Array.from(t);return{nodeType:111,t:r[0],o:r[n-1],l(){if(t.length!==n){let t=0;for(;t<n;)e.appendChild(r[t++])}return e}}})(i)||i),u.set(e,i))):-1===o&&d.add(e),((e,t)=>111===e.nodeType?1/t<0?t?it.rm(e.t.parentNode,e.t.nextSibling,e.o.nextSibling)||e.t:e.o:t?e.l():e.t:e)(i,o)}function f(e){let t=s.get(e);t&&(t(),s.delete(e)),u.delete(e)}return a(o((t=>{let n=e();return i((()=>{d.clear();let e=Array.from(function(e,t,n,r,o){let i,a,l=new Map,c=new Map;for(i=0;i<t.length;i++)l.set(t[i],i);for(i=0;i<n.length;i++)c.set(n[i],i);for(i=a=0;i!==t.length||a!==n.length;){var s=t[i],u=n[a];if(null===s)i++;else if(n.length<=a)e.removeChild(r(t[i],-1)),i++;else if(t.length<=i)e.insertBefore(r(u,1),r(t[i],0)||o),a++;else if(s===u)i++,a++;else{var d=c.get(s),p=l.get(u);void 0===d?(e.removeChild(r(t[i],-1)),i++):void 0===p?(e.insertBefore(r(u,1),r(t[i],0)||o),a++):(e.insertBefore(r(t[p],1),r(t[i],0)||o),t[p]=null,p>i+1&&i++,a++)}}return n}(c.parentNode,t||[],n,p,c));return d.forEach(f),e}))}))),a((function(){s.forEach((e=>e())),s.clear(),u.clear(),d.clear()})),l}const ut=()=>ft()===dt?ft(pt):ft(dt),dt=({items:e,keys:t},...n)=>ct([ct("table",null,ct("thead",null,ct("tr",null,st(t,(e=>ct("th",{scope:"col"},e))))),ct("tbody",null,st(e,(e=>ct("tr",{onclick:t=>location.hash="#channels/"+e.id},st(t,(t=>ct("td",null,ct("span",null,t)," ",e[t])))))))),n]),pt=({items:e},...t)=>ct([ct("ul",null,st(e,(e=>ct("li",{id:e.id},e.name)))),t]),ft=be(dt);const ht=({group_id:e})=>{let t=be([]),n=0;Qe.recv=e=>{let r=e.value;if(Array.isArray(r))return 0==r.length?n--:t(r);let o=t();o.unshift(r),t(o)};const r=t=>i.Channels({name:"",handle:"",group_id:e,by:0,limit:30,page:t}),o=e=>{n++,Qe.send(r(n))};return Qe.open=e=>o(),Qe.ready&&o(),ct([ct("button",{onclick:e=>{n--,n<1&&(n=1),Qe.send(r(n))}},"Prev Item"),ct("button",{onclick:o},"Next Item"),ct("button",{onclick:e=>{n=0;let t=setInterval((function(){300==n?clearInterval(t):o()}),1)}},"Run Load"),ct("button",{onclick:gt},"Switch Component"),ct("h2",null,"Channels"),ct(ke(vt),{items:t,keys:()=>Object.keys(t()[0]||{})})])},gt=()=>vt()===yt?vt(mt):vt(yt),yt=({items:e,keys:t},...n)=>ct([ct("table",null,ct("thead",null,ct("tr",null,st(t,(e=>ct("th",{scope:"col"},e))))),ct("tbody",null,st(e,(e=>ct("tr",{onclick:t=>location.hash="#topics/"+e.id},st(t,(t=>ct("td",null,ct("span",null,t)," ",e[t])))))))),n]),mt=({items:e},...t)=>ct([ct("ul",null,st(e,(e=>ct("li",{id:e.id},e.name)))),t]),vt=be(yt);const bt=({channel_id:e})=>{let t=be([]),n=0;Qe.recv=e=>{let r=e.value;if(Array.isArray(r))return 0==r.length?n--:t(r);let o=t();o.unshift(r),t(o)};const r=t=>i.Topics({name:"",group_id:0,channel_id:e,by:0,limit:30,page:t}),o=e=>{n++,Qe.send(r(n))};return Qe.open=e=>o(),Qe.ready&&o(),ct([ct("button",{onclick:e=>{n--,n<1&&(n=1),Qe.send(r(n))}},"Prev Item"),ct("button",{onclick:o},"Next Item"),ct("button",{onclick:e=>{n=0;let t=setInterval((function(){300==n?clearInterval(t):o()}),1)}},"Run Load"),ct("button",{onclick:wt},"Switch Component"),ct("h2",null,"Topics"),ct(ke(At),{items:t,keys:()=>Object.keys(t()[0]||{})})])},wt=()=>At()===Ct?At(It):At(Ct),Ct=({items:e,keys:t},...n)=>ct([ct("table",null,ct("thead",null,ct("tr",null,st(t,(e=>ct("th",{scope:"col"},e))))),ct("tbody",null,st(e,(e=>ct("tr",null,st(t,(t=>ct("td",null,ct("span",null,t)," ",e[t])))))))),n]),It=({items:e},...t)=>ct([ct("ul",null,st(e,(e=>ct("li",{id:e.id},e.name)))),t]),At=be(Ct),kt="defaultParagraphSeparator",Et="formatBlock",Tt=(e,t,n)=>e.addEventListener(t,n),xt=(e,t)=>e.appendChild(t),Ut=e=>document.createElement(e),St=e=>document.queryCommandState(e),$t=(e,t=null)=>document.execCommand(e,!1,t),_t={bold:{icon:"<b>B</b>",title:"Bold",state:()=>St("bold"),result:()=>$t("bold")},italic:{icon:"<i>I</i>",title:"Italic",state:()=>St("italic"),result:()=>$t("italic")},underline:{icon:"<u>U</u>",title:"Underline",state:()=>St("underline"),result:()=>$t("underline")},strikethrough:{icon:"<strike>S</strike>",title:"Strike-through",state:()=>St("strikeThrough"),result:()=>$t("strikeThrough")},heading1:{icon:"<b>H1</b>",title:"Heading 1",result:()=>$t(Et,"<h1>")},heading2:{icon:"<b>H2</b>",title:"Heading 2",result:()=>$t(Et,"<h2>")},quote:{icon:"&#8220;&#8221;",title:"Quote",result:()=>$t(Et,"<blockquote>")},olist:{icon:"1.",title:"Ordered List",result:()=>$t("insertOrderedList")},ulist:{icon:"&#8226;",title:"Unordered List",result:()=>$t("insertUnorderedList")},code:{icon:"&lt;&gt;",title:"Code",result:()=>$t(Et,"<pre>")},line:{icon:"&#8213;",title:"Horizontal Line",result:()=>$t("insertHorizontalRule")},link:{icon:"&#128279;",title:"Link",result:()=>{const e=window.prompt("Enter the link URL");e&&$t("createLink",e)}},image:{icon:"&#128247;",title:"Image",result:()=>{const e=window.prompt("Enter the image URL");e&&$t("insertImage",e)}}},Lt={actionbar:"pell-actionbar",button:"pell-button",content:"pell-content",selected:"pell-button-selected",topic:"pell-topic"};let Nt=be({}),Ht={};const Mt=e=>e.reduce(((e,t)=>(e[t.k]=t.v,e)),{}),Ot=({topic_id:t,chat_id:n})=>{let r,o,a=be([]),l=0;Qe.recv=e=>{let n=e.value[0];if(r=Mt(e.value[1]),o=Mt(e.value[2]),Array.isArray(n)){if(0==n.length)return l--;a(n.map(((e,t)=>(e.nor=be(e.nor),e.star=be(!1),e.i=t,e.createdAt=new Date(e.createdAt),e.updatedAt=new Date(e.updatedAt),e))))}u(n[n.length-1]),t&&(document.title=o[t]),setTimeout((()=>Ie()))};const c=r=>{var o;l++,Qe.send((o=l,i.Chats({filter:t>0?e.TopicId(t):n>0?e.Id(n):e.None(!0),limit:200,page:o})))};Qe.open=e=>c(),Qe.ready&&c();const s=(e=>{const t=e.actions?e.actions.map((e=>"string"==typeof e?_t[e]:_t[e.name]?{..._t[e.name],...e}:e)):Object.keys(_t).map((e=>_t[e])),n={...Lt,...e.classes},r=e.defaultParagraphSeparator||"div",o=e.element.topic=Ut("div");o.contentEditable=!0,o.className=n.topic,o.onkeydown=e=>{"Enter"===e.key&&(i.focus(),e.preventDefault())},xt(e.element,o);const i=e.element.content=Ut("div");i.contentEditable=!0,i.className=n.content,i.onfocus=()=>e.element.classList.add("sticky"),i.onblur=()=>{setTimeout((()=>{e.element.contains(document.activeElement)||e.element.classList.remove("sticky")}))},i.oninput=({target:{firstChild:t}})=>{e.onchange(i.innerHTML)},i.onkeydown=t=>{"Enter"!==t.key||t.shiftKey||(e.onsend(),t.preventDefault())},xt(e.element,i);const a=Ut("div");return a.className=n.actionbar,xt(e.element,a),t.forEach((e=>{const t=Ut("button");if(t.className=n.button,t.innerHTML=e.icon,t.title=e.title,t.setAttribute("type","button"),t.onclick=()=>e.result()&&i.focus(),e.state){const r=()=>t.classList[e.state()?"add":"remove"](n.selected);Tt(i,"keyup",r),Tt(i,"mouseup",r),Tt(t,"click",r)}xt(a,t)})),e.styleWithCSS&&$t("styleWithCSS"),$t(kt,r),e.element})({element:ct("div",{class:"pell"}),onchange:e=>{},onsend:()=>{if(!s.content.textContent.trim())return;let e=a(),t=e[e.length-1],n=Nt(),r=n.id,i=n.topicId;s.topic.textContent!==n.txt&&(r=0,i=Object.keys(o).length+1,o[i]=s.topic.textContent);let l={id:t.id+1,by:1,txt:s.content.innerHTML.trim(),re:r,topicId:i,star:be(!1),nor:be(0),createdAt:new Date,i:e.length};console.log(l),s.content.textContent="",e.push(l),a(e),r>0&&h(r),Ie(),u(l)}});s.content.innerHTML="";const u=({id:e,topicId:t,txt:n})=>{s.topic.innerHTML=n,s.topic.textContent=s.topic.textContent;let r=Nt();r.id!==e&&(r.id=e,r.topicId=t,r.txt=s.topic.textContent,Nt(r))},d=e=>{let{id:n,txt:i,by:l,topicId:c,re:s,star:d,nor:h,i:g}=e,y=Ht.by!==l,m=Ht.topicId!==c;Ht.id=n,Ht.by=l,Ht.topicId=c;let v=o[c];const b=()=>{p("#reps/"+n,n)};return ct("div",{class:function(){return"chat"+(()=>(d()?" star":"")+(m?" topic":"")+(Nt().id===n?" cur":"")).call(this)},onclick:e=>e.x<18&&e.offsetY<22&&f({id:n,star:d})},m?ct("div",{class:"topic-name"+(s?" re":" new")+(t?" head":"")},ct("a",{href:function(){return"#chats/"+("function"==typeof c?c.call(this):c)},onclick:e=>(p("#chats/"+c,v),e.preventDefault(),!1),innerHTML:v})):null,y||m?ct("div",{class:"by"},r[l]):null,ct("div",{onclick:()=>u(e)},(()=>{let e=h();if(1!==e||n!==a()[g+1].re)return e>0?ct([ct("span",{class:"rep",onclick:b},e," 💬")," "]):void 0}),(e=>document.createRange().createContextualFragment(e))(i)))},p=(e,t)=>{let n=screen.width/2-300,r=screen.height/2-300;window.open(e,t,`toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=600,height=600,top=${r}, left=${n}`)},f=({id:e,star:t})=>{const n=a().filter((t=>t.id===e))[0];n.star?n.star(!t()):n.star=be(!1)},h=e=>{const t=a().filter((t=>t.id===e))[0];t.nor(t.nor()+1)};return ct([ct("div",{class:"topics"},st(a,(e=>d(e)))),s])};const Dt=()=>jt()===Gt?jt(Pt):jt(Gt),Gt=({items:e,keys:t},...n)=>ct([ct("table",null,ct("thead",null,ct("tr",null,st(t,(e=>ct("th",{scope:"col"},e))))),ct("tbody",null,st(e,(e=>ct("tr",null,st(t,(t=>ct("td",null,ct("span",null,t)," ",Array.isArray(e[t])?e[t].length:e[t])))))))),n]),Pt=({items:e},...t)=>ct([ct("ul",null,st(e,(e=>ct("li",{id:e.id},e.name)))),t]),jt=be(Gt),Rt=(e,t)=>({pattern:e,view:t}),Bt=["chats","channels","topics","groups"],Kt=[Rt(/^$/,Ot),Rt(/^chats$/,(({topic_id:t,chat_id:n})=>{let r=be([]),o=0;Qe.recv=e=>{let t=e.value[0];if(Array.isArray(t))return 0==t.length?o--:r(t);let n=r();n.unshift(t),r(n)};const a=r=>i.Chats({filter:t>0?e.TopicId(t):n>0?e.Id(n):e.None(!0),limit:200,page:r}),l=e=>{o++,Qe.send(a(o))};return Qe.open=e=>l(),Qe.ready&&l(),ct([ct("button",{onclick:e=>{o--,o<1&&(o=1),Qe.send(a(o))}},"Prev Item"),ct("button",{onclick:l},"Next Item"),ct("button",{onclick:e=>{o=0;let t=setInterval((function(){300==o?clearInterval(t):l()}),1)}},"Run Load"),ct("button",{onclick:Dt},"Switch Component"),ct("h2",null,"Chats"),ct(ke(jt),{items:r,keys:()=>Object.keys(r()[0]||{})})])})),Rt(/^groups$/,(()=>{let e=be([]),t=0;Qe.recv=n=>{let r=n.value;if(Array.isArray(r))return 0==r.length?t--:e(r);let o=e();o.unshift(r),e(o)};const n=e=>i.Groups({name:"",handle:"",by:0,limit:30,page:e}),r=e=>{t++,Qe.send(n(t))};return Qe.open=e=>r(),Qe.ready&&r(),ct([ct("button",{onclick:e=>{t--,t<1&&(t=1),Qe.send(n(t))}},"Prev Item"),ct("button",{onclick:r},"Next Item"),ct("button",{onclick:e=>{t=0;let n=setInterval((function(){300==t?clearInterval(n):r()}),1)}},"Run Load"),ct("button",{onclick:ut},"Switch Component"),ct("h2",null,"Groups"),ct(ke(ft),{items:e,keys:()=>Object.keys(e()[0]||{})})])})),Rt(/^channels$/,ht),Rt(/^topics$/,bt),Rt(/^channels\/(?<group_id>\d+)$/,ht),Rt(/^topics\/(?<channel_id>\d+)$/,bt),Rt(/^chats\/(?<topic_id>\d+)$/,Ot),Rt(/^reps\/(?<chat_id>\d+)$/,Ot),Rt(/^products\/(?<id>\d+)$/,(({id:e})=>ct("h2",null,"Product ",e))),Rt(/^users\/(?<name>\w+)$/,(({name:e})=>ct("h2",null,e,"'s Profile"))),Rt(/^ip\/(?<ip>[\.\d]+)$/,Ot)],qt=be("");const zt=()=>qt(document.location.hash.substr(1));window.addEventListener("hashchange",zt),zt();document.querySelector(".app").append(ct([ct("div",{class:"nav"},ct("a",{href:"#",class:"nav-item"},"home"),(()=>Bt.map((e=>ct("a",{href:"#"+e,class:"nav-item "+(qt()===e?"is-active":"")},e))))),ct("div",{class:"container"},(()=>function(e){for(const{pattern:t,view:n}of Kt){const r=e.match(t);if(r)return n({...r.groups})}}(qt())))]))}();
