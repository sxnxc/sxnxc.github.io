!function(){"use strict";function n(n,e,t,r){return new(t||(t=Promise))((function(i,o){function u(n){try{s(r.next(n))}catch(n){o(n)}}function a(n){try{s(r.throw(n))}catch(n){o(n)}}function s(n){var e;n.done?i(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(u,a)}s((r=r.apply(n,e||[])).next())}))}function e(n,e){var t,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(n,u)}catch(n){o=[6,n],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function t(n,e){for(var t=0,r=e.length,i=n.length;t<r;t++,i++)n[i]=e[t];return n}function r(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var i={};function o(n){var e=n>>3;return n%8!=0&&e++,e}Object.defineProperty(i,"__esModule",{value:!0});var u=function(){function n(n,e){void 0===n&&(n=0);var t=null==e?void 0:e.grow;this.grow=t&&isFinite(t)&&o(t)||t||0,this.buffer="number"==typeof n?new Uint8Array(o(n)):n}return n.prototype.get=function(n){var e=n>>3;return e<this.buffer.length&&!!(this.buffer[e]&128>>n%8)},n.prototype.set=function(n,e){void 0===e&&(e=!0);var t=n>>3;if(e){if(this.buffer.length<t+1){var r=Math.max(t+1,Math.min(2*this.buffer.length,this.grow));if(r<=this.grow){var i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}this.buffer[t]|=128>>n%8}else t<this.buffer.length&&(this.buffer[t]&=~(128>>n%8))},n.prototype.forEach=function(n,e,t){void 0===e&&(e=0),void 0===t&&(t=8*this.buffer.length);for(var r=e,i=r>>3,o=128>>r%8,u=this.buffer[i];r<t;r++)n(!!(u&o),r),o=1===o?(u=this.buffer[++i],128):o>>1},n}(),a=i.default=u;function s(n,e,t){var r,i=this;return void 0===t&&(t=!1),function(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];r&&clearTimeout(r),t&&!r&&n.apply(i,o),r=setTimeout((function(){r=null,t||n.apply(i,o)}),e)}}function c(){var n;document.execCommand("selectAll",!1,void 0),null===(n=document.getSelection())||void 0===n||n.collapseToEnd()}function l(){var n=document.getSelection();return console.warn(n),n.focusOffset}var d=function(n){return document.getElementById(n)};function f(){window.scrollTo(0,document.documentElement.scrollHeight)}var v=function(n,e){for(var t=0,r=0;t<n.length;)r>=e.length&&(r=0),n.set([n[t]^e[r]],t),t++,r++},h=function(n,e){return S(m(n,e),64,24)},p=function(n){var e=g(n).a;return g(e)},m=function(n,e){return v(n,e),y(n,e)},g=function(n){var e=b(n),t=e.a,r=e.k;return v(t,r),{a:t,k:r}},b=function(n){var e=n[0],t=n.subarray(1,e+1);return{a:n.subarray(e+1),k:t}},y=function(n,e){var t=new Uint8Array(1+e.length+n.length);return t[0]=e.length,t.set(e,1),t.set(n,1+e.length),t},w=function(n,e){return n=Math.ceil(n),Math.floor(Math.random()*(Math.floor(e)-n)+n)},k=function(n,e){var t=new Uint8Array(n.length+e.length);return t.set(n,0),t.set(e,n.length),t},C=function(n){return(performance.now()-n).toFixed(2)},S=function(n,e,t){return void 0===e&&(e=64),void 0===t&&(t=8),m(n,crypto.getRandomValues(new Uint8Array(w(t,e))))},E=function(n){return function(n){return"hsl("+n%360+",100%,30%)"}(function(n){var e=0;if(0==n.length)return e;for(var t=0;t<n.length;t++)e=n.charCodeAt(t)+((e<<5)-e),e&=e;return e}(n+"#"))};function x(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)&&n.length<70}function A(n){return n.length<2||n.length>30?10:/^[0-9a-z_]+$/.test(n)?0:10}function _(){return window.scrollY+window.innerHeight===document.documentElement.scrollHeight}function U(){return Intl.DateTimeFormat().resolvedOptions().timeZone}function T(n){if(!/^[a-z0-9\_@\.]+$/.test(n.key))return n.preventDefault(),!1}function M(n){if(!/^[a-z0-9\_]+$/.test(n.key))return n.preventDefault(),!1}function D(n){n.target.value=n.target.value.toLowerCase().replace(/\s/g,"")}function L(n,e){return n.length<6?12:e&&n==e?14:void 0}function P(n,e){return!!e&&(n.getFullYear()===e.getFullYear()&&n.getMonth()===e.getMonth()&&n.getDate()===e.getDate())}const O=()=>{let n,e=new Promise((e=>n=e));return{complete:e=>n(e),join:()=>e}};var j,I=O(),N="s",K=["_t","_p","_e","_h","_r","_c","_s","_u","_n","_d","_m"],F=indexedDB.open(N,1);function z(n){console.warn("[db] deleting database",n);var e=window.indexedDB.deleteDatabase(n);e.onerror=function(e){console.error("[db] error deleting database",n,e)},e.onsuccess=function(e){console.warn("[db] deleted database",n)}}F.onsuccess=function(n){j=F.result,console.log("[db] open -",j.name,j.version,j.objectStoreNames),function(n){var e=n.objectStoreNames;if(e.length!==K.length)return console.warn("[db] db store missing"),void z(N);for(var t=0,r=K;t<r.length;t++){var i=r[t];if(!e.contains(i))return console.warn("[db] db store missing",i),void z(N)}}(j),I.complete(j)},F.onerror=function(n){console.error("[db] error",n.target.error),z(N),location.reload()},F.onblocked=function(n){console.log("[db] blocked",n)},F.onupgradeneeded=function(n){console.warn("[db] database upgrade needed from version",n.oldVersion,"->",n.newVersion);var e,t=(j=F.result).objectStoreNames;(console.log(t),t.contains("_s")||(console.log("make _ store"),j.createObjectStore("_s")),t.contains("_r")||(console.log("make ranges store"),j.createObjectStore("_r")),t.contains("_e")||(console.log("make users store"),j.createObjectStore("_e",{keyPath:"id"})),t.contains("_t"))||(console.log("make chats store"),(e=j.createObjectStore("_t",{keyPath:"id"})).createIndex("chanid",["chanid","id"],{unique:!1}),e.createIndex("re",["re","id"],{unique:!1}),e.createIndex("by",["by","id"],{unique:!1}),e.createIndex("dir","dir",{unique:!1}));t.contains("_p")||(console.log("make p2p chats store"),(e=j.createObjectStore("_p",{keyPath:"id",autoIncrement:!0})).createIndex("room",["room","id"],{unique:!1}));t.contains("_h")||(console.log("make chans store"),(r=j.createObjectStore("_h",{keyPath:"id"})).createIndex("mom",["mom","id"],{unique:!1}),r.createIndex("dir","dir",{unique:!1}),r.createIndex("chatid","chatid",{unique:!1}));if(!t.contains("_c")){console.log("make chanchats store");var r=j.createObjectStore("_c",{keyPath:["chanid","chatid"]})}t.contains("_u")||(console.log("make updates store"),j.createObjectStore("_u")),t.contains("_n")||(console.log("make chanusers store"),j.createObjectStore("_n")),t.contains("_d")||(console.log("make chanupdates store"),j.createObjectStore("_d")),t.contains("_m")||(console.log("make memupdates store"),j.createObjectStore("_m"));for(var i=0,o=K;i<o.length;i++){var u=o[i];j.objectStoreNames.contains(u)||(console.warn("[db] "+u+" store missing, creating a dummy one"),j.createObjectStore(u))}console.warn("[db] database upgrade complete")};var q=function(t,r){return n(void 0,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,I.join()];case 1:return(n=e.sent())?(n.transaction(["_s"],"readwrite").objectStore("_s").put(r,t),[2]):[2]}}))}))},R=function(){return n(void 0,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,I.join()];case 1:return(n=e.sent())?(K.forEach((function(e){return n.transaction([e],"readwrite").objectStore(e).clear()})),[2]):[2]}}))}))},B=function(t,r){return n(void 0,void 0,void 0,(function(){var n,i,o;return e(this,(function(e){switch(e.label){case 0:return[4,I.join()];case 1:return(n=e.sent())?(i=n.transaction([t],"readwrite"),o=i.objectStore(t),r.forEach((function(n){"string"==typeof n.timestamp&&(n.timestamp=new Date(n.timestamp)),o.put(n).onerror=console.error})),[2]):[2]}}))}))},H=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return n(void 0,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,I.join()];case 1:return(n=e.sent())?[4,en.apply(void 0,t)]:[2];case 2:return e.sent(),r=t,i=n.transaction(["_c"],"readwrite").objectStore("_c"),r.forEach((function(n){var e=IDBKeyRange.bound([n],[n,Number.MAX_VALUE]);i.delete(e).onerror=console.error})),function(e){var t=n.transaction(["_t"],"readwrite").objectStore("_t"),r=t.index("chanid");e.forEach((function(n){var e=IDBKeyRange.bound([n],[n,Number.MAX_VALUE]);r.openCursor(e).onsuccess=function(n){var e=n.target.result;e&&(t.delete(e.primaryKey).onerror=console.error,e.continue())}}))}(t.filter((function(n){return n>0}))),[2]}var r,i}))}))},V=function(r){var i=r.id,o=r.dir;return n(void 0,void 0,void 0,(function(){var r,u;return e(this,(function(a){switch(a.label){case 0:return[4,I.join()];case 1:return(r=a.sent())?(u=t([0],o),function(t,r){var i=this;r.forEach((function(r){return n(i,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,nn(r)];case 1:return(n=e.sent())&&n.includes(t)&&en(r),[2]}}))}))}))}(i,u),function(n,e){var t=r.transaction(["_c"],"readwrite").objectStore("_c");e.forEach((function(e){var r=IDBKeyRange.only([e,n]);t.delete(r).onerror=console.error}))}(i,u),function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=r.transaction(["_t"],"readwrite").objectStore("_t");n.forEach((function(n){t.delete(n).onerror=console.error}))}(i),[2]):[2]}}))}))},W=function(r){var i=r.id,o=r.dir;return n(void 0,void 0,void 0,(function(){var r,u;return e(this,(function(a){switch(a.label){case 0:return[4,I.join()];case 1:return(r=a.sent())?(function(t){var r=this;t.forEach((function(t){return n(r,void 0,void 0,(function(){return e(this,(function(n){return en(t),[2]}))}))}))}(u=t(t([0],o),[i])),function(n){var e=r.transaction(["_c"],"readwrite").objectStore("_c");n.forEach((function(n){var t=IDBKeyRange.bound([n],[n,Number.MAX_VALUE]);e.delete(t).onerror=console.error}))}(u),[2]):[2]}}))}))},$=function(t,r){return n(void 0,void 0,void 0,(function(){var n,i,o;return e(this,(function(e){switch(e.label){case 0:return[4,I.join()];case 1:return(n=e.sent())?(console.log("add",t,r),i=n.transaction([t],"readwrite"),o=i.objectStore(t),[2,new Promise((function(n){var e=o.put(r);e.onsuccess=function(e){n(e.target.result)},e.onerror=console.error}))]):[2]}}))}))},Y=function(t,r){return n(void 0,void 0,void 0,(function(){var n,i,o,u,a,s,c;return e(this,(function(e){switch(e.label){case 0:return[4,I.join()];case 1:return(n=e.sent())?0===r.length?[2,{value:[],missed:[]}]:(i=performance.now(),o=[],u=new Set,a=n.transaction([t],"readonly"),s=a.objectStore(t),c=0,[2,new Promise((function(n){r.forEach((function(e){var a=s.get(e);a.onerror=console.error,a.onsuccess=function(){if(a.result?o.push(a.result):u.add(e),++c===r.length){var s={value:o,missed:Array.from(u)};console.log("[db]","get "+t+" in",C(i),"ms",s),n(s)}}}))}))]):[2,{value:[],missed:r}]}}))}))},G=function(t,r,i,o,u,a,s){return void 0===s&&(s="prev"),n(void 0,void 0,void 0,(function(){var n,c,l,d,f,v,h,p;return e(this,(function(e){switch(e.label){case 0:return[4,I.join()];case 1:return(n=e.sent())?(c=performance.now(),l=[],d=n.transaction([t],"readonly"),f=r?r(d.objectStore(t),i,u,a):[d.objectStore(t),null],v=f[0],h=f[1],p=0,[2,new Promise((function(n){v.openCursor(h,s).onsuccess=function(e){var r=e.target.result;if(r){if(l.push(r.value),o&&++p===o)return console.log("[db] scan",t,i,u||"",o,"in",C(c),"ms",{value:l}),n(l);r.continue()}else console.log("[db] scan",t,i,u||"",o,"in",C(c),"ms",{value:l}),n(l)}}))]):[2,[]]}}))}))},X=function(n,e,t,r){var i=t?IDBKeyRange.upperBound(t,r):null;if(!e)return[n,i];var o=t||Number.MAX_VALUE;return[n=n.index("room"),i=IDBKeyRange.bound([e.value],[e.value,o],!1,r)]},Z=function(n,e,t,r){var i=t?IDBKeyRange.upperBound(t,r):null;if(!e)return[n,i];var o=t||Number.MAX_VALUE;return[n,i=IDBKeyRange.bound([e.value],[e.value,o],!1,r)]},J=function(t,r,i,o){return void 0===i&&(i=30),void 0===o&&(o=!0),n(void 0,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return[4,G("_c",Z,{value:t},i,r,o,"prev")];case 1:return[2,n.sent().map((function(n){return n.chatid}))]}}))}))},Q=function(t,r,i){return n(void 0,void 0,void 0,(function(){var o,u,a,s;return e(this,(function(c){switch(c.label){case 0:return[4,I.join()];case 1:return(o=c.sent())?(u=o.transaction(["_r"],"readwrite"),a=u.objectStore("_r"),(s=a.get(t)).onerror=console.error,s.onsuccess=function(o){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){if(s.result){if(i)return[2,a.put([s.result[0],s.result[1],i],t).onerror=console.error];r[0]<s.result[0]&&(r[0]=s.result[0]),r[1]>s.result[0]&&(r[1]=s.result[1])}return a.put(r,t).onerror=console.error,[2]}))}))},[2]):[2]}}))}))},nn=function(n){return rn(n,"_r")},en=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return n(void 0,void 0,void 0,(function(){return e(this,(function(n){return[2,un.apply(void 0,t(["_r"],r))]}))}))},tn=function(n){return rn(n,"_s")},rn=function(t,r){return n(void 0,void 0,void 0,(function(){var n,i,o;return e(this,(function(e){switch(e.label){case 0:return[4,I.join()];case 1:return(n=e.sent())?(i=n.transaction([r],"readonly"),o=i.objectStore(r),[2,new Promise((function(n){var e=o.get(t);e.onerror=console.error,e.onsuccess=function(){return n(e.result)}}))]):[2]}}))}))},on=function(t,r,i){return n(void 0,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,I.join()];case 1:return(n=e.sent())?(n.transaction([t],"readwrite").objectStore(t).put(i,r),[2]):[2]}}))}))},un=function(t){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return n(void 0,void 0,void 0,(function(){var n,i,o;return e(this,(function(e){switch(e.label){case 0:return[4,I.join()];case 1:return(n=e.sent())?(i=n.transaction([t],"readwrite"),o=i.objectStore(t),r.forEach((function(n){return o.delete(n).onerror=console.error})),[2]):[2]}}))}))},an=function(n,e){return crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:e},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])},sn=function(n){return crypto.subtle.importKey("raw",n,{name:"ECDH",namedCurve:"P-256"},!0,[])},cn=function(){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return console.log("[sec] generating key pairs"),[4,crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"])];case 1:return[2,n.sent()]}}))}))},ln=function(t,r,i){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return[4,crypto.subtle.encrypt({name:"AES-GCM",iv:i},r,t)];case 1:return[2,n.sent()]}}))}))},dn=function(t,r,i){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return[4,crypto.subtle.decrypt({name:"AES-GCM",iv:i},r,t)];case 1:return[2,n.sent()]}}))}))};let fn,vn=[];function hn(n){function e(t){if(0===arguments.length)return fn&&!e.__o.has(fn)&&(e.__o.add(fn),fn.u.push(e)),n;n=t;let r=fn;return fn=void 0,e.o=new Set(e.__o),e.o.forEach((n=>n.i=!1)),e.o.forEach((n=>{n.i||n()})),fn=r,n}return e.$o=1,e.__o=new Set,e.t=vn,e}function pn(n){n.__c.forEach(pn),n.u.forEach((e=>{e.__o.delete(n),e.o&&e.o.delete(n)})),n.l.forEach((n=>n())),mn(n)}function mn(n){n.u=[],n.__c=[],n.l=[]}let gn=(n,e,t,r)=>{let i={};for(let o=1;o<e.length;o++){let u=e[o],a="number"==typeof u?t[u]:u,s=e[++o];if(1===s)r[0]=a;else if(3===s)r[1]=Object.assign(r[1]||{},a);else if(5===s)(r[1]=r[1]||{})[e[++o]]=a;else if(6===s){let n=e[++o],t=(r[1]=r[1]||{})[n],u=i[n];u||"function"!=typeof a&&"function"!=typeof t||(u=t&&[t]||[],r[1][n]=function(){let n="";for(var e=0;e<u.length;e++)n+="function"==typeof u[e]?u[e].call(this):u[e];return n}),u?u.push(a):r[1][n]+=a+""}else if(s){let e=()=>n.apply(null,gn(n,a,t,["",null]));r.push("function"==typeof r[0]?e:e())}else r.push(a)}return r},bn=function(n){let e,t,r=1,i="",o="",u=[0],a=n=>{1===r&&(n||(i=i.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?u.push(n||i,0):3===r&&(n||i)?(u.push(n||i,1),r=2):2===r&&"..."===i&&n?u.push(n,3):2===r&&i&&!n?u.push(!0,5,i):r>=5&&((i||!n&&5===r)&&(u.push(i,r,t),r=6),n&&(u.push(n,r,t),r=6)),i=""};for(let s=0;s<n.length;s++){s&&(1===r&&a(),a(s));for(let c=0;c<n[s].length;c++)e=n[s][c],1===r?"<"===e?(a(),u=[u],r=3):i+=e:4===r?"--"===i&&">"===e?(r=1,i=""):i=e+i[0]:o?e===o?o="":i+=e:'"'===e||"'"===e?o=e:">"===e?(a(),r=1):r&&("="===e?(r=5,t=i,i=""):"/"===e&&(r<5||">"===n[s][c+1])?(a(),3===r&&(u=u[0]),r=u,(u=u[0]).push(r,2),r=0):" "===e||"\t"===e||"\n"===e||"\r"===e?(a(),r=2):i+=e),3===r&&"!--"===i&&(r=4,u=u[0])}return a(),u},yn=new Map,wn=function(n){let e=yn.get(this);return e||(e=new Map,yn.set(this,e)),e=gn(this,e.get(n)||(e.set(n,e=bn(n)),e),arguments,[]),e.length>1?e:e[0]},kn=function(){let n=wn.apply(this,arguments);if(n)return Array.isArray(n)?this(n):"object"==typeof n?n:this([n])};function Cn(){let n=kn.bind(this);return(this.wrap||n).apply(n,arguments)}let Sn={},En=[];function xn(n){return this.t&&this.t[n.type](n)}Sn.h=(...n)=>{let e,t=r=>{if(null==r);else if("string"==typeof r)e?Sn.add(e,r):e=Sn.s?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r);else if(Array.isArray(r))e||(e=document.createDocumentFragment()),r.forEach(t);else if(r instanceof Node)e?Sn.add(e,r):e=r;else if("object"==typeof r)Sn.property(e,r,null,Sn.s);else if("function"==typeof r)if(e){let n=Sn.add(e,"");Sn.insert(e,r,n)}else e=r.apply(null,n.splice(1));else Sn.add(e,""+r)};return n.forEach(t),e},Sn.insert=(n,e,t,r,i)=>(n=t&&t.parentNode||n,i=i||r instanceof Node&&r,e===r||(r&&"string"!=typeof r||!("string"==typeof e||"number"==typeof e&&(e+=""))?"function"==typeof e?Sn.subscribe((()=>{r=Sn.insert(n,e.call({el:n,endMark:t}),t,r,i)})):(t?r&&(i||(i=r.o&&r.o.nextSibling||t.previousSibling),Sn.rm(n,i,t)):n.textContent="",r=null,e&&!0!==e&&(r=Sn.add(n,e,t))):(null!=r&&n.firstChild?t?(t.previousSibling||n.lastChild).data=e:n.firstChild.data=e:t?Sn.add(n,e,t):n.textContent=e,r=e)),r),Sn.property=(n,e,t,r,i)=>{if(null!=e)if(!t||"attrs"===t&&(r=!0))for(t in e)Sn.property(n,e[t],t,r,i);else"o"!==t[0]||"n"!==t[1]||e.$o?"function"==typeof e?Sn.subscribe((()=>{Sn.property(n,e.call({el:n,name:t}),t,r,i)})):i?n.style.setProperty(t,e):r||"data-"===t.slice(0,5)||"aria-"===t.slice(0,5)?n.setAttribute(t,e):"style"===t?"string"==typeof e?n.style.cssText=e:Sn.property(n,e,null,r,!0):("class"===t&&(t+="Name"),n[t]=e):((n,e,t)=>{e=e.slice(2).toLowerCase(),t?n.addEventListener(e,xn):n.removeEventListener(e,xn),(n.t||(n.t={}))[e]=t})(n,t,e)},Sn.add=(n,e,t)=>{let r=(n=>{const{childNodes:e}=n;if(e&&11===n.nodeType)return e.length<2?e[0]:{o:Sn.add(n,"",e[0])}})(e=(n=>"string"==typeof n?document.createTextNode(n):n instanceof Node?n:Sn.h(En,n))(e))||e;return n.insertBefore(e,t&&t.parentNode&&t),r},Sn.rm=(n,e,t)=>{for(;e&&e!==t;){let t=e.nextSibling;n===e.parentNode&&n.removeChild(e),e=t}},Sn.subscribe=function(n){return function(n,e){function t(){let r=fn;return fn&&fn.__c.push(t),pn(t),t.i=!0,fn=t,e=n(e),fn=r,e}function r(){return t.i?fn&&t.u.forEach((n=>n())):e=t(),e}n.s=t,mn(t),t(),r.$o=1}(n),()=>pn(n.s)},Sn.cleanup=function(n){return fn&&fn.l.push(n),n},Sn.root=function(n){let e=fn,t=()=>{};fn=t,mn(t);let r=n((()=>{pn(t),fn=void 0}));return fn=e,r},Sn.sample=function(n){let e=fn;fn=void 0;let t=n();return fn=e,t},Sn.hs=(...n)=>{let e=Sn.s;Sn.s=!0;let t=An(...n);return Sn.s=e,t};let An=(...n)=>Sn.h.apply(Sn.h,n),_n=(...n)=>Cn.apply(An,n);var Un,Tn,Mn=new Map,Dn=function(n,e,t){void 0===t&&(t=!1);var r=Mn.get(n)||[];t?r=[e]:r.push(e),Mn.set(n,r)},Ln=function(n,e){return Mn.has(n)?Mn.get(n).forEach((function(n){return n(e)})):void 0},Pn={},On=function(n){return n&&(Object.assign(Pn,n),Ln("config",Pn)),Pn},jn=hn(void 0),In={id:hn(0),name:hn(""),chans:hn([]),salt:new Uint8Array};function Nn(){return n(this,void 0,void 0,(function(){var n,t,r,i,o,u,a,s,c,l;return e(this,(function(e){switch(e.label){case 0:return[4,tn("a")];case 1:return!(n=e.sent())||n.byteLength<54?[2]:(t=new Uint8Array(n,0,16),r=new Uint8Array(n,16,32),16===t.length&&(In.salt=t),32!==r.length?[3,3]:(i=In,[4,crypto.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt","decrypt"])]));case 2:i.sskey=e.sent(),e.label=3;case 3:return o=new Uint8Array(n,48,4),u=new Uint8Array(n,52),a=new DataView(o.buffer).getInt32(48,!1),s=(new TextDecoder).decode(u),a&&s&&(In.id(a),In.name(s)),[4,tn("c")];case 4:return(c=e.sent())&&c instanceof Array&&In.chans(c),console.log("[au]",In),(l=new Uint8Array(20)).set(t),l.set(o,16),setTimeout(f),[2,l]}}))}))}function Kn(t,r){return n(this,void 0,void 0,(function(){var n,i;return e(this,(function(e){switch(e.label){case 0:return[4,zn((n=new TextEncoder).encode(t),n.encode(r))];case 1:return i=e.sent(),[4,crypto.subtle.exportKey("raw",i)];case 2:return[2,e.sent()]}}))}))}function Fn(t,r){return n(this,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return[4,zn((new TextEncoder).encode(t),r)];case 1:return[2,n.sent()]}}))}))}function zn(t,r){return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"])];case 1:return n=e.sent(),[2,crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])]}}))}))}function qn(t){var r=t.data,i=t.chans;return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,Rn(r)];case 1:return n=e.sent(),$("_e",n),On({d:!0}),In.chans(i),q("c",i),[2]}}))}))}function Rn(t){return n(this,void 0,void 0,(function(){var n,r,i,o,u,a,s,c,l,d;return e(this,(function(e){switch(e.label){case 0:return n=new Uint8Array(t.slice(16,20)),r=new Uint8Array(t.slice(20)),i=new DataView(n.buffer).getInt32(0,!1),o=(new TextDecoder).decode(r),In.id(i),In.name(o),In.salt=new Uint8Array(t.slice(0,16)),u=In,[4,zn(jn(),In.salt)];case 1:return u.sskey=e.sent(),jn(void 0),s=Uint8Array.bind,[4,crypto.subtle.exportKey("raw",In.sskey)];case 2:return a=new(s.apply(Uint8Array,[void 0,e.sent()])),c=In.salt.length,(l=new Uint8Array(c+a.length+n.length+r.length)).set(In.salt),l.set(a,c),l.set(n,c+a.length),l.set(r,c+a.length+n.length),q("a",l.buffer),d=U(),[2,{id:i,name:o,tz:d}]}}))}))}!function(n){n.Shin=function(n){return{tag:"Shin",value:n}},n.Shan=function(n){return{tag:"Shan",value:n}},n.Tree=function(n){return{tag:"Tree",value:n}},n.NewChat=function(n){return{tag:"NewChat",value:n}},n.NewUser=function(n){return{tag:"NewUser",value:n}},n.Login=function(n){return{tag:"Login",value:n}},n.Logout=function(n){return{tag:"Logout",value:n}},n.Users=function(n){return{tag:"Users",value:n}},n.Chans=function(n){return{tag:"Chans",value:n}},n.Chats=function(n){return{tag:"Chats",value:n}},n.MuteChan=function(n){return{tag:"MuteChan",value:n}},n.UnmuteChan=function(n){return{tag:"UnmuteChan",value:n}},n.AddMems=function(n){return{tag:"AddMems",value:n}},n.DelChat=function(n){return{tag:"DelChat",value:n}},n.DelChan=function(n){return{tag:"DelChan",value:n}},n.EditChat=function(n){return{tag:"EditChat",value:n}},n.EditChan=function(n){return{tag:"EditChan",value:n}},n.Mems=function(n){return{tag:"Mems",value:n}},n.FindUsers=function(n){return{tag:"FindUsers",value:n}},n.FindMems=function(n){return{tag:"FindMems",value:n}},n.PushSubs=function(n){return{tag:"PushSubs",value:n}},n.Ons=function(n){return{tag:"Ons",value:n}},n.Unpack=function(n){return{tag:"Unpack",value:n}},n.Tz=function(n){return{tag:"Tz",value:n}},n.Profile={tag:"Profile"},n.EditProfile=function(n){return{tag:"EditProfile",value:n}},n.Pwd=function(n){return{tag:"Pwd",value:n}},n.Email=function(n){return{tag:"Email",value:n}},n.Au=function(n){return{tag:"Au",value:n}},n.Signup=function(n){return{tag:"Signup",value:n}},n.Fp=function(n){return{tag:"Fp",value:n}},n.EditStatus=function(n){return{tag:"EditStatus",value:n}},n.Status=function(n){return{tag:"Status",value:n}},n.ChatThread=function(n){return{tag:"ChatThread",value:n}},n.ChatList=function(n){return{tag:"ChatList",value:n}},n.Star=function(n){return{tag:"Star",value:n}},n.Sdp=function(n){return{tag:"Sdp",value:n}}}(Un||(Un={})),function(n){n.Shin=function(n){return{tag:"Shin",value:n}},n.Shan=function(n){return{tag:"Shan",value:n}},n.Tree=function(n){return{tag:"Tree",value:n}},n.Treeid=function(n){return{tag:"Treeid",value:n}},n.Chats=function(n){return{tag:"Chats",value:n}},n.Chans=function(n){return{tag:"Chans",value:n}},n.Users=function(n){return{tag:"Users",value:n}},n.Chat=function(n){return{tag:"Chat",value:n}},n.Login=function(n){return{tag:"Login",value:n}},n.MuteChan=function(n){return{tag:"MuteChan",value:n}},n.UnmuteChan=function(n){return{tag:"UnmuteChan",value:n}},n.DelChan=function(n){return{tag:"DelChan",value:n}},n.Update=function(n){return{tag:"Update",value:n}},n.Updates=function(n){return{tag:"Updates",value:n}},n.ChanUpdates=function(n){return{tag:"ChanUpdates",value:n}},n.MemUpdates=function(n){return{tag:"MemUpdates",value:n}},n.On=function(n){return{tag:"On",value:n}},n.Ons=function(n){return{tag:"Ons",value:n}},n.Mems=function(n){return{tag:"Mems",value:n}},n.Err=function(n){return{tag:"Err",value:n}},n.NewChan=function(n){return{tag:"NewChan",value:n}},n.FindUsers=function(n){return{tag:"FindUsers",value:n}},n.FindMems=function(n){return{tag:"FindMems",value:n}},n.Logout=function(n){return{tag:"Logout",value:n}},n.AddMems=function(n){return{tag:"AddMems",value:n}},n.Unpack=function(n){return{tag:"Unpack",value:n}},n.Profile=function(n){return{tag:"Profile",value:n}},n.Pwd=function(n){return{tag:"Pwd",value:n}},n.Name=function(n){return{tag:"Name",value:n}},n.Signup=function(n){return{tag:"Signup",value:n}},n.Typing=function(n){return{tag:"Typing",value:n}},n.Status=function(n){return{tag:"Status",value:n}},n.ChatThread=function(n){return{tag:"ChatThread",value:n}},n.ChatList=function(n){return{tag:"ChatList",value:n}},n.Sdp=function(n){return{tag:"Sdp",value:n}}}(Tn||(Tn={}));const Bn=(n,e=0,t=!0)=>({pos:e,littleEndian:t,view:new DataView(n)}),Hn=(n,e)=>{const{view:{buffer:t},pos:r}=n,i=t.byteLength;if(i-r>e)return n;const o=Math.max(2*i,i+e),u=new Uint8Array(o);return u.set(new Uint8Array(t)),Bn(u.buffer,r,n.littleEndian)},Vn=(n,e)=>{n=Hn(n,1);const{view:t,pos:r}=n;return t.setUint8(r,e),n.pos+=1,n},Wn=(n,e)=>{n=Hn(n,4);const{view:t,pos:r,littleEndian:i}=n;return t.setUint32(r,e,i),n.pos+=4,n},$n=(n,e)=>{n=Hn(n,2);const{view:t,pos:r,littleEndian:i}=n;return t.setUint16(r,e,i),n.pos+=2,n};function Yn(n,e){const{view:t,pos:r,littleEndian:i}=n;return t.setUint32(i?r:r+4,e,i),t.setUint32(i?r+4:r,0,i),n.pos+=8,n}const Gn=(n,e)=>{n=Hn(n,4);const{view:t,pos:r,littleEndian:i}=n;return t.setInt32(r,e,i),n.pos+=4,n},Xn=new TextEncoder,Zn="encodeInto"in Xn?(n,e)=>Xn.encodeInto(n,e).written:(n,e)=>{const t=Xn.encode(n);return e.set(t),t.length},Jn=(n,e)=>{n=Hn(n,3*e.length+8);const t=Zn(e,new Uint8Array(n.view.buffer,n.pos+8));return(n=Yn(n,t)).pos+=t,n},Qn=(n,e)=>Vn(n,e?1:0),ne=n=>(e,t)=>t.reduce(n,((n,e)=>Yn(Hn(n,8),e))(e,t.length)),ee=n=>(e,t)=>null===t?Vn(e,0):n(Vn(e,1),t),te=n=>{const{pos:e,view:t}=n;return n.pos+=1,t.getUint8(e)},re=n=>{const{pos:e,view:t,littleEndian:r}=n;return n.pos+=2,t.getUint16(e,r)},ie=n=>{const{pos:e,view:t,littleEndian:r}=n;return n.pos+=4,t.getUint32(e,r)},oe=n=>{const{view:e,pos:t,littleEndian:r}=n;return n.pos+=8,e.getUint32(r?t:t+4,r)},ue=n=>{const{pos:e,view:t,littleEndian:r}=n;return n.pos+=4,t.getInt32(e,r)},ae=n=>1===te(n),se=n=>e=>1===te(e)?n(e):null,ce=n=>e=>{const t=oe(e),r=new Array;for(let i=0;i<t;i++)r.push(n(e));return r},le=new TextDecoder,de=n=>{const e=oe(n),{pos:t,view:{buffer:r}}=n,i=le.decode(new Uint8Array(r,t,e));return n.pos+=e,i};var fe=ne(Gn),ve=ee(Jn),he=ee(fe),pe=ee(Gn),me=ee(Qn),ge=ee((function(n,e){var t=e.id,r=e.lo;return Gn(Gn(n,t),r)})),be=ne(Jn),ye=ee(be),we=ne(Vn),ke=ee(((n,e)=>{n=Hn(n,8);const{view:t,pos:r,littleEndian:i}=n;return t.setFloat64(r,e,i),n.pos+=8,n})),Ce=ee(we),Se=ee($n),Ee=function(n,e){var t=e.id,r=e.txt,i=e.by,o=e.chanid,u=e.dir,a=e.timestamp,s=e.men,c=e.re,l=e.nor,d=e.star;return me(pe(pe(he(Jn(fe(Gn(Gn(Jn(Gn(n,t),r),i),o),u),a),s),c),l),d)},xe=(ne(Ee),ne((function(n,e){var t=e.id,r=e.fullname,i=e.mom,o=e.by,u=e.dir,a=e.md,s=e.timestamp,c=e.chatid,l=e.about,d=e.to,f=e.re;return pe(he(ve(Gn(Jn($n(fe(Gn(Gn(Jn(Gn(n,t),r),i),o),u),a),s),c),l),d),f)})),function(n,e){var t=e.id,r=e.name,i=e.online;return Qn(Jn(Gn(n,t),r),i)}),Ae=ne(xe),_e=(ee((function(n,e){var t=e.data,r=e.chans;return fe(we(n,t),r)})),function(n,e){var t=e.id,r=e.action,i=e.chatid,o=e.txt;return ve(Gn($n(Gn(n,t),r),i),o)}),Ue=(ne(_e),ne((function(n,e){var t=e.id,r=e.action,i=e.chanid,o=e.name,u=e.about,a=e.md;return Se(ve(ve(Gn($n(Gn(n,t),r),i),o),u),a)})),ne((function(n,e){var t=e.id,r=e.action,i=e.chanid,o=e.by;return Gn(Gn($n(Gn(n,t),r),i),o)})),ne((function(n,e){var t=e.chanid,r=e.users;return Ae(Gn(n,t),r)})),function(n,e){var t=e.email,r=e.fullname,i=e.about;return ve(ve(ve(n,t),r),i)}),Te=function(n,e){var t=e.i,r=e.ub,i=e.lb,o=e.kw;return ve(pe(pe(Gn(n,t),r),i),o)},Me=function(n,e){var t=e.fr,r=e.to,i=e.offer,o=e.sd,u=e.ca;return be(we(me(pe(pe(n,t),r),i),o),u)},De=function(n,e){var t=e.txt;return Jn(n,t)},Le=function(n,e){var t=e.st,r=e.tz;return ve(ve(n,t),r)},Pe=function(n,e){switch(e.tag){case"Shin":return function(n,e){var t=e.chanid,r=e.kw,i=e.lu,o=e.cu,u=e.mu,a=e.ub,s=e.lb;return pe(pe(pe(pe(ge(ve(pe(n,t),r),i),o),u),a),s)}(Wn(n,0),e.value);case"Shan":return function(n,e){var t=e.chanid,r=e.kw,i=e.cu,o=e.mu,u=e.ub,a=e.lb;return pe(pe(pe(pe(ve(Gn(n,t),r),i),o),u),a)}(Wn(n,1),e.value);case"Tree":return function(n,e){var t=e.kw,r=e.reload;return me(ve(n,t),r)}(Wn(n,2),e.value);case"NewChat":return function(n,e){var t=e.txt,r=e.chanid,i=e.re,o=e.chname,u=e.men,a=e.to,s=e.emails;return ye(he(he(ve(pe(Gn(Jn(n,t),r),i),o),u),a),s)}(Wn(n,3),e.value);case"NewUser":return function(n,e){var t=e.name,r=e.key,i=e.tz,o=e.tgid,u=e.tgname,a=e.tgfn,s=e.tgln;return ve(ve(ve(ke(ve(we(Jn(n,t),r),i),o),u),a),s)}(Wn(n,4),e.value);case"Login":return function(n,e){var t=e.name,r=e.key,i=e.tz;return ve(we(Jn(n,t),r),i)}(Wn(n,5),e.value);case"Logout":return we(Wn(n,6),e.value);case"Users":return fe(Wn(n,7),e.value);case"Chans":return fe(Wn(n,8),e.value);case"Chats":return fe(Wn(n,9),e.value);case"MuteChan":return Gn(Wn(n,10),e.value);case"UnmuteChan":return Gn(Wn(n,11),e.value);case"AddMems":return function(n,e){var t=e.chanid,r=e.userids,i=e.emails;return ye(he(Gn(n,t),r),i)}(Wn(n,12),e.value);case"DelChat":return Gn(Wn(n,13),e.value);case"DelChan":return Gn(Wn(n,14),e.value);case"EditChat":return function(n,e){var t=e.id,r=e.txt;return Jn(Gn(n,t),r)}(Wn(n,15),e.value);case"EditChan":return function(n,e){var t=e.id,r=e.name,i=e.about,o=e.md;return Se(ve(ve(Gn(n,t),r),i),o)}(Wn(n,16),e.value);case"Mems":return fe(Wn(n,17),e.value);case"FindUsers":return Jn(Wn(n,18),e.value);case"FindMems":return function(n,e){var t=e.chanid,r=e.kw;return Jn(Gn(n,t),r)}(Wn(n,19),e.value);case"PushSubs":return function(n,e){var t=e.endpoint,r=e.auth,i=e.p256dh;return Jn(Jn(Jn(n,t),r),i)}(Wn(n,20),e.value);case"Ons":return fe(Wn(n,21),e.value);case"Unpack":return Jn(Wn(n,22),e.value);case"Tz":return Jn(Wn(n,23),e.value);case"Profile":return Wn(n,24);case"EditProfile":return Ue(Wn(n,25),e.value);case"Pwd":return function(n,e){var t=e.key,r=e.okey;return Ce(we(n,t),r)}(Wn(n,26),e.value);case"Email":return Jn(Wn(n,27),e.value);case"Au":return Jn(Wn(n,28),e.value);case"Signup":return Jn(Wn(n,29),e.value);case"Fp":return Jn(Wn(n,30),e.value);case"EditStatus":return Le(Wn(n,31),e.value);case"Status":return Gn(Wn(n,32),e.value);case"ChatThread":return Te(Wn(n,33),e.value);case"ChatList":return Te(Wn(n,34),e.value);case"Star":return Gn(Wn(n,35),e.value);case"Sdp":return Me(Wn(n,36),e.value)}},Oe=ce(ue),je=se(de),Ie=se(Oe),Ne=se(ue),Ke=se(ae),Fe=(se((function(n){return{id:ue(n),lo:ue(n)}})),ce(de)),ze=(se(Fe),ce(te)),qe=(se((n=>{const{pos:e,view:t,littleEndian:r}=n;return n.pos+=8,t.getFloat64(e,r)})),se(ze)),Re=se(re),Be=function(n){return{id:ue(n),txt:de(n),by:ue(n),chanid:ue(n),dir:Oe(n),timestamp:de(n),men:Ie(n),re:Ne(n),nor:Ne(n),star:Ke(n)}},He=ce(Be),Ve=ce((function(n){return{id:ue(n),fullname:de(n),mom:ue(n),by:ue(n),dir:Oe(n),md:re(n),timestamp:de(n),chatid:ue(n),about:je(n),to:Ie(n),re:Ne(n)}})),We=function(n){return{id:ue(n),name:de(n),online:ae(n)}},$e=ce(We),Ye=se((function(n){return{data:ze(n),chans:Oe(n)}})),Ge=function(n){return{id:ue(n),action:re(n),chatid:ue(n),txt:je(n)}},Xe=ce(Ge),Ze=ce((function(n){return{id:ue(n),action:re(n),chanid:ue(n),name:je(n),about:je(n),md:Re(n)}})),Je=ce((function(n){return{id:ue(n),action:re(n),chanid:ue(n),by:ue(n)}})),Qe=ce((function(n){return{chanid:ue(n),users:$e(n)}})),nt=function(n){return{email:je(n),fullname:je(n),about:je(n)}},et=function(n){return{fr:Ne(n),to:Ne(n),offer:Ke(n),sd:ze(n),ca:Fe(n)}},tt=function(n){return{txt:de(n)}},rt=function(n){return{st:je(n),tz:je(n)}},it=function(n){switch(ie(n)){case 0:return Tn.Shin(function(n){return{chats:He(n),chans:Ve(n),users:$e(n)}}(n));case 1:return Tn.Shan(Oe(n));case 2:return Tn.Tree(Ve(n));case 3:return Tn.Treeid(Oe(n));case 4:return Tn.Chats(He(n));case 5:return Tn.Chans(Ve(n));case 6:return Tn.Users($e(n));case 7:return Tn.Chat(Be(n));case 8:return Tn.Login(Ye(n));case 9:return Tn.MuteChan(Ne(n));case 10:return Tn.UnmuteChan(Ne(n));case 11:return Tn.DelChan(ue(n));case 12:return Tn.Update(Ge(n));case 13:return Tn.Updates(Xe(n));case 14:return Tn.ChanUpdates(Ze(n));case 15:return Tn.MemUpdates(Je(n));case 16:return Tn.On(We(n));case 17:return Tn.Ons(Oe(n));case 18:return Tn.Mems(Qe(n));case 19:return Tn.Err(re(n));case 20:return Tn.NewChan(ue(n));case 21:return Tn.FindUsers($e(n));case 22:return Tn.FindMems($e(n));case 23:return Tn.Logout(ae(n));case 24:return Tn.AddMems(ae(n));case 25:return Tn.Unpack(je(n));case 26:return Tn.Profile(nt(n));case 27:return Tn.Pwd(qe(n));case 28:return Tn.Name(je(n));case 29:return Tn.Signup(re(n));case 30:return Tn.Typing(function(n){return{by:Ne(n),dir:Oe(n),key:je(n),keyCode:Re(n),anchor:re(n),focus:re(n),txt:je(n),chname:je(n),re:Ne(n)}}(n));case 31:return Tn.Status(rt(n));case 32:return Tn.ChatThread(Oe(n));case 33:return Tn.ChatList(Oe(n));case 34:return Tn.Sdp(et(n))}throw new Error("bad variant index for Response")},ot=Bn(new ArrayBuffer(512)),ut=function(n,e){return ot.pos=0,ot=e(ot,n),new Uint8Array(ot.view.buffer).slice(0,ot.pos)},at=function(n,e){return e(Bn(n))},st=function(n){return at(n.buffer,it)},ct=function(n){return ut(n,Pe)},lt=function(n){return ut(n,De)},dt=function(n){return at(n.buffer,tt)};const ft=n=>new Zlib.RawInflate(n).decompress(),vt=n=>new Zlib.RawDeflate(n).compress();var ht,pt,mt=0,gt=0;function bt(t,r){return n(this,void 0,void 0,(function(){var n,i,o,u,a,s,c,l,d,f,h,p;return e(this,(function(e){switch(e.label){case 0:return mt++,console.groupCollapsed("[ax]","-> [nr] pack",mt,t),function(n,e){if(!n.length&&!n.byteLength)return console.log(n);console.log(e,"Length",n.length||n.byteLength,"bytes"),console.log((Object(n).buffer instanceof ArrayBuffer?n:"string"==typeof n?(new TextEncoder).encode(n):new Uint8ClampedArray(n)).reduce((function(n,e,t,r){return n+(t%16==0?t.toString(16).padStart(6,0)+"  ":" ")+e.toString(16).padStart(2,0)+(t===r.length-1||t%16==15?" ".repeat(3*(15-t%16))+Array.from(r).splice(t-t%16,16).reduce((function(n,e){return n+(e>31&&e<127||e>159?String.fromCharCode(e):".")}),"  ")+"\n":"")}),""))}(n=ct(t)),console.groupEnd(),i=On(),o=i.z,u=i.c,a=i.d,o&&(n=vt(n)),u?(d=crypto.getRandomValues(new Uint8Array(12)),v(n,d),s=k,c=[d],l=Uint8Array.bind,[4,ln(n,r,d)]):[3,2];case 1:n=s.apply(void 0,c.concat([new(l.apply(Uint8Array,[void 0,e.sent()]))])),e.label=2;case 2:return a?(d=crypto.getRandomValues(new Uint8Array(12)),v(n,d),f=k,h=[d],p=Uint8Array.bind,[4,ln(n,In.sskey,d)]):[3,4];case 3:n=f.apply(void 0,h.concat([new(p.apply(Uint8Array,[void 0,e.sent()]))])),e.label=4;case 4:return ht=performance.now(),[2,n]}}))}))}function yt(t,r){return n(this,void 0,void 0,(function(){var n,i,o,u,a,s,c,l,d;return e(this,(function(e){switch(e.label){case 0:return n=new Uint8Array(t),i=n.length,gt++,console.log("[ax]","<- [nr]",gt,i,"bytes in",C(ht),"ms"),o=On(),u=o.z,a=o.c,o.d?(c=n.subarray(0,12),s=Uint8Array.bind,[4,dn(n.subarray(12),In.sskey,c)]):[3,2];case 1:n=new(s.apply(Uint8Array,[void 0,e.sent()])),v(n,c),e.label=2;case 2:return a?(c=n.subarray(0,12),l=Uint8Array.bind,[4,dn(n.subarray(12),r,c)]):[3,4];case 3:n=new(l.apply(Uint8Array,[void 0,e.sent()])),v(n,c),e.label=4;case 4:return u&&(n=ft(n)),d=(100*i/n.length).toFixed(2),console.log("[ax] unpacked",gt,i+" / "+n.length+" bytes "+d+"% in "+C(ht)+" ms"),[2,wt(n)]}}))}))}function wt(n){var e=st(n);return console.groupCollapsed("[ax]","<- [nr] decode",gt,e),console.table(e.value),console.groupEnd(),e}var kt=document.location.hash.substr(1).match(/^ip\/(?<ip>[\:\.\d]+)$/),Ct=kt?null===(pt=kt.groups)||void 0===pt?void 0:pt.ip:"mx.hyze.io:9898";console.warn(Ct);var St,Et,xt,At,_t=O(),Ut=!1,Tt=500,Mt=0,Dt=function(n){},Lt={recv:function(n){return Dt=n},send:function(t){return n(this,void 0,void 0,(function(){var n,r;return e(this,(function(e){switch(e.label){case 0:return[4,_t.join()];case 1:return e.sent(),r=(n=Et).send,[4,bt(t,At)];case 2:return r.apply(n,[e.sent()]),[2]}}))}))}};function Pt(){Ut=!0,Mt++,Tt+=w(0,Mt<16?200:3e3),console.groupEnd(),console.groupEnd(),console.group("[ws]","retry "+Mt+" in "+(Tt/1e3).toFixed(2)+" sec"),setTimeout(Ot,Tt)}function Ot(){return n(this,void 0,void 0,(function(){var t,r=this;return e(this,(function(i){switch(i.label){case 0:return[4,Nt()];case 1:return t=i.sent(),St=performance.now(),(Et=new WebSocket("wss://"+Ct)).binaryType="arraybuffer",Et.onopen=function(){return n(r,void 0,void 0,(function(){return e(this,(function(n){return console.log("[ws] open in "+C(St)+" ms"),Et.send(t),console.log("[ws] -> send offer"),[2]}))}))},Et.onmessage=jt,Et.onerror=console.error,Et.onclose=Pt,[2]}}))}))}function jt(t){var r=t.data;return n(this,void 0,void 0,(function(){var n,t,i;return e(this,(function(e){switch(e.label){case 0:return console.log("[ws] <- received answer in "+C(St)+" ms"),n=new Uint8Array(r),t=On(function(n){var e=new a(n);return{z:e.get(0),c:e.get(1),d:e.get(2)}}(n)),console.log(t),[4,sn(n.slice(1))];case 1:return i=e.sent(),[4,an(xt.privateKey,i)];case 2:return At=e.sent(),Et.onmessage=It,_t.complete(),Ut&&Ln("reconnected"),Ut=!1,[2]}}))}))}function It(t){var r=t.data;return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return n=Dt,[4,yt(r,At)];case 1:return n.apply(void 0,[e.sent()]),[2]}}))}))}function Nt(){return n(this,void 0,void 0,(function(){var t,r=this;return e(this,(function(i){switch(i.label){case 0:return[4,(o=function(){return n(r,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,cn()];case 1:return xt=e.sent(),[4,crypto.subtle.exportKey("raw",xt.publicKey)];case 2:return n=e.sent(),[2,new Uint8Array(n)]}}))}))},u=Nn,n(void 0,void 0,void 0,(function(){var n,t,r;return e(this,(function(e){switch(e.label){case 0:return[4,Promise.all([o(),u()])];case 1:return n=e.sent(),t=n[0],(r=n[1])?[2,m(t,r)]:[2,S(t,64,24)]}}))})))];case 1:return t=i.sent(),console.log("[ws] offer in "+C(St)+" ms"),[2,t]}var o,u}))}))}console.groupCollapsed("[ws]","starting..."),Ot();function Kt(n){for(var e=(n+"=".repeat((4-n.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(e),r=new Uint8Array(t.length),i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}function Ft(){return n(this,void 0,void 0,(function(){var n,t,r;return e(this,(function(e){switch(e.label){case 0:return[4,navigator.serviceWorker.ready];case 1:return[4,e.sent().pushManager.getSubscription()];case 2:return(n=e.sent())?[3,3]:(console.log("no valid subscription"),navigator.serviceWorker.getRegistration().then((function(n){null==n||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Kt("BIm2PpzmeMy3pe_VkzyP8Yq-iqG8ay0qLBGcJZNXnq5lOKu1fAyY9xQ2PK2KQjzWulmKu8IzBLmut276h4tIw5k")}).then((function(n){console.log("push subscription",n)}),(function(n){console.log("error getting push permission",n)}))})),[3,5]);case 3:return t=JSON.parse(JSON.stringify(n)),[4,tn("s")];case 4:if((r=e.sent())instanceof ArrayBuffer&&(new TextDecoder).decode(r)==t.keys.auth)return[2];q("s",(new TextEncoder).encode(t.keys.auth).buffer),Ln("subs",t),e.label=5;case 5:return[2]}}))}))}function zt(n,e,t){const{root:r,subscribe:i,sample:o,cleanup:u}=Sn;null==t&&(t=!e.$t);let a=Sn.h([]),s=Sn.add(a,""),c=new Map,l=new Map,d=new Set;function f(n,i){if(null==n)return;let o=l.get(n);return 1===i?(d.delete(n),o||(o=t?r((t=>(c.set(n,t),e(n.$v||n)))):e(n.$v||n),11===o.nodeType&&(o=(n=>{const{childNodes:e}=n,{length:t}=e;if(t<2)return e[0];let r=Array.from(e);return{nodeType:111,t:r[0],o:r[t-1],l(){if(e.length!==t){let e=0;for(;e<t;)n.appendChild(r[e++])}return n}}})(o)||o),l.set(n,o))):-1===i&&d.add(n),((n,e)=>111===n.nodeType?1/e<0?e?Sn.rm(n.t.parentNode,n.t.nextSibling,n.o.nextSibling)||n.t:n.o:e?n.l():n.t:n)(o,i)}function v(n){let e=c.get(n);e&&(e(),c.delete(n)),l.delete(n)}return u(i((e=>{let t=n();return o((()=>{d.clear();let n=Array.from(function(n,e,t,r,i){let o,u,a=new Map,s=new Map;for(o=0;o<e.length;o++)a.set(e[o],o);for(o=0;o<t.length;o++)s.set(t[o],o);for(o=u=0;o!==e.length||u!==t.length;){var c=e[o],l=t[u];if(null===c)o++;else if(t.length<=u)n.removeChild(r(e[o],-1)),o++;else if(e.length<=o)n.insertBefore(r(l,1),r(e[o],0)||i),u++;else if(c===l)o++,u++;else{var d=s.get(c),f=a.get(l);void 0===d?(n.removeChild(r(e[o],-1)),o++):void 0===f?(n.insertBefore(r(l,1),r(e[o],0)||i),u++):(n.insertBefore(r(e[f],1),r(e[o],0)||i),e[f]=null,f>o+1&&o++,u++)}}return t}(s.parentNode,e||[],t,f,s));return d.forEach(v),n}))}))),u((function(){c.forEach((n=>n())),c.clear(),l.clear(),d.clear()})),a}"serviceWorker"in navigator&&(navigator.serviceWorker.register("sw.js").then((function(){console.log("[sw] registered")})),navigator.serviceWorker.addEventListener("message",(function(n){n.data.reload&&location.reload()}),!1));for(var qt="0VMZYpdgCGL3iKAzDHwocTt97e1hasO2mJNjExq4PvR6XyWSFbIn-5B_8fUukQlr",Rt=qt.split(""),Bt=new Array(123),Ht=0;Ht<qt.length;Ht++)Bt[qt.charCodeAt(Ht)]=Ht;var Vt=function(n){if(n<0)return"-"+Vt(-n);for(var e=n>>>0,t=n/4294967296>>>0,r="";t>0;)r=Rt[63&e]+r,e>>>=6,e|=(63&t)<<26,t>>>=6;var i="";do{i=Rt[63&e]+i,e>>>=6}while(e>0);return i+r},Wt={ntob:Vt,bton:function(n){for(var e=0,t=0;t<n.length;t++)e=64*e+Bt[n.charCodeAt(t)];return e}};const $t=[0,null,"⛩",0],Yt=(()=>{let n=hn($t);const e=hn([n]),t=e=>n(e),r=n=>{let r=e();r[n[0]]!==n&&(r[n[0]]=n),r.splice(n[0]+1),e(r),t(n),location.hash=n[0]>0?Wt.ntob(n[3]):""};return{path:e=>n()[e],paths:e,len:()=>e().length,setpath:t,same:e=>e===n(),cd:r,update:n=>{e([$t,...n]),t(n[n.length-1]||$t)},ishome:()=>n()===$t,home:()=>r($t)}})();var Gt=[];function Xt(){!function(n){for(var e=0,t=Gt;e<t.length;e++)(0,t[e])(n)}(document.location.hash.substr(1))}window.addEventListener("hashchange",Xt),setTimeout(Xt);var Zt=30;function Jt(n){return function(e){return void 0===e?n:n.get(e)}}function Qt(n){var e=hn(n);return e.add=function(n){return e().indexOf(n)<0?e(t(t([],e()),[n])):e()},e.delete=function(n){e().splice(e().indexOf(n),1),e(e())},e.last=function(){return e()[e().length-1]},e.pop=function(){var n=e().pop();return e(e()),n},e}function nr(n){return{id:n.id,by:n.by,chanid:n.chanid,dir:n.dir,timestamp:new Date(n.timestamp),men:n.men,re:n.re,txt:hn(n.txt),star:hn(n.star),first:hn(!1),last:hn(!1),firstre:hn(!1),lastre:hn(!1),showby:hn(!1),nor:hn(n.nor)}}var er=function(n,e){return n.reduce((function(n,e){return n.has(e.id)||n.set(e.id,nr(e)),n}),e)},tr=function(n,e){return n.reduce((function(n,e){return n.has(e.id)?"online"in e&&n.get(e.id).online(e.online):n.set(e.id,{id:e.id,name:e.name,online:hn(e.online),tz:hn(""),st:hn("")}),delete e.online,n}),e)},rr=function(n,e){return n.reduce((function(n,e){if(n.has(e.id)){var t=n.get(e.id);t.fullname(e.fullname),t.about(e.about),t.md(e.md)}else n.set(e.id,function(n){return{id:n.id,mom:n.mom,by:n.by,dir:n.dir,timestamp:new Date(n.timestamp),chatid:n.chatid,to:n.to,re:n.re,fullname:hn(n.fullname),about:hn(n.about),md:hn(n.md)}}(e));return n}),e)};var ir=hn([]),or=hn([]),ur=hn(0),ar=hn(0),sr=hn(0),cr=hn(0),lr=hn(""),dr=hn(""),fr=hn(null),vr=hn(!1),hr=hn(!1),pr=Jt(new Map),mr=Jt(new Map),gr=Jt(new Map),br={id:0,childids:hn([]),childs:Jt(new Map),open:function(){return!0}},yr=Jt(new Map([[0,br]])),wr=hn([]),kr=Qt([]),Cr=Qt([]),Sr=hn([]),Er=hn([]),xr=hn(0),Ar=hn(null),_r=hn(!1),Ur=hn(""),Tr=hn(!1),Mr=Qt([]),Dr=Qt([]),Lr=Qt([]),Pr=hn(!0),Or=hn(!1),jr=hn(!1);hn(""),hn("");var Ir,Nr=hn(0),Kr=hn(0),Fr=hn(0),zr=hn(null),qr=hn(location.hash.substr(1)),Rr=hn(0),Br=Qt([]),Hr=Jt(new Map),Vr=Qt([]),Wr=hn(!1),$r=function(){return or().length>0?or()[or().length-1]:0},Yr=(()=>{const n={},e={};return{create:t=>e[t]=new Promise((e=>n[t]=e)),complete:(e,t)=>n[e]?n[e](t):null,join:n=>e[n],joinall:(...n)=>Promise.all(n.map((n=>e[n]))),select:(...n)=>Promise.race(n.map((n=>e[n])))}})(),Gr={content:null},Xr=function(){switch(Fr()){case 1:return"please login first";case 2:return"invalid login name or password";case 3:return"email existed";case 4:return"username existed";case 5:return"please select a topic";case 6:return"topic is empty";case 7:return"invalid email address";case 8:return"error adding people";case 9:return"error signing up";case 10:return"invalid name";case 11:return"invalid input";case 12:return"password too short";case 13:return"invalid password";case 14:return"new password is the same with old password";case 15:return"peer offline";case 16:return"You are behind a NAT or firewall, can not create a direct connection to peer"}};function Zr(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.includes(Fr())}var Jr=function(n){Fr(n),clearTimeout(Ir),Ir=setTimeout((function(){return Fr(0)}),5e3)},Qr=function(n){zr(n),clearTimeout(Ir),Ir=setTimeout((function(){return zr(null)}),5e3)};s((function(n,e){var t,r,i;t=n+" is "+(e?"on":"off")+"line",r=void 0,i="useron","Notification"in window&&("granted"===Notification.permission?new Notification(t,{body:r,icon:"/icon-256.png",tag:i}):"denied"!==Notification.permission&&Notification.requestPermission().then((function(n){"granted"===n&&new Notification(t,{body:r,icon:"/icon-256.png",tag:i})})))}),500),Lt.recv((function(r){var i=r.tag,o=r.value;return n(void 0,void 0,void 0,(function(){var r,u,a,s,c,l,d,v,m,g,b,y,w,k,C,S,E,x,A,U,T,M,D;return e(this,(function(L){switch(L.label){case 0:switch(i){case"Err":return[3,1];case"Unpack":return[3,2];case"AddMems":return[3,3];case"Logout":return[3,4];case"NewChan":return[3,5];case"Shin":return[3,6];case"Update":return[3,7];case"Updates":return[3,8];case"ChanUpdates":return[3,9];case"MemUpdates":return[3,10];case"Login":return[3,11];case"Pwd":return[3,13];case"Users":return[3,16];case"Chans":return[3,17];case"Chat":return[3,18];case"Chats":return[3,19];case"Shan":return[3,20];case"Tree":return[3,24];case"Treeid":return[3,25];case"MuteChan":return[3,28];case"UnmuteChan":return[3,31];case"DelChan":return[3,34];case"Mems":return[3,35];case"FindUsers":return[3,36];case"FindMems":return[3,37];case"On":return[3,38];case"Ons":return[3,39];case"Profile":return[3,40];case"Name":return[3,41];case"Signup":return[3,42];case"ChatThread":return[3,43];case"ChatList":return[3,44];case"Status":return[3,45];case"Sdp":return[3,46]}return[3,47];case 1:return Jr(o),[3,47];case 2:return Yr.complete("unpack",o),[3,47];case 3:return Yr.complete("addmems",o),[3,47];case 4:return On({d:!1}),[3,47];case 5:return cr(o),f(),[3,47];case 6:return er((r=o).chats,mr()),tr(r.users,gr()),rr(r.chans,pr()),B("_t",r.chats),B("_h",r.chans),B("_e",r.users),function(t){n(this,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){return n=t||[],r=ur(),0===n.length?(vr(!0),Q(r,[],!0),console.log("top chat reached"),Yr.complete("chatscan",n),[2]):(vr(!1),Q(r,[n[0],n[n.length-1]]),i=n.map((function(n){return{chanid:r,chatid:n}})),B("_c",i),Yr.complete("chatscan",n),[2])}))}))}(r.chats.map((function(n){return n.id}))),[3,47];case 7:return u=o,_i(a=new Set([ur()]),u),a.forEach((function(n){return on("_u",n,u.id)})),[3,47];case 8:return(s=o).length&&function(t){n(this,void 0,void 0,(function(){var n,r,i,o;return e(this,(function(e){for(n=new Set([ur()]),r=0,i=t;r<i.length;r++)o=i[r],_i(n,o);return n.forEach((function(n){return on("_u",n,t[t.length-1].id)})),[2]}))}))}(s),[3,47];case 9:return(c=o).length&&function(t){n(this,void 0,void 0,(function(){var n,r,i,o,u,a,s,c,l,d,f,v;return e(this,(function(e){switch(e.label){case 0:n=new Set([ur()]),r=0,i=t,e.label=1;case 1:if(!(r<i.length))return[3,9];switch(o=i[r],u=o.action,a=o.chanid,s=o.name,c=o.about,l=o.md,u){case 1:return[3,2];case 2:return[3,6]}return[3,8];case 2:return(d=pr(a))&&(null!==s&&d.fullname(s),null!==c&&d.about(c),null!==l&&d.md(l)),[4,rn(a,"_h")];case 3:return(f=e.sent())?(null!==s&&(f.fullname=s),null!==c&&(f.about=c),null!==l&&(f.md=l),[4,$("_h",f)]):[3,5];case 4:e.sent(),f.dir.forEach((function(e){return n.add(e)})),e.label=5;case 5:return[3,8];case 6:return[4,wi(a)];case 7:return(v=e.sent())&&v.dir.forEach((function(e){return n.add(e)})),[3,8];case 8:return r++,[3,1];case 9:return n.forEach((function(n){return on("_d",n,t[t.length-1].id)})),[2]}}))}))}(c),[3,47];case 10:return(l=o).length&&function(r){n(this,void 0,void 0,(function(){var n,i,o,u,a,s,c,l,d,f,v,h,p,m,g,b;return e(this,(function(y){switch(y.label){case 0:for(n=new Set([ur()]),i=new Map,o=0,u=r;o<u.length;o++)switch(a=u[o],s=a.action,c=a.chanid,l=a.by,s){case 1:i.has(c)?i.get(c).adds.push(l):i.set(c,{adds:[l],rms:[]});break;case 0:i.has(c)?i.get(c).rms.push(l):i.set(c,{adds:[],rms:[l]})}d=function(r,i,o){var u;return e(this,(function(e){switch(e.label){case 0:return[4,rn(r,"_n")];case 1:return(u=e.sent())&&(u=u.filter((function(n){return o.indexOf(n)<0})),on("_n",r,Array.from(new Set(t(t([],i),u))))),n.add(r),[2]}}))},f=0,v=i.entries(),y.label=1;case 1:return f<v.length?(h=v[f],p=h[0],m=h[1],g=m.adds,b=m.rms,[5,d(p,g,b)]):[3,4];case 2:y.sent(),y.label=3;case 3:return f++,[3,1];case 4:return Ti(cr()||ur()),n.forEach((function(n){return on("_m",n,r[r.length-1].id)})),[2]}}))}))}(l),[3,47];case 11:return console.groupEnd(),o?[4,qn(o)]:(Jr(2),jn(void 0),Ln("login",!1),[2]);case 12:return L.sent(),Pi(),Ln("login",!0),Wr(!1),cr(0),br.childids([]),xi(),si(),[3,47];case 13:return o?In.id()?[4,Rn(o)]:[3,15]:(jn(void 0),Yr.complete("pwd",13),[2]);case 14:L.sent(),L.label=15;case 15:return Yr.complete("pwd"),[3,47];case 16:return B("_e",o),Yr.complete("users",o),[3,47];case 17:return B("_h",o),Yr.complete("chans",o),[3,47];case 18:return function(r){n(this,void 0,void 0,(function(){var i,o,u,a,s,c,l,d,v=this;return e(this,(function(h){switch(h.label){case 0:return(i=or()).includes(r.id)?[2]:(o=!pr(r.chanid),u=_(),[4,$("_t",r)]);case 1:return h.sent(),a=ur()?r.dir:t([0],r.dir),s=a.map((function(n){return Q(n,[r.id,r.id]),{chanid:n,chatid:r.id}})),B("_c",s),c=new Set(gr().has(r.by)?[]:[r.by]),r.men&&r.men.forEach((function(n){gr().has(n)||c.add(n)})),l=r.dir.filter((function(n){return!pr(n)})),d=new Set(l),[4,ri(c,d)];case 2:return h.sent(),r.re&&Wi(r.re),mr($r()),mr().set(r.id,nr(r)),i.push(r.id),or(i),o&&si(!0),u&&f(),"ontouchstart"in document.documentElement||Li(),r.dir.forEach((function(t){return n(v,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return(n=pr(t))&&(n.chatid=r.id),[4,rn(t,"_h")];case 1:return(n=e.sent())?(n.chatid=r.id,[4,$("_h",n)]):[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))})),[2]}}))}))}(o),[3,47];case 19:return B("_t",d=o),Yr.complete("chats",d),[3,47];case 20:return(v=o).length>0?(hr(!1),[4,oi(v)]):[3,22];case 21:return L.sent(),[3,23];case 22:hr(!0),L.label=23;case 23:return Yr.complete("chanscan",v),[3,47];case 24:return(m=o).length>0&&(B("_h",m),rr(m,pr())),Yr.complete("scantree",m.map((function(n){return n.id}))),[3,47];case 25:return(g=o).length>0?[4,oi(g)]:[3,27];case 26:L.sent(),L.label=27;case 27:return Yr.complete("scantree",o),[3,47];case 28:return o?(C=o,(b=In.chans()).includes(C)?[2]:(b.push(C),In.chans(b),[4,q("c",b)])):[2];case 29:return L.sent(),[4,H.apply(void 0,t([0,C],null!==(U=null===(A=pr(C))||void 0===A?void 0:A.dir)&&void 0!==U?U:[]))];case 30:return L.sent(),xi(),ci(Yt.path(3)),[3,47];case 31:return o?(C=o,(y=In.chans()).includes(C)?((w=y.indexOf(C))>-1&&y.splice(w,1),In.chans(y),[4,q("c",y)]):[2]):[2];case 32:return L.sent(),[4,H.apply(void 0,t([0,C],null!==(M=null===(T=pr(C))||void 0===T?void 0:T.dir)&&void 0!==M?M:[]))];case 33:return L.sent(),xi(),ci(Yt.path(3)),[3,47];case 34:return wi(o),[3,47];case 35:return Yr.complete("memlist",o),[3,47];case 36:return tr(E=o,gr()),B("_e",E),Yr.complete("findusers",E),[3,47];case 37:return tr(E=o,gr()),B("_e",E),Yr.complete("findmems",E),[3,47];case 38:return C=(k=o).id,S=k.online,C?(null===(D=gr(C))||void 0===D||D.online(S),[3,47]):[2];case 39:return(E=o).forEach((function(n){var e;return null===(e=gr(n))||void 0===e?void 0:e.online(!0)})),[3,47];case 40:return Yr.complete("profile",o),[3,47];case 41:return Yr.complete("name",o),[3,47];case 42:return Yr.complete("signup",o),[3,47];case 43:return Yr.complete("thread",o),[3,47];case 44:return Yr.complete("list",o),[3,47];case 45:return Yr.complete("status",o),[3,47];case 46:return(x=o).offer?function(t){var r=t.fr,i=t.sd,o=t.ca;n(this,void 0,void 0,(function(){var n,t,u,a,s,c,l,d,f,v,m,g,b,y,w,k,C,S;return e(this,(function(e){switch(e.label){case 0:return n=Yr.create("ice"),[4,co(r)];case 1:return t=e.sent(),u=p(new Uint8Array(i)),a=u.a,s=u.k,[4,ao()];case 2:return c=e.sent(),l=c.keypair,d=c.pub,[4,sn(s)];case 3:return f=e.sent(),v=t,[4,an(l.privateKey,f)];case 4:return v.sharedkey=e.sent(),m=(new TextDecoder).decode(ft(a)),[4,t.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:m}))];case 5:return e.sent(),[4,t.createAnswer()];case 6:return g=e.sent(),[4,t.setLocalDescription(g)];case 7:e.sent(),b=0,y=o,e.label=8;case 8:return b<y.length?(w=y[b],k=new RTCIceCandidate({candidate:w,sdpMid:"0",sdpMLineIndex:0}),[4,t.addIceCandidate(k)]):[3,11];case 9:e.sent(),e.label=10;case 10:return b++,[3,8];case 11:return C=vt((new TextEncoder).encode(t.localDescription.sdp)),S=h(C,d),[4,n];case 12:return e.sent(),Lt.send(Un.Sdp({fr:null,to:r,sd:S,ca:uo,offer:null})),[2]}}))}))}(x):Yr.complete("offer",x),[3,47];case 47:return[2]}}))}))})),function(n){Gt.push(n)}((function(i){return n(void 0,void 0,void 0,(function(){var o,u,a,s,c,l,v,h,p,m,g,b,y,w,C,S;return e(this,(function(E){switch(E.label){case 0:return qr(i),Rr(0),o=Br(),In.id()>0&&(o=t(t([],o),[In.id()])),[4,Ai(o)];case 1:return E.sent(),"$"!==i[0]?[3,4]:(u=i.slice(1).split("/"),a=u[0],s=u[1],c=u[2],s.length<50?(location.hash="#",[2,Wr(!1)]):[4,Yr.create("unpack",Lt.send(Un.Unpack(s)))]);case 2:return(l=E.sent())?[4,Yr.create("name",Lt.send(Un.Email(l)))]:(location.hash="#",[2,Wr(!1)]);case 3:switch(v=E.sent(),a){case"i":if(!v)return function(t,i){var o=hn("Log in Telegram"),u={};function a(r){r.preventDefault();var o=r.target,a=o.n,s=o.p,c=a.value.trim();Fi(A,c)&&Fi(L,s.value)&&function(t,r,i,o,u){n(this,void 0,void 0,(function(){var n,a,s,c,l,d,f,v,h;return e(this,(function(e){switch(e.label){case 0:return console.groupEnd(),console.groupCollapsed("[au]","register",t,r),[4,R()];case 1:return e.sent(),n=crypto.getRandomValues(new Uint8Array(12)),[4,Fn(o,n)];case 2:return a=e.sent(),[4,Kn(i,r)];case 3:return s=e.sent(),l=k,d=[n],f=Uint8Array.bind,[4,ln(s,a,n)];case 4:return c=l.apply(void 0,d.concat([new(f.apply(Uint8Array,[void 0,e.sent()]))])),v=U(),h={name:r,key:c,tz:v,tgid:u.id||null,tgname:u.username||null,tgfn:u.first_name||null,tgln:u.last_name||null},jn(s),Lt.send(Un.NewUser(h)),[2]}}))}))}(t,c,s.value,i,u)}function s(n){n.preventDefault()(window).Telegram.Login.auth({bot_id:"1850607378",request_access:!0},(function(n){n&&(d("username").value=n.username,o("Log in as "+n.first_name),u=n)}))}Gr.content=_n(Zi||(Zi=r(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Sign up</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input id="username" type="text" name="n" placeholder="Username" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" class=','/>\n                    <script async src="https://telegram.org/js/telegram-widget.js?15"><\/script>\n                    <div><button onclick=',">",'</button></div>\n                    <div class="bn"><button type="submit">Sign up</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Sign up</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input id="username" type="text" name="n" placeholder="Username" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" class=','/>\n                    <script async src="https://telegram.org/js/telegram-widget.js?15"><\/script>\n                    <div><button onclick=',">",'</button></div>\n                    <div class="bn"><button type="submit">Sign up</button></div>\n                </form>\n            </div>\n        </div>\n    '])),t,a,(function(){return Zr(4,10,12)&&_n(Xi||(Xi=r(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),Xr())}),M,D,(function(){return Zr(4,10)&&"er"}),(function(){return Zr(12)&&"er"}),s,o),Wr(!0)}(l,c),[2,Dn("login",(function(n){return n?location.hash="#":null}))];break;case"f":if(v&&(v==In.name()||!In.id()))return[2,Bi(v,l,c)]}return location.hash="#",[2,Wr(!1)];case 4:return"/"!==i[0]?[3,6]:(h=Wt.bton(i.slice(1)),ar(h),or([]),function(t){n(this,void 0,void 0,(function(){var r;return e(this,(function(i){switch(i.label){case 0:return Ei.cb=null,[4,Yr.create("thread",Lt.send(Un.ChatThread({i:t,kw:null,ub:null,lb:null})))];case 1:return r=i.sent(),[4,ni(r,"re")];case 2:return i.sent(),Ei.cb=function(r){return function(t,r){return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,Yr.create("thread",Lt.send(Un.ChatThread({i:t,kw:null,ub:r,lb:null})))];case 1:return n=e.sent(),[2,ni(n)]}}))}))}(t,r)},[2]}}))}))}(h),Li(),[4,si()]);case 5:return E.sent(),[2];case 6:return"&"!==i[0]?[3,10]:(p=Wt.bton(i.slice(1)))==In.id()?[2,location.hash="#"]:(ur(0),ar(0),Ti(0),cr(0),ii([]),or([]),[4,Ai([p])]);case 7:return E.sent(),Rr(p),[4,fo(p)];case 8:return E.sent(),[4,si()];case 9:return E.sent(),!Hr().has(p)&&(null===(y=gr(p))||void 0===y?void 0:y.online())&&so(p),setTimeout((function(){Li(),f()}),100),[2];case 10:return(m=["!","@","*"].indexOf(i[0]))>-1?(ur(0),cr(0),ar(0),or([]),function(t){n(this,void 0,void 0,(function(){var r;return e(this,(function(i){switch(i.label){case 0:return Ei.cb=null,[4,Yr.create("list",Lt.send(Un.ChatList({i:t,kw:null,ub:null,lb:null})))];case 1:return r=i.sent(),[4,ni(r,"re")];case 2:return i.sent(),Ei.cb=function(r){return function(t,r){return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,Yr.create("list",Lt.send(Un.ChatList({i:t,kw:null,ub:r,lb:null})))];case 1:return n=e.sent(),[2,ni(n)]}}))}))}(t,r)},[2]}}))}))}(m),Li(),[4,si()]):[3,12];case 11:return E.sent(),[2];case 12:return"%"===i[0]?[2,location.hash="#"+Wt.ntob(Number(i.slice(1)))]:i&&qt.includes(i[0])?[3,14]:(ur(0),ar(0),Ti(0),cr(0),ii([]),[4,si()]);case 13:return E.sent(),xi(),document.title="hyze - micro chat for team",[2];case 14:return g=Wt.bton(i),[4,si()];case 15:return E.sent(),ur(g),cr(0),ar(0),xi(),pr(g)?(b=null!==(C=null===(w=pr(g))||void 0===w?void 0:w.dir)&&void 0!==C?C:[],ii(t(t([],b),[g])),Ti(g),document.title=(null===(S=pr(ur()))||void 0===S?void 0:S.fullname())+" - hyze",[2]):[2]}}))}))}));var ni=function(t,r){return n(void 0,void 0,void 0,(function(){var n,i,o,u,a,s,c,l,f,v,h;return e(this,(function(e){switch(e.label){case 0:return[4,ei(t)];case 1:return e.sent(),n=t[0],i=new Set,o=new Set,u=or(),a="re"===r?new Set:new Set(u),t=t.filter((function(n){var e=mr(n);if(!e)return!1;gr().has(e.by)||i.add(e.by),e.men&&e.men.forEach((function(n){gr().has(n)||i.add(n)})),e.dir.forEach((function(n){pr().has(n)||o.add(n)}));var t=a.has(n);return t&&console.error("duplicated id in keys",n),a.add(n),!t})),[4,ri(i,o)];case 2:switch(e.sent(),t.reverse(),r){case"re":or(t);break;case"pre":or(u.concat(t));break;default:or(t.concat(u))}for(s=or(),c=0;c<s.length;c++)l=mr(s[c-1]),f=mr(s[c+1]),(v=mr(s[c])).showby(v.by!==(null==l?void 0:l.by)),v.first(v.chanid!==(null==l?void 0:l.chanid)),v.last(v.chanid!==(null==f?void 0:f.chanid)),v.firstre(null!==v.re&&v.re!==(null==l?void 0:l.re)&&v.re!=(null==l?void 0:l.id)),v.lastre(null!==v.re&&v.re!==(null==f?void 0:f.re));return Li(),n&&(null===(h=d(Wt.ntob(n)+"_"))||void 0===h||h.scrollIntoView()),[2]}}))}))},ei=function(t){return n(void 0,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,ti(t)];case 1:return t=e.sent(),n=t.map((function(n){var e;return null===(e=mr(n))||void 0===e?void 0:e.re})).filter((function(n){return n&&n>0&&!mr().has(n)})),ti(Array.from(new Set(n))),[2]}}))}))},ti=function(t){return n(void 0,void 0,void 0,(function(){var n,r,i,o;return e(this,(function(e){switch(e.label){case 0:return 0===(t=t.filter((function(n){return!mr().has(n)}))).length?[2,t]:[4,Y("_t",t)];case 1:return n=e.sent(),r=n.value,i=n.missed,er(r,mr()),i.length>0?[4,Yr.create("chats",Lt.send(Un.Chats(i)))]:[3,3];case 2:o=e.sent(),er(o,mr()),e.label=3;case 3:return[2,t]}}))}))},ri=function(t,r){return n(void 0,void 0,void 0,(function(){var n,i,o,u,a;return e(this,(function(e){switch(e.label){case 0:return[4,Y("_e",Array.from(t))];case 1:return n=e.sent(),[4,Y("_h",Array.from(r))];case 2:return i=e.sent(),n.value.length&&Lt.send(Un.Ons(n.value.filter((function(n){return n.id!=In.id()})).map((function(n){return n.id})))),tr(n.value,gr()),rr(i.value,pr()),n.missed.length>0&&Yr.create("users",Lt.send(Un.Users(n.missed))),i.missed.length>0&&Yr.create("chans",Lt.send(Un.Chans(i.missed))),[4,Yr.joinall("users","chans")];case 3:return o=e.sent(),u=o[0],a=o[1],u&&tr(u,gr()),a&&rr(a,pr()),[2]}}))}))},ii=function(n){var e=n.map((function(n,e){var t=pr(n);return[e+1,null==t?void 0:t.mom,null==t?void 0:t.fullname,n]}));Yt.update(e)},oi=function(t){return n(void 0,void 0,void 0,(function(){var n,r,i,o;return e(this,(function(e){switch(e.label){case 0:return 0===(t=t.filter((function(n){return!pr().has(n)}))).length?[2]:[4,Y("_h",t)];case 1:return n=e.sent(),r=n.value,i=n.missed,console.log("[chans] gets",{value:r,missed:i}),rr(r,pr()),i.length>0?[4,Yr.create("chans",Lt.send(Un.Chans(i)))]:[3,3];case 2:o=e.sent(),rr(o,pr()),e.label=3;case 3:return[2]}}))}))},ui=function(n,e,t,r,i,o){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),r&&dr(r);var u=Un.Shan({chanid:n,kw:r,ub:i,lb:o,cu:e,mu:t});return Yr.create("chanscan",Lt.send(u))};function ai(){return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,G("_h",(function(n){return[n.index("chatid"),null]}))];case 1:return n=e.sent(),console.log("[chans] load tree",n),rr(n,pr()),[2,n.map((function(n){return n.id}))]}}))}))}function si(t,r){return void 0===t&&(t=null),void 0===r&&(r=null),n(this,void 0,void 0,(function(){var n,i,o;return e(this,(function(e){switch(e.label){case 0:return 0===br.childids().length||t?(console.log("[dir]","load tree",t||"",r||""),n=performance.now(),r?(o=[],[3,3]):[3,1]):[3,6];case 1:return[4,ai()];case 2:o=e.sent(),e.label=3;case 3:return(i=o).length<1?[4,pi(t,r)]:[3,5];case 4:i=e.sent(),e.label=5;case 5:li(i),console.log("[dir]","tree loaded",r||"","in",C(n),"ms"),e.label=6;case 6:return[2]}}))}))}var ci=function(t,r,i){return void 0===r&&(r=null),void 0===i&&(i=null),n(void 0,void 0,void 0,(function(){var n,o,u,a,s;return e(this,(function(e){switch(e.label){case 0:return console.groupEnd(),console.log("[dir]","list",t,"ub",i,r?'"'+r+'"':""),n=performance.now(),si(null,r),[4,rn(t,"_d")];case 1:return o=e.sent()||null,[4,rn(t,"_m")];case 2:return u=e.sent()||null,[4,ui(t,o,u,r,i)];case 3:return a=e.sent(),i?0===a.length?console.warn("no more result"):ir(ir().concat(a)):(0!==a.length||r||Ln("nochan"),ir(a)),(s=di(t))&&(fi(ir(),s.childs()),s.childids(ir())),console.log("[dir]","chans load",t,"ub",i,r?'"'+r+'"':"","in",C(n),"ms"),console.groupEnd(),[2]}}))}))};function li(n,e){var t;void 0===e&&(e=0);var r=n.filter((function(n){var t;return(null===(t=pr(n))||void 0===t?void 0:t.mom)==e})),i=di(e);i&&((ur()==e||ur()&&pr(ur())&&(null===(t=pr(ur()))||void 0===t?void 0:t.dir.includes(e)))&&i.open(!0),fi(r,i.childs()),i.childids(r));for(var o=0,u=r;o<u.length;o++){li(n,u[o])}}function di(n){var e,r,i,o,u=n&&pr(n)?t(t([0],null!==(r=null===(e=pr(n))||void 0===e?void 0:e.dir)&&void 0!==r?r:[]),[n]):[0],a=yr();for(o=0;o<u.length;o++){var s=u[o];a.has(s)&&(i=a.get(s),a=i.childs())}return i}function fi(n,e){return n.reduce((function(n,e){return n.has(e)||n.set(e,{id:e,childids:hn([]),childs:Jt(new Map),open:hn(!1)}),n}),e)}var vi=function(n){return void 0===n&&(n=null),ci(Yt.path(3),n)},hi=function(n){void 0===n&&(n=null),fr(n),xi(n)};function pi(t,r){return void 0===t&&(t=null),void 0===r&&(r=null),n(this,void 0,void 0,(function(){return e(this,(function(n){return r&&dr(r),[2,Yr.create("scantree",Lt.send(Un.Tree({kw:r,reload:t})))]}))}))}var mi=function(t){var r=t.id,i=t.mom,o=t.fullname;return n(void 0,void 0,void 0,(function(){return e(this,(function(n){return r===ur()||Yt.cd([Yt.path(0)+1,i,o,r]),[2]}))}))},gi=function(t){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){return Lt.send(Un.MuteChan(t)),[2]}))}))},bi=function(t){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){return Lt.send(Un.UnmuteChan(t)),[2]}))}))},yi=function(t,r,i){return n(void 0,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,Yr.create("addmems",Lt.send(Un.AddMems({chanid:t,userids:r,emails:i})))];case 1:return n=e.sent(),Ti(t),[2,n]}}))}))};function wi(t){return n(this,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){switch(e.label){case 0:return(n=pr(t))&&pr().delete(t),[4,rn(t,"_h")];case 1:return(n=e.sent())?[4,W(n)]:[3,3];case 2:e.sent(),e.label=3;case 3:return r=ir(),(i=r.indexOf(t))>-1&&(r.splice(i,1),ir(r)),[2,n]}}))}))}var ki=function(n,e,t){void 0===n&&(n=null),void 0===e&&(e=null),void 0===t&&(t=null);var r=Un.Shin({chanid:ur(),kw:n,ub:e,lb:t,lu:null,cu:null,mu:null});return Yr.create("chatscan",Lt.send(r))},Ci=function(n,e,t,r,i,o){void 0===n&&(n=null),void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null);var u=Un.Shin({chanid:ur(),kw:r,ub:i,lb:o,lu:n,cu:e,mu:t});return Yr.create("chatscan",Lt.send(u))},Si=function(t){return n(void 0,void 0,void 0,(function(){var n,r,i,o,u,a;return e(this,(function(e){switch(e.label){case 0:return n=fr()||null,r=ur(),console.groupEnd(),console.groupCollapsed("[store]","⬆ load more",r,"ub",t,"kw",n),i=performance.now(),[4,nn(r)];case 1:return(o=e.sent()||[])[2]&&t===o[1]?(vr(!0),console.log("[store] top chat reached"),[2]):(vr(!1),n?[3,4]:[4,J(r,t,Zt)]);case 2:return u=e.sent(),o[2]||u.length===Zt?[4,ni(u)]:[3,4];case 3:return e.sent(),console.log("[store]","scan more",r,"ub",t,"in",C(i),"ms"),[2];case 4:return[4,ki(n,t)];case 5:return(a=e.sent()).length>0?[4,ni(a)]:[3,7];case 6:e.sent(),e.label=7;case 7:return console.log("[store]","update more",r,"ub",t,"kw",n,"in",C(i),"ms"),console.groupEnd(),[2]}}))}))},Ei={cb:null};function xi(t){return void 0===t&&(t=null),n(this,void 0,void 0,(function(){var n,r,i,o,u,a,s,c,l,d,f;return e(this,(function(e){switch(e.label){case 0:return Ei.cb=null,vr(!1),sr(0),n=ur(),console.groupEnd(),console.groupCollapsed("[store]","⟳ reload",n),r=performance.now(),[4,nn(n)];case 1:return i=e.sent()||[],o=void 0,u=t?null:i[0]||null,[4,J(n,o,Zt)];case 2:return a=e.sent(),[4,ni(a,"re")];case 3:return e.sent(),Ei.cb=Si,console.log("[store]","chats reload",n,"in",C(r),"ms"),f={},[4,rn(n,"_u")];case 4:return f.id=e.sent()||0,f.lo=i[1]||0,s=f,[4,rn(n,"_d")];case 5:return c=e.sent()||null,[4,rn(n,"_m")];case 6:return l=e.sent()||null,[4,Ci(s,c,l,t,o,u)];case 7:return d=e.sent()||[],[4,ni(d,d.length!==Zt&&0!==a.length&&u?"pre":"re")];case 8:return e.sent(),console.log("[store]","updated",n,"in",C(r),"ms"),console.groupEnd(),[2]}}))}))}function Ai(t){return n(this,void 0,void 0,(function(){var n,r,i,o,u;return e(this,(function(e){switch(e.label){case 0:return(n=t.filter((function(n){return!gr().has(n)}))).length?[4,Y("_e",n)]:[3,4];case 1:return r=e.sent(),i=r.value,o=r.missed,tr(i,gr()),o.length>0?[4,Yr.create("users",Lt.send(Un.Users(o)))]:[3,3];case 2:(u=e.sent())&&tr(u,gr()),e.label=3;case 3:Lt.send(Un.Ons(n.filter((function(n){return n!=In.id()})))),e.label=4;case 4:return[2]}}))}))}function _i(t,r){var i,o=r.action,u=r.chatid,a=r.txt;return n(this,void 0,void 0,(function(){var n,r;return e(this,(function(e){switch(e.label){case 0:switch(o){case 1:return[3,1];case 2:return[3,5]}return[3,7];case 1:return null===(i=mr(u))||void 0===i||i.txt(a),[4,rn(u,"_t")];case 2:return(n=e.sent())?(n.txt=null!=a?a:"",[4,$("_t",n)]):[3,4];case 3:e.sent(),n.dir.forEach((function(n){return t.add(n)})),e.label=4;case 4:return[3,7];case 5:return[4,Ui(u)];case 6:return(r=e.sent())&&r.dir.forEach((function(n){return t.add(n)})),[3,7];case 7:return[2]}}))}))}function Ui(t){return n(this,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){switch(e.label){case 0:return(n=mr(t))&&mr().delete(t),[4,rn(t,"_t")];case 1:return(n=e.sent())?[4,V(n)]:[3,3];case 2:e.sent(),e.label=3;case 3:return r=or(),(i=r.indexOf(t))>-1&&(r.splice(i,1),or(r)),Li(),[2,n]}}))}))}function Ti(r){var i,o,u,a;return n(this,void 0,void 0,(function(){var n,s,c,l,d,f,v,h,p,m,g;return e(this,(function(e){switch(e.label){case 0:return r?(n=null===(o=null===(i=pr(r))||void 0===i?void 0:i.md())||void 0===o||o?t(t([],null!==(a=null===(u=pr(r))||void 0===u?void 0:u.dir)&&void 0!==a?a:[]),[r]):[r],[4,Y("_n",n)]):[2,wr([])];case 1:return s=e.sent(),c=s.value,l=s.missed,d=[],l.length?[4,Yr.create("memlist",Lt.send(Un.Mems(l)))]:[3,3];case 2:for(f=e.sent(),v=0,h=f;v<h.length;v++)p=h[v],tr(p.users,gr()),B("_e",p.users),m=p.users.map((function(n){return n.id})),on("_n",p.chanid,m),d=t(t([],d),m);e.label=3;case 3:return[4,Ai(g=Array.from(new Set(t(t([],c.flat()),d))))];case 4:return e.sent(),g.sort((function(n){var e;return(null===(e=gr(n))||void 0===e?void 0:e.online())?-1:0})),wr(g),[2]}}))}))}function Mi(t){return n(this,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){switch(e.label){case 0:return[4,Yr.create("findusers",Lt.send(Un.FindUsers(t)))];case 1:return n=e.sent(),Sr(n),(r=n.find((function(n){return n.name===t})))?xr(n.indexOf(r)):(i=n.find((function(n){return n.name.startsWith(t)})),xr(i?n.indexOf(i):0)),[2,n.length]}}))}))}function Di(t){return n(this,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){switch(e.label){case 0:return[4,Yr.create("findmems",Lt.send(Un.FindMems({chanid:cr()||ur(),kw:t})))];case 1:return n=e.sent(),Er(n),(r=n.find((function(n){return n.name===t})))?xr(n.indexOf(r)):(i=n.find((function(n){return n.name.startsWith(t)})),xr(i?n.indexOf(i):0)),[2,n.length]}}))}))}function Li(){if(d("cs")){var n=window.innerHeight-d("cs").offsetHeight-(In.id()?96:64)-(Tr()&&_r()?56:Tr()?32:_r()?24:0);d("cs").childElementCount>2&&(n-=5),d("os").style.height=n>0?n+"px":"0"}}function Pi(){var n=In.id(),e=gr(n);e?e.online(!0):gr().set(n,{id:n,name:In.name(),online:hn(!0),tz:hn(U()),st:hn("")})}window.onresize=Li,Dn("reconnected",(function(){xi(),ci(Yt.path(3))}));var Oi=new Map;function ji(t,r){return n(this,void 0,void 0,(function(){var n,i,o;return e(this,(function(e){switch(e.label){case 0:return Oi.has(t)?(i=Oi.get(t),[3,3]):[3,1];case 1:return[4,Yr.create("name",Lt.send(Un.Email(t)))];case 2:i=e.sent(),e.label=3;case 3:return n=i,Oi.set(t,n),n?[4,Ii(n)]:[2,Jr(2)];case 4:return o=e.sent(),Ni(n,r,o),[2]}}))}))}function Ii(t){return n(this,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return Lt.send(Un.Au(t)),Qr("a secret 6-digits otp code has been sent to your registered email"),[4,Yr.create("enterotp",Hi())];case 1:return[2,n.sent()]}}))}))}function Ni(t,r,i){return n(this,void 0,void 0,(function(){var n,o,u,a,s,c,l,d,f;return e(this,(function(e){switch(e.label){case 0:return console.groupEnd(),console.groupCollapsed("[au]","login",t),pr().clear(),mr().clear(),gr().clear(),wr([]),[4,R()];case 1:return e.sent(),n=crypto.getRandomValues(new Uint8Array(12)),[4,Fn(i,n)];case 2:return o=e.sent(),[4,Kn(r,t)];case 3:return u=e.sent(),s=k,c=[n],l=Uint8Array.bind,[4,ln(u,o,n)];case 4:return a=s.apply(void 0,c.concat([new(l.apply(Uint8Array,[void 0,e.sent()]))])),d=U(),f={name:t,key:a,tz:d},jn(u),Lt.send(Un.Login(f)),[2]}}))}))}function Ki(t,r,i,o){return void 0===o&&(o=null),n(this,void 0,void 0,(function(){var n,u,a,s,c,l,d,f,v,h;return e(this,(function(e){switch(e.label){case 0:return n=crypto.getRandomValues(new Uint8Array(12)),[4,Fn(r,n)];case 1:return u=e.sent(),o?(c=Uint8Array.bind,[4,Kn(o,t)]):[3,3];case 2:return s=new(c.apply(Uint8Array,[void 0,e.sent()])),[3,4];case 3:s=null,e.label=4;case 4:return a=s,[4,Kn(i,t)];case 5:return l=e.sent(),f=k,v=[n],h=Uint8Array.bind,[4,ln(l,u,n)];case 6:return d=f.apply(void 0,v.concat([new(h.apply(Uint8Array,[void 0,e.sent()]))])),jn(l),[2,Yr.create("pwd",Lt.send(Un.Pwd({key:d,okey:a})))]}}))}))}function Fi(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var r=n.apply(void 0,e);return!r||Jr(r)}function zi(){Gr.content=_n(Gi||(Gi=r(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Sign up</div>\n                <div class="sub">We will send a sign up invitation to your email</div>\n                <form onsubmit=',">\n                    ",'\n                    <input type="text" name="m" placeholder="Your email address" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <div class="bn"><button type="submit">Sign up</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Sign up</div>\n                <div class="sub">We will send a sign up invitation to your email</div>\n                <form onsubmit=',">\n                    ",'\n                    <input type="text" name="m" placeholder="Your email address" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <div class="bn"><button type="submit">Sign up</button></div>\n                </form>\n            </div>\n        </div>\n    '])),(function(t){return n(this,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){switch(e.label){case 0:return t.preventDefault(),n=t.target.m,x(r=n.value.trim())?[4,Yr.create("signup",Lt.send(Un.Signup(r)))]:[3,2];case 1:return(i=e.sent())?[2,Jr(i)]:(Qr("an invite code has been sent to "+r+", it should arrive shortly, you might have to check your spam folder"),Wr(!1),[3,3]);case 2:Jr(7),e.label=3;case 3:return[2]}}))}))}),(function(){return Zr(3,7)&&_n(Yi||(Yi=r(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),Xr())}),T,D,(function(){return Zr(3,7)&&"er"})),Wr(!0)}function qi(){Gr.content=_n(Qi||(Qi=r(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Log in</div>\n                <div class="sub"></div>\n                <form onsubmit=',">\n                    ",'\n                    <input type="text" name="m" placeholder="Username or email" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" />\n                    <div class="lf fp"><a onclick=','>Forgot password</a></div>\n                    <div class="bn">\n                        <button type="submit">Log in</button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Log in</div>\n                <div class="sub"></div>\n                <form onsubmit=',">\n                    ",'\n                    <input type="text" name="m" placeholder="Username or email" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" />\n                    <div class="lf fp"><a onclick=','>Forgot password</a></div>\n                    <div class="bn">\n                        <button type="submit">Log in</button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    '])),(function(t){return n(this,void 0,void 0,(function(){var n,r,i,o,u;return e(this,(function(e){switch(e.label){case 0:return t.preventDefault(),n=t.target,r=n.m,i=n.p,x(o=r.value.trim())?[2,ji(o,i.value)]:Fi(A,o)?[4,Ii(o)]:[3,2];case 1:u=e.sent(),Ni(o,i.value,u),e.label=2;case 2:return[2]}}))}))}),(function(){return Zr(7,10)&&_n(Ji||(Ji=r(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),Xr())}),T,D,(function(){return Zr(7,10)&&"er"}),Ri),Wr(!0)}function Ri(){Gr.content=_n(eo||(eo=r(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Forgot password</div>\n                <div class="sub">We will send a password reset link to your email</div>\n                <form onsubmit=',">\n                    ",'\n                    <input type="text" name="m" placeholder="Your email address" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Forgot password</div>\n                <div class="sub">We will send a password reset link to your email</div>\n                <form onsubmit=',">\n                    ",'\n                    <input type="text" name="m" placeholder="Your email address" onkeypress='," onkeyup=",' required autocomplete="on" class=',' />\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '])),(function(t){return n(this,void 0,void 0,(function(){var n,r;return e(this,(function(e){return t.preventDefault(),n=t.target.m,x(r=n.value.trim())?(Yr.create("forgotpwd",Lt.send(Un.Fp(r))),Qr("a password reset link has been sent to "+r+", it should arrive shortly, you might have to check your spam folder"),Wr(!1)):Jr(7),[2]}))}))}),(function(){return Zr(7)&&_n(no||(no=r(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),Xr())}),T,D,(function(){return Zr(7)&&"er"})),Wr(!0)}function Bi(t,i,o){Gr.content=_n(ro||(ro=r(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Reset password</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" class=','/>\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Reset password</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input type="password" name="p" placeholder="Password" required autocomplete="on" class=','/>\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '])),i,(function(r){return n(this,void 0,void 0,(function(){var n,i;return e(this,(function(e){switch(e.label){case 0:return r.preventDefault(),Fi(L,(n=r.target.p).value)?[4,Ki(t,o,n.value)]:[3,2];case 1:if(i=e.sent())return[2,Jr(i)];Qr("password updated"),Wr(!1),location.hash="#",e.label=2;case 2:return[2]}}))}))}),(function(){return Zr(12)&&_n(to||(to=r(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),Xr())}),(function(){return Zr(12)&&"er"})),Wr(!0)}function Hi(){var n=t([],Array(6)).map((function(n){return _n(io||(io=r(['<input class="ot" type="tel" autocomplete="chrome-off"/>'],['<input class="ot" type="tel" autocomplete="chrome-off"/>'])))})),e=n[0];e.addEventListener("input",u),setTimeout((function(){return e.focus()}));for(var i=function(e){var t=n[e];t.addEventListener("keypress",(function(r){r.keyCode>47&&r.keyCode<58&&(t.value=r.key,e!==n.length-1&&n[e+1].focus()),r.preventDefault()})),t.addEventListener("keydown",(function(r){"Backspace"===r.key&&(t.value="",0!==e&&n[e-1].focus())})),t.addEventListener("keyup",(function(e){if(16!==e.keyCode&&9!=e.keyCode&&224!=e.keyCode&&18!=e.keyCode&&17!=e.keyCode){e.target.value.length>1&&u(e);var t=n.map((function(n){return n.value})).join("");t.length===n.length&&Yr.complete("enterotp",t)}}))},o=0;o<n.length;o++)i(o);function u(n){var e=n.data||n.target.value;e&&1!==e.length&&a(n.target,e)}function a(n,e){n.focus(),n.value=e[0],e=e.substring(1),n.nextElementSibling&&e.length&&a(n.nextElementSibling,e)}Gr.content=_n(oo||(oo=r(['\n        <div class="pi">\n            <div class="su otp">\n                <div class="head">Enter OTP code</div>\n                <div class="sub">Please enter the 6-digits code sent to your email</div>\n                <div id="otp">',"</div>\n            </div>\n        </div>\n    "],['\n        <div class="pi">\n            <div class="su otp">\n                <div class="head">Enter OTP code</div>\n                <div class="sub">Please enter the 6-digits code sent to your email</div>\n                <div id="otp">',"</div>\n            </div>\n        </div>\n    "])),n),Wr(!0)}Dn("config",(function(t){var r=t.d;return n(void 0,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return r?(Pi(),Ft(),[3,3]):[3,1];case 1:return In.id()?(cr(0),gr(In.id())&&(null===(n=gr(In.id()))||void 0===n||n.online(!1)),In.id(0),In.name(""),In.chans([]),delete In.sskey,In.salt=new Uint8Array,[4,R()]):[3,3];case 2:e.sent(),br.childids([]),Yt.ishome()?(xi(),si()):Yt.home(),e.label=3;case 3:return[2]}}))}))})),Dn("subs",(function(n){Lt.send(Un.PushSubs({endpoint:n.endpoint,auth:n.keys.auth,p256dh:n.keys.p256dh}))}));var Vi=function(n){cr()!==n?cr(n):cr(0),Ti(cr()||ur()),sr(0)};var Wi=function(t){return n(void 0,void 0,void 0,(function(){var n,r,i;return e(this,(function(e){switch(e.label){case 0:return(n=mr(t))&&n.nor(n.nor()+1),[4,rn(t,"_t")];case 1:return(r=e.sent())?(r.nor=null!==(i=null==n?void 0:n.nor())&&void 0!==i?i:null,[4,$("_t",r)]):[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))};function $i(t){return n(this,void 0,void 0,(function(){return e(this,(function(n){return[2,Yr.create("status",Lt.send(Un.Status(t)))]}))}))}var Yi,Gi,Xi,Zi,Ji,Qi,no,eo,to,ro,io,oo,uo=[];function ao(){return n(this,void 0,void 0,(function(){var n,t;return e(this,(function(e){switch(e.label){case 0:return[4,cn()];case 1:return n=e.sent(),[4,crypto.subtle.exportKey("raw",n.publicKey)];case 2:return t=e.sent(),[2,{keypair:n,pub:new Uint8Array(t)}]}}))}))}function so(t){return n(this,void 0,void 0,(function(){var n,r,i,o,u,a,s,c,l,d,f,v,m,g,b,y,w,k;return e(this,(function(e){switch(e.label){case 0:return n=Yr.create("ice"),[4,co(t)];case 1:return[4,(r=e.sent()).createOffer()];case 2:return i=e.sent(),[4,r.setLocalDescription(i)];case 3:return e.sent(),o=vt((new TextEncoder).encode(r.localDescription.sdp)),[4,ao()];case 4:return u=e.sent(),a=u.keypair,s=u.pub,o=h(o,s),[4,n];case 5:return e.sent(),[4,Yr.create("offer",Lt.send(Un.Sdp({fr:null,to:t,sd:o,ca:uo,offer:!0})))];case 6:return c=e.sent(),l=p(new Uint8Array(c.sd)),d=l.a,f=l.k,[4,sn(f)];case 7:return v=e.sent(),m=r,[4,an(a.privateKey,v)];case 8:m.sharedkey=e.sent(),g=(new TextDecoder).decode(ft(d)),r.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:g})),b=0,y=c.ca,e.label=9;case 9:return b<y.length?(w=y[b],k=new RTCIceCandidate({candidate:w,sdpMid:"0",sdpMLineIndex:0}),[4,r.addIceCandidate(k)]):[3,12];case 10:e.sent(),e.label=11;case 11:return b++,[3,9];case 12:return[2]}}))}))}function co(t){return n(this,void 0,void 0,(function(){var r,i,o=this;return e(this,(function(u){switch(u.label){case 0:return[4,Ai([t])];case 1:return u.sent(),r=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]}),Hr().has(t)||Br.add(t),Hr().set(t,r),r.onicecandidate=function(n){n.candidate?uo.push(n.candidate.candidate):Yr.complete("ice",uo)},r.onconnectionstatechange=function(n){console.log("[peer]",r.connectionState),r.connectionState},(i=r.createDataChannel("p",{negotiated:!0,id:1})).binaryType="arraybuffer",i.onopen=function(n){console.log("dc",t,"open",n)},i.onmessage=function(i){var u=i.data;return n(o,void 0,void 0,(function(){var n,i,o,a,s,c;return e(this,(function(e){switch(e.label){case 0:return n=_(),i=new Uint8Array(u),o=i.subarray(0,12),a=Uint8Array.bind,[4,dn(i.subarray(12),r.sharedkey,o)];case 1:return i=new(a.apply(Uint8Array,[void 0,e.sent()])),v(i,o),(s=dt(ft(i))).by=t,s.ts=new Date,s.room=t,Vr.last().by!=t&&(s.showby=!0),c=s,[4,$("_p",s)];case 2:return c.id=e.sent(),Rr()==t&&Vr.add(s),n&&setTimeout(f),Li(),[2]}}))}))},i.onclose=function(n){var e,r;console.log("dc",t,"close",n),setTimeout((function(){var n;if(null===(n=gr(t))||void 0===n?void 0:n.online())return so(t)}),(e=1e3,r=5e3,Math.random()*(r-e)+e))},i.onerror=function(n){console.warn("dc",t,"error",n)},r.send=function(t){return n(o,void 0,void 0,(function(){var n,o,u,a,s;return e(this,(function(e){switch(e.label){case 0:return n=vt(lt(t)),o=crypto.getRandomValues(new Uint8Array(12)),v(n,o),u=k,a=[o],s=Uint8Array.bind,[4,ln(n,r.sharedkey,o)];case 1:return n=u.apply(void 0,a.concat([new(s.apply(Uint8Array,[void 0,e.sent()]))])),i.send(n),[2]}}))}))},r.open=function(){return"open"===i.readyState},[2,r]}}))}))}function lo(n,e){var t=n.id;if(!t||sr()===t)return sr(0);e.focus(),sr(t)}function fo(t){return n(this,void 0,void 0,(function(){var r;return e(this,(function(i){switch(i.label){case 0:return[4,(o=t,void 0===s&&(s=!0),n(void 0,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return[4,G("_p",X,{value:o},a,u,s,"prev")];case 1:return[2,n.sent()]}}))})))];case 1:return r=i.sent(),Vr(r.reverse()),[2]}var o,u,a,s}))}))}var vo=function(){var n=document.createElement("div");n.contentEditable="true",n.className="s-c",n.oninput=s((function(){var e=n.textContent;e&&e.length>50||(vi(e),hi(e))}),200),n.onkeydown=function(n){"Enter"!==n.key||n.shiftKey||n.preventDefault()};var e=document.createElement("div");return setTimeout((function(){new IntersectionObserver((function(e){if(!(e[0].intersectionRatio<=0)){var t=di(ur()).childids(),r=t[t.length-1];if(!(!r||hr()||t.length<Zt)){var i=n.textContent||null;i&&i.length>50||setTimeout((function(){return ci(Yt.path(3),i,r)}))}}}),{}).observe(e)})),An("div",{class:"cn"},An("div",{class:"s"},n),An("div",{class:"tbl"},An("table",null,An("tbody",null,(function(){return zt(di(ur()).childids,(function(n){var e=pr(n);return An("tr",{onClick:function(){return mi(e)}},An("td",null,An("button",{onClick:function(e){return function(n,e){if(n.stopPropagation(),!In.id())return qi();In.chans().includes(e)?bi(e):gi(e)}(e,n)}},(function(){return In.chans().includes(n)?"➕":"➖"}))),An("td",null,e.fullname))}))}),e))))},ho="formatBlock",po=function(n,e){return n.appendChild(e)},mo=function(n){return document.createElement(n)},go=function(n){return document.queryCommandState(n)},bo=function(n,e){return document.execCommand(n,!1,e)},yo=[{icon:"<b>B</b>",title:"Bold",state:function(){return go("bold")},result:function(){return bo("bold")}},{icon:"<i>I</i>",title:"Italic",state:function(){return go("italic")},result:function(){return bo("italic")}},{icon:"<u>U</u>",title:"Underline",state:function(){return go("underline")},result:function(){return bo("underline")}},{icon:"<strike>S</strike>",title:"Strike-through",state:function(){return go("strikeThrough")},result:function(){return bo("strikeThrough")}},{icon:"&#8220&#8221;",title:"Quote",result:function(){return bo(ho,"<blockquote>")}},{icon:"&lt;&gt;",title:"Code",result:function(){return bo(ho,"<pre>")}},{icon:"&#128279;",title:"Link",class:" lk",result:function(){var n=window.prompt("Enter the link URL");n&&bo("createLink",n)}},{icon:"🌁",title:"Image",class:" im",result:function(){var n=window.prompt("Enter the image URL");n&&bo("insertImage",n)}},{icon:"⏎",title:"Enter to send",class:" en se",result:function(n){return Pr()?Pr(!1):Pr(!0),Pr()?n.classList.add("se"):n.classList.remove("se"),!0}}],wo="e-b",ko="e-bs",Co="",So=0,Eo=!1,xo=hn(!1),Ao=function(){return d("tp")},_o=function(){return d("pm")},Uo=function(){return d("mb")},To=function(n){So=l();var e=n.textContent,t=e.indexOf(" ",So);-1==t&&(t=e.length);var r=/[\S]+$/.exec(e.slice(0,t));return r?r[0]:""},Mo=function(n){var e=n.id,t=n.name;Er([]),xr(0);var r=Ar();if(r.spellcheck=!1,r===Uo()){var i=Co?"@"+t:t;r.textContent=Co?function(n,e){var t=n.textContent,r=t.indexOf(" ",So);-1==r&&(r=t.length);var i=t.slice(0,r).replace(/\S+$/,e);return So=i.length,i+t.slice(r)}(r,i):r.textContent+i,r.focus(),Co?function(n,e){var t=document.createRange(),r=window.getSelection();t.setStart(n.childNodes[0],e),t.collapse(!0),null==r||r.removeAllRanges(),null==r||r.addRange(t)}(r,So):c(),xo(!1),e&&Lr.add(e)}else e?Mr.add(e):Dr.add(Co),r.textContent="",_o().focus()},Do=function(){return An("div",{id:"uls",class:function(){return"uls"+(Ar()===Uo()&&Tr()?" ms":"")}},An("ul",null,zt(Er,(function(n){return An("li",{id:n.id.toString(),tabIndex:-1,class:function(){return Er()[xr()]===n?"se":""},onClick:function(){return Mo(n)},onMouseOver:function(){return Eo||xr(Er().indexOf(n))}},n.id?An("i",{class:function(){var e;return"dot"+((null===(e=gr(n.id))||void 0===e?void 0:e.online())?" on":"")}}):null,n.name)}))))},Lo=function(){return An("div",{class:function(){return"em sel"+(Tr()?" sh":"")},onClick:function(){return _o().focus()}},zt(Dr,(function(n){return An("div",{class:"tg ie"},n,An("i",{onClick:function(){return Dr.delete(n)}},"✕"))})),zt(Mr,(function(n){var e;return An("div",{class:function(){var e;return(null===(e=gr(n))||void 0===e?void 0:e.online())?"tg on":"tg"}},null===(e=gr(n))||void 0===e?void 0:e.name,An("i",{onClick:function(){return Mr.delete(n)}},"✕"))})),An("div",{class:"wp"},An("div",{id:"pm",class:"e-m"+(Dr().length+Mr().length===0?" to":""),onKeyDown:Po,onInput:Io,contentEditable:!0}),(function(){return Ar()===_o()&&Tr()&&Er().length>0&&Do})))};function Po(n){var e;if(!Oo(n)){if(8!=n.keyCode||(null===(e=_o().textContent)||void 0===e?void 0:e.length)||(Mr.pop(),_o().focus()),32!==n.keyCode&&!/^[a-zA-Z0-9\_@\.]+$/.test(n.key))return n.preventDefault(),!1;"Enter"!==n.key&&"Tab"!==n.key||(Uo().focus(),n.preventDefault())}}function Oo(n){var e,t;return!!Er().length&&("Enter"===n.key||"Tab"===n.key||32===n.keyCode?(Mo(Er()[xr()]),n.preventDefault(),!0):27==n.keyCode?(Er([]),xr(),xo(!1),!0):(38==n.keyCode&&(0===xr()?xr(Er().length-1):xr(xr()-1),null===(e=d(Er()[xr()].id))||void 0===e||e.focus(),n.preventDefault(),Eo=!0,setTimeout((function(){return Eo=!1}),300)),40==n.keyCode&&(xr()===Er().length-1?xr(0):xr(xr()+1),null===(t=d(Er()[xr()].id))||void 0===t||t.focus(),n.preventDefault(),Eo=!0,setTimeout((function(){return Eo=!1}),300)),n.target.focus(),!0))}var jo=s((function(t){return n(void 0,void 0,void 0,(function(){var n,r,i,o;return e(this,(function(e){switch(e.label){case 0:return(Co=To(t.target).toLowerCase()).length>50?[2]:[4,Di(Co)];case 1:return n=e.sent(),r=pr(cr()||ur()),i=void 0!==r&&(null!==(o=r.md())&&void 0!==o?o:0)<2,!n&&x(Co)&&i&&Er([{id:0,name:"✉️ Invite "+Co,online:!1}]),[2]}}))}))}),100);function Io(n){Ar(_o()),jo(n)}var No=function(){var n;if(!In.id())return null;if($r()&&mr($r())&&cr()==(null===(n=mr($r()))||void 0===n?void 0:n.chanid))return null;var e=pr(cr());if(!e)return null;_()&&setTimeout(f,50);var r=function(){return t(t([],e.dir.slice(Yt.len()-2)),[e.id])};return r().length>0&&An("div",{class:"dr",style:function(){return"background:"+E(e.id)}},zt(r,(function(n){var e;return An("span",null,An("a",{href:"#"+Wt.ntob(n)},null===(e=pr(n))||void 0===e?void 0:e.fullname))})))},Ko=function(){return An("div",{id:"tp",class:function(){return"e-t"+(_r()?" sh":"")},onKeyUp:zo,onKeyDown:Fo,contentEditable:!0})},Fo=function(n){n.target.spellcheck=!1,"Enter"===n.key&&n.preventDefault()},zo=function(n){Ur(n.target.textContent),"Enter"===n.key&&(Uo().focus(),n.preventDefault())},qo=function(){return!(cr()||ur()||Tr()||_r())},Ro=function(){return An(Array.prototype,null,An("style",null,".e-c[contenteditable]:empty::before { content: '"+function(){var n,e="Send a "+(Tr()?"private ":"")+"message ";return cr()?n=pr(cr()):ur()&&(n=pr(ur())),n?e+(_r()?"on new topic "+(Ur()?'"'+Ur()+'" ':"")+'in "'+n.fullname()+'"':'in "'+n.fullname()+'"'):_r()?e+"on new topic "+(Ur()?'"'+Ur()+'"':""):e+"..."}()+"'; }"),(function(){return Ar()===Uo()&&xo()&&Er().length>0&&Do}),An("div",{id:"mb",class:"e-c",onKeyDown:Ho,onInput:Vo,onFocus:Bo,contentEditable:!0}))},Bo=function(){if(0!==or().length)return qo()?(cr(mr($r()).chanid),void Ti(cr())):cr()||Tr()||_r()?void 0:(cr(mr($r()).chanid),void Ti(cr()))},Ho=function(t){if(Ar(Uo()),"@"===t.key&&xo(!0),!Oo(t)&&"Enter"===t.key){if(t.preventDefault(),Pr()&&!t.shiftKey)return void function(t,r){var i;n(this,void 0,void 0,(function(){var n,o,u,a,s,c,l,d,f,v;return e(this,(function(e){switch(e.label){case 0:return In.id()?t.innerHTML.length>120||r.innerHTML.length>4e3?[2,Jr(11)]:r.innerHTML.trim()?Rr()?(null===(i=gr(Rr()))||void 0===i?void 0:i.online())?Hr(Rr()).open()?(n={txt:r.innerHTML.trim()},Hr(Rr()).send(n),n.by=In.id(),n.ts=new Date,n.room=Rr(),(null==(o=Vr.last())?void 0:o.by)!=In.id()&&(n.showby=!0),u=n,[4,$("_p",n)]):[2,Jr(16)]:[2,Jr(15)]:[3,2]:[2]:[2,Jr(1)];case 1:return u.id=e.sent(),Vr.add(n),r.textContent="",Li(),[2];case 2:return a=cr()||ur(),s=sr()||ar()||null,c=null,t.textContent===lr()||(null==(c=t.textContent)?void 0:c.trim().length)?a||Tr()||c&&c.trim().length?(l=r.innerHTML.trim(),d=null,f=null,v=null,Tr()&&(Mr().length>0&&(d=Mr.add(In.id()).sort((function(n,e){return n-e}))),Dr().length>0&&(f=Dr())),Lr().length>0&&(v=Lr().filter((function(n){var e;return l.indexOf("@"+(null===(e=gr(n))||void 0===e?void 0:e.name))>-1}))),Lt.send(Un.NewChat({txt:l,chanid:a,re:s,chname:c,men:v,to:d,emails:f})),_r(!1),Tr(!1),t.textContent="",r.textContent="",Ur(""),lr(""),lo({},r),[2]):[2,Jr(5)]:[2,Jr(6)]}}))}))}(Ao(),Uo());t.target.textContent+="\n\n",c()}},Vo=function(n){Uo().spellcheck=!1,xo()&&Wo(n)},Wo=s((function(n){(Co=To(n.target).toLowerCase()).startsWith("@")?(Co=Co.replace(/[@'";:,.\/?\\-]/,"")).length>50||Di(Co):xo(!1)}),100),$o=An("div",{class:"e-a"});yo.forEach((function(n){var e,t,r=mo("button");if(r.className=wo+" eb",n.class&&(r.className+=n.class),r.innerHTML=n.icon,r.title=n.title,r.setAttribute("type","button"),r.onclick=function(e){return n.result(r)&&Uo().focus()},n.state){e="click",t=function(){return r.classList[n.state()?"add":"remove"](ko)},r.addEventListener(e,t)}po($o,r)}));var Yo=mo("button");Yo.className=wo+" md",Yo.innerHTML="👤",Yo.title="Private message",Yo.setAttribute("type","button");var Go=function(){if(!In.id())return qi();var n=_();Yo.classList.add("se"),Tr(!0),n&&setTimeout(f),Li(),"ontouchstart"in document.documentElement||_o().focus()};Yo.onclick=function(){return Tr()?(Yo.classList.remove("se"),Tr(!1),void Li()):Go()};var Xo=mo("button");Xo.className="ntb",Xo.innerHTML="✏️ New Topic",Xo.title="New topic",Xo.setAttribute("type","button"),Xo.onclick=function(n){if(!In.id())return qi();var e=_();_r()?_r(!1):_r(!0),e&&_r()&&setTimeout(f),function(n,e){if(_r(n),Li(),n?Xo.classList.add("se"):Xo.classList.remove("se"),"ontouchstart"in document.documentElement)return;n&&Ao().focus();e&&(Ao().innerText=e,Ur(e))}(_r())},po($o,Xo),po($o,Yo),bo("defaultParagraphSeparator","div");var Zo=function(){return An("div",{class:function(){return"e"+(In.id()?qo()?" ds":"":" hd")}},(function(){var n,e;return sr()?An("div",{class:"re",style:function(){return"color:"+E(sr())}},An("i",null,"→"),An("b",null,null===(n=gr(mr(sr()).by))||void 0===n?void 0:n.name),An("a",{href:"#/"+Wt.ntob(sr())},null===(e=mr(sr()))||void 0===e?void 0:e.txt)):null}),No," ",Ko," ",Lo," ",Ro," ",$o)},Jo=function(n,e){var t,r=null===(t=d(n+"_"))||void 0===t?void 0:t.querySelector(".ct");if("true"===r.contentEditable)return r.contentEditable=!1,r.classList.remove("ce"),r.innerHTML=e.txt(),void(r.onclick=function(){return!1});r.spellcheck=!1,r.contentEditable=!0,r.classList.add("ce"),r.focus(),r.onclick=function(n){"true"===r.contentEditable&&n.stopPropagation()},r.onkeydown=function(n){if("Tab"===n.key)return document.execCommand("insertHTML",!1,"&#09"),n.preventDefault();if("Escape"===n.key)return r.contentEditable=!1,r.classList.remove("ce"),void(r.innerHTML=e.txt());if("Enter"===n.key){var t=r.innerHTML.trim();n.shiftKey||(n.preventDefault(),r.contentEditable=!1,r.classList.remove("ce"),t!==e.txt()&&(i=e.id,o=t,Lt.send(Un.EditChat({id:i,txt:o}))))}var i,o}};var Qo="6aa35ee",nu="0.0.334";function eu(t){var r=t.name;return n(this,void 0,void 0,(function(){function n(n){var e,t,r;n.preventDefault();var u=n.target.n,a=u.value.trim()==i?null:u.value.trim(),s=null!==(r=null===(t=null===(e=d("ab"))||void 0===e?void 0:e.textContent)||void 0===t?void 0:t.trim())&&void 0!==r?r:null,c=function(n,e){return n&&n.length<2?10:e&&e.length>1e3?11:0}(a,s=s==(o||"")?null:s);0===c?(!function(n,e,t){void 0===t&&(t=null),Lt.send(Un.EditProfile({fullname:n,about:e,email:t}))}(a,s),Wr(!1)):Jr(c)}var t,i,o;return e(this,(function(e){switch(e.label){case 0:return[4,Yr.create("profile",Lt.send(Un.Profile))];case 1:return t=e.sent(),i=t.fullname,o=t.about,Gr.content=An("div",{class:"pi"},An("div",{class:"su"},An("div",{class:"head"},"Profile"),An("div",{class:"sub"},r),An("form",{onSubmit:function(e){return n(e)}},(function(){return Zr(10,11)&&An("div",{class:"erm"},Xr())}),An("input",{value:null!=i?i:"",type:"text",name:"n",placeholder:"Full name",required:!0,class:function(){return Zr(10)?"er":""}}),An("div",{id:"ab",class:"ab",contentEditable:!0},o),An("div",{class:"bn"},An("button",{type:"submit"},"Save"))))),Wr(!0),[2]}}))}))}var tu,ru=function(t,r){return n(void 0,void 0,void 0,(function(){function i(n){var e=n.target.textContent;if(e&&e.length>50)return Jr(11);var t=U(),i=e&&e.trim().length?e:null;gr(r).tz(t),gr(r).st(null!=i?i:""),function(n){Lt.send(Un.EditStatus(n))}({tz:t,st:i})}var o,u,a,s,l,d,f,v,h;return e(this,(function(p){switch(p.label){case 0:return In.id()?(t.stopPropagation(),(null===(s=gr(r))||void 0===s?void 0:s.tz())?[3,2]:[4,$i(r)]):[2];case 1:o=p.sent(),u=o.st,a=o.tz,In.id()==r&&(a=U()),gr(r).tz(null!=a?a:""),gr(r).st(null!=u?u:""),p.label=2;case 2:return Gr.content=An("div",{class:"pi"},An("div",{class:"ui"},An("div",{class:"un"},An("i",{class:function(){var n;return"do"+((null===(n=gr(r))||void 0===n?void 0:n.online())?" on":"")}}),An("b",{style:function(){var n,e;return(null===(n=gr(r))||void 0===n?void 0:n.online())?"color:"+E(null===(e=gr(r))||void 0===e?void 0:e.name):""}},null===(l=gr(r))||void 0===l?void 0:l.name)),r!==In.id()?An("div",{style:"font-size:12px"},null===(d=gr(r))||void 0===d?void 0:d.st()):An("div",{class:"st",contentEditable:!0,onBlur:i},null===(f=gr(r))||void 0===f?void 0:f.st)),An("hr",null),(function(){var n,e;return(null===(n=gr(r))||void 0===n?void 0:n.tz())?An("div",{class:"sub"},An("i",null,"🕑")," Local time ",function(n){return(new Date).toLocaleTimeString(Intl.DateTimeFormat().resolvedOptions().locale,{timeZone:n,hour:"numeric",minute:"2-digit"})}(null===(e=gr(r))||void 0===e?void 0:e.tz())):null}),r!==In.id()?An(Array.prototype,null,An("div",{class:"bt"},An("i",{class:"fl"},"💬")," ",An("a",{onClick:function(){return function(n){Wr(!1),Go(),Mr([n]),sr(0)}(r)}},"Send private message")),An("div",{class:"bt"},An("i",null,"@")," ",An("a",{onClick:function(){return function(n){var e;if(Wr(!1),!In.id())return qi();Uo().innerHTML+="@"+(null===(e=gr(n))||void 0===e?void 0:e.name),Uo().focus(),c(),Lr.add(n)}(r)}},"Mention ",An("b",null,null===(v=gr(r))||void 0===v?void 0:v.name))),(null===(h=gr(r))||void 0===h?void 0:h.online())?An("div",{class:"bt"},An("i",{class:"fl"},"↔"),An("a",{onClick:function(){Wr(!1),location.hash="#&"+Wt.ntob(r)}},"Send direct p2p message")):null):An(Array.prototype,null,An("div",{class:"bt",onClick:function(){return eu(gr(r))}},An("i",null,"✏️")," ",An("a",null,"Edit profile")),An("div",{class:"bt",onClick:function(){return function(t){var r=t.name;Gr.content=An("div",{class:"pi"},An("div",{class:"su"},An("div",{class:"head"},"Change Password"),An("div",{class:"sub"},r),An("form",{onSubmit:function(t){return n(this,void 0,void 0,(function(){var n,i,o,u,a;return e(this,(function(e){switch(e.label){case 0:return t.preventDefault(),n=t.target,i=n.o,Fi(L,(o=n.p).value,i.value)?[4,Ii(r)]:[3,3];case 1:return u=e.sent(),[4,Ki(r,u,o.value,i.value)];case 2:if(a=e.sent())return[2,Jr(a)];Qr("password updated"),Wr(!1),e.label=3;case 3:return[2]}}))}))}},(function(){return Zr(12,13,14)&&An("div",{class:"erm"},Xr())}),An("input",{type:"password",name:"o",placeholder:"Old password",required:!0,autocomplete:"true",class:function(){return Zr(13)?"er":""}}),An("input",{type:"password",name:"p",placeholder:"New password",required:!0,autocomplete:"true",class:function(){return Zr(12,14)?"er":""}}),An("div",{class:"bn"},An("button",{type:"submit"},"Submit"))))),Wr(!0)}(gr(r))}},An("i",null,"🔒")," ",An("a",null,"Change password")),An("div",{class:"bt",onClick:function(){return function(){var t;return n(this,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return console.groupEnd(),console.groupCollapsed("[au]","logout"),cr(0),wr([]),null===(t=gr(In.id()))||void 0===t||t.online(!1),pr().clear(),mr().clear(),[4,Lt.send(Un.Logout(In.salt))];case 1:return n.sent(),[4,R()];case 2:return n.sent(),On({d:!1}),console.groupEnd(),Wr(!1),Ln("logout"),[2]}}))}))}()}},An("i",null,"🚪")," ",An("a",null,"Sign out")),An("div",{class:"v"},nu," ",Qo))),Wr(!0),[2]}}))}))},iu=function(n,e){if(n.shiftKey)return function(n,e){var t=screen.width/2-300,r=screen.height/2-300;window.open(n,e,"toolbar=yes,location=yes,status=no,menubar=yes,scrollbars=yes,resizable=yes,width=600,height=600,top="+r+",left="+t)}("#"+Wt.ntob(e),e.toString()),n.preventDefault();Vi(e),n.stopPropagation()},ou=function(){var i=hn(0),o=hn(0),u=!1,a=function(n){var e=n.id,t=n.txt,a=n.by,c=n.chanid,l=n.star,d=n.men,f=n.timestamp,v=n.showby,h=n.first,p=n.firstre,m=n.last,g=n.lastre,b=n.re,y=n.nor,w=Wt.ntob(e);function k(){return["ct"].join(" ")}return An("div",{id:w+"_",class:function(){return"c"+(sr()===e||o()==e?" cur":"")+(cr()>0&&cr()!==c?" bl":"")+(((new Date).getTime()-f.getTime())/1e3<60?" nc":"")+(b||y()?" r":"")+(h()||p()&&b!=ar()?" fr":"")+(m()||g()&&b!=ar()?" lr":"")},onClick:function(e){return function(n,e){"ontouchstart"in document.documentElement||Vi(e.chanid)}(0,n)},onTouchEnd:function(e){return function(n,e){u||Vi(e.chanid)}(0,n)},onMouseOver:function(){return i()!==e&&i(e)},style:function(){return"border-color:"+E(b||(y()?e:c))}},(function(){var n,t;return p()&&b!=ar()&&mr(b)?An("div",{class:"re",style:function(){return b||y()?"color:"+E(b||e):""},onMouseOver:function(){return o()!==b&&o(b)},onMouseOut:function(){return o(0)}},An("i",null,"→"),An("b",null,null===(n=gr(mr(b).by))||void 0===n?void 0:n.name),An("a",{href:"#/"+Wt.ntob(b),onClick:function(n){return n.stopPropagation()}},null===(t=mr(b))||void 0===t?void 0:t.txt)):null}),(function(){var n;return v()||h()||p()?An("div",null,An("a",{class:function(){var n;return"by"+((null===(n=gr(a))||void 0===n?void 0:n.online())?" on":"")},style:function(){var n,e;return(null===(n=gr(a))||void 0===n?void 0:n.online())?"color:"+E(null===(e=gr(a))||void 0===e?void 0:e.name):""},onClick:function(n){return ru(n,a)}},null===(n=gr(a))||void 0===n?void 0:n.name)):null}),An("div",{class:function(){return l()?" star":""},style:function(){return y()?"color:"+E(e):""}},(function(){var n,e,i,o=t();if(d&&d.length)for(var u=0,a=d;u<a.length;u++){var s=a[u],c=null===(n=gr(s))||void 0===n?void 0:n.name,l=In.id()==s?"j":(null===(e=gr(s))||void 0===e?void 0:e.online())?"k":"i",f=(null===(i=gr(s))||void 0===i?void 0:i.online())?'style="color:'+E(c)+'"':"";o=o.replaceAll("@"+c,'<b onclick="b('+s+')" class="'+l+'" '+f+">@"+c+"</b>")}return _n(tu||(tu=r(["<div class="," innerHTML="," />"],["<div class="," innerHTML="," />"])),k,o)}),(function(){var n;return y()&&e!=ar()?An("p",{class:"mr"},An("i",null,"→"),An("a",{href:"#/"+w,onClick:function(n){return n.stopPropagation()}},y()+(null!==(n=y())&&void 0!==n&&n?" replies":" reply"))):null})),(function(){return i()===e&&In.id()?s(w,n):null}))},s=function(t,r){var i,o,u,a=function(n){n.preventDefault(),n.stopPropagation();var e=_();lo(r,Uo()),sr()===r.id?cr(r.chanid):cr(0),e&&setTimeout(f)};return An(Array.prototype,null,An("div",{class:"ts"},(i=r.timestamp,o=6e4,(u=(new Date).getTime()-i.getTime())<o?Math.round(u/1e3)+"s":u<36e5?Math.round(u/o)+"m":i.toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale,{hour:"numeric",minute:"2-digit"}))),An("div",{class:"pm pr",title:"reply",onTouchEnd:a,onClick:a},An("i",null,"→"),An("div",{class:"pu"},An("div",null,"reply"))),An("div",{class:"pm",onClick:function(n){return n.stopPropagation()}},An("i",{class:"i"},"..."),An("div",{class:"pu"},An("div",{onClick:function(t){return function(t){return n(void 0,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return t.star(!t.star()),Lt.send(Un.Star(t.id)),[4,rn(t.id,"_t")];case 1:return(n=e.sent())?(n.star=t.star(),[4,$("_t",n)]):[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))}(r)}},"⭐ ",r.star()?"unstar":"star"),An("div",{onClick:function(n){return Jo(t,r)}},"✏️ edit"),An("div",{onClick:function(n){return c(r)}},"🗑️ trash"))))},c=function(n){var e=n.id,t=n.txt;confirm('Do you want to delete this chat? \n"'+t()+'"')&&function(n){Lt.send(Un.DelChat(n)),Ui(n)}(e)},l=document.createElement("div");return setTimeout((function(){new IntersectionObserver((function(n){n[0].intersectionRatio<=0||Ei.cb&&(!or()[0]||vr()||or().length<Zt||setTimeout((function(){if(Ei.cb){var n=or()[0];!n||vr()||or().length<Zt||Ei.cb(n)}})))}),{}).observe(l)})),setTimeout((function(){var n,e;null===(n=d("cs"))||void 0===n||n.addEventListener("touchstart",(function(){return u=!1}),{passive:!0}),null===(e=d("cs"))||void 0===e||e.addEventListener("touchmove",(function(){return u=!0}),{passive:!0})})),An(Array.prototype,null,An("div",{id:"os"}),An("div",{id:"cs"},l,(function(){var n=[],e=0,r=null;return or().reduce((function(n,t){return P(mr(t).timestamp,r)?mr(t).chanid!=e?(e=mr(t).chanid,n.push(hn([t])),n):(n[n.length-1]().push(t),n):(r=mr(t).timestamp,n.push(hn(r)),e=mr(t).chanid,n.push(hn([t])),n)}),n),zt(hn(n),(function(n){var e=n();if(e instanceof Date)return An("div",{class:"date"},(r=e,i=new Date,P(r,i)?"Today":(i.setDate(i.getDate()-1),P(r,i)?"Yesterday":r.toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale,{month:"short",day:"numeric"}))));var r,i,o=mr(n()[0]);return An("div",null,An("div",{class:"tn"},(function(){return function(n){var e=pr(n);if(!e)return null;var r=function(){return t(t([],e.dir.slice(Yt.len()-2)),[e.id])};return r().length>0&&An("div",{class:"dr",style:function(){return"background:"+E(n)}},zt(r,(function(n){var e;return An("span",null,An("a",{href:"#"+Wt.ntob(n),onClick:function(e){return iu(e,n)}},null===(e=pr(n))||void 0===e?void 0:e.fullname))})))}(o.chanid)}),An("div",{class:"ts"},function(n){return n.toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale,{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}(o.timestamp))),zt(n,(function(n){return a(mr(n))})))}))}),(function(){var n;return gr(Rr())?An("div",null,An("div",{class:"tn"},An("div",{class:"dr",style:function(){var n;return"background:"+E(null===(n=gr(Rr()))||void 0===n?void 0:n.name)}},An("span",null,An("a",null,"↔ ",null===(n=gr(Rr()))||void 0===n?void 0:n.name)))),zt(Vr,(function(n){var e=n.by,t=n.txt,r=n.showby;return gr(e)?An("div",{class:"c",style:function(){var n;return"border-color:"+E(null===(n=gr(Rr()))||void 0===n?void 0:n.name)}},(function(){var n;return r?An("div",null,An("a",{class:function(){var n;return"by"+((null===(n=gr(e))||void 0===n?void 0:n.online())?" on":"")},style:function(){var n,t;return(null===(n=gr(e))||void 0===n?void 0:n.online())?"color:"+E(null===(t=gr(e))||void 0===t?void 0:t.name):""},onClick:function(n){return ru(n,e)}},null===(n=gr(e))||void 0===n?void 0:n.name)):null}),An("div",null,t)):An("div",null)}))):null})),Zo)},uu=[["","All messages"],["!","Private messages"],["@","Mentions"],["*","Stars"]],au=function(){var n=document.createElement("div");n.contentEditable="true",n.className="s-c",n.oninput=s((function(){var e=n.textContent;e&&e.length>50||(vi(e),hi(e))}),200),n.onkeydown=function(n){"Enter"!==n.key||n.shiftKey||n.preventDefault()};var e=function(n){return An("ul",null,zt(n.childids,(function(t){var r,i=n.childs(t);return An(Array.prototype,null,An("li",{class:function(){return function(n){return[In.chans().includes(n)?"":"on",n==ur()?"se":""].join(" ")}(t)},onClick:function(){return function(n,e){n.open(!n.open()),mi(e)}(i,pr(t))}},An("div",{class:"sb"},An("i",null,(function(){return i.childids().length?i.open()?"▼":"▶":""}))),An("div",{class:"lb"},(function(){return function(n){var e,t,r;return(null===(e=pr(n))||void 0===e?void 0:e.md)&&null!==(r=null===(t=pr(n))||void 0===t?void 0:t.md())&&void 0!==r&&r?"🔒":""}(t)})," ",null===(r=pr(t))||void 0===r?void 0:r.fullname),An("div",{class:"dot",onClick:function(n){return function(n,e){if(n.stopPropagation(),!In.id())return qi();In.chans().includes(e)?bi(e):gi(e)}(n,t)}})),(function(){return i.open()&&i.childids().length?e(i):null}))})))};return An(Array.prototype,null,An("div",{class:"dn n"},An("i",{onClick:function(){return Ln("lnclose")}},"✕")),An("div",{class:"s"},n),In.id()?An("ul",{class:"hm"},(function(){return uu.map((function(n){return An("li",{class:(qr()[0]||"")==n[0]?"se":"",onClick:function(){return location.hash=n[0]}},n[1])}))})):null,zt(Br,(function(n){var e;return An("div",null,An("div",{class:"tn"},An("div",{class:"dr",style:function(){var e;return"background:"+E(null===(e=gr(n))||void 0===e?void 0:e.name)}},An("span",null,An("a",{href:"#&"+Wt.ntob(n)},"↔ ",null===(e=gr(n))||void 0===e?void 0:e.name)))))})),An("div",{class:"nt"},(function(){return br.childids().length?e(br):null})))},su="",cu=0,lu=!1,du=function(){var t=s((function(t){return n(void 0,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return(su=function(n){cu=l();var e=n.textContent,t=e.indexOf(" ",cu);-1==t&&(t=e.length);var r=/[\S]+$/.exec(e.slice(0,t));return r?r[0]:""}(t.target).toLowerCase())&&su.length>50?[2]:[4,Mi(su)];case 1:return!n.sent()&&x(su)&&Sr([{id:0,name:"✉️ Invite "+su,online:!1}]),[2]}}))}))}),100),r=An("div",{class:"am",contentEditable:!0,onKeyDown:function(n){if(Ar(r),o(n))return;8!=n.keyCode||r.textContent.length||(kr.pop(),r.focus());if(32!==n.keyCode&&!/^[a-zA-Z0-9\_@\.]+$/.test(n.key))return void n.preventDefault();"Enter"!==n.key&&"Tab"!==n.key||n.preventDefault()},onInput:t});function i(n){var e=n.id;Sr([]),xr(0),e?kr.add(e):Cr.add(su),r.textContent="",r.spellcheck=!1,r.focus()}function o(n){var e,t;return!!Sr().length&&("Enter"===n.key||"Tab"===n.key||32===n.keyCode?(i(Sr()[xr()]),n.preventDefault(),!0):27==n.keyCode?(Sr([]),xr(),!0):(38==n.keyCode&&(0===xr()?xr(Sr().length-1):xr(xr()-1),null===(e=d(Sr()[xr()].id))||void 0===e||e.focus(),n.preventDefault(),lu=!0,setTimeout((function(){return lu=!1}),300)),40==n.keyCode&&(xr()===Sr().length-1?xr(0):xr(xr()+1),null===(t=d(Sr()[xr()].id))||void 0===t||t.focus(),n.preventDefault(),lu=!0,setTimeout((function(){return lu=!1}),300)),n.target.focus(),!0))}var u=function(){return An("div",{class:"uls adm"},An("ul",null,zt(Sr,(function(n){return An("li",{id:n.id.toString(),tabIndex:-1,class:function(){return Sr()[xr()]===n?"se":""},onClick:function(){return i(n)},onMouseOver:function(){return function(n){lu||xr(n)}(Sr().indexOf(n))}},n.id?An("i",{class:function(){var e;return null===(e=gr(n.id))||void 0===e||e.online()," on"}}):null," ",n.name)}))))},a=An("div",{class:"sel",onClick:function(){return r.focus()}},zt(Cr,(function(n){return An("div",{class:"tg ie"},n,An("i",{onClick:function(){return Cr.delete(n)}},"✕"))})),zt(kr,(function(n){var e;return An("div",{class:function(){var e;return(null===(e=gr(n))||void 0===e?void 0:e.online())?"tg on":"tg"}},null===(e=gr(n))||void 0===e?void 0:e.name,An("i",{onClick:function(){return kr.delete(n)}},"✕"))})),r,(function(){return Ar()===r&&Sr().length>0&&u}));return a.focus=function(){return r.focus()},a},fu=function(){var r=["Public","Internal"],i=function(){return cr()?pr(cr()):pr(ur())};var o=function(t,r){var i;t.stopPropagation(),window.confirm("Do you want to delete this channel?\n"+r.fullname())&&(i=r.id,n(void 0,void 0,void 0,(function(){return e(this,(function(n){return Lt.send(Un.DelChan(i)),[2]}))})))},u=function(){var n;return(null===(n=i())||void 0===n?void 0:n.by)===In.id()};function a(){var n=kr().length+Cr().length;return n>0?" "+n+(n>1?" people":" person"):""}var s=function(t){var r=t.id,i=t.fullname,o=du();Gr.content=An("div",{class:"pi"},An("div",{class:"amb"},An("div",{class:"head"},"Add people"),An("div",{class:"sub"},i),o,An("div",{class:"bn"},An("button",{onClick:function(){return function(t,r){return n(void 0,void 0,void 0,(function(){var n,i;return e(this,(function(e){switch(e.label){case 0:return n=kr().length?kr():null,i=Cr().length?Cr():null,n||i?[4,yi(t,n,i)]:[2];case 1:return e.sent()?(Qr("added"+a()+" to "+r()),Wr(!1)):Jr(8),[2]}}))}))}(r,i)}},"Add",a)))),Wr(!0),o.focus()};function c(n,e){var t,r,i,o=e.id,u=e.fullname,a=e.about,s=e.md;n.preventDefault();var c=n.target,l=c.n,f=c.m,v=l.value.trim()==u()?null:l.value.trim(),h=f&&Number(f.value)!=s()?Number(f.value):null,p=null!==(i=null===(r=null===(t=d("ab"))||void 0===t?void 0:t.textContent)||void 0===r?void 0:r.trim())&&void 0!==i?i:null,m=function(n,e,t){return n&&0===n.length?10:t&&(t>2||t<0)||e&&e.length>1e3?11:0}(v,p=p==(a()||"")?null:p,h);0===m?(!function(n){Lt.send(Un.EditChan(n))}({id:o,name:v,about:p,md:h}),Wr(!1)):Jr(m)}return An(Array.prototype,null,An("div",{class:"dn"},An("i",{onClick:function(){return Ln("rnclose")}},"✕")),An("div",{class:"ub"},(function(){return i()&&u()&&An("div",{title:"edit",onClick:function(){return function(n){var e;Gr.content=An("div",{class:"pi"},An("div",{class:"su et"},An("div",{class:"head"},"About"),An("div",{class:"sub"},n.fullname),An("form",{onSubmit:function(e){return c(e,n)}},(function(){return Zr(10,11)&&An("div",{class:"erm"},Xr())}),An("input",{value:n.fullname,type:"text",name:"n",placeholder:"topic name",required:!0,class:function(){return Zr(10)?"er":""}}),An("div",{id:"ab",class:"ab",contentEditable:!0},n.about),1!=In.id()||null!==(e=null==n?void 0:n.md())&&void 0!==e&&!e?null:An("select",{name:"m"},r.map((function(e,t){return An("option",{selected:function(){return n.md()==t},value:t},e)}))),An("div",{class:"bn"},An("button",{type:"submit"},"Save"))))),Wr(!0)}(i())},class:"ed"},"✎")}),An("div",{class:"head"},"About"),An("div",{class:"sub b"},(function(){var n;return null===(n=i())||void 0===n?void 0:n.fullname})),An("div",{class:"sub"},(function(){var n;return null===(n=i())||void 0===n?void 0:n.about}))),An("div",{class:"ub"},An("div",{class:"he"},"Settings"),An("div",{class:"sub"},(function(){return i()?t(t([],r),["Private"])[i().md()]:""}))),An("div",{class:"ft"},An("div",{class:"ub lf"},An("div",{class:"he"},"Members")),(function(){return In.id()>0&&An("div",{class:"rt"},(function(){return i()&&An("button",{title:"add members",onClick:function(){return s(i())}},"👤")}))})),An("div",{class:"uls mem"},An("ul",null,zt(wr,(function(n){var e;return An("li",{id:n.toString(),tabIndex:-1,style:function(){var e,t;return(null===(e=gr(n))||void 0===e?void 0:e.online())?"color:"+E(null===(t=gr(n))||void 0===t?void 0:t.name):""},onClick:function(e){return ru(e,n)}},n?An("i",{class:function(){var e;return"dot"+((null===(e=gr(n))||void 0===e?void 0:e.online())?" on":"")}}):null,null===(e=gr(n))||void 0===e?void 0:e.name)})))),(function(){return i()&&u()&&An("div",{class:"ft dt"},An("div",{class:"ub lf"},An("div",{class:"he"},"Delete")),An("div",{class:"rt"},An("button",{title:"delete topic",onClick:function(n){return o(n,i())}},"🗑️")))}))},vu=function(){return Or()?Number(localStorage.getItem("w")||185):0},hu=function(){return jr()?Number(localStorage.getItem("e")||185):0};function pu(){var n=localStorage.getItem("l"),e=null!==n&&"0"!==n&&window.innerWidth>650;Or(e);var t="1"==localStorage.getItem("r")&&window.innerWidth>650;jr(t),Nr(vu()),Kr(hu())}function mu(){Or(!Or()),Nr(vu()),localStorage.setItem("l",Or()?"1":"0")}function gu(){jr(!jr()),Kr(hu()),localStorage.setItem("r",jr()?"1":"0")}pu(),setTimeout(pu,100);var bu=function(){return null},yu=hn(bu);function wu(){return An("div",{onMouseDown:function(n){document.onmousemove=function(n){Nr(n.clientX+2)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,localStorage.setItem("w",Nr().toString())}},class:"dw"})}function ku(){return An("div",{onMouseDown:function(n){document.onmousemove=function(n){Kr(document.documentElement.offsetWidth-n.clientX+2)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,localStorage.setItem("e",Kr().toString())}},class:"de"})}document.querySelector("body").append(function(){Dn("nochan",(function(){return yu(bu)})),Dn("rnclose",gu),Dn("lnclose",mu);return An(Array.prototype,null,An("div",{class:"ma",style:function(){return"left:"+(Or()&&window.innerWidth>650?Nr():0)+"px;right:"+(jr()&&window.innerWidth>650?Kr():0)+"px"}},An("div",{class:"n"},An("div",null,An("ol",{class:"bc"},(function(){return zt(Yt.paths,(function(n){return An("li",null,An("a",{onClick:function(){return function(n){n[0]===Yt.len()-1?yu()===vo?yu(bu):yu(vo):Yt.cd(n)}(n)}},n[2]))}))})),(function(){return In.id()?An(Array.prototype,null,An("div",{onClick:mu,class:"av mv"},An("i",null,"☰")),An("div",{onClick:gu,class:"av iv"},An("i",null,"ⓘ")),An("div",{onClick:function(n){return ru(n,In.id())},class:"av"},An("i",null,"👨🏻‍💻"))):An(Array.prototype,null,An("div",{class:"u"},An("a",{onClick:zi},"sign up")),An("div",{class:"m"},An("a",{onClick:qi},"log in")))})),yu),ou),(function(){return Or()&&An("div",{class:"ln",style:"width:"+Nr()+"px"},au,wu)}),(function(){return jr()&&An("div",{class:"rn",style:"width:"+Kr()+"px"},fu,ku)}),(function(){return Fr()>0&&An("div",{class:"err"},Xr())}),(function(){return zr()&&An("div",{class:"inf"},zr())}),(function(){return Wr()&&An("div",{id:"mod",class:"mod",onClick:function(){return Wr(!1)}},An("div",{class:"pop",onClick:function(n){return n.stopPropagation()}},Gr.content))}))}())}();
