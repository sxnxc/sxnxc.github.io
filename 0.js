!function(){"use strict";let e,n=[];function t(t){function a(n){if(0===arguments.length)return e&&!a.__o.has(e)&&(a.__o.add(e),e.u.push(a)),t;t=n;let r=e;return e=void 0,a.o=new Set(a.__o),a.o.forEach((e=>e.i=!1)),a.o.forEach((e=>{e.i||e()})),e=r,t}return a.$o=1,a.__o=new Set,a.t=n,a}function a(e){e.__c.forEach(a),e.u.forEach((n=>{n.__o.delete(e),n.o&&n.o.delete(e)})),e.l.forEach((e=>e())),r(e)}function r(e){e.u=[],e.__c=[],e.l=[]}let i=(e,n,t,a)=>{let r={};for(let s=1;s<n.length;s++){let o=n[s],l="number"==typeof o?t[o]:o,c=n[++s];if(1===c)a[0]=l;else if(3===c)a[1]=Object.assign(a[1]||{},l);else if(5===c)(a[1]=a[1]||{})[n[++s]]=l;else if(6===c){let e=n[++s],t=(a[1]=a[1]||{})[e],i=r[e];i||"function"!=typeof l&&"function"!=typeof t||(i=t&&[t]||[],a[1][e]=function(){let e="";for(var n=0;n<i.length;n++)e+="function"==typeof i[n]?i[n].call(this):i[n];return e}),i?i.push(l):a[1][e]+=l+""}else if(c){let n=()=>e.apply(null,i(e,l,t,["",null]));a.push("function"==typeof a[0]?n:n())}else a.push(l)}return a},s=function(e){let n,t,a=1,r="",i="",s=[0],o=e=>{1===a&&(e||(r=r.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?s.push(e||r,0):3===a&&(e||r)?(s.push(e||r,1),a=2):2===a&&"..."===r&&e?s.push(e,3):2===a&&r&&!e?s.push(!0,5,r):a>=5&&((r||!e&&5===a)&&(s.push(r,a,t),a=6),e&&(s.push(e,a,t),a=6)),r=""};for(let l=0;l<e.length;l++){l&&(1===a&&o(),o(l));for(let c=0;c<e[l].length;c++)n=e[l][c],1===a?"<"===n?(o(),s=[s],a=3):r+=n:4===a?"--"===r&&">"===n?(a=1,r=""):r=n+r[0]:i?n===i?i="":r+=n:'"'===n||"'"===n?i=n:">"===n?(o(),a=1):a&&("="===n?(a=5,t=r,r=""):"/"===n&&(a<5||">"===e[l][c+1])?(o(),3===a&&(s=s[0]),a=s,(s=s[0]).push(a,2),a=0):" "===n||"\t"===n||"\n"===n||"\r"===n?(o(),a=2):r+=n),3===a&&"!--"===r&&(a=4,s=s[0])}return o(),s},o=new Map,l=function(e){let n=o.get(this);return n||(n=new Map,o.set(this,n)),n=i(this,n.get(e)||(n.set(e,n=s(e)),n),arguments,[]),n.length>1?n:n[0]},c=function(){let e=l.apply(this,arguments);if(e)return Array.isArray(e)?this(e):"object"==typeof e?e:this([e])};function u(){let e=c.bind(this);return(this.wrap||e).apply(e,arguments)}let d={},f=[];function h(e){return this.t&&this.t[e.type](e)}d.h=(...e)=>{let n,t=a=>{if(null==a);else if("string"==typeof a)n?d.add(n,a):n=d.s?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a);else if(Array.isArray(a))n||(n=document.createDocumentFragment()),a.forEach(t);else if(a instanceof Node)n?d.add(n,a):n=a;else if("object"==typeof a)d.property(n,a,null,d.s);else if("function"==typeof a)if(n){let e=d.add(n,"");d.insert(n,a,e)}else n=a.apply(null,e.splice(1));else d.add(n,""+a)};return e.forEach(t),n},d.insert=(e,n,t,a,r)=>(e=t&&t.parentNode||e,r=r||a instanceof Node&&a,n===a||(a&&"string"!=typeof a||!("string"==typeof n||"number"==typeof n&&(n+=""))?"function"==typeof n?d.subscribe((()=>{a=d.insert(e,n.call({el:e,endMark:t}),t,a,r)})):(t?a&&(r||(r=a.o&&a.o.nextSibling||t.previousSibling),d.rm(e,r,t)):e.textContent="",a=null,n&&!0!==n&&(a=d.add(e,n,t))):(null!=a&&e.firstChild?t?(t.previousSibling||e.lastChild).data=n:e.firstChild.data=n:t?d.add(e,n,t):e.textContent=n,a=n)),a),d.property=(e,n,t,a,r)=>{if(null!=n)if(!t||"attrs"===t&&(a=!0))for(t in n)d.property(e,n[t],t,a,r);else"o"!==t[0]||"n"!==t[1]||n.$o?"function"==typeof n?d.subscribe((()=>{d.property(e,n.call({el:e,name:t}),t,a,r)})):r?e.style.setProperty(t,n):a||"data-"===t.slice(0,5)||"aria-"===t.slice(0,5)?e.setAttribute(t,n):"style"===t?"string"==typeof n?e.style.cssText=n:d.property(e,n,null,a,!0):("class"===t&&(t+="Name"),e[t]=n):((e,n,t)=>{n=n.slice(2).toLowerCase(),t?e.addEventListener(n,h):e.removeEventListener(n,h),(e.t||(e.t={}))[n]=t})(e,t,n)},d.add=(e,n,t)=>{let a=(e=>{const{childNodes:n}=e;if(n&&11===e.nodeType)return n.length<2?n[0]:{o:d.add(e,"",n[0])}})(n=(e=>"string"==typeof e?document.createTextNode(e):e instanceof Node?e:d.h(f,e))(n))||n;return e.insertBefore(n,t&&t.parentNode&&t),a},d.rm=(e,n,t)=>{for(;n&&n!==t;){let t=n.nextSibling;e===n.parentNode&&e.removeChild(n),n=t}},d.subscribe=function(n){return function(n,t){function i(){let r=e;return e&&e.__c.push(i),a(i),i.i=!0,e=i,t=n(t),e=r,t}function s(){return i.i?e&&i.u.forEach((e=>e())):t=i(),t}n.s=i,r(i),i(),s.$o=1}(n),()=>a(n.s)},d.cleanup=function(n){return e&&e.l.push(n),n},d.root=function(n){let t=e,i=()=>{};e=i,r(i);let s=n((()=>{a(i),e=void 0}));return e=t,s},d.sample=function(n){let t=e;e=void 0;let a=n();return e=t,a},d.hs=(...e)=>{let n=d.s;d.s=!0;let t=v(...e);return d.s=n,t};let v=(...e)=>d.h.apply(d.h,e),p=(...e)=>u.apply(v,e);var m={};function y(e){var n=e>>3;return e%8!=0&&n++,n}Object.defineProperty(m,"__esModule",{value:!0});var w=function(){function e(e,n){void 0===e&&(e=0);var t=null==n?void 0:n.grow;this.grow=t&&isFinite(t)&&y(t)||t||0,this.buffer="number"==typeof e?new Uint8Array(y(e)):e}return e.prototype.get=function(e){var n=e>>3;return n<this.buffer.length&&!!(this.buffer[n]&128>>e%8)},e.prototype.set=function(e,n){void 0===n&&(n=!0);var t=e>>3;if(n){if(this.buffer.length<t+1){var a=Math.max(t+1,Math.min(2*this.buffer.length,this.grow));if(a<=this.grow){var r=new Uint8Array(a);r.set(this.buffer),this.buffer=r}}this.buffer[t]|=128>>e%8}else t<this.buffer.length&&(this.buffer[t]&=~(128>>e%8))},e.prototype.forEach=function(e,n,t){void 0===n&&(n=0),void 0===t&&(t=8*this.buffer.length);for(var a=n,r=a>>3,i=128>>a%8,s=this.buffer[r];a<t;a++)e(!!(s&i),a),i=1===i?(s=this.buffer[++r],128):i>>1},e}(),g=m.default=w;function b(e,n,t=!1){var a;return(...r)=>{clearTimeout(a),t&&!a&&e.apply(this,r),a=setTimeout((()=>{a=null,t||e.apply(this,r)}),n)}}function k(){document.execCommand("selectAll",!1,null),document.getSelection().collapseToEnd()}function C(){return document.getSelection().focusOffset}const S=e=>document.getElementById(e);const E=(e,n)=>e.reduce(((e,n)=>(e.has(n.id)||e.set(n.id,n),e)),n),x=(e,n)=>e.reduce(((e,n)=>(e.has(n.id)?"online"in n&&e.get(n.id).online(n.online):e.set(n.id,{...n,online:t(n.online)}),delete n.online,e)),n),_=(e,n)=>e.reduce(((e,n)=>{if(e.has(n.id)){let t=e.get(n.id);t.fullname(n.fullname),t.about(n.about),t.md(n.md)}else e.set(n.id,{...n,fullname:t(n.fullname),about:t(n.about),md:t(n.md)});return e}),n);function T(){window.scrollTo(0,document.documentElement.scrollHeight)}const U=(e,n)=>{let t=0,a=0;for(;t<e.length;)a>=n.length&&(a=0),e.set([e[t]^n[a]],t),t++,a++},A=(e,n)=>N(D(e,n),64,24),M=e=>{let{a:n}=L(e);return L(n)},D=(e,n)=>(U(e,n),O(e,n)),L=e=>{let{a:n,k:t}=P(e);return U(n,t),{a:n,k:t}},P=e=>{let n=e[0],t=e.subarray(1,n+1);return{a:e.subarray(n+1),k:t}},O=(e,n)=>{let t=new Uint8Array(1+n.length+e.length);return t[0]=n.length,t.set(n,1),t.set(e,1+n.length),t},j=(e,n)=>(e=Math.ceil(e),Math.floor(Math.random()*(Math.floor(n)-e)+e)),I=(e,n)=>{let t=new Uint8Array(e.length+n.length);return t.set(e,0),t.set(n,e.length),t},N=(e,n=64,t=8)=>D(e,crypto.getRandomValues(new Uint8Array(j(t,n)))),z=e=>(e=>"hsl("+e%360+",100%,30%)")((e=>{var n=0;if(0==e.length)return n;for(var t=0;t<e.length;t++)n=e.charCodeAt(t)+((n<<5)-n),n&=n;return n})(e+"#"));function F(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)&&e.length<70}function K(e){return e.length<2||e.length>30?10:/^[0-9a-z_]+$/.test(e)?0:10}function R(){return window.scrollY+window.innerHeight===document.documentElement.scrollHeight}function q(){let e=Intl.DateTimeFormat().resolvedOptions().timeZone;return e&&e.length>0?e:null}function B(e){if(!/^[a-z0-9\_@\.]+$/.test(e.key))return e.preventDefault(),!1}function H(e){if(!/^[a-z0-9\_]+$/.test(e.key))return e.preventDefault(),!1}function $(e){e.target.value=e.target.value.toLowerCase().replace(/\s/g,"")}function V(e,n=null){return e.length<6?12:n&&e==n?14:void 0}function W(e,n){return!!n&&(e.getFullYear()===n.getFullYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate())}const Y=()=>{let e,n=new Promise((n=>e=n));return{complete:n=>e(n),join:()=>n}},G=Y(),X="s",Z=["_t","_p","_e","_h","_r","_c","_s","_u","_n","_d","_m"];let J,Q=indexedDB.open(X,1);function ee(e){var n=window.indexedDB.deleteDatabase(e);n.onerror=e=>{},n.onsuccess=e=>{}}Q.onsuccess=e=>{J=Q.result,function(e){let n=e.objectStoreNames;if(n.length!==Z.length)return void ee(X);for(const e of Z)if(!n.contains(e))return void ee(X)}(J),G.complete(J),Q.open?Q.open():Q.open=!0},Q.onerror=e=>{ee(X),location.reload()},Q.onblocked=e=>{},Q.onupgradeneeded=e=>{J=Q.result;let n=J.objectStoreNames;if(n.contains("_s")||J.createObjectStore("_s"),n.contains("_r")||J.createObjectStore("_r"),n.contains("_e")||J.createObjectStore("_e",{keyPath:"id"}),!n.contains("_t")){let e=J.createObjectStore("_t",{keyPath:"id"});e.createIndex("chanid",["chanid","id"],{unique:!1}),e.createIndex("re",["re","id"],{unique:!1}),e.createIndex("by",["by","id"],{unique:!1}),e.createIndex("dir","dir",{unique:!1})}if(!n.contains("_p")){J.createObjectStore("_p",{keyPath:"id",autoIncrement:!0}).createIndex("room",["room","id"],{unique:!1})}if(!n.contains("_h")){let e=J.createObjectStore("_h",{keyPath:"id"});e.createIndex("mom",["mom","id"],{unique:!1}),e.createIndex("dir","dir",{unique:!1}),e.createIndex("chatid","chatid",{unique:!1})}n.contains("_c")||J.createObjectStore("_c",{keyPath:["chanid","chatid"]}),n.contains("_u")||J.createObjectStore("_u"),n.contains("_n")||J.createObjectStore("_n"),n.contains("_d")||J.createObjectStore("_d"),n.contains("_m")||J.createObjectStore("_m");for(const e of Z)J.objectStoreNames.contains(e)||J.createObjectStore(e)};const ne=async(e,n)=>{let t=await G.join();t&&t.transaction(["_s"],"readwrite").objectStore("_s").put(n,e)},te=async()=>{let e=await G.join();e&&Z.forEach((n=>e.transaction([n],"readwrite").objectStore(n).clear()))},ae=async(e,n)=>{let t=await G.join();if(!t)return;let a=t.transaction([e],"readwrite").objectStore(e);n.forEach((e=>{"string"==typeof e.timestamp&&(e.timestamp=new Date(e.timestamp)),a.put(e).onerror=console.error}))},re=async(...e)=>{let n=await G.join();n&&(await he(...e),function(e){let t=n.transaction(["_c"],"readwrite").objectStore("_c");e.forEach((e=>{let n=IDBKeyRange.bound([e],[e,Number.MAX_VALUE]);t.delete(n).onerror=console.error}))}(e),function(e){let t=n.transaction(["_t"],"readwrite").objectStore("_t"),a=t.index("chanid");e.forEach((e=>{let n=IDBKeyRange.bound([e],[e,Number.MAX_VALUE]);a.openCursor(n).onsuccess=e=>{var n=e.target.result;n&&(t.delete(n.primaryKey).onerror=console.error,n.continue())}}))}(e.filter((e=>e>0))))},ie=async(e,n)=>{let t=await G.join();if(!t)return;let a=t.transaction([e],"readwrite").objectStore(e);return new Promise((e=>{let t=a.put(n);t.onsuccess=n=>{e(n.target.result)},t.onerror=console.error}))},se=async(e,n)=>{let t=await G.join();if(!t)return{value:[],missed:n};if(0===n.length)return{value:[],missed:[]};performance.now();let a=[],r=new Set,i=t.transaction([e],"readonly").objectStore(e),s=0;return new Promise((e=>{n.forEach((t=>{let o=i.get(t);o.onerror=console.error,o.onsuccess=i=>{if(o.result?a.push(o.result):r.add(t),++s===n.length){let n={value:a,missed:Array.from(r)};e(n)}}}))}))},oe=async(e,n,t,a,r,i,s="prev")=>{let o=await G.join();if(!o)return;performance.now();let l=[],c=o.transaction([e],"readonly"),[u,d]=n?n(c.objectStore(e),t,r,i):[c.objectStore(e),null],f=0;return new Promise((e=>{u.openCursor(d,s).onsuccess=n=>{var t=n.target.result;if(t){if(l.push(t.value),a&&++f===a)return e(l);t.continue()}else e(l)}}))},le=(e,n,t,a)=>{let r=t?IDBKeyRange.upperBound(t,a):null;if(!n)return[e,r];let i=t||Number.MAX_VALUE;return e=e.index("room"),r=IDBKeyRange.bound([n.value],[n.value,i],!1,a),[e,r]},ce=(e,n,t,a)=>{let r=t?IDBKeyRange.upperBound(t,a):null;if(!n)return[e,r];let i=t||Number.MAX_VALUE;return r=IDBKeyRange.bound([n.value],[n.value,i],!1,a),[e,r]},ue=async(e,n,t=30,a=!0)=>{let r={value:e};return(await oe("_c",ce,r,t,n,a,"prev")).map((e=>e.chatid))},de=async(e,n,t)=>{let a=await G.join();if(!a)return;let r=a.transaction(["_r"],"readwrite").objectStore("_r"),i=r.get(e);i.onerror=console.error,i.onsuccess=async a=>{if(i.result){if(t)return r.put([i.result[0],i.result[1],t],e).onerror=console.error;n[0]<i.result[0]&&(n[0]=i.result[0]),n[1]>i.result[0]&&(n[1]=i.result[1])}r.put(n,e).onerror=console.error}},fe=e=>pe(e,"_r"),he=async(...e)=>ye("_r",...e),ve=e=>pe(e,"_s"),pe=async(e,n)=>{let t=await G.join();if(!t)return;let a=t.transaction([n],"readonly").objectStore(n);return new Promise((n=>{let t=a.get(e);t.onerror=console.error,t.onsuccess=e=>n(t.result)}))},me=async(e,n,t)=>{let a=await G.join();a&&a.transaction([e],"readwrite").objectStore(e).put(t,n)},ye=async(e,...n)=>{let t=await G.join();if(!t)return;let a=t.transaction([e],"readwrite").objectStore(e);n.forEach((e=>a.delete(e).onerror=console.error))},we=(e,n)=>crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:n},e,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),ge=e=>crypto.subtle.importKey("raw",e,{name:"ECDH",namedCurve:"P-256"},!0,[]),be=async()=>await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"]),ke=async(e,n,t)=>await crypto.subtle.encrypt({name:"AES-GCM",iv:t},n,e),Ce=async(e,n,t)=>await crypto.subtle.decrypt({name:"AES-GCM",iv:t},n,e),Se=new Map,Ee=(e,n,t=!1)=>{let a=Se.get(e)||[];t?a=[n]:a.push(n),Se.set(e,a)},xe=(e,n)=>Se.has(e)?Se.get(e).forEach((e=>e(n))):void 0,_e={},Te=e=>(e&&(Object.assign(_e,e),xe("config",_e)),_e),Ue=t(void 0),Ae={id:t(0),name:t(null),chans:t([])};async function Me(){let e=await ve("a");if(!e||e.byteLength<54)return;let n=new Uint8Array(e,0,16),t=new Uint8Array(e,16,32);16===n.length&&(Ae.salt=n),32===t.length&&(Ae.sskey=await crypto.subtle.importKey("raw",t,"AES-GCM",!1,["encrypt","decrypt"]));let a=new Uint8Array(e,48,4),r=new Uint8Array(e,52),i=new DataView(a.buffer).getInt32(48,!1),s=(new TextDecoder).decode(r);i&&s&&(Ae.id(i),Ae.name(s));let o=await ve("c");o&&o instanceof Array&&Ae.chans(o);var l=new Uint8Array(20);return l.set(n),l.set(a,16),setTimeout(T),l}async function De(e,n){let t=new TextEncoder,a=await Pe(t.encode(e),t.encode(n));return await crypto.subtle.exportKey("raw",a)}async function Le(e,n){return await Pe((new TextEncoder).encode(e),n)}async function Pe(e,n){let t=await crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function Oe(e){let n=new Uint8Array(e.slice(16,20)),t=new Uint8Array(e.slice(20)),a=new DataView(n.buffer).getInt32(0,!1),r=(new TextDecoder).decode(t);Ae.id(a),Ae.name(r),Ae.salt=new Uint8Array(e.slice(0,16)),Ae.sskey=await Pe(Ue(),Ae.salt),Ue(void 0);let i=new Uint8Array(await crypto.subtle.exportKey("raw",Ae.sskey)),s=Ae.salt.length,o=new Uint8Array(s+i.length+n.length+t.length);return o.set(Ae.salt),o.set(i,s),o.set(n,s+i.length),o.set(t,s+i.length+n.length),ne("a",o.buffer),{id:a,name:r,tz:q()}}var je,Ie;!function(e){e.Shin=function(e){return{tag:"Shin",value:e}},e.Shan=function(e){return{tag:"Shan",value:e}},e.Tree=function(e){return{tag:"Tree",value:e}},e.NewChat=function(e){return{tag:"NewChat",value:e}},e.NewUser=function(e){return{tag:"NewUser",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.Logout=function(e){return{tag:"Logout",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Chans=function(e){return{tag:"Chans",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.MuteChan=function(e){return{tag:"MuteChan",value:e}},e.UnmuteChan=function(e){return{tag:"UnmuteChan",value:e}},e.AddMems=function(e){return{tag:"AddMems",value:e}},e.DelChat=function(e){return{tag:"DelChat",value:e}},e.DelChan=function(e){return{tag:"DelChan",value:e}},e.EditChat=function(e){return{tag:"EditChat",value:e}},e.EditChan=function(e){return{tag:"EditChan",value:e}},e.Mems=function(e){return{tag:"Mems",value:e}},e.FindUsers=function(e){return{tag:"FindUsers",value:e}},e.FindMems=function(e){return{tag:"FindMems",value:e}},e.PushSubs=function(e){return{tag:"PushSubs",value:e}},e.Ons=function(e){return{tag:"Ons",value:e}},e.Unpack=function(e){return{tag:"Unpack",value:e}},e.Tz=function(e){return{tag:"Tz",value:e}},e.Profile={tag:"Profile"},e.EditProfile=function(e){return{tag:"EditProfile",value:e}},e.Pwd=function(e){return{tag:"Pwd",value:e}},e.Email=function(e){return{tag:"Email",value:e}},e.Au=function(e){return{tag:"Au",value:e}},e.Signup=function(e){return{tag:"Signup",value:e}},e.Fp=function(e){return{tag:"Fp",value:e}},e.EditStatus=function(e){return{tag:"EditStatus",value:e}},e.Status=function(e){return{tag:"Status",value:e}},e.ChatThread=function(e){return{tag:"ChatThread",value:e}},e.ChatList=function(e){return{tag:"ChatList",value:e}},e.Star=function(e){return{tag:"Star",value:e}},e.Sdp=function(e){return{tag:"Sdp",value:e}}}(je||(je={})),function(e){e.Shin=function(e){return{tag:"Shin",value:e}},e.Shan=function(e){return{tag:"Shan",value:e}},e.Tree=function(e){return{tag:"Tree",value:e}},e.Treeid=function(e){return{tag:"Treeid",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.Chans=function(e){return{tag:"Chans",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Chat=function(e){return{tag:"Chat",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.MuteChan=function(e){return{tag:"MuteChan",value:e}},e.UnmuteChan=function(e){return{tag:"UnmuteChan",value:e}},e.DelChan=function(e){return{tag:"DelChan",value:e}},e.Update=function(e){return{tag:"Update",value:e}},e.Updates=function(e){return{tag:"Updates",value:e}},e.ChanUpdates=function(e){return{tag:"ChanUpdates",value:e}},e.MemUpdates=function(e){return{tag:"MemUpdates",value:e}},e.On=function(e){return{tag:"On",value:e}},e.Ons=function(e){return{tag:"Ons",value:e}},e.Mems=function(e){return{tag:"Mems",value:e}},e.Err=function(e){return{tag:"Err",value:e}},e.NewChan=function(e){return{tag:"NewChan",value:e}},e.FindUsers=function(e){return{tag:"FindUsers",value:e}},e.FindMems=function(e){return{tag:"FindMems",value:e}},e.Logout=function(e){return{tag:"Logout",value:e}},e.AddMems=function(e){return{tag:"AddMems",value:e}},e.Unpack=function(e){return{tag:"Unpack",value:e}},e.Profile=function(e){return{tag:"Profile",value:e}},e.Pwd=function(e){return{tag:"Pwd",value:e}},e.Name=function(e){return{tag:"Name",value:e}},e.Signup=function(e){return{tag:"Signup",value:e}},e.Typing=function(e){return{tag:"Typing",value:e}},e.Status=function(e){return{tag:"Status",value:e}},e.ChatThread=function(e){return{tag:"ChatThread",value:e}},e.ChatList=function(e){return{tag:"ChatList",value:e}},e.Sdp=function(e){return{tag:"Sdp",value:e}}}(Ie||(Ie={}));const Ne=(e,n=0,t=!0)=>({pos:n,littleEndian:t,view:new DataView(e)}),ze=(e,n)=>{const{view:{buffer:t},pos:a}=e,r=t.byteLength;if(r-a>n)return e;const i=Math.max(2*r,r+n),s=new Uint8Array(i);return s.set(new Uint8Array(t)),Ne(s.buffer,a,e.littleEndian)},Fe=(e,n)=>{e=ze(e,1);const{view:t,pos:a}=e;return t.setUint8(a,n),e.pos+=1,e},Ke=(e,n)=>{e=ze(e,4);const{view:t,pos:a,littleEndian:r}=e;return t.setUint32(a,n,r),e.pos+=4,e},Re=(e,n)=>{e=ze(e,2);const{view:t,pos:a,littleEndian:r}=e;return t.setUint16(a,n,r),e.pos+=2,e};function qe(e,n){const{view:t,pos:a,littleEndian:r}=e;return t.setUint32(r?a:a+4,n,r),t.setUint32(r?a+4:a,0,r),e.pos+=8,e}const Be=(e,n)=>{e=ze(e,4);const{view:t,pos:a,littleEndian:r}=e;return t.setInt32(a,n,r),e.pos+=4,e},He=new TextEncoder,$e="encodeInto"in He?(e,n)=>He.encodeInto(e,n).written:(e,n)=>{const t=He.encode(e);return n.set(t),t.length},Ve=(e,n)=>{e=ze(e,3*n.length+8);const t=$e(n,new Uint8Array(e.view.buffer,e.pos+8));return(e=qe(e,t)).pos+=t,e},We=(e,n)=>Fe(e,n?1:0),Ye=e=>(n,t)=>t.reduce(e,((e,n)=>qe(ze(e,8),n))(n,t.length)),Ge=e=>(n,t)=>null===t?Fe(n,0):e(Fe(n,1),t),Xe=e=>{const{pos:n,view:t}=e;return e.pos+=1,t.getUint8(n)},Ze=e=>{const{pos:n,view:t,littleEndian:a}=e;return e.pos+=2,t.getUint16(n,a)},Je=e=>{const{pos:n,view:t,littleEndian:a}=e;return e.pos+=4,t.getUint32(n,a)},Qe=e=>{const{view:n,pos:t,littleEndian:a}=e;return e.pos+=8,n.getUint32(a?t:t+4,a)},en=e=>{const{pos:n,view:t,littleEndian:a}=e;return e.pos+=4,t.getInt32(n,a)},nn=e=>1===Xe(e),tn=e=>n=>1===Xe(n)?e(n):null,an=e=>n=>{const t=Qe(n),a=new Array;for(let r=0;r<t;r++)a.push(e(n));return a},rn=new TextDecoder,sn=e=>{const n=Qe(e),{pos:t,view:{buffer:a}}=e,r=rn.decode(new Uint8Array(a,t,n));return e.pos+=n,r};var on=Ye(Be),ln=Ge(Ve),cn=Ge(on),un=Ge(Be),dn=Ge(We),fn=Ge((function(e,n){var t=n.id,a=n.lo;return Be(Be(e,t),a)})),hn=Ye(Ve),vn=Ge(hn),pn=Ye(Fe),mn=Ge(((e,n)=>{e=ze(e,8);const{view:t,pos:a,littleEndian:r}=e;return t.setFloat64(a,n,r),e.pos+=8,e})),yn=Ge(pn),wn=Ge(Re),gn=function(e,n){var t=n.id,a=n.txt,r=n.by,i=n.chanid,s=n.dir,o=n.timestamp,l=n.men,c=n.re,u=n.nor,d=n.star;return dn(un(un(cn(Ve(on(Be(Be(Ve(Be(e,t),a),r),i),s),o),l),c),u),d)},bn=(Ye(gn),Ye((function(e,n){var t=n.id,a=n.fullname,r=n.mom,i=n.by,s=n.dir,o=n.md,l=n.timestamp,c=n.chatid,u=n.about,d=n.to,f=n.re;return un(cn(ln(Be(Ve(Re(on(Be(Be(Ve(Be(e,t),a),r),i),s),o),l),c),u),d),f)})),function(e,n){var t=n.id,a=n.name,r=n.online;return We(Ve(Be(e,t),a),r)}),kn=Ye(bn),Cn=(Ge((function(e,n){var t=n.data,a=n.chans;return on(pn(e,t),a)})),function(e,n){var t=n.id,a=n.action,r=n.chatid,i=n.txt;return ln(Be(Re(Be(e,t),a),r),i)}),Sn=(Ye(Cn),Ye((function(e,n){var t=n.id,a=n.action,r=n.chanid,i=n.name,s=n.about,o=n.md;return wn(ln(ln(Be(Re(Be(e,t),a),r),i),s),o)})),Ye((function(e,n){var t=n.id,a=n.action,r=n.chanid,i=n.by;return Be(Be(Re(Be(e,t),a),r),i)})),Ye((function(e,n){var t=n.chanid,a=n.users;return kn(Be(e,t),a)})),function(e,n){var t=n.email,a=n.fullname,r=n.about;return ln(ln(ln(e,t),a),r)}),En=function(e,n){var t=n.i,a=n.ub,r=n.lb,i=n.kw;return ln(un(un(Be(e,t),a),r),i)},xn=function(e,n){var t=n.fr,a=n.to,r=n.offer,i=n.sd,s=n.ca;return hn(pn(dn(un(un(e,t),a),r),i),s)},_n=function(e,n){var t=n.txt;return Ve(e,t)},Tn=function(e,n){var t=n.st,a=n.tz;return ln(ln(e,t),a)},Un=function(e,n){switch(n.tag){case"Shin":return function(e,n){var t=n.chanid,a=n.kw,r=n.lu,i=n.cu,s=n.mu,o=n.ub,l=n.lb;return un(un(un(un(fn(ln(un(e,t),a),r),i),s),o),l)}(Ke(e,0),n.value);case"Shan":return function(e,n){var t=n.chanid,a=n.kw,r=n.cu,i=n.mu,s=n.ub,o=n.lb;return un(un(un(un(ln(Be(e,t),a),r),i),s),o)}(Ke(e,1),n.value);case"Tree":return function(e,n){var t=n.kw,a=n.reload;return dn(ln(e,t),a)}(Ke(e,2),n.value);case"NewChat":return function(e,n){var t=n.txt,a=n.chanid,r=n.re,i=n.chname,s=n.men,o=n.to,l=n.emails;return vn(cn(cn(ln(un(Be(Ve(e,t),a),r),i),s),o),l)}(Ke(e,3),n.value);case"NewUser":return function(e,n){var t=n.name,a=n.key,r=n.tz,i=n.tgid,s=n.tgname,o=n.tgfn,l=n.tgln;return ln(ln(ln(mn(ln(pn(Ve(e,t),a),r),i),s),o),l)}(Ke(e,4),n.value);case"Login":return function(e,n){var t=n.name,a=n.key,r=n.tz;return ln(pn(Ve(e,t),a),r)}(Ke(e,5),n.value);case"Logout":return pn(Ke(e,6),n.value);case"Users":return on(Ke(e,7),n.value);case"Chans":return on(Ke(e,8),n.value);case"Chats":return on(Ke(e,9),n.value);case"MuteChan":return Be(Ke(e,10),n.value);case"UnmuteChan":return Be(Ke(e,11),n.value);case"AddMems":return function(e,n){var t=n.chanid,a=n.userids,r=n.emails;return vn(cn(Be(e,t),a),r)}(Ke(e,12),n.value);case"DelChat":return Be(Ke(e,13),n.value);case"DelChan":return Be(Ke(e,14),n.value);case"EditChat":return function(e,n){var t=n.id,a=n.txt;return Ve(Be(e,t),a)}(Ke(e,15),n.value);case"EditChan":return function(e,n){var t=n.id,a=n.name,r=n.about,i=n.md;return wn(ln(ln(Be(e,t),a),r),i)}(Ke(e,16),n.value);case"Mems":return on(Ke(e,17),n.value);case"FindUsers":return Ve(Ke(e,18),n.value);case"FindMems":return function(e,n){var t=n.chanid,a=n.kw;return Ve(Be(e,t),a)}(Ke(e,19),n.value);case"PushSubs":return function(e,n){var t=n.endpoint,a=n.auth,r=n.p256dh;return Ve(Ve(Ve(e,t),a),r)}(Ke(e,20),n.value);case"Ons":return on(Ke(e,21),n.value);case"Unpack":return Ve(Ke(e,22),n.value);case"Tz":return Ve(Ke(e,23),n.value);case"Profile":return Ke(e,24);case"EditProfile":return Sn(Ke(e,25),n.value);case"Pwd":return function(e,n){var t=n.key,a=n.okey;return yn(pn(e,t),a)}(Ke(e,26),n.value);case"Email":return Ve(Ke(e,27),n.value);case"Au":return Ve(Ke(e,28),n.value);case"Signup":return Ve(Ke(e,29),n.value);case"Fp":return Ve(Ke(e,30),n.value);case"EditStatus":return Tn(Ke(e,31),n.value);case"Status":return Be(Ke(e,32),n.value);case"ChatThread":return En(Ke(e,33),n.value);case"ChatList":return En(Ke(e,34),n.value);case"Star":return Be(Ke(e,35),n.value);case"Sdp":return xn(Ke(e,36),n.value)}},An=an(en),Mn=tn(sn),Dn=tn(An),Ln=tn(en),Pn=tn(nn),On=(tn((function(e){return{id:en(e),lo:en(e)}})),an(sn)),jn=(tn(On),an(Xe)),In=(tn((e=>{const{pos:n,view:t,littleEndian:a}=e;return e.pos+=8,t.getFloat64(n,a)})),tn(jn)),Nn=tn(Ze),zn=function(e){return{id:en(e),txt:sn(e),by:en(e),chanid:en(e),dir:An(e),timestamp:sn(e),men:Dn(e),re:Ln(e),nor:Ln(e),star:Pn(e)}},Fn=an(zn),Kn=an((function(e){return{id:en(e),fullname:sn(e),mom:en(e),by:en(e),dir:An(e),md:Ze(e),timestamp:sn(e),chatid:en(e),about:Mn(e),to:Dn(e),re:Ln(e)}})),Rn=function(e){return{id:en(e),name:sn(e),online:nn(e)}},qn=an(Rn),Bn=tn((function(e){return{data:jn(e),chans:An(e)}})),Hn=function(e){return{id:en(e),action:Ze(e),chatid:en(e),txt:Mn(e)}},$n=an(Hn),Vn=an((function(e){return{id:en(e),action:Ze(e),chanid:en(e),name:Mn(e),about:Mn(e),md:Nn(e)}})),Wn=an((function(e){return{id:en(e),action:Ze(e),chanid:en(e),by:en(e)}})),Yn=an((function(e){return{chanid:en(e),users:qn(e)}})),Gn=function(e){return{email:Mn(e),fullname:Mn(e),about:Mn(e)}},Xn=function(e){return{fr:Ln(e),to:Ln(e),offer:Pn(e),sd:jn(e),ca:On(e)}},Zn=function(e){return{txt:sn(e)}},Jn=function(e){return{st:Mn(e),tz:Mn(e)}},Qn=function(e){switch(Je(e)){case 0:return Ie.Shin(function(e){return{chats:Fn(e),chans:Kn(e),users:qn(e)}}(e));case 1:return Ie.Shan(An(e));case 2:return Ie.Tree(Kn(e));case 3:return Ie.Treeid(An(e));case 4:return Ie.Chats(Fn(e));case 5:return Ie.Chans(Kn(e));case 6:return Ie.Users(qn(e));case 7:return Ie.Chat(zn(e));case 8:return Ie.Login(Bn(e));case 9:return Ie.MuteChan(Ln(e));case 10:return Ie.UnmuteChan(Ln(e));case 11:return Ie.DelChan(en(e));case 12:return Ie.Update(Hn(e));case 13:return Ie.Updates($n(e));case 14:return Ie.ChanUpdates(Vn(e));case 15:return Ie.MemUpdates(Wn(e));case 16:return Ie.On(Rn(e));case 17:return Ie.Ons(An(e));case 18:return Ie.Mems(Yn(e));case 19:return Ie.Err(Ze(e));case 20:return Ie.NewChan(en(e));case 21:return Ie.FindUsers(qn(e));case 22:return Ie.FindMems(qn(e));case 23:return Ie.Logout(nn(e));case 24:return Ie.AddMems(nn(e));case 25:return Ie.Unpack(Mn(e));case 26:return Ie.Profile(Gn(e));case 27:return Ie.Pwd(In(e));case 28:return Ie.Name(Mn(e));case 29:return Ie.Signup(Ze(e));case 30:return Ie.Typing(function(e){return{by:Ln(e),dir:An(e),key:Mn(e),keyCode:Nn(e),anchor:Ze(e),focus:Ze(e),txt:Mn(e),chname:Mn(e),re:Ln(e)}}(e));case 31:return Ie.Status(Jn(e));case 32:return Ie.ChatThread(An(e));case 33:return Ie.ChatList(An(e));case 34:return Ie.Sdp(Xn(e))}throw new Error("bad variant index for Response")},et=Ne(new ArrayBuffer(512)),nt=function(e,n){return et.pos=0,et=n(et,e),new Uint8Array(et.view.buffer).slice(0,et.pos)},tt=function(e,n){return n(Ne(e))},at=function(e){return tt(e.buffer,Qn)},rt=function(e){return nt(e,Un)},it=function(e){return nt(e,_n)},st=function(e){return tt(e.buffer,Zn)};const ot=e=>new Zlib.RawInflate(e).decompress(),lt=e=>new Zlib.RawDeflate(e).compress();async function ct(e,n){let t=new Uint8Array(e),a=t.length,{z:r,c:i,d:s}=Te();if(s){let e=t.subarray(0,12);t=new Uint8Array(await Ce(t.subarray(12),Ae.sskey,e)),U(t,e)}if(i){let e=t.subarray(0,12);t=new Uint8Array(await Ce(t.subarray(12),n,e)),U(t,e)}return r&&(t=ot(t)),(100*a/t.length).toFixed(2),function(e){return at(e)}(t)}const ut=document.location.hash.substr(1).match(/^ip\/(?<ip>[\:\.\d]+)$/),dt=ut?ut.groups.ip:"mx.hyze.io:9898",ft=Y();let ht,vt,pt,mt=!1,yt=500,wt=0,gt=()=>{},bt={recv:e=>gt=e,send:async function(e){await ft.join(),ht.send(await async function(e,n){((e,n)=>{e.length||e.byteLength})(e=rt(e));let{z:t,c:a,d:r}=Te();if(t&&(e=lt(e)),a){const t=crypto.getRandomValues(new Uint8Array(12));U(e,t),e=I(t,new Uint8Array(await ke(e,n,t)))}if(r){const n=crypto.getRandomValues(new Uint8Array(12));U(e,n),e=I(n,new Uint8Array(await ke(e,Ae.sskey,n)))}return performance.now(),e}(e,pt))}};function kt(){mt=!0,wt++,yt+=j(0,wt<16?200:3e3),setTimeout(Ct,yt)}async function Ct(){const e=await async function(){const e=async()=>{vt=await be();let e=await crypto.subtle.exportKey("raw",vt.publicKey);return new Uint8Array(e)};return await(async(e,n)=>{let[t,a]=await Promise.all([e(),n()]);return a?D(t,a):N(t,64,24)})(e,Me)}();performance.now(),ht=new WebSocket("wss://"+dt),ht.binaryType="arraybuffer",ht.onopen=async()=>{ht.send(e)},ht.onmessage=St,ht.onerror=console.error,ht.onclose=kt}async function St({data:e}){let n=new Uint8Array(e);Te((e=>{const n=new g(e);return{z:n.get(0),c:n.get(1),d:n.get(2)}})(n));let t=await ge(n.slice(1));pt=await we(vt.privateKey,t),ht.onmessage=Et,ft.complete(),mt&&xe("reconnected"),mt=!1}async function Et({data:e}){gt(await ct(e,pt))}Ct();function xt(e){const n=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(n),a=new Uint8Array(t.length);for(let e=0;e<t.length;++e)a[e]=t.charCodeAt(e);return a}async function _t(){let e=await navigator.serviceWorker.ready,n=await e.pushManager.getSubscription();if(n){let e=JSON.parse(JSON.stringify(n)),t=await ve("s");if(t instanceof ArrayBuffer&&(new TextDecoder).decode(t)==e.keys.auth)return;ne("s",(new TextEncoder).encode(e.keys.auth).buffer),xe("subs",e)}else navigator.serviceWorker.getRegistration().then((e=>{e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:xt("BIm2PpzmeMy3pe_VkzyP8Yq-iqG8ay0qLBGcJZNXnq5lOKu1fAyY9xQ2PK2KQjzWulmKu8IzBLmut276h4tIw5k")}).then((e=>{}),(e=>{}))}))}function Tt(e,n,t){const{root:a,subscribe:r,sample:i,cleanup:s}=d;null==t&&(t=!n.$t);let o=d.h([]),l=d.add(o,""),c=new Map,u=new Map,f=new Set;function h(e,r){if(null==e)return;let i=u.get(e);return 1===r?(f.delete(e),i||(i=t?a((t=>(c.set(e,t),n(e.$v||e)))):n(e.$v||e),11===i.nodeType&&(i=(e=>{const{childNodes:n}=e,{length:t}=n;if(t<2)return n[0];let a=Array.from(n);return{nodeType:111,t:a[0],o:a[t-1],l(){if(n.length!==t){let n=0;for(;n<t;)e.appendChild(a[n++])}return e}}})(i)||i),u.set(e,i))):-1===r&&f.add(e),((e,n)=>111===e.nodeType?1/n<0?n?d.rm(e.t.parentNode,e.t.nextSibling,e.o.nextSibling)||e.t:e.o:n?e.l():e.t:e)(i,r)}function v(e){let n=c.get(e);n&&(n(),c.delete(e)),u.delete(e)}return s(r((n=>{let t=e();return i((()=>{f.clear();let e=Array.from(function(e,n,t,a,r){let i,s,o=new Map,l=new Map;for(i=0;i<n.length;i++)o.set(n[i],i);for(i=0;i<t.length;i++)l.set(t[i],i);for(i=s=0;i!==n.length||s!==t.length;){var c=n[i],u=t[s];if(null===c)i++;else if(t.length<=s)e.removeChild(a(n[i],-1)),i++;else if(n.length<=i)e.insertBefore(a(u,1),a(n[i],0)||r),s++;else if(c===u)i++,s++;else{var d=l.get(c),f=o.get(u);void 0===d?(e.removeChild(a(n[i],-1)),i++):void 0===f?(e.insertBefore(a(u,1),a(n[i],0)||r),s++):(e.insertBefore(a(n[f],1),a(n[i],0)||r),n[f]=null,f>i+1&&i++,s++)}}return t}(l.parentNode,n||[],t,h,l));return f.forEach(v),e}))}))),s((function(){c.forEach((e=>e())),c.clear(),u.clear(),f.clear()})),o}function Ut(e,n,t,a){return new(t||(t=Promise))((function(r,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function o(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,o)}l((a=a.apply(e,n||[])).next())}))}function At(e,n){var t,a,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,a&&(r=2&i[0]?a.return:i[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,i[1])).done)return r;switch(a=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,a=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=n.call(e,s)}catch(e){i=[6,e],a=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}}function Mt(e,n){for(var t=0,a=n.length,r=e.length;t<a;t++,r++)e[r]=n[t];return e}function Dt(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e}"serviceWorker"in navigator&&(navigator.serviceWorker.register("sw.js").then((()=>{})),navigator.serviceWorker.addEventListener("message",(function(e){e.data.reload&&location.reload()}),!1));const Lt="0VMZYpdgCGL3iKAzDHwocTt97e1hasO2mJNjExq4PvR6XyWSFbIn-5B_8fUukQlr",Pt=Lt.split(""),Ot=new Array(123);for(let e=0;e<Lt.length;e++)Ot[Lt.charCodeAt(e)]=e;const jt=e=>{if(e<0)return"-"+jt(-e);let n=e>>>0,t=e/4294967296>>>0,a="";for(;t>0;)a=Pt[63&n]+a,n>>>=6,n|=(63&t)<<26,t>>>=6;let r="";do{r=Pt[63&n]+r,n>>>=6}while(n>0);return r+a};var It={ntob:jt,bton:e=>{let n=0;for(let t=0;t<e.length;t++)n=64*n+Ot[e.charCodeAt(t)];return n}};const Nt=[0,null,"⛩",0],zt=(()=>{let e=t(Nt);const n=t([e]),a=n=>e(n),r=e=>{let t=n();t[e[0]]!==e&&(t[e[0]]=e),t.splice(e[0]+1),n(t),a(e),location.hash=e[0]>0?It.ntob(e[3]):""};return{path:n=>e()[n],paths:n,len:()=>n().length,setpath:a,same:n=>n===e(),cd:r,update:e=>{n([Nt,...e]),a(e[e.length-1]||Nt)},ishome:()=>e()===Nt,home:()=>r(Nt)}})(),Ft=[];function Kt(){!function(e){for(const n of Ft)n(e)}(document.location.hash.substr(1))}window.addEventListener("hashchange",Kt),setTimeout(Kt);const Rt=30,qt=e=>(n,t)=>{if(void 0===n)return e;let a=e.get(n);return t?a?a[t]:void 0:a},Bt=e=>{let n=t(e);return n.add=e=>n().indexOf(e)<0?n([...n(),e]):n(),n.delete=e=>{n().splice(n().indexOf(e),1),n(n())},n.last=()=>n()[n().length-1],n.pop=()=>{let e=n().pop();return n(n()),e},n},Ht=t([]),$t=t([]),Vt=t(0),Wt=t(0),Yt=t(0),Gt=t(0),Xt=t(""),Zt=t(""),Jt=t(""),Qt=t(!1),ea=t(!1),na=qt(new Map),ta=qt(new Map),aa=qt(new Map),ra={id:0,childids:t([]),childs:qt(new Map),open:()=>{}},ia=qt(new Map([[0,ra]])),sa=t([]),oa=Bt([]),la=Bt([]),ca=t([]),ua=t([]),da=t(0),fa=t(null),ha=t(!1),va=t(""),pa=t(!1),ma=Bt([]),ya=Bt([]),wa=Bt([]),ga=t(!0),ba=t(null),ka=t(!1),Ca=t(!1);t(""),t("");const Sa=t(0),Ea=t(0),xa=t(0),_a=t(null),Ta=t(location.hash.substr(1)),Ua=t(null),Aa=Bt([]),Ma=qt(new Map),Da=Bt([]),La=t(!1),Pa=()=>$t().length>0?$t()[$t().length-1]:0,Oa=(()=>{const e={},n={};return{create:t=>n[t]=new Promise((n=>e[t]=n)),complete:(n,t)=>e[n]?e[n](t):null,join:e=>n[e],joinall:(...e)=>Promise.all(e.map((e=>n[e]))),select:(...e)=>Promise.race(e.map((e=>n[e])))}})(),ja={content:null},Ia=()=>{switch(xa()){case 1:return"please login first";case 2:return"invalid login name or password";case 3:return"email existed";case 4:return"username existed";case 5:return"please select a topic";case 6:return"topic is empty";case 7:return"invalid email address";case 8:return"error adding people";case 9:return"error signing up";case 10:return"invalid name";case 11:return"invalid input";case 12:return"password too short";case 13:return"invalid password";case 14:return"new password is the same with old password";case 15:return"peer offline";case 16:return"You are behind a NAT or firewall, can not create a direct connection to peer"}};function Na(...e){return e.includes(xa())}let za;const Fa=e=>{xa(e),clearTimeout(za),za=setTimeout((()=>xa(0)),5e3)},Ka=e=>{_a(e),clearTimeout(za),za=setTimeout((()=>_a(null)),5e3)};bt.recv((async e=>{let n=e.value;switch(e.tag){case"Err":Fa(n);break;case"Unpack":Oa.complete("unpack",n);break;case"AddMems":Oa.complete("addmems",n);break;case"Logout":Te({d:!1});break;case"NewChan":Gt(n),T();break;case"Shin":if(!n)return;E(n.chats,ta()),x(n.users,aa()),_(n.chans,na()),ae("_t",n.chats),ae("_h",n.chans),ae("_e",n.users),async function(e){let n=e||[],t=Vt();if(0===n.length)return Qt(!0),de(t,null,!0),void Oa.complete("chatscan",n);Qt(!1),de(t,[n[0],n[n.length-1]]);let a=n.map((e=>({chanid:t,chatid:e})));ae("_c",a),Oa.complete("chatscan",n)}(n.chats.map((e=>e.id)));break;case"Update":{let e=new Set([Vt()]);lr(e,n),e.forEach((e=>me("_u",e,n.id)));break}case"Updates":n&&n.length&&async function(e){let n=new Set([Vt()]);for(const t of e)lr(n,t);n.forEach((n=>me("_u",n,e[e.length-1].id)))}(n);break;case"ChanUpdates":n&&n.length&&async function(e){let n=new Set([Vt()]);for(const{action:t,chanid:a,name:r,about:i,md:s}of e)switch(t){case 1:{let e=na(a);e&&(null!==r&&e.fullname(r),null!==i&&e.about(i),null!==s&&e.md(s)),e=await pe(a,"_h"),e&&(null!==r&&(e.fullname=r),null!==i&&(e.about=i),null!==s&&(e.md=s),await ie("_h",e),e.dir.forEach((e=>n.add(e))));break}case 2:let e=await ar(a);e&&e.dir.forEach((e=>n.add(e)))}n.forEach((n=>me("_d",n,e[e.length-1].id)))}(n);break;case"MemUpdates":n&&n.length&&async function(e){let n=new Set([Vt()]),t=new Map;for(const{action:n,chanid:a,by:r}of e)switch(n){case 1:t.has(a)?t.get(a).adds.push(r):t.set(a,{adds:[r],rms:[]});break;case 0:t.has(a)?t.get(a).rms.push(r):t.set(a,{adds:[],rms:[r]})}for(let[e,{adds:a,rms:r}]of t.entries()){let t=await pe(e,"_n");t&&(t=t.filter((e=>r.indexOf(e)<0)),me("_n",e,Array.from(new Set([...a,...t])))),n.add(e)}ur(Gt()||Vt()),n.forEach((n=>me("_m",n,e[e.length-1].id)))}(n);break;case"Login":if(!n)return Fa(2),Ue(void 0),void xe("login",!1);await async function({data:e,chans:n}){const t=await Oe(e);ie("_e",t),Te({d:!0}),Ae.chans(n),ne("c",n)}(n),hr(),xe("login",!0),La(!1),Gt(0),ra.childids([]),sr(),Wa();break;case"Pwd":if(!n)return Ue(void 0),void Oa.complete("pwd",13);Ae.id()&&await Oe(n),Oa.complete("pwd");break;case"Users":ae("_e",n),Oa.complete("users",n);break;case"Chans":ae("_h",n),Oa.complete("chans",n);break;case"Chat":!async function(e){let n=$t();if(n.includes(e.id))return;let a=!na(e.chanid),r=R();e.by==Ae.id()&&ba(e.id);await ie("_t",e);let i=(Vt()?e.dir:[0,...e.dir]).map((n=>(de(n,[e.id,e.id]),{chanid:n,chatid:e.id})));ae("_c",i);let s=new Set(aa().has(e.by)?[]:[e.by]);e.men&&e.men.forEach((e=>{aa().has(e)||s.add(e)}));let o=e.dir.filter((e=>!na(e))),l=new Set(o);await Ha(s,l),e.re&&Sr(e.re);let c=ta(Pa())||{};e.nor=t(0),e.star=t(!1),e.txt=t(e.txt),e.showby=t(e.by!==c.by),e.first=t(e.chanid!==c.chanid),e.last=t(!1),e.firstre=t(e.re&&e.re!==c.re&&e.re!=c.id),e.lastre=t(!1),e.timestamp=new Date(e.timestamp),ta().set(e.id,e),n.push(e.id),$t(n),a&&Wa(!0);r&&T();"ontouchstart"in document.documentElement||fr();e.dir.forEach((async n=>{let t=na(n);t&&(t.chatid=e.id),t=await pe(n,"_h"),t&&(t.chatid=e.id,await ie("_h",t))}))}(n);break;case"Chats":n.length>0&&ae("_t",n),Oa.complete("chats",n);break;case"Shan":{let e=n;e.length>0?(ea(!1),await Va(e)):ea(!0),Oa.complete("chanscan",e);break}case"Tree":n.length>0&&(ae("_h",n),_(n,na())),Oa.complete("scantree",n.map((e=>e.id)));break;case"Treeid":n.length>0&&await Va(n),Oa.complete("scantree",n);break;case"MuteChan":{let e=n;if(!e)return;let t=Ae.chans();if(t.includes(e))return;t.push(e),Ae.chans(t),await ne("c",t),await re(0,e,...na(e,"dir")),sr(),Ya(zt.path(3));break}case"UnmuteChan":{let e=n,t=Ae.chans();if(!t.includes(e))return;const a=t.indexOf(e);a>-1&&t.splice(a,1),Ae.chans(t),await ne("c",t),await re(0,e,...na(e,"dir")),sr(),Ya(zt.path(3));break}case"DelChan":ar(n);break;case"Mems":Oa.complete("memlist",n);break;case"FindUsers":x(n,aa()),ae("_e",n),Oa.complete("findusers",n);break;case"FindMems":x(n,aa()),ae("_e",n),Oa.complete("findmems",n);break;case"On":{let{id:e,online:t}=n;if(!e)return;let a=aa(e);a&&a.online(t);break}case"Ons":n.forEach((e=>aa(e).online(!0)));break;case"Profile":Oa.complete("profile",n);break;case"Name":Oa.complete("name",n);break;case"Signup":Oa.complete("signup",n);break;case"ChatThread":Oa.complete("thread",n);break;case"ChatList":Oa.complete("list",n);break;case"Status":Oa.complete("status",n);break;case"Sdp":n.offer?async function({fr:e,sd:n,ca:t}){let a=Oa.create("ice"),r=await Ur(e),{a:i,k:s}=M(new Uint8Array(n)),{keypair:o,pub:l}=await _r();s=await ge(s),r.sharedkey=await we(o.privateKey,s);let c=(new TextDecoder).decode(ot(i));await r.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:c}));let u=await r.createAnswer();await r.setLocalDescription(u);for(const e of t){const n=new RTCIceCandidate({candidate:e,sdpMid:0,sdpMLineIndex:0});await r.addIceCandidate(n)}n=lt((new TextEncoder).encode(r.localDescription.sdp)),n=A(n,l),await a,bt.send(je.Sdp({fr:null,to:e,sd:n,ca:xr,offer:null}))}(n):Oa.complete("offer",n)}})),(e=>{Ft.push(e)})((async e=>{Ta(e),Ua(null);let n=Aa();if(Ae.id()>0&&(n=[...n,Ae.id()]),await or(n),"$"===e[0]){let[n,a,r]=e.slice(1).split("/");if(a.length<50)return location.hash="#",La(!1);let i=await Oa.create("unpack",bt.send(je.Unpack(a)));if(!i)return location.hash="#",La(!1);let s=await Oa.create("name",bt.send(je.Email(i)));switch(n){case"i":if(!s)return function(e,n){const a=t("Log in Telegram");let r={};function i(e){e.preventDefault();let{n:t,p:a}=e.target,i=t.value.trim();wr(K,i)&&wr(V,a.value)&&async function(e,n,t,a,r){await te();const i=crypto.getRandomValues(new Uint8Array(12)),s=await Le(a,i);let o=await De(t,n),l=I(i,new Uint8Array(await ke(o,s,i))),c=q(),u={name:n,key:l,tz:c,tgid:r.id||null,tgname:r.username||null,tgfn:r.first_name||null,tgln:r.last_name||null};Ue(o),bt.send(je.NewUser(u))}(0,i,a.value,n,r)}function s(e){e.preventDefault(),window.Telegram.Login.auth({bot_id:"1850607378",request_access:!0},(e=>{e&&(S("username").value=e.username,a("Log in as "+e.first_name),r=e)}))}ja.content=v("div",{class:"pi"},v("div",{class:"su"},v("div",{class:"head"},"Sign up"),v("div",{class:"sub"},e),v("form",{onsubmit:i},(()=>Na(4,10,12)&&v("div",{class:"erm"},Ia())),v("input",{id:"username",type:"text",name:"n",placeholder:"Username",onkeypress:H,onkeyup:$,required:!0,autocomplete:"on",class:()=>Na(4,10)&&"er"}),v("input",{type:"password",name:"p",placeholder:"Password",required:!0,autocomplete:"on",class:()=>Na(12)&&"er"}),v("script",{async:!0,src:"https://telegram.org/js/telegram-widget.js?15"}),v("div",null,v("button",{onclick:s},a)),v("div",{class:"bn"},v("button",{type:"submit"},"Sign up"))))),La(!0)}(i,r),Ee("login",(e=>e?location.hash="#":null));break;case"f":if(s&&(s==Ae.name()||!Ae.id()))return function(e,n,t){async function a(n){n.preventDefault();let{p:a}=n.target;if(wr(V,a.value)){let n=await yr(e,t,a.value);if(n)return Fa(n);Ka("password updated"),La(!1),location.hash="#"}}ja.content=v("div",{class:"pi"},v("div",{class:"su"},v("div",{class:"head"},"Reset password"),v("div",{class:"sub"},n),v("form",{onsubmit:a},(()=>Na(12)&&v("div",{class:"erm"},Ia())),v("input",{type:"password",name:"p",placeholder:"Password",required:!0,autocomplete:"on",class:()=>Na(12)&&"er"}),v("div",{class:"bn"},v("button",{type:"submit"},"Submit"))))),La(!0)}(s,i,r)}return location.hash="#",La(!1)}if("/"===e[0]){let n=It.bton(e.slice(1));return Wt(n),$t([]),async function(e){ir.cb=null;let n=await Oa.create("thread",bt.send(je.ChatThread({i:e,kw:null,ub:null,lb:null})));await Ra(n,"re"),ir.cb=n=>async function(e,n){let t=await Oa.create("thread",bt.send(je.ChatThread({i:e,kw:null,ub:n,lb:null})));return Ra(t)}(e,n)}(n),fr(),void await Wa()}if("&"===e[0]){let n=It.bton(e.slice(1));return n==Ae.id()?location.hash="#":(Vt(0),Wt(0),ur(0),Gt(0),$a([]),$t([]),await or([n]),Ua(n),await async function(e){let n=await(async(e,n,t,a=!0)=>{let r={value:e};return await oe("_p",le,r,t,n,a,"prev")})(e);Da(n.reverse())}(n),await Wa(),!Ma().has(n)&&aa(n).online()&&Tr(n),void setTimeout((()=>fr()||T()),100))}let a=["!","@","*"].indexOf(e[0]);if(a>-1)return Vt(0),Gt(0),Wt(0),$t([]),async function(e){ir.cb=null;let n=await Oa.create("list",bt.send(je.ChatList({i:e,kw:null,ub:null,lb:null})));await Ra(n,"re"),ir.cb=n=>async function(e,n){let t=await Oa.create("list",bt.send(je.ChatList({i:e,kw:null,ub:n,lb:null})));return Ra(t)}(e,n)}(a),fr(),void await Wa();if("%"===e[0])return location.hash="#"+It.ntob(Number(e.slice(1)));if(!e||!Lt.includes(e[0]))return Vt(0),Wt(0),ur(0),Gt(0),$a([]),await Wa(),sr(),void(document.title="hyze - micro chat for team");let r=It.bton(e);if(await Wa(),Vt(r),Gt(0),Wt(0),sr(),!na(r))return;let i=na(r).dir;$a([...i,r]),ur(r),document.title=na(Vt()).fullname()+" - hyze"}));const Ra=async(e,n=null)=>{await qa(e);let a=e[0],r=new Set,i=new Set,s=$t(),o="re"===n?new Set:new Set(s);switch(e=e.filter((e=>{let n=ta(e);if(!n)return!1;"function"!=typeof n.txt&&(n.txt=t(n.txt),n.star=t(n.star),n.first=t(!1),n.last=t(!1),n.firstre=t(!1),n.lastre=t(!1),n.showby=t(!1),n.nor=t(n.nor)),"string"==typeof n.timestamp&&(n.timestamp=new Date(n.timestamp)),aa().has(n.by)||r.add(n.by),n.men&&n.men.forEach((e=>{aa().has(e)||r.add(e)})),n.dir.forEach((e=>{na().has(e)||i.add(e)}));let a=o.has(e);return o.add(e),!a})),await Ha(r,i),e.reverse(),n){case"re":$t(e);break;case"pre":$t(s.concat(e));break;default:$t(e.concat(s))}let l=$t();for(let e=0;e<l.length;e++){let n=ta(l[e-1])||{},t=ta(l[e+1])||{},a=ta(l[e]);a.showby(a.by!==n.by),a.first(a.chanid!==n.chanid),a.last(a.chanid!==t.chanid),a.firstre(a.re&&a.re!==n.re&&a.re!=n.id),a.lastre(a.re&&a.re!==t.re)}fr(),a&&S(It.ntob(a)+"_").scrollIntoView()},qa=async e=>{e=await Ba(e),e=new Set(e.map((e=>ta(e,"re"))).filter((e=>e>0&&!ta().has(e)))),Ba(Array.from(e))},Ba=async e=>{if(0===(e=e.filter((e=>!ta().has(e)))).length)return e;let{value:n,missed:t}=await se("_t",e);if(E(n,ta()),t.length>0){let e=await Oa.create("chats",bt.send(je.Chats(t)));E(e,ta())}return e},Ha=async(e,n)=>{let t=await se("_e",Array.from(e)),a=await se("_h",Array.from(n));t.value.length&&bt.send(je.Ons(t.value.filter((e=>e.id!=Ae.id())).map((e=>e.id)))),x(t.value,aa()),_(a.value,na()),t.missed.length>0&&Oa.create("users",bt.send(je.Users(t.missed))),a.missed.length>0&&Oa.create("chans",bt.send(je.Chans(a.missed)));let[r,i]=await Oa.joinall("users","chans");r&&x(r,aa()),i&&_(i,na())},$a=e=>{let n=e.map(((e,n)=>{let t=na(e)||{};return[n+1,t.mom,t.fullname,e]}));zt.update(n)},Va=async e=>{if(0===(e=e.filter((e=>!na().has(e)))).length)return;let{value:n,missed:t}=await se("_h",e);if(_(n,na()),t.length>0){let e=await Oa.create("chans",bt.send(je.Chans(t)));_(e,na())}};async function Wa(e=null,n=null){if(0===ra.childids().length||e){performance.now();let t=n?[]:await async function(){let e=await oe("_h",(e=>[e.index("chatid"),null]));return _(e,na()),e.map((e=>e.id))}();t.length<1&&(t=await async function(e=null,n=null){n&&Zt(n);return Oa.create("scantree",bt.send(je.Tree({kw:n,reload:e})))}(e,n)),Ga(t)}}const Ya=async(e,n=null,t=null)=>{performance.now(),Wa(null,n);let a=await pe(e,"_d")||null,r=await pe(e,"_m")||null,i=await((e,n=null,t=null,a=null,r=null,i=null)=>{a&&Zt(a);let s=je.Shan({chanid:e,kw:a,ub:r,lb:i,cu:n,mu:t});return Oa.create("chanscan",bt.send(s))})(e,a,r,n,t);t?0===i.length||Ht(Ht().concat(i)):(0!==i.length||n||xe("nochan"),Ht(i));let s=Xa(e);s&&(Za(Ht(),s.childs()),s.childids(Ht()))};function Ga(e,n=0){const t=e.filter((e=>na(e).mom==n));let a=Xa(n);a&&((Vt()==n||Vt()&&na(Vt())&&na(Vt()).dir.includes(n))&&a.open(!0),Za(t,a.childs()),a.childids(t));for(const n of t)Ga(e,n)}function Xa(e){let n=e&&na(e)?[0,...na(e).dir,e]:[0],t=ia();var a,r;for(r=0;r<n.length;r++){let e=n[r];t.has(e)&&(a=t.get(e),t=a.childs())}return a}function Za(e,n){return e.reduce(((e,n)=>(e.has(n)||e.set(n,{id:n,childids:t([]),childs:qt(new Map),open:t(!1)}),e)),n)}const Ja=e=>Ya(zt.path(3),e),Qa=e=>{Jt(e),sr(e)};const er=async({id:e,mom:n,name:t})=>{e!==Vt()&&zt.cd([zt.path(0)+1,n,t,e])},nr=async e=>{bt.send(je.MuteChan(e))},tr=async e=>{bt.send(je.UnmuteChan(e))};async function ar(e){let n=na(e);n&&na().delete(e),n=await pe(e,"_h"),n&&await(async({id:e,dir:n})=>{let t=await G.join();if(!t)return;let a=[0,...n,e];!function(e){e.forEach((async e=>{he(e)}))}(a),function(e){let n=t.transaction(["_c"],"readwrite").objectStore("_c");e.forEach((e=>{let t=IDBKeyRange.bound([e],[e,Number.MAX_VALUE]);n.delete(t).onerror=console.error}))}(a)})(n);let t=Ht(),a=t.indexOf(e);return a>-1&&(t.splice(a,1),Ht(t)),n}const rr=async e=>{let n=Jt()||null,t=Vt();performance.now();let a=await fe(t)||[];if(a[2]&&e===a[1])return void Qt(!0);if(Qt(!1),!n){let n=await ue(t,e,Rt);if(a[2]||n.length===Rt)return void await Ra(n)}let r=await((e=null,n=null,t=null)=>{let a=je.Shin({chanid:Vt(),kw:e,ub:n,lb:t,lu:null,cu:null,mu:null});return Oa.create("chatscan",bt.send(a))})(n,e);r.length>0&&await Ra(r)};let ir={cb:null};async function sr(e=null){ir.cb=null,Qt(!1),Yt(0);let n=Vt();performance.now();let t=await fe(n)||[],a=e?null:t[0]||null,r=await ue(n,null,Rt);await Ra(r,"re"),ir.cb=rr;let i={id:await pe(n,"_u")||0,lo:t[1]||0},s=await pe(n,"_d")||null,o=await pe(n,"_m")||null,l=await((e=null,n=null,t=null,a=null,r=null,i=null)=>{let s=je.Shin({chanid:Vt(),kw:a,ub:r,lb:i,lu:e,cu:n,mu:t});return Oa.create("chatscan",bt.send(s))})(i,s,o,e,null,a)||[];await Ra(l,l.length!==Rt&&0!==r.length&&a?"pre":"re")}async function or(e){let n=e.filter((e=>!aa().has(e)));if(n.length){let{value:e,missed:t}=await se("_e",n);if(x(e,aa()),t.length>0){let e=await Oa.create("users",bt.send(je.Users(t)));e&&x(e,aa())}bt.send(je.Ons(n.filter((e=>e!=Ae.id()))))}}async function lr(e,{action:n,chatid:t,txt:a}){switch(n){case 1:{let n=ta(t);n&&n.txt(a),n=await pe(t,"_t"),n&&(n.txt=a,await ie("_t",n),n.dir.forEach((n=>e.add(n))));break}case 2:let n=await cr(t);n&&n.dir.forEach((n=>e.add(n)))}}async function cr(e){let n=ta(e);n&&ta().delete(e),n=await pe(e,"_t"),n&&await(async({id:e,dir:n})=>{let t=await G.join();if(!t)return;let a=[0,...n];!function(e,n){n.forEach((async n=>{let t=await fe(n);t&&t.includes(e)&&he(n)}))}(e,a),function(e,n){let a=t.transaction(["_c"],"readwrite").objectStore("_c");n.forEach((n=>{let t=IDBKeyRange.only([n,e]);a.delete(t).onerror=console.error}))}(e,a),function(...e){let n=t.transaction(["_t"],"readwrite").objectStore("_t");e.forEach((e=>{n.delete(e).onerror=console.error}))}(e)})(n);let t=$t(),a=t.indexOf(e);return a>-1&&(t.splice(a,1),$t(t)),fr(),n}async function ur(e){if(!e)return sa([]);let n=na(e).md()<2?[...na(e).dir,e]:[e],{value:t,missed:a}=await se("_n",n),r=[];if(a.length){let e=await Oa.create("memlist",bt.send(je.Mems(a)));for(const n of e){x(n.users,aa()),ae("_e",n.users);let e=n.users.map((e=>e.id));me("_n",n.chanid,e),r=[...r,...e]}}let i=Array.from(new Set([...t.flat(),...r]));await or(i),i.sort((e=>aa(e).online()?-1:0)),sa(i)}async function dr(e){let n=await Oa.create("findmems",bt.send(je.FindMems({chanid:Gt()||Vt(),kw:e})));ua(n);let t=n.find((n=>n.name===e));if(t)da(n.indexOf(t));else{let t=n.find((n=>n.name.startsWith(e)));da(t?n.indexOf(t):0)}return n.length}function fr(){if(!S("cs"))return;let e=window.innerHeight-S("cs").offsetHeight-(Ae.id()?96:64)-(pa()&&ha()?56:pa()?32:ha()?24:0),n=S("os");S("cs").childElementCount>2&&(e-=5),n.style.height=e>0?e+"px":"0"}function hr(){const e=Ae.id();let n=aa(e);n?n.online(!0):aa().set(e,{id:e,name:Ae.name(),tz:q(),online:t(!0)})}window.onresize=fr,Ee("reconnected",(()=>{sr(),Ya(zt.path(3))}));let vr=new Map;async function pr(e){return bt.send(je.Au(e)),Ka("a secret 6-digits otp code has been sent to your registered email"),await Oa.create("enterotp",function(){let e=[...Array(6)].map((e=>v("input",{class:"ot",type:"tel",autocomplete:"chrome-off"}))),n=e[0];n.addEventListener("input",t),setTimeout((()=>n.focus()));for(let n=0;n<e.length;n++){let a=e[n];a.addEventListener("keypress",(function(t){t.keyCode>47&&t.keyCode<58&&(a.value=t.key,n!==e.length-1&&e[n+1].focus()),t.preventDefault()})),a.addEventListener("keydown",(function(t){"Backspace"===t.key&&(a.value="",0!==n&&e[n-1].focus())})),a.addEventListener("keyup",(function(n){if(16===n.keyCode||9==n.keyCode||224==n.keyCode||18==n.keyCode||17==n.keyCode)return;n.target.value.length>1&&t(n);let a=e.map((e=>e.value)).join("");a.length===e.length&&Oa.complete("enterotp",a)}))}function t(e){let n=e.data||e.target.value;n&&1!==n.length&&a(e.target,n)}function a(e,n){e.focus(),e.value=n[0],n=n.substring(1),e.nextElementSibling&&n.length&&a(e.nextElementSibling,n)}ja.content=v("div",{class:"pi"},v("div",{class:"su otp"},v("div",{class:"head"},"Enter OTP code"),v("div",{class:"sub"},"Please enter the 6-digits code sent to your email"),v("div",{id:"otp"},e))),La(!0)}())}async function mr(e,n,t){na().clear(),ta().clear(),aa().clear(),sa([]),await te();const a=crypto.getRandomValues(new Uint8Array(12)),r=await Le(t,a);let i=await De(n,e),s={name:e,key:I(a,new Uint8Array(await ke(i,r,a))),tz:q()};Ue(i),bt.send(je.Login(s))}async function yr(e,n,t,a=null){const r=crypto.getRandomValues(new Uint8Array(12)),i=await Le(n,r);let s=a?new Uint8Array(await De(a,e)):null,o=await De(t,e),l=I(r,new Uint8Array(await ke(o,i,r)));return Ue(o),Oa.create("pwd",bt.send(je.Pwd({key:l,okey:s})))}function wr(e,...n){let t=e(...n);return!t||Fa(t)}function gr(){ja.content=v("div",{class:"pi"},v("div",{class:"su"},v("div",{class:"head"},"Sign up"),v("div",{class:"sub"},"We will send a sign up invitation to your email"),v("form",{onsubmit:async function(e){e.preventDefault();let{m:n}=e.target,t=n.value.trim();if(F(t)){let e=await Oa.create("signup",bt.send(je.Signup(t)));if(e)return Fa(e);Ka(`an invite code has been sent to ${t}, it should arrive shortly, you might have to check your spam folder`),La(!1)}else Fa(7)}},(()=>Na(3,7)&&v("div",{class:"erm"},Ia())),v("input",{type:"text",name:"m",placeholder:"Your email address",onkeypress:B,onkeyup:$,required:!0,autocomplete:"on",class:()=>Na(3,7)&&"er"}),v("div",{class:"bn"},v("button",{type:"submit"},"Sign up"))))),La(!0)}function br(){ja.content=v("div",{class:"pi"},v("div",{class:"su"},v("div",{class:"head"},"Log in"),v("div",{class:"sub"}),v("form",{onsubmit:async function(e){e.preventDefault();let{m:n,p:t}=e.target,a=n.value.trim();if(F(a))return async function(e,n){let t=vr.has(e)?vr.get(e):await Oa.create("name",bt.send(je.Email(e)));if(vr.set(e,t),!t)return Fa(2);mr(t,n,await pr(t))}(a,t.value);if(wr(K,a)){let e=await pr(a);mr(a,t.value,e)}}},(()=>Na(7,10)&&v("div",{class:"erm"},Ia())),v("input",{type:"text",name:"m",placeholder:"Username or email",onkeypress:B,onkeyup:$,required:!0,autocomplete:"on",class:()=>Na(7,10)&&"er"}),v("input",{type:"password",name:"p",placeholder:"Password",required:!0,autocomplete:"on"}),v("div",{class:"lf fp"},v("a",{onclick:kr},"Forgot password")),v("div",{class:"bn"},v("button",{type:"submit"},"Log in"))))),La(!0)}function kr(){ja.content=v("div",{class:"pi"},v("div",{class:"su"},v("div",{class:"head"},"Forgot password"),v("div",{class:"sub"},"We will send a password reset link to your email"),v("form",{onsubmit:async function(e){e.preventDefault();let{m:n}=e.target,t=n.value.trim();F(t)?(Oa.create("forgotpwd",bt.send(je.Fp(t))),Ka(`a password reset link has been sent to ${t}, it should arrive shortly, you might have to check your spam folder`),La(!1)):Fa(7)}},(()=>Na(7)&&v("div",{class:"erm"},Ia())),v("input",{type:"text",name:"m",placeholder:"Your email address",onkeypress:B,onkeyup:$,required:!0,autocomplete:"on",class:()=>Na(7)&&"er"}),v("div",{class:"bn"},v("button",{type:"submit"},"Submit"))))),La(!0)}Ee("config",(async({d:e})=>{e?(hr(),_t()):Ae.id()&&(Gt(0),aa(Ae.id())&&aa(Ae.id()).online(!1),Ae.id(0),Ae.name(null),Ae.chans([]),delete Ae.sskey,delete Ae.salt,await te(),ra.childids([]),zt.ishome()?(sr(),Wa()):zt.home())})),Ee("subs",(function(e){bt.send(je.PushSubs({endpoint:e.endpoint,auth:e.keys.auth,p256dh:e.keys.p256dh}))}));const Cr=e=>{Gt()!==e?Gt(e):Gt(0),ur(Gt()||Vt()),Yt(0)};const Sr=async e=>{const n=ta(e);n&&n.nor(n.nor()+1);const t=await pe(e,"_t");t&&(t.nor=n.nor(),await ie("_t",t))};async function Er(e){return Oa.create("status",bt.send(je.Status(e)))}let xr=[];async function _r(){const e=await be(),n=await crypto.subtle.exportKey("raw",e.publicKey);return{keypair:e,pub:new Uint8Array(n)}}async function Tr(e){let n=Oa.create("ice"),t=await Ur(e),a=await t.createOffer();await t.setLocalDescription(a);let r=lt((new TextEncoder).encode(t.localDescription.sdp)),{keypair:i,pub:s}=await _r();r=A(r,s),await n;let o=await Oa.create("offer",bt.send(je.Sdp({fr:null,to:e,sd:r,ca:xr,offer:!0}))),{a:l,k:c}=M(new Uint8Array(o.sd));c=await ge(c),t.sharedkey=await we(i.privateKey,c);let u=(new TextDecoder).decode(ot(l));t.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:u}));for(const e of o.ca){const n=new RTCIceCandidate({candidate:e,sdpMid:0,sdpMLineIndex:0});await t.addIceCandidate(n)}}async function Ur(e){await or([e]);let n=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]});Ma().has(e)||Aa.add(e),Ma().set(e,n),n.onicecandidate=e=>{e.candidate?xr.push(e.candidate.candidate):Oa.complete("ice",xr)},n.onconnectionstatechange=e=>{};let t=n.createDataChannel("p",{negotiated:!0,id:1});return t.binaryType="arraybuffer",t.onopen=e=>{},t.onmessage=async({data:t})=>{let a=R(),r=new Uint8Array(t),i=r.subarray(0,12);r=new Uint8Array(await Ce(r.subarray(12),n.sharedkey,i)),U(r,i);let s=st(ot(r));s.by=e,s.ts=new Date,s.room=e,(Da.last()||{}).by!=e&&(s.showby=!0),s.id=await ie("_p",s),Ua()==e&&Da.add(s),a&&setTimeout(T),fr()},t.onclose=n=>{var t,a;setTimeout((()=>{if(aa(e).online())return Tr(e)}),(t=1e3,a=5e3,Math.random()*(a-t)+t))},t.onerror=e=>{},n.send=async e=>{let a=lt(it(e));const r=crypto.getRandomValues(new Uint8Array(12));U(a,r),a=I(r,new Uint8Array(await ke(a,n.sharedkey,r))),t.send(a)},n.open=()=>"open"===t.readyState,n}function Ar({id:e},n){if(!e||Yt()===e)return Yt(0);n.focus(),Yt(e)}var Mr,Dr,Lr=function(){var e=document.createElement("div");e.contentEditable="true",e.className="s-c",e.oninput=b((function(){var n=e.textContent;n&&n.length>50||(Ja(n),Qa(n))}),200),e.onkeydown=function(e){"Enter"!==e.key||e.shiftKey||e.preventDefault()};var n=document.createElement("div");return setTimeout((function(){new IntersectionObserver((function(n){if(!(n[0].intersectionRatio<=0)){var t=Xa(Vt()).childids(),a=t[t.length-1];if(!(!a||ea()||t.length<Rt)){var r=e.textContent||null;r&&r.length>50||setTimeout((function(){return Ya(zt.path(3),r,a)}))}}}),{}).observe(n)})),p(Dr||(Dr=Dt(['\n        <div class="cn">\n            <div class="s">','</div>\n            <div class="tbl">\n                <table>\n                    <tbody>\n                        ',"\n                        ","\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    "],['\n        <div class="cn">\n            <div class="s">','</div>\n            <div class="tbl">\n                <table>\n                    <tbody>\n                        ',"\n                        ","\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    "])),e,(function(){return Tt(Xa(Vt()).childids,(function(e){var n=na(e);return p(Mr||(Mr=Dt(["\n                                    <tr onclick=",">\n                                        <td>\n                                            <button onclick=",">\n                                                ","\n                                            </button>\n                                        </td>\n                                        <td>","</td>\n                                    </tr>\n                                "],["\n                                    <tr onclick=",">\n                                        <td>\n                                            <button onclick=",">\n                                                ","\n                                            </button>\n                                        </td>\n                                        <td>","</td>\n                                    </tr>\n                                "])),(function(){return er(n)}),(function(n){return function(e,n){if(e.stopPropagation(),!Ae.id())return br();Ae.chans().includes(n)?tr(n):nr(n)}(n,e)}),(function(){return Ae.chans().includes(e)?"➕":"➖"}),n.fullname)}))}),n)};const Pr="formatBlock",Or=(e,n)=>e.appendChild(n),jr=e=>document.createElement(e),Ir=e=>document.queryCommandState(e),Nr=(e,n=null)=>document.execCommand(e,!1,n),zr=[{icon:"<b>B</b>",title:"Bold",state:()=>Ir("bold"),result:()=>Nr("bold")},{icon:"<i>I</i>",title:"Italic",state:()=>Ir("italic"),result:()=>Nr("italic")},{icon:"<u>U</u>",title:"Underline",state:()=>Ir("underline"),result:()=>Nr("underline")},{icon:"<strike>S</strike>",title:"Strike-through",state:()=>Ir("strikeThrough"),result:()=>Nr("strikeThrough")},{icon:"&#8220&#8221;",title:"Quote",result:()=>Nr(Pr,"<blockquote>")},{icon:"&lt;&gt;",title:"Code",result:()=>Nr(Pr,"<pre>")},{icon:"&#128279;",title:"Link",class:" lk",result:()=>{const e=window.prompt("Enter the link URL");e&&Nr("createLink",e)}},{icon:"🌁",title:"Image",class:" im",result:()=>{const e=window.prompt("Enter the image URL");e&&Nr("insertImage",e)}},{icon:"⏎",title:"Enter to send",class:" en se",result:e=>(ga()?ga(!1):ga(!0),ga()?e.classList.add("se"):e.classList.remove("se"),!0)}],Fr="e-b",Kr="e-bs";let Rr="",qr=0,Br=!1,Hr=t(!1);const $r=()=>S("tp"),Vr=()=>S("pm"),Wr=()=>S("mb"),Yr=e=>{qr=C();let n=e.textContent,t=n.indexOf(" ",qr);-1==t&&(t=n.length);var a=/[\S]+$/.exec(n.slice(0,t));return a?a[0]:""},Gr=({id:e,name:n})=>{ua([]),da(0);let t=fa();if(t.spellcheck=!1,t===Wr()){let a=Rr?"@"+n:n;t.textContent=Rr?((e,n)=>{let t=e.textContent,a=t.indexOf(" ",qr);-1==a&&(a=t.length);var r=t.slice(0,a).replace(/\S+$/,n);return qr=r.length,r+t.slice(a)})(t,a):t.textContent+a,t.focus(),Rr?function(e,n){var t=document.createRange(),a=window.getSelection();t.setStart(e.childNodes[0],n),t.collapse(!0),a.removeAllRanges(),a.addRange(t)}(t,qr):k(),Hr(!1),e&&wa.add(e)}else e?ma.add(e):ya.add(Rr),t.textContent="",Vr().focus()},Xr=()=>v("div",{id:"uls",class:function(){return"uls"+(()=>fa()===Wr()&&pa()?" ms":"").call(this)}},v("ul",null,Tt(ua,(e=>v("li",{id:e.id,tabIndex:"-1",class:()=>ua()[da()]===e?"se":"",onclick:()=>Gr(e),onMouseOver:()=>Br||da(ua().indexOf(e))},e.id?v("i",{class:function(){return"dot"+(()=>aa(e.id).online()?" on":"").call(this)}}):null," ",e.name))))),Zr=()=>v("div",{class:function(){return"em sel"+(()=>pa()?" sh":"").call(this)},onclick:()=>Vr().focus()},Tt(ya,(e=>v("div",{class:"tg ie"},e,v("i",{onclick:()=>ya.delete(e)},"✕")))),Tt(ma,(e=>v("div",{class:()=>aa(e).online()?"tg on":"tg"},aa(e).name,v("i",{onclick:()=>ma.delete(e)},"✕")))),v("div",{class:"wp"},v("div",{id:"pm",class:"e-m"+(ya().length+ma().length===0?" to":""),onkeydown:Jr,oninput:ni,contentEditable:"true"}),(()=>fa()===Vr()&&pa()&&ua().length>0&&Xr)));function Jr(e){if(!Qr(e)){if(8!=e.keyCode||Vr().textContent.length||(ma.pop(),Vr().focus()),32!==e.keyCode&&!/^[a-zA-Z0-9\_@\.]+$/.test(e.key))return e.preventDefault(),!1;"Enter"!==e.key&&"Tab"!==e.key||(Wr().focus(),e.preventDefault())}}function Qr(e){return!!ua().length&&("Enter"===e.key||"Tab"===e.key||32===e.keyCode?(Gr(ua()[da()]),e.preventDefault(),!0):27==e.keyCode?(ua([]),da(),Hr(!1),!0):(38==e.keyCode&&(0===da()?da(ua().length-1):da(da()-1),S(ua()[da()].id).focus(),e.preventDefault(),Br=!0,setTimeout((()=>Br=!1),300)),40==e.keyCode&&(da()===ua().length-1?da(0):da(da()+1),S(ua()[da()].id).focus(),e.preventDefault(),Br=!0,setTimeout((()=>Br=!1),300)),e.target.focus(),!0))}const ei=b((async e=>{if(Rr=Yr(e.target).toLowerCase(),Rr.length>50)return;let n=await dr(Rr),t=na(Gt()||Vt()),a=t&&t.md()<2;!n&&F(Rr)&&a&&ua([{id:0,name:"✉️ Invite "+Rr}])}),100);function ni(e){fa(Vr()),ei(e)}const ti=()=>{if(!Ae.id())return null;if(Pa()&&ta(Pa())&&Gt()==ta(Pa()).chanid)return null;let e=na(Gt());if(!e)return null;R()&&setTimeout(T,50);const n=()=>[...e.dir.slice(zt.len()-2),e.id];return n().length>0&&v("div",{class:"dr",style:()=>"background:"+z(e.id)},Tt(n,(e=>v("span",null,v("a",{href:"#"+It.ntob(e),innerHTML:na(e,"fullname")})))))},ai=()=>v("div",{id:"tp",class:function(){return"e-t"+(()=>ha()?" sh":"").call(this)},onkeyup:ii,onkeydown:ri,contentEditable:"true"}),ri=e=>{e.target.spellcheck=!1,"Enter"===e.key&&e.preventDefault()},ii=e=>{va(e.target.textContent),"Enter"===e.key&&(Wr().focus(),e.preventDefault())},si=()=>!(Gt()||Vt()||pa()||ha()),oi=()=>Ae.id()?si()?" ds":"":" hd",li=()=>v([v("style",null,".e-c[contenteditable]:empty::before { content: '",(()=>{let e,n=`Send a ${pa()?"private ":""}message `;return Gt()?e=na(Gt()):Vt()&&(e=na(Vt())),e?n+(ha()?`on new topic ${va()?`"${va()}" `:""}in "${e.fullname()}"`:`in "${e.fullname()}"`):ha()?n+"on new topic "+(va()?`"${va()}"`:""):n+"..."}),"'; }"),()=>fa()===Wr()&&Hr()&&ua().length>0&&Xr,v("div",{id:"mb",class:"e-c",onkeydown:ui,oninput:di,onfocus:ci,contentEditable:"true"})]),ci=()=>{if(0!==$t().length)return si()?(Gt(ta(Pa()).chanid),void ur(Gt())):Gt()||pa()||ha()?void 0:(Gt(ta(Pa()).chanid),void ur(Gt()))},ui=e=>{if(fa(Wr()),"@"===e.key&&Hr(!0),!Qr(e)&&"Enter"===e.key){if(e.preventDefault(),ga()&&!e.shiftKey)return void async function(e,n){if(!Ae.id())return Fa(1);if(e.innerHTML.length>120)return Fa(11);if(n.innerHTML.length>4e3)return Fa(11);if(!n.innerHTML.trim())return;if(Ua()){if(!aa(Ua()).online())return Fa(15);if(!Ma(Ua()).open())return Fa(16);let e={txt:n.innerHTML.trim()};return Ma(Ua()).send(e),e.by=Ae.id(),e.ts=new Date,e.room=Ua(),(Da.last()||{}).by!=Ae.id()&&(e.showby=!0),e.id=await ie("_p",e),Da.add(e),n.textContent="",void fr()}let t=Gt()||Vt(),a=Yt()||Wt()||null,r=null;if(e.textContent!==Xt()&&(r=e.textContent,!r.trim().length))return Fa(6);if(!(t||pa()||r&&r.trim().length))return Fa(5);let i=n.innerHTML.trim(),s=null,o=null,l=null;pa()&&(ma().length>0&&(s=ma.add(Ae.id()).sort(((e,n)=>e-n))),ya().length>0&&(o=ya())),wa().length>0&&(l=wa().filter((e=>i.indexOf("@"+aa(e).name)>-1))),bt.send(je.NewChat({txt:i,chanid:t,re:a,chname:r,men:l,to:s,emails:o})),ha(!1),pa(!1),e.textContent="",n.textContent="",va(""),Xt(""),Ar({},n)}($r(),Wr());e.target.textContent+="\n\n",k()}},di=e=>{Wr().spellcheck=!1,Hr()&&fi(e)},fi=b((e=>{(Rr=Yr(e.target).toLowerCase(),Rr.startsWith("@"))?(Rr=Rr.replace(/[@'";:,.\/?\\-]/,""),Rr.length>50||dr(Rr)):Hr(!1)}),100),hi=v("div",{class:"e-a"});zr.forEach((e=>{const n=jr("button");if(n.className=Fr+" eb",e.class&&(n.className+=e.class),n.innerHTML=e.icon,n.title=e.title,n.setAttribute("type","button"),n.onclick=t=>e.result(n)&&Wr().focus(),e.state){t="click",a=()=>n.classList[e.state()?"add":"remove"](Kr),n.addEventListener(t,a)}var t,a;Or(hi,n)}));const vi=jr("button");vi.className=Fr+" md",vi.innerHTML="👤",vi.title="Private message",vi.setAttribute("type","button");const pi=()=>{if(!Ae.id())return br();let e=R();vi.classList.add("se"),pa(!0),e&&setTimeout(T),fr(),"ontouchstart"in document.documentElement||Vr().focus()};vi.onclick=()=>pa()?(vi.classList.remove("se"),pa(!1),void fr()):pi();const mi=jr("button");mi.className="ntb",mi.innerHTML="✏️ New Topic",mi.title="New topic",mi.setAttribute("type","button"),mi.onclick=e=>{if(!Ae.id())return br();let n=R();ha()?ha(!1):ha(!0),n&&ha()&&setTimeout(T),function(e,n){if(ha(e),fr(),e?mi.classList.add("se"):mi.classList.remove("se"),"ontouchstart"in document.documentElement)return;e&&$r().focus();n&&($r().innerText=n,va(n))}(ha())},Or(hi,mi),Or(hi,vi),Nr("defaultParagraphSeparator","div");const yi=()=>v("div",{class:function(){return"e"+oi.call(this)}},(()=>Yt()?v("div",{class:"re",style:()=>"color:"+z(Yt())},v("i",null,"→"),v("b",null,aa(ta(Yt()).by).name)," ",v("a",{href:"#/"+It.ntob(Yt())},ta(Yt()).txt)):null),ti,ai,Zr,li,hi),wi=(e,n)=>{let t=S(e+"_").querySelector(".ct");if("true"===t.contentEditable)return t.contentEditable=!1,t.classList.remove("ce"),t.innerHTML=n.txt(),void(t.onclick=()=>!1);t.spellcheck=!1,t.contentEditable=!0,t.classList.add("ce"),t.focus(),t.onclick=e=>{"true"===t.contentEditable&&e.stopPropagation()},t.onkeydown=e=>{if("Tab"===e.key)return document.execCommand("insertHTML",!1,"&#09"),e.preventDefault();if("Escape"===e.key)return t.contentEditable=!1,t.classList.remove("ce"),void(t.innerHTML=n.txt());if("Enter"===e.key){let i=t.innerHTML.trim();e.shiftKey||(e.preventDefault(),t.contentEditable=!1,t.classList.remove("ce"),i!==n.txt()&&(a=n.id,r=i,bt.send(je.EditChat({id:a,txt:r}))))}var a,r}};var gi="a704b5c",bi="0.0.327";function ki(e){e.id;var n=e.name;return Ut(this,void 0,void 0,(function(){function e(e){e.preventDefault();var n=e.target.n,t=n.value.trim()==a?null:n.value.trim(),i=S("ab").textContent.trim(),s=function(e,n){return e&&e.length<2?10:n&&n.length>1e3?11:0}(t,i=i==(r||"")?null:i);0===s?(!function(e,n,t=null){Oa.create("saveprofile",bt.send(je.EditProfile({fullname:e,about:n,email:t})))}(t,i),La(!1)):Fa(s)}var t,a,r;return At(this,(function(i){switch(i.label){case 0:return[4,Oa.create("profile",bt.send(je.Profile))];case 1:return t=i.sent(),a=t.fullname,r=t.about,ja.content=p(Si||(Si=Dt(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Profile</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ","\n                    <input\n                        value=",'\n                        type="text"\n                        name="n"\n                        placeholder="Full name"\n                        required\n                        class=','\n                    />\n                    <div id="ab" class="ab" contenteditable="true">','</div>\n                    <div class="bn"><button type="submit">Save</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Profile</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ","\n                    <input\n                        value=",'\n                        type="text"\n                        name="n"\n                        placeholder="Full name"\n                        required\n                        class=','\n                    />\n                    <div id="ab" class="ab" contenteditable="true">','</div>\n                    <div class="bn"><button type="submit">Save</button></div>\n                </form>\n            </div>\n        </div>\n    '])),n,(function(n){return e(n)}),(function(){return Na(10,11)&&p(Ci||(Ci=Dt(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),Ia())}),a,(function(){return Na(10)&&"er"}),r),La(!0),[2]}}))}))}var Ci,Si,Ei,xi,_i,Ti,Ui,Ai,Mi,Di,Li,Pi,Oi,ji,Ii,Ni,zi,Fi,Ki,Ri,qi,Bi,Hi,$i,Vi,Wi,Yi=function(e,n){return Ut(void 0,void 0,void 0,(function(){function a(e){var t=e.target.textContent;if(t&&t.length>50)return Fa(11);var a=t&&t.trim().length?t:null,r=q(),i=aa(n).otz!=r?r:null;aa(n).tz(r),aa(n).st(a),function(e){bt.send(je.EditStatus(e))}({st:a,tz:i})}var r,i,s;return At(this,(function(o){switch(o.label){case 0:return Ae.id()?(e.stopPropagation(),aa(n).st?[3,2]:[4,Er(n)]):[2];case 1:r=o.sent(),i=r.st,s=r.tz,Ae.id()==n&&(aa(n).otz=s,s=q()),aa(n).st=t(i),aa(n).tz=t(s),o.label=2;case 2:return ja.content=p(Li||(Li=Dt(['\n        <div class="pi">\n            <div class="ui">\n                <div class="un">\n                    <i class="dot','"></i>\n                    <b style=',"\n                        >","</b\n                    >\n                </div>\n                ","\n            </div>\n            <hr />\n            ","\n            ","\n        </div>\n    "],['\n        <div class="pi">\n            <div class="ui">\n                <div class="un">\n                    <i class="dot','"></i>\n                    <b style=',"\n                        >","</b\n                    >\n                </div>\n                ","\n            </div>\n            <hr />\n            ","\n            ","\n        </div>\n    "])),(function(){return aa(n).online()?" on":""}),(function(){return aa(n).online()?"color:"+z(aa(n).name):""}),aa(n).name,n!==Ae.id()?p(_i||(_i=Dt(['<div style="font-size:12px">',"</div>"],['<div style="font-size:12px">',"</div>"])),aa(n).st):p(Ti||(Ti=Dt(['<div class="st" contenteditable="true" onblur=',">","</div>"],['<div class="st" contenteditable="true" onblur=',">","</div>"])),a,aa(n).st),(function(){return aa(n).tz()&&p(Ui||(Ui=Dt(['<div class="sub"><i>🕑</i> Local time ',"</div>"],['<div class="sub"><i>🕑</i> Local time ',"</div>"])),function(e){return(new Date).toLocaleTimeString(Intl.DateTimeFormat().resolvedOptions().locale,{timeZone:e,hour:"numeric",minute:"2-digit"})}(aa(n).tz()))}),n!==Ae.id()?p(Mi||(Mi=Dt(['\n                      <div class="bt"><i class="fl">💬</i> <a onclick=','>Send private message</a></div>\n                      <div class="bt">\n                          <i>@</i> <a onclick=',">Mention <b>","</b></a>\n                      </div>\n                      ","\n                  "],['\n                      <div class="bt"><i class="fl">💬</i> <a onclick=','>Send private message</a></div>\n                      <div class="bt">\n                          <i>@</i> <a onclick=',">Mention <b>","</b></a>\n                      </div>\n                      ","\n                  "])),(function(){return function(e){La(!1),pi(),ma([e]),Yt(0)}(n)}),(function(){return function(e){if(La(!1),!Ae.id())return br();Wr().innerHTML+="@"+aa(e).name,Wr().focus(),k(Wr()),wa.add(e)}(n)}),aa(n).name,aa(n).online()&&p(Ai||(Ai=Dt(['<div class="bt">\n                          <i class="fl">↔</i>\n                          <a\n                              onclick=',"\n                              >Send direct p2p message</a\n                          >\n                      </div>"],['<div class="bt">\n                          <i class="fl">↔</i>\n                          <a\n                              onclick=',"\n                              >Send direct p2p message</a\n                          >\n                      </div>"])),(function(){La(!1),location.hash="#&"+It.ntob(n)}))):p(Di||(Di=Dt(['\n                      <div class="bt" onclick=','><i>✏️</i> <a>Edit profile</a></div>\n                      <div class="bt" onclick=','><i>🔒</i> <a>Change password</a></div>\n                      <div class="bt" onclick=','><i>🚪</i> <a>Sign out</a></div>\n                      <div class="v">'," ","</div>\n                  "],['\n                      <div class="bt" onclick=','><i>✏️</i> <a>Edit profile</a></div>\n                      <div class="bt" onclick=','><i>🔒</i> <a>Change password</a></div>\n                      <div class="bt" onclick=','><i>🚪</i> <a>Sign out</a></div>\n                      <div class="v">'," ","</div>\n                  "])),(function(){return ki(aa(n))}),(function(){return function(e){var n=e.name;ja.content=p(xi||(xi=Dt(['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Change Password</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input\n                        type="password"\n                        name="o"\n                        placeholder="Old password"\n                        required\n                        autocomplete="true"\n                        class=','\n                    />\n                    <input\n                        type="password"\n                        name="p"\n                        placeholder="New password"\n                        required\n                        autocomplete="true"\n                        class=','\n                    />\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '],['\n        <div class="pi">\n            <div class="su">\n                <div class="head">Change Password</div>\n                <div class="sub">',"</div>\n                <form onsubmit=",">\n                    ",'\n                    <input\n                        type="password"\n                        name="o"\n                        placeholder="Old password"\n                        required\n                        autocomplete="true"\n                        class=','\n                    />\n                    <input\n                        type="password"\n                        name="p"\n                        placeholder="New password"\n                        required\n                        autocomplete="true"\n                        class=','\n                    />\n                    <div class="bn"><button type="submit">Submit</button></div>\n                </form>\n            </div>\n        </div>\n    '])),n,(function(e){return Ut(this,void 0,void 0,(function(){var t,a,r,i,s;return At(this,(function(o){switch(o.label){case 0:return e.preventDefault(),t=e.target,a=t.o,wr(V,(r=t.p).value,a.value)?[4,pr(n)]:[3,3];case 1:return i=o.sent(),[4,yr(n,i,r.value,a.value)];case 2:if(s=o.sent())return[2,Fa(s)];Ka("password updated"),La(!1),o.label=3;case 3:return[2]}}))}))}),(function(){return Na(12,13,14)&&p(Ei||(Ei=Dt(['<div class="erm">',"</div>"],['<div class="erm">',"</div>"])),Ia())}),(function(){return Na(13)&&"er"}),(function(){return Na(12,14)&&"er"})),La(!0)}(aa(n))}),(function(){return async function(){Gt(0),sa([]),aa(Ae.id()).online(!1),na().clear(),ta().clear(),await bt.send(je.Logout(Ae.salt)),await te(),Te({d:!1}),La(!1),xe("logout")}()}),bi,gi)),La(!0),[2]}}))}))},Gi=function(e,n){if(e.shiftKey)return function(e,n){var t=screen.width/2-300,a=screen.height/2-300;window.open(e,n,"toolbar=yes,location=yes,status=no,menubar=yes,scrollbars=yes,resizable=yes,width=600,height=600,top="+a+",left="+t)}("#"+It.ntob(n),n),e.preventDefault();Cr(n),e.stopPropagation()},Xi=function(){var e=t(0),n=t(0),a=!1,r=function(t){var r=t.id,s=t.txt,o=t.by,l=t.chanid,c=t.star,u=t.men,d=t.timestamp,f=t.showby,h=t.first,v=t.firstre,m=t.last,y=t.lastre,w=t.re,g=t.nor,b=It.ntob(r);function k(){return["ct"].join(" ")}return p(Fi||(Fi=Dt(["\n            <div\n                id=",'\n                class="c','"\n                onclick=',"\n                ontouchend=","\n                onmouseover=","\n                style=","\n            >\n                ","\n                ","\n                <div class="," style=",">\n                    ","\n                    ","\n                </div>\n                ","\n            </div>\n        "],["\n            <div\n                id=",'\n                class="c','"\n                onclick=',"\n                ontouchend=","\n                onmouseover=","\n                style=","\n            >\n                ","\n                ","\n                <div class="," style=",">\n                    ","\n                    ","\n                </div>\n                ","\n            </div>\n        "])),b+"_",(function(){return(Yt()===r||n()==r?" cur":"")+(Gt()>0&&Gt()!==l?" bl":"")+(((new Date).getTime()-d.getTime())/1e3<60?" nc":"")+(w||g()?" r":"")+(h()||v()&&w!=Wt()?" fr":"")+(m()||y()&&w!=Wt()?" lr":"")}),(function(e){return function(e,n){"ontouchstart"in document.documentElement||Cr(n.chanid)}(0,t)}),(function(e){return function(e,n){a||Cr(n.chanid)}(0,t)}),(function(n){return e()!==r&&e(r)}),(function(){return"border-color:"+z(w||(g()?r:l))}),(function(){return v()&&w!=Wt()&&ta(w)?p(Ii||(Ii=Dt(['\n                              <div\n                                  class="re"\n                                  style=',"\n                                  onmouseover=","\n                                  onmouseout=","\n                              >\n                                  <i>→</i><b>",'</b>\n                                  <a href="#/','" onclick=',"\n                                      >","</a\n                                  >\n                              </div>\n                          "],['\n                              <div\n                                  class="re"\n                                  style=',"\n                                  onmouseover=","\n                                  onmouseout=","\n                              >\n                                  <i>→</i><b>",'</b>\n                                  <a href="#/','" onclick=',"\n                                      >","</a\n                                  >\n                              </div>\n                          "])),(function(){return w||g()?"color:"+z(w||r):""}),(function(e){return n()!==w&&n(w)}),(function(e){return n(0)}),aa(ta(w,"by"),"name"),It.ntob(w),(function(e){return e.stopPropagation()}),ta(w,"txt")):null}),(function(){return f()||h()||v()?p(Ni||(Ni=Dt(['<div>\n                              <a\n                                  class="by','"\n                                  style=',"\n                                  onclick=","\n                                  >","</a\n                              >\n                          </div>"],['<div>\n                              <a\n                                  class="by','"\n                                  style=',"\n                                  onclick=","\n                                  >","</a\n                              >\n                          </div>"])),(function(){return aa(o).online()?" on":""}),(function(){return aa(o).online()?"color:"+z(aa(o).name):""}),(function(e){return Yi(e,o)}),aa(o).name):null}),(function(){return c()?" star":""}),(function(){return g()?"color:"+z(r):""}),(function(){var e=s();if(u&&u.length)for(var n=0,t=u;n<t.length;n++){var a=t[n],r=aa(a).name,i=Ae.id()==a?"j":aa(a).online()?"k":"i",o=aa(a).online()?'style="color:'+z(r)+'"':"";e=e.replaceAll("@"+r,'<b onclick="b('+a+')" class="'+i+'" '+o+">@"+r+"</b>")}return p(ji||(ji=Dt(["<div class="," innerHTML="," />"],["<div class="," innerHTML="," />"])),k,e)}),(function(){return g()&&r!=Wt()?p(zi||(zi=Dt(['<p class="mr">\n                                  <i>→</i\n                                  ><a href="#/','" onclick=',"\n                                      >","</a\n                                  >\n                              </p>"],['<p class="mr">\n                                  <i>→</i\n                                  ><a href="#/','" onclick=',"\n                                      >","</a\n                                  >\n                              </p>"])),b,(function(e){return e.stopPropagation()}),g()+(g()>1?" replies":" reply")):null}),(function(){return e()===r&&Ae.id()?i(b,t):null}))},i=function(e,n){var t,a,r,i=function(e){e.preventDefault(),e.stopPropagation();var t=R();Ar(n,Wr()),Yt()===n.id?Gt(n.chanid):Gt(0),t&&setTimeout(T)};return p(Ki||(Ki=Dt(['\n            <div class="ts">','</div>\n            <div class="pm pr" title="reply" ontouchend='," onclick=",'>\n                <i>→</i>\n                <div class="pu">\n                    <div>reply</div>\n                </div>\n            </div>\n            <div class="pm" onclick=','>\n                <i class="i">...</i>\n                <div class="pu">\n                    <div onclick=',">⭐ ","</div>\n                    <div onclick=",">✏️ edit</div>\n                    <div onclick=",">🗑️ trash</div>\n                </div>\n            </div>\n        "],['\n            <div class="ts">','</div>\n            <div class="pm pr" title="reply" ontouchend='," onclick=",'>\n                <i>→</i>\n                <div class="pu">\n                    <div>reply</div>\n                </div>\n            </div>\n            <div class="pm" onclick=','>\n                <i class="i">...</i>\n                <div class="pu">\n                    <div onclick=',">⭐ ","</div>\n                    <div onclick=",">✏️ edit</div>\n                    <div onclick=",">🗑️ trash</div>\n                </div>\n            </div>\n        "])),(t=n.timestamp,a=6e4,(r=new Date-t)<a?Math.round(r/1e3)+"s":r<36e5?Math.round(r/a)+"m":t.toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale,{hour:"numeric",minute:"2-digit"})),i,i,(function(e){return e.stopPropagation()}),(function(e){return(async e=>{e.star(!e.star()),bt.send(je.Star(e.id));const n=await pe(e.id,"_t");n&&(n.star=e.star(),await ie("_t",n))})(n)}),n.star()?"unstar":"star",(function(t){return wi(e,n)}),(function(e){return s(n)}))},s=function(e){var n=e.id,t=e.txt;confirm('Do you want to delete this chat? \n"'+t()+'"')&&function(e){bt.send(je.DelChat(e)),cr(e)}(n)},o=document.createElement("div");return setTimeout((function(){new IntersectionObserver((function(e){e[0].intersectionRatio<=0||ir.cb&&(!$t()[0]||Qt()||$t().length<Rt||setTimeout((function(){if(ir.cb){var e=$t()[0];!e||Qt()||$t().length<Rt||ir.cb(e)}})))}),{}).observe(o)})),setTimeout((function(){S("cs").addEventListener("touchstart",(function(e){return a=!1}),{passive:!0}),S("cs").addEventListener("touchmove",(function(e){return a=!0}),{passive:!0})})),p(Wi||(Wi=Dt(['\n        <div id="os"></div>\n        <div id="cs">\n            ',"\n            ","\n            ","\n        </div>\n        ","\n    "],['\n        <div id="os"></div>\n        <div id="cs">\n            ',"\n            ","\n            ","\n        </div>\n        ","\n    "])),o,(function(){var e=[],n=0,a=null;return $t().reduce((function(e,r){return W(ta(r).timestamp,a)?ta(r).chanid!=n?(n=ta(r).chanid,e.push(t([r])),e):(e[e.length-1]().push(r),e):(a=ta(r).timestamp,e.push(t(a)),n=ta(r).chanid,e.push(t([r])),e)}),e),Tt(t(e),(function(e){var n=e();if(n instanceof Array){var t=ta(e()[0]);return p(Ri||(Ri=Dt(['\n                            <div>\n                                <div class="tn">\n                                    ','\n                                    <div class="ts">',"</div>\n                                </div>\n                                ","\n                            </div>\n                        "],['\n                            <div>\n                                <div class="tn">\n                                    ','\n                                    <div class="ts">',"</div>\n                                </div>\n                                ","\n                            </div>\n                        "])),(function(){return function(e){var n=na(e);if(!n)return null;var t=function(){return Mt(Mt([],n.dir.slice(zt.len()-2)),[n.id])};return t().length>0&&p(Oi||(Oi=Dt(['<div class="dr" style=',">\n            ","\n        </div>"],['<div class="dr" style=',">\n            ","\n        </div>"])),(function(){return"background:"+z(e)}),Tt(t,(function(e){return p(Pi||(Pi=Dt(['<span\n                    ><a\n                        href="#','"\n                        onclick=',"\n                        innerHTML=","\n                /></span>"],['<span\n                    ><a\n                        href="#','"\n                        onclick=',"\n                        innerHTML=","\n                /></span>"])),It.ntob(e),(function(n){return Gi(n,e)}),na(e,"fullname"))})))}(t.chanid)}),t.timestamp.toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale,{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}),Tt(e,(function(e){return ta(e)&&r(ta(e))})))}return p(qi||(qi=Dt(['<div class="date">',"</div>"],['<div class="date">',"</div>"])),function(e){let n=new Date;return W(e,n)?"Today":(n.setDate(n.getDate()-1),W(e,n)?"Yesterday":e.toLocaleString(Intl.DateTimeFormat().resolvedOptions().locale,{month:"short",day:"numeric"}))}(n))}))}),(function(){return aa(Ua())?p(Vi||(Vi=Dt(['<div>\n                          <div class="tn">\n                              <div class="dr" style=',">\n                                  <span><a>↔ ","</a></span>\n                              </div>\n                          </div>\n                          ","\n                      </div>"],['<div>\n                          <div class="tn">\n                              <div class="dr" style=',">\n                                  <span><a>↔ ","</a></span>\n                              </div>\n                          </div>\n                          ","\n                      </div>"])),(function(){return"background:"+z(aa(Ua()).name)}),aa(Ua()).name,Tt(Da,(function(e){var n=e.by,t=e.txt,a=e.showby;return aa(n)?p(Hi||(Hi=Dt(['\n                                        <div class="c" style=',">\n                                            ","\n                                            <div>","</div>\n                                        </div>\n                                    "],['\n                                        <div class="c" style=',">\n                                            ","\n                                            <div>","</div>\n                                        </div>\n                                    "])),(function(){return"border-color:"+z(aa(Ua()).name)}),(function(){return a?p(Bi||(Bi=Dt(['<div>\n                                                          <a\n                                                              class="by','"\n                                                              style=',"\n                                                              onclick=","\n                                                              >","</a\n                                                          >\n                                                      </div>"],['<div>\n                                                          <a\n                                                              class="by','"\n                                                              style=',"\n                                                              onclick=","\n                                                              >","</a\n                                                          >\n                                                      </div>"])),(function(){return aa(n).online()?" on":""}),(function(){return aa(n).online()?"color:"+z(aa(n,"name")):""}),(function(e){return Yi(e,n)}),aa(n,"name")):null}),t):p($i||($i=Dt(["<div />"],["<div />"])))}))):null}),yi)};const Zi=[["","All messages"],["!","Private messages"],["@","Mentions"],["*","Stars"]],Ji=()=>{const e=document.createElement("div");e.contentEditable=!0,e.className="s-c",e.oninput=b((n=>{let t=e.textContent;t.length>50||(Ja(t),Qa(t))}),200),e.onkeydown=e=>{"Enter"!==e.key||e.shiftKey||e.preventDefault()};const n=e=>v("ul",null,Tt(e.childids,(t=>{let a=e.childs(t);return v([v("li",{class:()=>function(e){return[Ae.chans().includes(e)?"":"on",e==Vt()?"se":""].join(" ")}(t),onclick:()=>function(e,n){e.open(!e.open()),er(n)}(a,na(t))},v("div",{class:"sb"},v("i",null,(()=>a.childids().length?a.open()?"▼":"▶":""))),v("div",{class:"lb"},(()=>function(e){return na(e,"md")&&na(e,"md")()>1?"🔒":""}(t))," ",na(t,"fullname")),v("div",{class:"dot",onclick:e=>((e,n)=>{if(e.stopPropagation(),!Ae.id())return br();Ae.chans().includes(n)?tr(n):nr(n)})(e,t)})),()=>a.open()&&a.childids().length?n(a):null])})));return v([v("div",{class:"dn n"},v("i",{onclick:()=>xe("lnclose")},"✕")),v("div",{class:"s"},e),Ae.id()?v("ul",{class:"hm"},(()=>Zi.map((e=>v("li",{class:(Ta()[0]||"")==e[0]&&"se",onclick:()=>location.hash=e[0]},e[1]))))):null,Tt(Aa,(e=>v("div",null,v("div",{class:"tn"},v("div",{class:"dr",style:()=>"background:"+z(aa(e,"name"))},v("span",null,v("a",{href:"#&"+It.ntob(e)},"↔ ",aa(e,"name")))))))),v("div",{class:"nt"},(()=>ra.childids().length?n(ra):null))])};let Qi="",es=0,ns=!1;const ts=()=>{const e=b((async e=>{if(Qi=(e=>{es=C();let n=e.textContent,t=n.indexOf(" ",es);-1==t&&(t=n.length);var a=/[\S]+$/.exec(n.slice(0,t));return a?a[0]:""})(e.target).toLowerCase(),Qi&&Qi.length>50)return;!await async function(e){let n=await Oa.create("findusers",bt.send(je.FindUsers(e)));ca(n);let t=n.find((n=>n.name===e));if(t)da(n.indexOf(t));else{let t=n.find((n=>n.name.startsWith(e)));da(t?n.indexOf(t):0)}return n.length}(Qi)&&F(Qi)&&ca([{id:0,name:"✉️ Invite "+Qi}])}),100),n=v("div",{class:"am",contentEditable:"true",onkeydown:function(e){if(fa(n),a(e))return;8!=e.keyCode||n.textContent.length||(oa.pop(),n.focus());if(32!==e.keyCode&&!/^[a-zA-Z0-9\_@\.]+$/.test(e.key))return void e.preventDefault();"Enter"!==e.key&&"Tab"!==e.key||e.preventDefault()},oninput:e});function t({id:e,name:t}){ca([]),da(0),e?oa.add(e):la.add(Qi),n.textContent="",n.spellcheck=!1,n.focus()}function a(e){return!!ca().length&&("Enter"===e.key||"Tab"===e.key||32===e.keyCode?(t(ca()[da()]),e.preventDefault(),!0):27==e.keyCode?(ca([]),da(),!0):(38==e.keyCode&&(0===da()?da(ca().length-1):da(da()-1),S(ca()[da()].id).focus(),e.preventDefault(),ns=!0,setTimeout((()=>ns=!1),300)),40==e.keyCode&&(da()===ca().length-1?da(0):da(da()+1),S(ca()[da()].id).focus(),e.preventDefault(),ns=!0,setTimeout((()=>ns=!1),300)),e.target.focus(),!0))}const r=()=>v("div",{class:"uls adm"},v("ul",null,Tt(ca,(e=>v("li",{id:e.id,tabIndex:"-1",class:()=>ca()[da()]===e?"se":"",onclick:()=>t(e),onMouseOver:()=>function(e){ns||da(e)}(ca().indexOf(e))},e.id?v("i",{class:function(){return"dot"+(()=>aa(e.id).online()?" on":"").call(this)}}):null," ",e.name))))),i=v("div",{class:"sel",onclick:()=>n.focus()},Tt(la,(e=>v("div",{class:"tg ie"},e,v("i",{onclick:()=>la.delete(e)},"✕")))),Tt(oa,(e=>v("div",{class:()=>aa(e).online()?"tg on":"tg"},aa(e).name,v("i",{onclick:()=>oa.delete(e)},"✕")))),n,(()=>fa()===n&&ca().length>0&&r));return i.focus=()=>n.focus(),i},as=()=>{const e=["Public","Internal"],n=()=>Gt()?na(Gt()):Vt()?na(Vt()):null;const t=(e,n)=>{e.stopPropagation(),window.confirm("Do you want to delete this channel?\n"+n.fullname())&&(async e=>{bt.send(je.DelChan(e))})(n.id)},a=()=>n().by===Ae.id(),r=async(e,n)=>{let t=oa().length?oa():null,a=la().length?la():null;(t||a)&&(await(async(e,n,t)=>{let a=await Oa.create("addmems",bt.send(je.AddMems({chanid:e,userids:n,emails:t})));return ur(e),a})(e,t,a)?(Ka(`added${i()} to ${n()}`),La(!1)):Fa(8))};function i(){let e=oa().length+la().length;return e>0?" "+e+(e>1?" people":" person"):""}function s(e,{id:n,fullname:t,about:a,md:r}){e.preventDefault();let{n:i,m:s}=e.target,o=i.value.trim()==t()?null:i.value.trim(),l=s&&s.value.trim()!=r()?s.value.trim():null,c=S("ab").textContent.trim();c=c==(a()||"")?null:c;let u=function(e,n,t){return e&&0===e.length?10:t&&(t>2||t<0)||n&&n.length>1e3?11:0}(o,c,l);0===u?(!function(e,n,t,a){Oa.create("editchan",bt.send(je.EditChan({id:e,name:n,about:t,md:a})))}(n,o,c,l),La(!1)):Fa(u)}return v([v("div",{class:"dn"},v("i",{onclick:()=>xe("rnclose")},"✕")),v("div",{class:"ub"},(()=>n()&&a()&&v("div",{title:"edit",onclick:()=>{return t=n(),ja.content=v("div",{class:"pi"},v("div",{class:"su et"},v("div",{class:"head"},"About"),v("div",{class:"sub"},t.fullname),v("form",{onsubmit:e=>s(e,t)},(()=>Na(10,11)&&v("div",{class:"erm"},errmsg())),v("input",{value:t.fullname,type:"text",name:"n",placeholder:"topic name",required:!0,class:()=>Na(10)&&"er"}),v("div",{id:"ab",class:"ab",contentEditable:"true"},t.about),1==Ae.id()&&t.md()<2?v("select",{name:"m"},e.map(((e,n)=>v("option",{selected:()=>t.md()==n,value:n},e)))):null,v("div",{class:"bn"},v("button",{type:"submit"},"Save"))))),void La(!0);var t},class:"ed"},"✎")),v("div",{class:"head"},"About"),v("div",{class:"sub b"},(function(){return n()?n().fullname:""})),v("div",{class:"sub"},(function(){return n()?n().about:""}))),v("div",{class:"ub"},v("div",{class:"he"},"Settings"),v("div",{class:"sub"},(function(){return n()?[...e,"Private"][n().md()]:""}))),v("div",{class:"ft"},v("div",{class:"ub lf"},v("div",{class:"he"},"Members")),(()=>Ae.id()>0&&v("div",{class:"rt"},(()=>n()&&v("button",{title:"add members",onclick:()=>(({id:e,fullname:n})=>{const t=ts();ja.content=v("div",{class:"pi"},v("div",{class:"amb"},v("div",{class:"head"},"Add people"),v("div",{class:"sub"},n),t,v("div",{class:"bn"},v("button",{onclick:()=>r(e,n)},"Add",i)))),La(!0),t.focus()})(n())},"👤"))))),v("div",{class:"uls mem"},v("ul",null,Tt(sa,(e=>v("li",{id:e,tabIndex:"-1",style:()=>aa(e).online()?"color:"+z(aa(e).name):"",onclick:n=>Yi(n,e)},e?v("i",{class:function(){return"dot"+(()=>aa(e).online()?" on":"").call(this)}}):null," ",aa(e).name))))),()=>n()&&a()&&v("div",{class:"ft dt"},v("div",{class:"ub lf"},v("div",{class:"he"},"Delete")),v("div",{class:"rt"},v("button",{title:"delete topic",onclick:e=>t(e,n())},"🗑️")))])},rs=()=>ka()?localStorage.getItem("w")||185:0,is=()=>Ca()?localStorage.getItem("e")||185:0;function ss(){const e="0"!==localStorage.getItem("l")&&window.innerWidth>650;ka(e);const n=1==localStorage.getItem("r")&&window.innerWidth>650;Ca(n),Sa(rs()),Ea(is())}function os(){ka(!ka()),Sa(rs()),localStorage.setItem("l",ka()?1:0)}function ls(){Ca(!Ca()),Ea(is()),localStorage.setItem("r",Ca()?1:0)}ss(),setTimeout(ss,100);const cs=()=>null,us=t(cs);function ds(){return v("div",{onmousedown:function(e){document.onmousemove=e=>{Sa(e.clientX+2)},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null,localStorage.setItem("w",Sa())}},class:"dw"})}function fs(){return v("div",{onmousedown:function(e){document.onmousemove=e=>{Ea(document.documentElement.offsetWidth-e.clientX+2)},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null,localStorage.setItem("e",Ea())}},class:"de"})}document.querySelector("body").append((()=>{Ee("nochan",(()=>us(cs))),Ee("rnclose",ls),Ee("lnclose",os);function e(){return ka()&&window.innerWidth>650?Sa():0}function n(){return Ca()&&window.innerWidth>650?Ea():0}return v([v("div",{class:"ma",style:function(){return"left:"+e.call(this)+"px;right:"+n.call(this)+"px"}},v("div",{class:"n"},v("div",null,v("ol",{class:"bc"},(()=>Tt(zt.paths,(e=>v("li",null,v("a",{onclick:n=>(e=>{e[0]===zt.len()-1?us()===Lr?us(cs):us(Lr):zt.cd(e)})(e)},e[2])))))),(()=>Ae.id()?v([v("div",{onclick:os,class:"av mv"},v("i",null,"☰")),v("div",{onclick:ls,class:"av iv"},v("i",null,"ⓘ")),v("div",{onclick:e=>Yi(e,Ae.id()),class:"av"},v("i",null,"👨🏻‍💻"))]):v([v("div",{class:"u"},v("a",{onclick:gr},"sign up")),v("div",{class:"m"},v("a",{onclick:br},"log in"))]))),us),Xi),()=>ka()&&v("div",{class:"ln",style:function(){return"width:"+("function"==typeof Sa?Sa.call(this):Sa)+"px"}},Ji,ds),()=>Ca()&&v("div",{class:"rn",style:function(){return"width:"+("function"==typeof Ea?Ea.call(this):Ea)+"px"}},as,fs),()=>xa()>0&&v("div",{class:"err"},Ia()),()=>_a()&&v("div",{class:"inf"},_a()),()=>La()&&v("div",{id:"mod",class:"mod",onclick:()=>La(!1)},v("div",{class:"pop",onclick:e=>e.stopPropagation()},ja.content))])})())}();
