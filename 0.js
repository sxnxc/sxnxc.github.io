!function(){"use strict";var e,t,n,r,o;!function(e){e.None=function(e){return{tag:"None",value:e}},e.Id=function(e){return{tag:"Id",value:e}},e.TopicId=function(e){return{tag:"TopicId",value:e}},e.ChannelId=function(e){return{tag:"ChannelId",value:e}},e.GroupId=function(e){return{tag:"GroupId",value:e}},e.By=function(e){return{tag:"By",value:e}}}(e||(e={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Email=function(e){return{tag:"Email",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(t||(t={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(n||(n={})),function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Handle=function(e){return{tag:"Handle",value:e}}}(r||(r={})),function(e){e.Id=function(e){return{tag:"Id",value:e}}}(o||(o={}));var a,i;!function(e){e.User=function(e){return{tag:"User",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Group=function(e){return{tag:"Group",value:e}},e.Groups=function(e){return{tag:"Groups",value:e}},e.Channel=function(e){return{tag:"Channel",value:e}},e.Channels=function(e){return{tag:"Channels",value:e}},e.Topic=function(e){return{tag:"Topic",value:e}},e.Topics=function(e){return{tag:"Topics",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.NewChat=function(e){return{tag:"NewChat",value:e}}}(a||(a={})),function(e){e.User=function(e){return{tag:"User",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Group=function(e){return{tag:"Group",value:e}},e.Groups=function(e){return{tag:"Groups",value:e}},e.Channel=function(e){return{tag:"Channel",value:e}},e.Channels=function(e){return{tag:"Channels",value:e}},e.Topic=function(e){return{tag:"Topic",value:e}},e.Topics=function(e){return{tag:"Topics",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.Chat=function(e){return{tag:"Chat",value:e}}}(i||(i={}));const l=(e,t=0,n=!0)=>({pos:t,littleEndian:n,view:new DataView(e)}),c=(e,t)=>{const{view:{buffer:n},pos:r}=e,o=n.byteLength;if(o-r>t)return e;const a=Math.max(2*o,o+t),i=new Uint8Array(a);return i.set(new Uint8Array(n)),l(i.buffer,r,e.littleEndian)},s=(e,t)=>{e=c(e,1);const{view:n,pos:r}=e;return n.setUint8(r,t),e.pos+=1,e},u=(e,t)=>{e=c(e,4);const{view:n,pos:r,littleEndian:o}=e;return n.setUint32(r,t,o),e.pos+=4,e},d=(e,t)=>{e=c(e,2);const{view:n,pos:r,littleEndian:o}=e;return n.setUint16(r,t,o),e.pos+=2,e};function p(e,t){const{view:n,pos:r,littleEndian:o}=e;return n.setUint32(o?r:r+4,t,o),n.setUint32(o?r+4:r,0,o),e.pos+=8,e}const f=(e,t)=>{e=c(e,4);const{view:n,pos:r,littleEndian:o}=e;return n.setInt32(r,t,o),e.pos+=4,e},h=new TextEncoder,g="encodeInto"in h?(e,t)=>h.encodeInto(e,t).written:(e,t)=>{const n=h.encode(e);return t.set(n),n.length},y=(e,t)=>{e=c(e,3*t.length+8);const n=g(t,new Uint8Array(e.view.buffer,e.pos+8));return(e=p(e,n)).pos+=n,e},m=(e,t)=>s(e,t?1:0),v=e=>(t,n)=>n.reduce(e,((e,t)=>p(c(e,8),t))(t,n.length)),w=e=>(t,n)=>null===n?s(t,0):e(s(t,1),n),b=e=>{const{pos:t,view:n}=e;return e.pos+=1,n.getUint8(t)},I=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getUint32(t,r)},C=e=>{const{view:t,pos:n,littleEndian:r}=e;return e.pos+=8,t.getUint32(r?n:n+4,r)},A=e=>{const{pos:t,view:n,littleEndian:r}=e;return e.pos+=4,n.getInt32(t,r)},k=e=>1===b(e),E=e=>t=>1===b(t)?e(t):null,T=e=>t=>{const n=C(t),r=new Array;for(let o=0;o<n;o++)r.push(e(t));return r},x=new TextDecoder,U=e=>{const t=C(e),{pos:n,view:{buffer:r}}=e,o=x.decode(new Uint8Array(r,n,t));return e.pos+=t,o};var S=w(y),_=w(m),$=y,N=w($),L=function(e,t){var n=t.id,r=t.txt,o=t.by,a=t.re,i=t.nor,l=t.topicId,c=t.channelId,s=t.groupId,u=t.createdAt,d=t.updatedAt;return $($(f(f(f(f(f(f(y(f(e,n),r),o),a),i),l),c),s),u),d)},H=(v(L),v((function(e,t){var n=t.k,r=t.v;return y(f(e,n),r)})),function(e,t){var n=t.id,r=t.handle,o=t.email,a=t.emailVerified,i=t.name,l=t.picture,c=t.gender,s=t.lastLogin,u=t.createdAt,d=t.updatedAt;return $($(N(_(S(y(m(y(y(f(e,n),r),o),a),i),l),c),s),u),d)}),M=(v(H),function(e,t){var n=t.id,r=t.name,o=t.handle,a=t.by,i=t.createdAt,l=t.updatedAt;return $($(f(y(y(f(e,n),r),o),a),i),l)}),O=(v(M),function(e,t){var n=t.id,r=t.name,o=t.handle,a=t.groupId,i=t.by,l=t.createdAt,c=t.updatedAt;return $($(f(f(y(y(f(e,n),r),o),a),i),l),c)}),D=(v(O),function(e,t){var n=t.id,r=t.name,o=t.groupId,a=t.channelId,i=t.by,l=t.createdAt,c=t.updatedAt;return $($(f(f(f(y(f(e,n),r),o),a),i),l),c)}),G=(v(D),function(e,t){var n=t.filter,r=t.limit,o=t.page;return d(d(function(e,t){switch(t.tag){case"None":return m(u(e,0),t.value);case"Id":return f(u(e,1),t.value);case"TopicId":return f(u(e,2),t.value);case"ChannelId":return f(u(e,3),t.value);case"GroupId":return f(u(e,4),t.value);case"By":return f(u(e,5),t.value)}}(e,n),r),o)}),P=function(e,t){switch(t.tag){case"User":return function(e,t){switch(t.tag){case"Id":return f(u(e,0),t.value);case"Email":return y(u(e,1),t.value);case"Handle":return y(u(e,2),t.value)}}(u(e,0),t.value);case"Users":return function(e,t){var n=t.name,r=t.email,o=t.handle,a=t.limit,i=t.page;return d(d(y(y(y(e,n),r),o),a),i)}(u(e,1),t.value);case"Group":return function(e,t){switch(t.tag){case"Id":return f(u(e,0),t.value);case"Handle":return y(u(e,1),t.value)}}(u(e,2),t.value);case"Groups":return function(e,t){var n=t.name,r=t.handle,o=t.by,a=t.limit,i=t.page;return d(d(f(y(y(e,n),r),o),a),i)}(u(e,3),t.value);case"Channel":return function(e,t){switch(t.tag){case"Id":return f(u(e,0),t.value);case"Handle":return y(u(e,1),t.value)}}(u(e,4),t.value);case"Channels":return function(e,t){var n=t.name,r=t.handle,o=t.group_id,a=t.by,i=t.limit,l=t.page;return d(d(f(f(y(y(e,n),r),o),a),i),l)}(u(e,5),t.value);case"Topic":return function(e,t){switch(t.tag){case"Id":return f(u(e,0),t.value)}}(u(e,6),t.value);case"Topics":return function(e,t){var n=t.name,r=t.group_id,o=t.channel_id,a=t.by,i=t.limit,l=t.page;return d(d(f(f(f(y(e,n),r),o),a),i),l)}(u(e,7),t.value);case"Chats":return G(u(e,8),t.value);case"NewChat":return L(u(e,9),t.value)}},R=E(U),j=E(k),B=U,K=E(B),q=function(e){return{id:A(e),txt:U(e),by:A(e),re:A(e),nor:A(e),topicId:A(e),channelId:A(e),groupId:A(e),createdAt:B(e),updatedAt:B(e)}},z=T(q),F=T((function(e){return{k:A(e),v:U(e)}})),V=function(e){return{id:A(e),handle:U(e),email:U(e),emailVerified:k(e),name:U(e),picture:R(e),gender:j(e),lastLogin:K(e),createdAt:B(e),updatedAt:B(e)}},W=T(V),Y=function(e){return{id:A(e),name:U(e),handle:U(e),by:A(e),createdAt:B(e),updatedAt:B(e)}},J=T(Y),Z=function(e){return{id:A(e),name:U(e),handle:U(e),groupId:A(e),by:A(e),createdAt:B(e),updatedAt:B(e)}},Q=T(Z),X=function(e){return{id:A(e),name:U(e),groupId:A(e),channelId:A(e),by:A(e),createdAt:B(e),updatedAt:B(e)}},ee=T(X),te=function(e){switch(I(e)){case 0:return i.User(V(e));case 1:return i.Users(W(e));case 2:return i.Group(Y(e));case 3:return i.Groups(J(e));case 4:return i.Channel(Z(e));case 5:return i.Channels(Q(e));case 6:return i.Topic(X(e));case 7:return i.Topics(ee(e));case 8:return i.Chats(function(e){return t=z(e),n=F(e),r=F(e),[t,n,r];var t,n,r}(e));case 9:return i.Chat(q(e))}throw new Error("bad variant index for Response")},ne=l(new ArrayBuffer(512)),re=function(e,t){return ne.pos=0,ne=t(ne,e),new Uint8Array(ne.view.buffer).slice(0,ne.pos)},oe=function(e,t){return t(l(e))},ae=function(e){return oe(e.buffer,te)},ie=function(e){return re(e,P)};const le=e=>new Zlib.Inflate(e).decompress(),ce=e=>new Zlib.Deflate(e).compress(),se=[];function ue(e){let t={};return function(){const n=se.slice.call(arguments),r=n.map((e=>{if(fe(e)||Array.isArray(e)){let t={};for(let n in e)t[n]=pe(e[n]);return t}return pe(e)})),o=JSON.stringify(r);let a=t[o];return void 0===a&&(a=e.apply(this,n),a&&11===a.nodeType&&(a=se.slice.call(a.childNodes)),t[o]=a),a}}let de=0;function pe(e){return"function"==typeof e||e instanceof Node?(e.$m||(e.$m=++de),{$m:e.$m}):e}function fe(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function he(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ge,ye,me=he((function(e,t){function n(e){var t=e>>3;return e%8!=0&&t++,t}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===e&&(e=0);var r=null==t?void 0:t.grow;this.grow=r&&isFinite(r)&&n(r)||r||0,this.buffer="number"==typeof e?new Uint8Array(n(e)):e}return e.prototype.get=function(e){var t=e>>3;return t<this.buffer.length&&!!(this.buffer[t]&128>>e%8)},e.prototype.set=function(e,t){void 0===t&&(t=!0);var n=e>>3;if(t){if(this.buffer.length<n+1){var r=Math.max(n+1,Math.min(2*this.buffer.length,this.grow));if(r<=this.grow){var o=new Uint8Array(r);o.set(this.buffer),this.buffer=o}}this.buffer[n]|=128>>e%8}else n<this.buffer.length&&(this.buffer[n]&=~(128>>e%8))},e.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=8*this.buffer.length);for(var r=t,o=r>>3,a=128>>r%8,i=this.buffer[o];r<n;r++)e(!!(i&a),r),a=1===a?(i=this.buffer[++o],128):a>>1},e}();t.default=r}(ye={path:ge,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&ye.path)}},ye.exports),ye.exports));let ve,we=[];function be(e){let t=ve,n=()=>{};ve=n,Ae(n);let r=e((()=>{Ce(n),ve=void 0}));return ve=t,r}function Ie(e){function t(n){if(0===arguments.length)return ve&&!t.__o.has(ve)&&(t.__o.add(ve),ve.u.push(t)),e;e=n;let r=ve;return ve=void 0,t.o=new Set(t.__o),t.o.forEach((e=>e.i=!1)),t.o.forEach((e=>{e.i||e()})),ve=r,e}return t.$o=1,t.__o=new Set,t.t=we,t}function Ce(e){e.__c.forEach(Ce),e.u.forEach((t=>{t.__o.delete(e),t.o&&t.o.delete(e)})),e.l.forEach((e=>e())),Ae(e)}function Ae(e){e.u=[],e.__c=[],e.l=[]}const ke=()=>window.scrollTo(0,document.body.scrollHeight),Ee=ue((e=>ue(((t,n)=>be((()=>e(t,n))))))),Te=e=>(t,...n)=>()=>Ee(e())(t,n),xe=e=>{console.log("Length",e.length,"bytes"),console.log((Object(e).buffer instanceof ArrayBuffer?e:"string"==typeof e?new TextEncoder("utf-8").encode(e):new Uint8ClampedArray(e)).reduce(((e,t,n,r)=>e+(n%16==0?n.toString(16).padStart(6,0)+"  ":" ")+t.toString(16).padStart(2,0)+(n===r.length-1||n%16==15?" ".repeat(3*(15-n%16))+Array.from(r).splice(n-n%16,16).reduce(((e,t)=>e+(t>31&&t<127||t>159?String.fromCharCode(t):".")),"  ")+"\n":"")),""))},Ue=(e,t)=>{let n=0,r=0;for(;n<e.length;)r>=t.length&&(r=0),e.set([e[n]^t[r]],n),n++,r++},Se=(e,t)=>(Ue(e,t),Ne(e,t)),_e=e=>{let{a:t,k:n}=$e(e);return Ue(t,n),{a:t,k:n}},$e=e=>{let t=e[0],n=e.subarray(1,t+1);return{a:e.subarray(t+1),k:n}},Ne=(e,t)=>{let n=new Uint8Array(1+t.length+e.length);return n[0]=t.length,n.set(t,1),n.set(e,1+t.length),n},Le=(e,t)=>(e=Math.ceil(e),Math.floor(Math.random()*(Math.floor(t)-e)+e)),He=e=>(performance.now()-e).toFixed(2),Me=(e,t=64)=>Se(e,crypto.getRandomValues(new Uint8Array(Le(1,t)))),Oe=document.location.hash.substr(1).match(/^ip\/(?<ip>[\:\.\d]+)$/),De=Oe?Oe.groups.ip:"192.168.1.3:443",Ge="wss://"+De;let Pe,Re,je,Be,Ke,qe,ze,Fe,Ve,We,Ye,Je,Ze=500,Qe=0,Xe={ready:!1},et=0,tt=1;function nt(){ze=!1,function(){qe=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]});let e=tt++;qe.onicecandidate=e=>{e.candidate},qe.onconnectionstatechange=t=>{switch(qe.connectionState){case"failed":case"disconnected":console.log("[peer]",e,"restarting....")}},qe.oniceconnectionstatechange=e=>{switch(qe.iceConnectionState){case"disconnected":console.log("[ice] restarting....")}}}(),Ye=qe.createDataChannel("cu",{ordered:!1,maxRetransmits:0}),Ye.binaryType="arraybuffer",et=0,Xe.send=rt,Ye.onopen=e=>{console.log(`[dc] open in ${He(Pe)} ms`),console.groupEnd("[dc]"),et=0,Xe.ready=!0,Xe.open&&Xe.open(e)},Ye.onmessage=ot,Ye.onclose=e=>{console.log("[dc] close",e)},Ye.onerror=e=>{console.log("[dc] error:",e)},async function(){const e=async()=>{let e=await qe.createOffer();return await qe.setLocalDescription(e),ce((new TextEncoder).encode(qe.localDescription.sdp))},t=async()=>{if(Fe)return Fe;Be=await(async()=>(console.log("[sec] generating key pairs"),await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"])))();let e=await crypto.subtle.exportKey("raw",Be.publicKey);return Fe=new Uint8Array(e),Fe};Ke=await(async(e,t)=>{let[n,r]=await Promise.all([e(),t()]);return Me(Se(n,r))})(e,t),console.log(`[dc] sdp in ${He(Pe)} ms`),1===Re.readyState&&at()}()}async function rt(e){if(et++,console.groupEnd("[dc]"),console.group("[dc]","-> sending packet",et,e),e=ie(e),xe(e),Je.z&&(e=ce(e)),Je.m&&(e=Me(e,e.length),Ue(e,Ve)),Je.c){const t=crypto.getRandomValues(new Uint8Array(12));Ue(e,t),e=((e,t)=>{let n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n})(t,new Uint8Array(await(async(e,t,n)=>(console.log("[sec] encrypting data"),await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e)))(e,We,t)))}xe(e),Ye.send(e),je=performance.now()}async function ot(e){let t=new Uint8Array(e.data),n=t.length;if(Je.c){let e=t.subarray(0,12);t=new Uint8Array(await(async(e,t,n)=>(console.log("[sec] decrypting data"),await crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,e)))(t.subarray(12),We,e)),Ue(t,e)}if(Je.m){Ue(t,Ve);let{a:e}=_e(t);t=new Uint8Array(e)}Je.z&&(t=le(t));let r=(100*n/t.length).toFixed(2);console.log(`[dc] <- received ${n} / ${t.length} byte ${r}% in ${He(je)} ms`);let o=it(0,t);Xe.recv&&Xe.recv(o),console.groupEnd("[dc]")}console.group("[ws]","starting..."),function e(t){Pe=performance.now(),Re=new WebSocket(Ge),Re.binaryType="arraybuffer",Re.onopen=()=>{console.log(`[ws] open in ${He(Pe)} ms`),console.groupEnd("[ws]"),console.group("[dc]","opening..."),t?nt():Ke&&at()},Re.onmessage=async e=>{console.log(`[ws] <- received answer in ${He(Pe)} ms`);let t=new Uint8Array(e.data),{a:n,k:r}=_e(t);var o,a,i;Je=(e=>{const t=new me(e);return{z:t.get(0),m:t.get(1),c:t.get(2),d:t.get(3)?1:0}})(n),console.log(Je),r=await(o=r,crypto.subtle.importKey("raw",o,{name:"ECDH",namedCurve:"P-256"},!0,[])),We=await(a=Be.privateKey,i=r,crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:i},a,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])),Ve=new Uint8Array(await crypto.subtle.exportKey("raw",We));let l=JSON.parse((e=>(new TextDecoder).decode(le(e)))(n.slice(1))),c=l.answer?l.answer:l;if(await qe.setRemoteDescription(new RTCSessionDescription(c)),!l.candidate)return;const s=new RTCIceCandidate({candidate:l.candidate,sdpMid:0,sdpMLineIndex:0});await qe.addIceCandidate(s)},Re.onclose=t=>{Qe++,Ze+=Le(0,Qe<16?200:3e3),console.log("[ws] closed",t),console.groupEnd("[ws]"),console.groupEnd("[ws]"),console.groupCollapsed("[ws]",`retry ${Qe} in ${(Ze/1e3).toFixed(2)} sec`),setTimeout((()=>{e(!0)}),Ze)},Re.onerror=e=>{console.log("[ws] error",e)}}(),nt();const at=()=>{ze||(console.log("[ws] -> sending offer"),Re.send(Ke),ze=!0)},it=(e,t)=>{switch(e){case 0:let e=ae(t);return console.table(e.value),e}};let lt={},ct=[];function st(e){return this.t&&this.t[e.type](e)}lt.h=(...e)=>{let t,n=r=>{if(null==r);else if("string"==typeof r)t?lt.add(t,r):t=lt.s?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r);else if(Array.isArray(r))t||(t=document.createDocumentFragment()),r.forEach(n);else if(r instanceof Node)t?lt.add(t,r):t=r;else if("object"==typeof r)lt.property(t,r,null,lt.s);else if("function"==typeof r)if(t){let e=lt.add(t,"");lt.insert(t,r,e)}else t=r.apply(null,e.splice(1));else lt.add(t,""+r)};return e.forEach(n),t},lt.insert=(e,t,n,r,o)=>(e=n&&n.parentNode||e,o=o||r instanceof Node&&r,t===r||(r&&"string"!=typeof r||!("string"==typeof t||"number"==typeof t&&(t+=""))?"function"==typeof t?lt.subscribe((()=>{r=lt.insert(e,t.call({el:e,endMark:n}),n,r,o)})):(n?r&&(o||(o=r.o&&r.o.nextSibling||n.previousSibling),lt.rm(e,o,n)):e.textContent="",r=null,t&&!0!==t&&(r=lt.add(e,t,n))):(null!=r&&e.firstChild?n?(n.previousSibling||e.lastChild).data=t:e.firstChild.data=t:n?lt.add(e,t,n):e.textContent=t,r=t)),r),lt.property=(e,t,n,r,o)=>{if(null!=t)if(!n||"attrs"===n&&(r=!0))for(n in t)lt.property(e,t[n],n,r,o);else"o"!==n[0]||"n"!==n[1]||t.$o?"function"==typeof t?lt.subscribe((()=>{lt.property(e,t.call({el:e,name:n}),n,r,o)})):o?e.style.setProperty(n,t):r||"data-"===n.slice(0,5)||"aria-"===n.slice(0,5)?e.setAttribute(n,t):"style"===n?"string"==typeof t?e.style.cssText=t:lt.property(e,t,null,r,!0):("class"===n&&(n+="Name"),e[n]=t):((e,t,n)=>{t=t.slice(2).toLowerCase(),n?e.addEventListener(t,st):e.removeEventListener(t,st),(e.t||(e.t={}))[t]=n})(e,n,t)},lt.add=(e,t,n)=>{let r=(e=>{const{childNodes:t}=e;if(t&&11===e.nodeType)return t.length<2?t[0]:{o:lt.add(e,"",t[0])}})(t=(e=>"string"==typeof e?document.createTextNode(e):e instanceof Node?e:lt.h(ct,e))(t))||t;return e.insertBefore(t,n&&n.parentNode&&n),r},lt.rm=(e,t,n)=>{for(;t&&t!==n;){let n=t.nextSibling;e===t.parentNode&&e.removeChild(t),t=n}},lt.subscribe=function(e){return function(e,t){function n(){let r=ve;return ve&&ve.__c.push(n),Ce(n),n.i=!0,ve=n,t=e(t),ve=r,t}function r(){return n.i?ve&&n.u.forEach((e=>e())):t=n(),t}e.s=n,Ae(n),n(),r.$o=1}(e),()=>Ce(e.s)},lt.cleanup=function(e){return ve&&ve.l.push(e),e},lt.root=be,lt.sample=function(e){let t=ve;ve=void 0;let n=e();return ve=t,n},lt.hs=(...e)=>{let t=lt.s;lt.s=!0;let n=ut(...e);return lt.s=t,n};let ut=(...e)=>lt.h.apply(lt.h,e);function dt(e,t,n){const{root:r,subscribe:o,sample:a,cleanup:i}=lt;null==n&&(n=!t.$t);let l=lt.h([]),c=lt.add(l,""),s=new Map,u=new Map,d=new Set;function p(e,o){if(null==e)return;let a=u.get(e);return 1===o?(d.delete(e),a||(a=n?r((n=>(s.set(e,n),t(e.$v||e)))):t(e.$v||e),11===a.nodeType&&(a=(e=>{const{childNodes:t}=e,{length:n}=t;if(n<2)return t[0];let r=Array.from(t);return{nodeType:111,t:r[0],o:r[n-1],l(){if(t.length!==n){let t=0;for(;t<n;)e.appendChild(r[t++])}return e}}})(a)||a),u.set(e,a))):-1===o&&d.add(e),((e,t)=>111===e.nodeType?1/t<0?t?lt.rm(e.t.parentNode,e.t.nextSibling,e.o.nextSibling)||e.t:e.o:t?e.l():e.t:e)(a,o)}function f(e){let t=s.get(e);t&&(t(),s.delete(e)),u.delete(e)}return i(o((t=>{let n=e();return a((()=>{d.clear();let e=Array.from(function(e,t,n,r,o){let a,i,l=new Map,c=new Map;for(a=0;a<t.length;a++)l.set(t[a],a);for(a=0;a<n.length;a++)c.set(n[a],a);for(a=i=0;a!==t.length||i!==n.length;){var s=t[a],u=n[i];if(null===s)a++;else if(n.length<=i)e.removeChild(r(t[a],-1)),a++;else if(t.length<=a)e.insertBefore(r(u,1),r(t[a],0)||o),i++;else if(s===u)a++,i++;else{var d=c.get(s),p=l.get(u);void 0===d?(e.removeChild(r(t[a],-1)),a++):void 0===p?(e.insertBefore(r(u,1),r(t[a],0)||o),i++):(e.insertBefore(r(t[p],1),r(t[a],0)||o),t[p]=null,p>a+1&&a++,i++)}}return n}(c.parentNode,t||[],n,p,c));return d.forEach(f),e}))}))),i((function(){s.forEach((e=>e())),s.clear(),u.clear(),d.clear()})),l}const pt=()=>gt()===ft?gt(ht):gt(ft),ft=({items:e,keys:t},...n)=>ut([ut("table",null,ut("thead",null,ut("tr",null,dt(t,(e=>ut("th",{scope:"col"},e))))),ut("tbody",null,dt(e,(e=>ut("tr",{onclick:t=>location.hash="#channels/"+e.id},dt(t,(t=>ut("td",null,ut("span",null,t)," ",e[t])))))))),n]),ht=({items:e},...t)=>ut([ut("ul",null,dt(e,(e=>ut("li",{id:e.id},e.name)))),t]),gt=Ie(ft);const yt=({group_id:e})=>{let t=Ie([]),n=0;Xe.recv=e=>{let r=e.value;if(Array.isArray(r))return 0==r.length?n--:t(r);let o=t();o.unshift(r),t(o)};const r=t=>a.Channels({name:"",handle:"",group_id:e,by:0,limit:30,page:t}),o=e=>{n++,Xe.send(r(n))};return Xe.open=e=>o(),Xe.ready&&o(),ut([ut("button",{onclick:e=>{n--,n<1&&(n=1),Xe.send(r(n))}},"Prev Item"),ut("button",{onclick:o},"Next Item"),ut("button",{onclick:e=>{n=0;let t=setInterval((function(){300==n?clearInterval(t):o()}),1)}},"Run Load"),ut("button",{onclick:mt},"Switch Component"),ut("h2",null,"Channels"),ut(Te(bt),{items:t,keys:()=>Object.keys(t()[0]||{})})])},mt=()=>bt()===vt?bt(wt):bt(vt),vt=({items:e,keys:t},...n)=>ut([ut("table",null,ut("thead",null,ut("tr",null,dt(t,(e=>ut("th",{scope:"col"},e))))),ut("tbody",null,dt(e,(e=>ut("tr",{onclick:t=>location.hash="#topics/"+e.id},dt(t,(t=>ut("td",null,ut("span",null,t)," ",e[t])))))))),n]),wt=({items:e},...t)=>ut([ut("ul",null,dt(e,(e=>ut("li",{id:e.id},e.name)))),t]),bt=Ie(vt);const It=({channel_id:e})=>{let t=Ie([]),n=0;Xe.recv=e=>{let r=e.value;if(Array.isArray(r))return 0==r.length?n--:t(r);let o=t();o.unshift(r),t(o)};const r=t=>a.Topics({name:"",group_id:0,channel_id:e,by:0,limit:30,page:t}),o=e=>{n++,Xe.send(r(n))};return Xe.open=e=>o(),Xe.ready&&o(),ut([ut("button",{onclick:e=>{n--,n<1&&(n=1),Xe.send(r(n))}},"Prev Item"),ut("button",{onclick:o},"Next Item"),ut("button",{onclick:e=>{n=0;let t=setInterval((function(){300==n?clearInterval(t):o()}),1)}},"Run Load"),ut("button",{onclick:Ct},"Switch Component"),ut("h2",null,"Topics"),ut(Te(Et),{items:t,keys:()=>Object.keys(t()[0]||{})})])},Ct=()=>Et()===At?Et(kt):Et(At),At=({items:e,keys:t},...n)=>ut([ut("table",null,ut("thead",null,ut("tr",null,dt(t,(e=>ut("th",{scope:"col"},e))))),ut("tbody",null,dt(e,(e=>ut("tr",null,dt(t,(t=>ut("td",null,ut("span",null,t)," ",e[t])))))))),n]),kt=({items:e},...t)=>ut([ut("ul",null,dt(e,(e=>ut("li",{id:e.id},e.name)))),t]),Et=Ie(At),Tt="defaultParagraphSeparator",xt="formatBlock",Ut=(e,t,n)=>e.addEventListener(t,n),St=(e,t)=>e.appendChild(t),_t=e=>document.createElement(e),$t=e=>document.queryCommandState(e),Nt=(e,t=null)=>document.execCommand(e,!1,t),Lt={bold:{icon:"<b>B</b>",title:"Bold",state:()=>$t("bold"),result:()=>Nt("bold")},italic:{icon:"<i>I</i>",title:"Italic",state:()=>$t("italic"),result:()=>Nt("italic")},underline:{icon:"<u>U</u>",title:"Underline",state:()=>$t("underline"),result:()=>Nt("underline")},strikethrough:{icon:"<strike>S</strike>",title:"Strike-through",state:()=>$t("strikeThrough"),result:()=>Nt("strikeThrough")},heading1:{icon:"<b>H1</b>",title:"Heading 1",result:()=>Nt(xt,"<h1>")},heading2:{icon:"<b>H2</b>",title:"Heading 2",result:()=>Nt(xt,"<h2>")},quote:{icon:"&#8220;&#8221;",title:"Quote",result:()=>Nt(xt,"<blockquote>")},olist:{icon:"1.",title:"Ordered List",result:()=>Nt("insertOrderedList")},ulist:{icon:"&#8226;",title:"Unordered List",result:()=>Nt("insertUnorderedList")},code:{icon:"&lt;&gt;",title:"Code",result:()=>Nt(xt,"<pre>")},line:{icon:"&#8213;",title:"Horizontal Line",result:()=>Nt("insertHorizontalRule")},link:{icon:"&#128279;",title:"Link",result:()=>{const e=window.prompt("Enter the link URL");e&&Nt("createLink",e)}},image:{icon:"&#128247;",title:"Image",result:()=>{const e=window.prompt("Enter the image URL");e&&Nt("insertImage",e)}}},Ht={actionbar:"pell-actionbar",button:"pell-button",content:"pell-content",selected:"pell-button-selected",topic:"pell-topic"};let Mt=Ie({}),Ot={};const Dt=e=>e.reduce(((e,t)=>(e[t.k]=t.v,e)),{}),Gt=({topic_id:t,chat_id:n})=>{let r,o,i=Ie([]),l=0;Xe.recv=e=>{switch(e.tag){case"Chat":let n=window.scrollY+window.innerHeight===document.body.scrollHeight,a=i();a.push({...e.value,nor:Ie(0),star:Ie(!1),i:a.length}),i(a),n&&ke();break;case"Chats":let c=e.value[0];if(r=Dt(e.value[1]),o=Dt(e.value[2]),Array.isArray(c)){if(0==c.length)return l--;i(c.reverse().map(((e,t)=>(e.nor=Ie(e.nor),e.star=Ie(!1),e.i=t,e.createdAt=new Date(e.createdAt),e.updatedAt=new Date(e.updatedAt),e))))}u(c[c.length-1]),t&&(document.title=o[t]),setTimeout((()=>ke()))}};const c=r=>{var o;l++,Xe.send((o=l,a.Chats({filter:t>0?e.TopicId(t):n>0?e.Id(n):e.None(!0),limit:50,page:o})))};Xe.open=e=>c(),Xe.ready&&c();const s=(e=>{const t=e.actions?e.actions.map((e=>"string"==typeof e?Lt[e]:Lt[e.name]?{...Lt[e.name],...e}:e)):Object.keys(Lt).map((e=>Lt[e])),n={...Ht,...e.classes},r=e.defaultParagraphSeparator||"div",o=e.element.topic=_t("div");o.contentEditable=!0,o.className=n.topic,o.onkeydown=e=>{"Enter"===e.key&&(a.focus(),e.preventDefault())},St(e.element,o);const a=e.element.content=_t("div");a.contentEditable=!0,a.className=n.content,a.onfocus=()=>{let t=window.scrollY+window.innerHeight===document.body.scrollHeight;e.element.classList.add("sticky"),t&&setTimeout((()=>ke()))},a.onblur=()=>{setTimeout((()=>{e.element.contains(document.activeElement)||e.element.classList.remove("sticky")}))},a.oninput=({target:{firstChild:t}})=>{e.onchange(a.innerHTML)},a.onkeydown=t=>{"Enter"!==t.key||t.shiftKey||(e.onsend(),t.preventDefault())},St(e.element,a);const i=_t("div");return i.className=n.actionbar,St(e.element,i),t.forEach((e=>{const t=_t("button");if(t.className=n.button,t.innerHTML=e.icon,t.title=e.title,t.setAttribute("type","button"),t.onclick=()=>e.result()&&a.focus(),e.state){const r=()=>t.classList[e.state()?"add":"remove"](n.selected);Ut(a,"keyup",r),Ut(a,"mouseup",r),Ut(t,"click",r)}St(i,t)})),e.styleWithCSS&&Nt("styleWithCSS"),Nt(Tt,r),e.element})({element:ut("div",{class:"pell"}),onchange:e=>{},onsend:()=>{if(!s.content.textContent.trim())return;let e=i(),t=e[e.length-1],n=Mt(),r=n.id,{topicId:l,channelId:c,groupId:d}=n;s.topic.textContent!==n.txt&&(r=0,l=Object.keys(o).length+1,o[l]=s.topic.textContent);let p=t.id+1,f=s.content.innerHTML.trim(),g=new Date,y=g.toISOString(),m={id:p,txt:f,by:1,re:r,nor:Ie(0),topicId:l,channelId:c,groupId:d,createdAt:g,updatedAt:g,star:Ie(!1),i:e.length};console.log(m),s.content.textContent="",e.push(m),Xe.send(a.NewChat({id:p,txt:f,by:1,re:r,nor:0,topicId:l,channelId:c,groupId:d,createdAt:y,updatedAt:y})),i(e),r>0&&h(r),ke(),u(m)}});s.content.innerHTML="";const u=({id:e,txt:t,topicId:n,channelId:r,groupId:o})=>{s.topic.innerHTML=t,s.topic.textContent=s.topic.textContent;let a=Mt();a.id!==e&&(a.id=e,a.txt=s.topic.textContent,a.topicId=n,a.channelId=r,a.groupId=o,Mt(a))},d=e=>{let{id:n,txt:a,by:l,topicId:c,re:s,star:d,nor:h,i:g}=e,y=Ot.by!==l,m=Ot.topicId!==c;Ot.id=n,Ot.by=l,Ot.topicId=c;let v=o[c];const w=()=>{p("#reps/"+n,n)};return ut("div",{class:function(){return"chat"+(()=>(d()?" star":"")+(m?" topic":"")+(Mt().id===n?" cur":"")).call(this)},onclick:e=>e.x<18&&e.offsetY<22&&f({id:n,star:d})},m?ut("div",{class:"topic-name"+(s?" re":" new")+(t?" head":"")},ut("a",{href:function(){return"#chats/"+("function"==typeof c?c.call(this):c)},onclick:e=>(p("#chats/"+c,v),e.preventDefault(),!1),innerHTML:v})):null,y||m?ut("div",{class:"by"},r[l]):null,ut("div",{onclick:()=>u(e)},(()=>{let e=h();if(1!==e||n!==i()[g+1].re)return e>0?ut([ut("span",{class:"rep",onclick:w},e," 💬")," "]):void 0}),(e=>document.createRange().createContextualFragment(e))(a)))},p=(e,t)=>{let n=screen.width/2-300,r=screen.height/2-300;window.open(e,t,`toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=600,height=600,top=${r}, left=${n}`)},f=({id:e,star:t})=>{const n=i().filter((t=>t.id===e))[0];n.star?n.star(!t()):n.star=Ie(!1)},h=e=>{const t=i().filter((t=>t.id===e))[0];t.nor(t.nor()+1)};return ut([ut("div",{class:"topics"},dt(i,(e=>d(e)))),s])};const Pt=()=>Bt()===Rt?Bt(jt):Bt(Rt),Rt=({items:e,keys:t},...n)=>ut([ut("table",null,ut("thead",null,ut("tr",null,dt(t,(e=>ut("th",{scope:"col"},e))))),ut("tbody",null,dt(e,(e=>ut("tr",null,dt(t,(t=>ut("td",null,ut("span",null,t)," ",Array.isArray(e[t])?e[t].length:e[t])))))))),n]),jt=({items:e},...t)=>ut([ut("ul",null,dt(e,(e=>ut("li",{id:e.id},e.name)))),t]),Bt=Ie(Rt),Kt=(e,t)=>({pattern:e,view:t}),qt=["chats","channels","topics","groups"],zt=[Kt(/^$/,Gt),Kt(/^chats$/,(({topic_id:t,chat_id:n})=>{let r=Ie([]),o=0;Xe.recv=e=>{let t=e.value[0];if(Array.isArray(t))return 0==t.length?o--:r(t);let n=r();n.unshift(t),r(n)};const i=r=>a.Chats({filter:t>0?e.TopicId(t):n>0?e.Id(n):e.None(!0),limit:200,page:r}),l=e=>{o++,Xe.send(i(o))};return Xe.open=e=>l(),Xe.ready&&l(),ut([ut("button",{onclick:e=>{o--,o<1&&(o=1),Xe.send(i(o))}},"Prev Item"),ut("button",{onclick:l},"Next Item"),ut("button",{onclick:e=>{o=0;let t=setInterval((function(){300==o?clearInterval(t):l()}),1)}},"Run Load"),ut("button",{onclick:Pt},"Switch Component"),ut("h2",null,"Chats"),ut(Te(Bt),{items:r,keys:()=>Object.keys(r()[0]||{})})])})),Kt(/^groups$/,(()=>{let e=Ie([]),t=0;Xe.recv=n=>{let r=n.value;if(Array.isArray(r))return 0==r.length?t--:e(r);let o=e();o.unshift(r),e(o)};const n=e=>a.Groups({name:"",handle:"",by:0,limit:30,page:e}),r=e=>{t++,Xe.send(n(t))};return Xe.open=e=>r(),Xe.ready&&r(),ut([ut("button",{onclick:e=>{t--,t<1&&(t=1),Xe.send(n(t))}},"Prev Item"),ut("button",{onclick:r},"Next Item"),ut("button",{onclick:e=>{t=0;let n=setInterval((function(){300==t?clearInterval(n):r()}),1)}},"Run Load"),ut("button",{onclick:pt},"Switch Component"),ut("h2",null,"Groups"),ut(Te(gt),{items:e,keys:()=>Object.keys(e()[0]||{})})])})),Kt(/^channels$/,yt),Kt(/^topics$/,It),Kt(/^channels\/(?<group_id>\d+)$/,yt),Kt(/^topics\/(?<channel_id>\d+)$/,It),Kt(/^chats\/(?<topic_id>\d+)$/,Gt),Kt(/^reps\/(?<chat_id>\d+)$/,Gt),Kt(/^products\/(?<id>\d+)$/,(({id:e})=>ut("h2",null,"Product ",e))),Kt(/^users\/(?<name>\w+)$/,(({name:e})=>ut("h2",null,e,"'s Profile"))),Kt(/^ip\/(?<ip>[\.\d]+)$/,Gt)],Ft=Ie("");const Vt=()=>Ft(document.location.hash.substr(1));window.addEventListener("hashchange",Vt),Vt();document.querySelector(".app").append(ut([ut("div",{class:"nav"},ut("a",{href:"#",class:"nav-item"},"home"),(()=>qt.map((e=>ut("a",{href:"#"+e,class:"nav-item "+(Ft()===e?"is-active":"")},e))))),ut("div",{class:"container"},(()=>function(e){for(const{pattern:t,view:n}of zt){const r=e.match(t);if(r)return n({...r.groups})}}(Ft())))]))}();
