!function(){"use strict";const e=[];function t(t){let n={};return function(){const i=e.slice.call(arguments),o=i.map((e=>{if(r(e)||Array.isArray(e)){let t={};for(let n in e)t[n]=a(e[n]);return t}return a(e)})),s=JSON.stringify(o);let c=n[s];return void 0===c&&(c=t.apply(this,i),c&&11===c.nodeType&&(c=e.slice.call(c.childNodes)),n[s]=c),c}}let n=0;function a(e){return"function"==typeof e||e instanceof Node?(e.$m||(e.$m=++n),{$m:e.$m}):e}function r(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function o(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var s,c,l=o((function(e,t){function n(e){var t=e>>3;return e%8!=0&&t++,t}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){void 0===e&&(e=0);var a=null==t?void 0:t.grow;this.grow=a&&isFinite(a)&&n(a)||a||0,this.buffer="number"==typeof e?new Uint8Array(n(e)):e}return e.prototype.get=function(e){var t=e>>3;return t<this.buffer.length&&!!(this.buffer[t]&128>>e%8)},e.prototype.set=function(e,t){void 0===t&&(t=!0);var n=e>>3;if(t){if(this.buffer.length<n+1){var a=Math.max(n+1,Math.min(2*this.buffer.length,this.grow));if(a<=this.grow){var r=new Uint8Array(a);r.set(this.buffer),this.buffer=r}}this.buffer[n]|=128>>e%8}else n<this.buffer.length&&(this.buffer[n]&=~(128>>e%8))},e.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=8*this.buffer.length);for(var a=t,r=a>>3,i=128>>a%8,o=this.buffer[r];a<n;a++)e(!!(o&i),a),i=1===i?(o=this.buffer[++r],128):i>>1},e}();t.default=a}(c={path:s,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&c.path)}},c.exports),c.exports));let u,d=[];function h(e){let t=u,n=()=>{};u=n,m(n);let a=e((()=>{p(n),u=void 0}));return u=t,a}function f(e){function t(n){if(0===arguments.length)return u&&!t.__o.has(u)&&(t.__o.add(u),u.u.push(t)),e;e=n;let a=u;return u=void 0,t.o=new Set(t.__o),t.o.forEach((e=>e.i=!1)),t.o.forEach((e=>{e.i||e()})),u=a,e}return t.$o=1,t.__o=new Set,t.t=d,t}function p(e){e.__c.forEach(p),e.u.forEach((t=>{t.__o.delete(e),t.o&&t.o.delete(e)})),e.l.forEach((e=>e())),m(e)}function m(e){e.u=[],e.__c=[],e.l=[]}const w=(e,t)=>e.reduce(((e,t)=>(e.set(t.id,t),e)),t),y=()=>window.scrollTo(0,document.body.scrollHeight),g=t((e=>t(((t,n)=>h((()=>e(t,n))))))),v=e=>(t,...n)=>()=>g(e())(t,n),b=(e,t)=>{let n=0,a=0;for(;n<e.length;)a>=t.length&&(a=0),e.set([e[n]^t[a]],n),n++,a++},C=(e,t)=>(b(e,t),S(e,t)),E=e=>{let{a:t,k:n}=L(e);return b(t,n),{a:t,k:n}},L=e=>{let t=e[0],n=e.subarray(1,t+1);return{a:e.subarray(t+1),k:n}},S=(e,t)=>{let n=new Uint8Array(1+t.length+e.length);return n[0]=t.length,n.set(t,1),n.set(e,1+t.length),n},U=(e,t)=>(e=Math.ceil(e),Math.floor(Math.random()*(Math.floor(t)-e)+e)),A=(e,t)=>{let n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n},T=(e,t=64,n=8)=>C(e,crypto.getRandomValues(new Uint8Array(U(n,t)))),x=()=>{let e,t=new Promise((t=>e=t));return{complete:t=>e(t),join:()=>t}},N=navigator.vendor.includes("Apple")?{transaction:()=>{}}:openDatabase("sonic","1.0","sonic",1073741824);function k(e,t){}function O(e,t){}N.transaction((e=>{e.executeSql("CREATE TABLE IF NOT EXISTS users (\n            id integer NOT NULL PRIMARY KEY,\n            name varchar(50) NOT NULL\n        )",[],k,O),e.executeSql("CREATE TABLE IF NOT EXISTS userchans (\n            id integer NOT NULL PRIMARY KEY\n        )",[],k,O),e.executeSql("CREATE TABLE IF NOT EXISTS chans (\n            id integer NOT NULL PRIMARY KEY,\n            name varchar(50) NOT NULL,\n            fullname varchar(150) NOT NULL,\n            mom integer NOT NULL,\n            by integer NOT NULL,\n            dir text NOT NULL,\n            ispub boolean NOT NULL DEFAULT '0',\n            isprv boolean NOT NULL DEFAULT '0',\n            timestamp datetime NOT NULL DEFAULT CURRENT_TIMESTAMP\n        )",[],k,O),e.executeSql("CREATE TABLE IF NOT EXISTS chats (\n            id integer NOT NULL PRIMARY KEY,\n            txt text NOT NULL,\n            by integer NOT NULL,\n            re integer NOT NULL,\n            nor integer NOT NULL DEFAULT '0',\n            chanid integer NOT NULL,\n            dir text NOT NULL,\n            status integer NOT NULL DEFAULT '0',\n            timestamp datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            star boolean\n        )",[],k,O),e.executeSql("CREATE TABLE IF NOT EXISTS chanchats (\n            chanid integer NOT NULL,\n            chatid integer NOT NULL,\n            PRIMARY KEY (chanid, chatid)\n        )",[],k,O)}));const j=()=>{N.transaction((e=>{e.executeSql("SELECT * FROM sqlite_master WHERE type = 'table' AND name NOT LIKE '\\_%' escape '\\'",[],((e,t)=>{var n,a,r;function i(){}for(a=(n=t.rows).length;a--;)r=n.item(a).name,e.executeSql("DROP TABLE "+r,[],i,console.error)}),console.error)}))};window._qd=j,window._q=(e,t=[])=>{N.transaction((n=>{n.executeSql(e,t,((e,t)=>{}),console.error)}))};var D={date:"1/10/2021, 2:33:33 AM",build:"1474cb0",ver:"0.0.46"};const I=x(),M="sonic",R=["session","chats","users","chans","ranges","chanchats","updates"];let _;localStorage.getItem("_")!==D.ver&&(localStorage.setItem("_",D.ver),K(M),j()),window._d=()=>K(M);let P=indexedDB.open(M,1);function K(e){var t=window.indexedDB.deleteDatabase(e);t.onerror=e=>{},t.onsuccess=e=>{}}P.onsuccess=e=>{_=P.result,function(e){let t=e.objectStoreNames;for(const e of R)if(!t.contains(e))return void K(M)}(_),I.complete(_),P.open?P.open():P.open=!0},P.onerror=e=>{I.complete()},P.onblocked=e=>{},P.onupgradeneeded=e=>{_=P.result;let t=_.objectStoreNames;if(!t.contains("session")){_.createObjectStore("session")}if(!t.contains("ranges")){_.createObjectStore("ranges")}if(!t.contains("chats")){let e=_.createObjectStore("chats",{keyPath:"id"});e.createIndex("chanid",["chanid","id"],{unique:!1}),e.createIndex("re",["re","id"],{unique:!1}),e.createIndex("by",["by","id"],{unique:!1})}if(!t.contains("users")){_.createObjectStore("users",{keyPath:"id"})}if(!t.contains("chans")){_.createObjectStore("chans",{keyPath:"id"}).createIndex("mom",["mom","id"],{unique:!1})}if(!t.contains("chanchats")){_.createObjectStore("chanchats",{keyPath:["chanid","chatid"]})}if(!t.contains("chanchats")){_.createObjectStore("updates")}for(const e of R)_.objectStoreNames.contains(e)||_.createObjectStore(e)};const B=async(e,t)=>{let n=await I.join();n&&n.transaction(["session"],"readwrite").objectStore("session").put(t,e)},q=async()=>{let e=await I.join();e&&(e.transaction(["session"],"readwrite").objectStore("session").clear(),e.transaction(["chans"],"readwrite").objectStore("chans").clear(),e.transaction(["chats"],"readwrite").objectStore("chats").clear(),e.transaction(["chanchats"],"readwrite").objectStore("chanchats").clear(),e.transaction(["ranges"],"readwrite").objectStore("ranges").clear(),e.transaction(["updates"],"readwrite").objectStore("updates").clear(),e.transaction(["users"],"readwrite").objectStore("users").clear())},H=async(e,t)=>{let n=await I.join();if(!n)return;let a=n.transaction([e],"readwrite").objectStore(e);t.forEach((e=>{"string"==typeof e.timestamp&&(e.timestamp=new Date(e.timestamp)),a.put(e).onerror=console.error})),N.transaction((n=>{t.forEach((t=>{let a=Object.keys(t),r=`INSERT OR REPLACE INTO ${e} (${a.join(",")}) VALUES (${Array(a.length).fill("?").join(",")})`;n.executeSql(r,Object.values(t).map((e=>"function"==typeof e?e():e)),k,O)}))}))},F=async(...e)=>{let t=await I.join();t&&(await W(...e),function(e){let n=t.transaction(["chanchats"],"readwrite").objectStore("chanchats");e.forEach((e=>{let t=IDBKeyRange.bound([e],[e,Number.MAX_VALUE]);n.delete(t).onerror=console.error}))}(e),function(e){let n=t.transaction(["chats"],"readwrite").objectStore("chats"),a=n.index("chanid");e.forEach((e=>{let t=IDBKeyRange.bound([e],[e,Number.MAX_VALUE]);a.openCursor(t).onsuccess=e=>{var t=e.target.result;t&&(n.delete(t.primaryKey).onerror=console.error,t.continue())}}))}(e.filter((e=>e>0))))},$=async({id:e,dir:t})=>{let n=await I.join();if(!n)return;let a=[0,...t];!function(e,t){t.forEach((async t=>{let n=await G(t);n&&n.includes(e)&&W(t)}))}(e,a),function(e,t){let a=n.transaction(["chanchats"],"readwrite").objectStore("chanchats");t.forEach((t=>{let n=IDBKeyRange.only([t,e]);a.delete(n).onerror=console.error}))}(e,a),function(...e){let t=n.transaction(["chats"],"readwrite").objectStore("chats");e.forEach((e=>{t.delete(e).onerror=console.error}))}(e)},Y=async(e,t)=>{let n=await I.join();n&&(n.transaction([e],"readwrite").objectStore(e).put(t).onerror=console.error,N.transaction((n=>{let a=Object.keys(t),r=`INSERT OR REPLACE INTO ${e} (${a.join(",")}) VALUES (${Array(a.length).fill("?").join(",")})`;n.executeSql(r,Object.values(t).map((e=>"function"==typeof e?e():e)),k,O)})))},V=async(e,t)=>{let n=await I.join();if(!n)return{value:[],missed:t};if(0===t.length)return{value:[],missed:[]};performance.now();let a=[],r=new Set,i=n.transaction([e],"readonly").objectStore(e),o=0;return new Promise((e=>{t.forEach((n=>{let s=i.get(n);s.onerror=console.error,s.onsuccess=i=>{if(s.result?a.push(s.result):r.add(n),++o===t.length){let t={value:a,missed:Array.from(r)};e(t)}}}))}))},J=(e,t,n,a)=>{let r=n?IDBKeyRange.upperBound(n,a):null;if(!t)return[e,r];let i=n||Number.MAX_VALUE;switch(t.tag){case"Chanid":r=IDBKeyRange.bound([t.value],[t.value,i],!1,a)}return[e,r]},X=async(e,t,n=30,a=!0)=>(await(async(e,t,n,a,r,i,o)=>{let s=await I.join();if(!s)return;performance.now();let c=[],l=s.transaction([e],"readonly"),[u,d]=i?i(l.objectStore(e),t,a,r):[l.objectStore(e),null],h=0;return new Promise((e=>{u.openCursor(d,o).onsuccess=t=>{var a=t.target.result;if(a){if(c.push(a.value),++h===n)return e(c);a.continue()}else e(c)}}))})("chanchats",e,n,t,a,J,"prev")).map((e=>e.chatid)),z=async(e,t,n)=>{let a=await I.join();if(!a)return;let r=a.transaction(["ranges"],"readwrite").objectStore("ranges"),i=r.get(e);i.onerror=console.error,i.onsuccess=async a=>{if(i.result){if(n)return r.put([i.result[0],i.result[1],n],e).onerror=console.error;t[0]<i.result[0]&&(t[0]=i.result[0]),t[1]>i.result[0]&&(t[1]=i.result[1])}r.put(t,e).onerror=console.error}},G=e=>Q(e,"ranges"),W=async(...e)=>{let t=await I.join();if(!t)return;let n=t.transaction(["ranges"],"readwrite").objectStore("ranges");e.forEach((e=>n.delete(e).onerror=console.error))},Z=e=>Q(e,"session"),Q=async(e,t)=>{let n=await I.join();if(!n)return;let a=n.transaction([t],"readonly").objectStore(t);return new Promise((t=>{let n=a.get(e);n.onerror=console.error,n.onsuccess=e=>t(n.result)}))},ee=async(e,t,n)=>{let a=await I.join();a&&a.transaction([e],"readwrite").objectStore(e).put(n,t)};var te,ne,ae;!function(e){e.Id=function(e){return{tag:"Id",value:e}},e.Chanid=function(e){return{tag:"Chanid",value:e}}}(te||(te={})),function(e){e.ChatScan=function(e){return{tag:"ChatScan",value:e}},e.ChanScan=function(e){return{tag:"ChanScan",value:e}},e.AddChat=function(e){return{tag:"AddChat",value:e}},e.AddUser=function(e){return{tag:"AddUser",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.Logout=function(e){return{tag:"Logout",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Chans=function(e){return{tag:"Chans",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.ChanJoin=function(e){return{tag:"ChanJoin",value:e}},e.ChanLeave=function(e){return{tag:"ChanLeave",value:e}},e.ChanAdd=function(e){return{tag:"ChanAdd",value:e}},e.DelChat=function(e){return{tag:"DelChat",value:e}},e.DelChan=function(e){return{tag:"DelChan",value:e}},e.EditChat=function(e){return{tag:"EditChat",value:e}},e.Update=function(e){return{tag:"Update",value:e}}}(ne||(ne={})),function(e){e.ChatScan=function(e){return{tag:"ChatScan",value:e}},e.ChanScan=function(e){return{tag:"ChanScan",value:e}},e.Chats=function(e){return{tag:"Chats",value:e}},e.Chans=function(e){return{tag:"Chans",value:e}},e.Users=function(e){return{tag:"Users",value:e}},e.Chat=function(e){return{tag:"Chat",value:e}},e.Chan=function(e){return{tag:"Chan",value:e}},e.User=function(e){return{tag:"User",value:e}},e.Login=function(e){return{tag:"Login",value:e}},e.ChanJoin=function(e){return{tag:"ChanJoin",value:e}},e.DelChat=function(e){return{tag:"DelChat",value:e}},e.DelChan=function(e){return{tag:"DelChan",value:e}},e.EditChat=function(e){return{tag:"EditChat",value:e}},e.Update=function(e){return{tag:"Update",value:e}},e.Updates=function(e){return{tag:"Updates",value:e}},e.UserOn=function(e){return{tag:"UserOn",value:e}},e.UserOff=function(e){return{tag:"UserOff",value:e}},e.OnlineUsers=function(e){return{tag:"OnlineUsers",value:e}}}(ae||(ae={}));const re=(e,t=0,n=!0)=>({pos:t,littleEndian:n,view:new DataView(e)}),ie=(e,t)=>{const{view:{buffer:n},pos:a}=e,r=n.byteLength;if(r-a>t)return e;const i=Math.max(2*r,r+t),o=new Uint8Array(i);return o.set(new Uint8Array(n)),re(o.buffer,a,e.littleEndian)},oe=(e,t)=>{e=ie(e,1);const{view:n,pos:a}=e;return n.setUint8(a,t),e.pos+=1,e},se=(e,t)=>{e=ie(e,4);const{view:n,pos:a,littleEndian:r}=e;return n.setUint32(a,t,r),e.pos+=4,e},ce=(e,t)=>{e=ie(e,2);const{view:n,pos:a,littleEndian:r}=e;return n.setUint16(a,t,r),e.pos+=2,e};function le(e,t){const{view:n,pos:a,littleEndian:r}=e;return n.setUint32(r?a:a+4,t,r),n.setUint32(r?a+4:a,0,r),e.pos+=8,e}const ue=(e,t)=>{e=ie(e,4);const{view:n,pos:a,littleEndian:r}=e;return n.setInt32(a,t,r),e.pos+=4,e},de=new TextEncoder,he="encodeInto"in de?(e,t)=>de.encodeInto(e,t).written:(e,t)=>{const n=de.encode(e);return t.set(n),n.length},fe=(e,t)=>{e=ie(e,3*t.length+8);const n=he(t,new Uint8Array(e.view.buffer,e.pos+8));return(e=le(e,n)).pos+=n,e},pe=(e,t)=>oe(e,t?1:0),me=e=>(t,n)=>n.reduce(e,((e,t)=>le(ie(e,8),t))(t,n.length)),we=e=>(t,n)=>null===n?oe(t,0):e(oe(t,1),n),ye=e=>{const{pos:t,view:n}=e;return e.pos+=1,n.getUint8(t)},ge=e=>{const{pos:t,view:n,littleEndian:a}=e;return e.pos+=2,n.getUint16(t,a)},ve=e=>{const{pos:t,view:n,littleEndian:a}=e;return e.pos+=4,n.getUint32(t,a)},be=e=>{const{view:t,pos:n,littleEndian:a}=e;return e.pos+=8,t.getUint32(a?n:n+4,a)},Ce=e=>{const{pos:t,view:n,littleEndian:a}=e;return e.pos+=4,n.getInt32(t,a)},Ee=e=>1===ye(e),Le=e=>t=>1===ye(t)?e(t):null,Se=e=>t=>{const n=be(t),a=new Array;for(let r=0;r<n;r++)a.push(e(t));return a},Ue=new TextDecoder,Ae=e=>{const t=be(e),{pos:n,view:{buffer:a}}=e,r=Ue.decode(new Uint8Array(a,n,t));return e.pos+=t,r};var Te=me(ue),xe=we((function(e,t){switch(t.tag){case"Id":return ue(se(e,0),t.value);case"Chanid":return ue(se(e,1),t.value)}})),Ne=we(fe),ke=we(ue),Oe=we(oe),je=me(oe),De=(we(Te),function(e,t){var n=t.id,a=t.txt,r=t.by,i=t.re,o=t.nor,s=t.chanid,c=t.dir,l=t.status,u=t.timestamp;return fe(ce(Te(ue(ue(ue(ue(fe(ue(e,n),a),r),i),o),s),c),l),u)}),Ie=(me(De),function(e,t){var n=t.id,a=t.name,r=t.fullname,i=t.mom,o=t.by,s=t.dir,c=t.ispub,l=t.isprv,u=t.timestamp;return fe(pe(pe(Te(ue(ue(fe(fe(ue(e,n),a),r),i),o),s),c),l),u)}),Me=(me(Ie),me((function(e,t){var n=t.id,a=t.name;return fe(ue(e,n),a)})),we(De),we(Ie),we((function(e,t){var n=t.id,a=t.name,r=t.email,i=t.emailverified,o=t.fullname,s=t.key,c=t.timestamp;return fe(fe(fe(pe(fe(fe(ue(e,n),a),r),i),o),s),c)})),we((function(e,t){var n=t.data,a=t.chans;return Te(je(e,n),a)})),me((function(e,t){var n=t.id,a=t.action,r=t.chatid,i=t.txt;return Ne(ue(ce(ue(e,n),a),r),i)})),function(e,t){var n=t.filter,a=t.kw,r=t.ub,i=t.lb,o=t.limit;return Oe(ke(ke(Ne(xe(e,n),a),r),i),o)}),Re=function(e,t){var n=t.id,a=t.txt;return fe(ue(e,n),a)},_e=function(e,t){switch(t.tag){case"ChatScan":return Me(se(e,0),t.value);case"ChanScan":return Me(se(e,1),t.value);case"AddChat":return function(e,t){var n=t.txt,a=t.re,r=t.chname;return Ne(ke(fe(e,n),a),r)}(se(e,2),t.value);case"AddUser":return function(e,t){var n=t.email,a=t.name,r=t.key;return je(fe(fe(e,n),a),r)}(se(e,3),t.value);case"Login":return function(e,t){var n=t.email,a=t.key;return je(fe(e,n),a)}(se(e,4),t.value);case"Logout":return je(se(e,5),t.value);case"Users":return Te(se(e,6),t.value);case"Chans":return Te(se(e,7),t.value);case"Chats":return Te(se(e,8),t.value);case"ChanJoin":return ue(se(e,9),t.value);case"ChanLeave":return ue(se(e,10),t.value);case"ChanAdd":return function(e,t){var n=t.id,a=t.email;return fe(ue(e,n),a)}(se(e,11),t.value);case"DelChat":return ue(se(e,12),t.value);case"DelChan":return ue(se(e,13),t.value);case"EditChat":return Re(se(e,14),t.value);case"Update":return function(e,t){var n=t.id,a=t.chanid,r=t.chatid;return ue(ue(ue(e,n),a),r)}(se(e,15),t.value)}},Pe=Se(Ce),Ke=(Le((function(e){switch(ve(e)){case 0:return te.Id(Ce(e));case 1:return te.Chanid(Ce(e))}throw new Error("bad variant index for Filter")})),Le(Ae)),Be=Le(Ce),qe=(Le(ye),Se(ye)),He=Le(Pe),Fe=function(e){return{id:Ce(e),txt:Ae(e),by:Ce(e),re:Ce(e),nor:Ce(e),chanid:Ce(e),dir:Pe(e),status:ge(e),timestamp:Ae(e)}},$e=Se(Fe),Ye=function(e){return{id:Ce(e),name:Ae(e),fullname:Ae(e),mom:Ce(e),by:Ce(e),dir:Pe(e),ispub:Ee(e),isprv:Ee(e),timestamp:Ae(e)}},Ve=Se(Ye),Je=Se((function(e){return{id:Ce(e),name:Ae(e)}})),Xe=Le(Fe),ze=Le(Ye),Ge=Le((function(e){return{id:Ce(e),name:Ae(e),email:Ae(e),emailverified:Ee(e),fullname:Ae(e),key:Ae(e),timestamp:Ae(e)}})),We=Le((function(e){return{data:qe(e),chans:Pe(e)}})),Ze=Se((function(e){return{id:Ce(e),action:ge(e),chatid:Ce(e),txt:Ke(e)}})),Qe=function(e){return{id:Ce(e),txt:Ae(e)}},et=function(e){switch(ve(e)){case 0:return ae.ChatScan(He(e));case 1:return ae.ChanScan(He(e));case 2:return ae.Chats($e(e));case 3:return ae.Chans(Ve(e));case 4:return ae.Users(Je(e));case 5:return ae.Chat(Xe(e));case 6:return ae.Chan(ze(e));case 7:return ae.User(Ge(e));case 8:return ae.Login(We(e));case 9:return ae.ChanJoin(Be(e));case 10:return ae.DelChat(Ce(e));case 11:return ae.DelChan(Ce(e));case 12:return ae.EditChat(Qe(e));case 13:return ae.Update(Ce(e));case 14:return ae.Updates(Ze(e));case 15:return ae.UserOn(Ce(e));case 16:return ae.UserOff(Ce(e));case 17:return ae.OnlineUsers(Pe(e))}throw new Error("bad variant index for Response")},tt=re(new ArrayBuffer(512)),nt=function(e,t){return tt.pos=0,tt=t(tt,e),new Uint8Array(tt.view.buffer).slice(0,tt.pos)},at=function(e,t){return t(re(e))},rt=function(e){return at(e.buffer,et)},it=function(e){return nt(e,_e)};const ot=e=>new Zlib.Inflate(e).decompress(),st=e=>new Zlib.Deflate(e).compress(),ct=async(e,t,n)=>await crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e),lt=async(e,t,n)=>await crypto.subtle.decrypt({name:"AES-GCM",iv:n},t,e);let ut={},dt=[];function ht(e){return this.t&&this.t[e.type](e)}ut.h=(...e)=>{let t,n=a=>{if(null==a);else if("string"==typeof a)t?ut.add(t,a):t=ut.s?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a);else if(Array.isArray(a))t||(t=document.createDocumentFragment()),a.forEach(n);else if(a instanceof Node)t?ut.add(t,a):t=a;else if("object"==typeof a)ut.property(t,a,null,ut.s);else if("function"==typeof a)if(t){let e=ut.add(t,"");ut.insert(t,a,e)}else t=a.apply(null,e.splice(1));else ut.add(t,""+a)};return e.forEach(n),t},ut.insert=(e,t,n,a,r)=>(e=n&&n.parentNode||e,r=r||a instanceof Node&&a,t===a||(a&&"string"!=typeof a||!("string"==typeof t||"number"==typeof t&&(t+=""))?"function"==typeof t?ut.subscribe((()=>{a=ut.insert(e,t.call({el:e,endMark:n}),n,a,r)})):(n?a&&(r||(r=a.o&&a.o.nextSibling||n.previousSibling),ut.rm(e,r,n)):e.textContent="",a=null,t&&!0!==t&&(a=ut.add(e,t,n))):(null!=a&&e.firstChild?n?(n.previousSibling||e.lastChild).data=t:e.firstChild.data=t:n?ut.add(e,t,n):e.textContent=t,a=t)),a),ut.property=(e,t,n,a,r)=>{if(null!=t)if(!n||"attrs"===n&&(a=!0))for(n in t)ut.property(e,t[n],n,a,r);else"o"!==n[0]||"n"!==n[1]||t.$o?"function"==typeof t?ut.subscribe((()=>{ut.property(e,t.call({el:e,name:n}),n,a,r)})):r?e.style.setProperty(n,t):a||"data-"===n.slice(0,5)||"aria-"===n.slice(0,5)?e.setAttribute(n,t):"style"===n?"string"==typeof t?e.style.cssText=t:ut.property(e,t,null,a,!0):("class"===n&&(n+="Name"),e[n]=t):((e,t,n)=>{t=t.slice(2).toLowerCase(),n?e.addEventListener(t,ht):e.removeEventListener(t,ht),(e.t||(e.t={}))[t]=n})(e,n,t)},ut.add=(e,t,n)=>{let a=(e=>{const{childNodes:t}=e;if(t&&11===e.nodeType)return t.length<2?t[0]:{o:ut.add(e,"",t[0])}})(t=(e=>"string"==typeof e?document.createTextNode(e):e instanceof Node?e:ut.h(dt,e))(t))||t;return e.insertBefore(t,n&&n.parentNode&&n),a},ut.rm=(e,t,n)=>{for(;t&&t!==n;){let n=t.nextSibling;e===t.parentNode&&e.removeChild(t),t=n}},ut.subscribe=function(e){return function(e,t){function n(){let a=u;return u&&u.__c.push(n),p(n),n.i=!0,u=n,t=e(t),u=a,t}function a(){return n.i?u&&n.u.forEach((e=>e())):t=n(),t}e.s=n,m(n),n(),a.$o=1}(e),()=>p(e.s)},ut.cleanup=function(e){return u&&u.l.push(e),e},ut.root=h,ut.sample=function(e){let t=u;u=void 0;let n=e();return u=t,n},ut.hs=(...e)=>{let t=ut.s;ut.s=!0;let n=ft(...e);return ut.s=t,n};let ft=(...e)=>ut.h.apply(ut.h,e);const pt=new Map,mt=(e,t,n=!1)=>{let a=pt.get(e)||[];n?a=[t]:a.push(t),pt.set(e,a)},wt=(e,t)=>pt.has(e)?pt.get(e).forEach((e=>e(t))):void 0,yt={},gt=e=>(e&&(Object.assign(yt,e),wt("config",yt)),yt),vt=f(void 0),bt={id:f(0),name:f(""),chans:f([])};async function Ct(){let e=await Z("a");if(!e||e.byteLength<53)return;let t=new Uint8Array(e,0,16),n=new Uint8Array(e,16,32);t&&16===t.length&&(bt.salt=t),n&&32===n.length&&(bt.sskey=await crypto.subtle.importKey("raw",n,"AES-GCM",!1,["encrypt","decrypt"]));let a=new Uint8Array(e,48,4),r=new Uint8Array(e,52),i=new DataView(a.buffer).getInt32(48,!1),o=(new TextDecoder).decode(r);i&&o&&(bt.id(i),bt.name(o));let s=await Z("c");return s&&s instanceof Array&&bt.chans(s),bt.salt}async function Et(e,t){let n=new TextEncoder,a=await Lt(n.encode(e),n.encode(t));return await crypto.subtle.exportKey("raw",a)}async function Lt(e,t){let n=await crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}const St=document.location.hash.substr(1).match(/^ip\/(?<ip>[\:\.\d]+)$/);let Ut="wss://"+(St?St.groups.ip:"192.168.100.11:443");window._ws=e=>(e&&("string"==typeof e&&(Ut="wss://"+e),Ht(!0)),Ut),window._ws=()=>Tt,window._pc=()=>Ot,window._dc=()=>Rt;let At,Tt,xt,Nt,kt,Ot,jt,Dt,It,Mt,Rt,_t=500,Pt=0,Kt=new Set,Bt={recv:e=>Kt.add(e)};Ht(),Ft();const qt=x();function Ht(e){At=performance.now(),Tt=new WebSocket(Ut),Tt.binaryType="arraybuffer",Tt.onopen=()=>{e?Ft():kt&&Vt()},Tt.onmessage=async e=>{let t=new Uint8Array(e.data),{a:n,k:a}=E(t);gt((e=>{const t=new l(e);return{z:t.get(0),m:t.get(1),c:t.get(2),d:t.get(3)}})(n));var r,i,o;a=await(r=a,crypto.subtle.importKey("raw",r,{name:"ECDH",namedCurve:"P-256"},!0,[])),Mt=await(i=Nt.privateKey,o=a,crypto.subtle.deriveKey({name:"ECDH",namedCurve:"P-256",public:o},i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])),It=new Uint8Array(await crypto.subtle.exportKey("raw",Mt));let s=JSON.parse((e=>(new TextDecoder).decode(ot(e)))(n.slice(1))),c=s.answer?s.answer:s;if(await Ot.setRemoteDescription(new RTCSessionDescription(c)),!s.candidate)return;const u=new RTCIceCandidate({candidate:s.candidate,sdpMid:0,sdpMLineIndex:0});await Ot.addIceCandidate(u)},Tt.onclose=e=>{Pt++,_t+=U(0,Pt<16?200:3e3),setTimeout((()=>{Ht(!0)}),_t)},Tt.onerror=e=>{}}function Ft(){jt=!1,Ot=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]}),Ot.onicecandidate=e=>{e.candidate},Ot.onconnectionstatechange=e=>{Ot.connectionState},Ot.oniceconnectionstatechange=e=>{Ot.iceConnectionState},Rt=Ot.createDataChannel("cu",{}),Rt.binaryType="arraybuffer",Bt.send=$t,Rt.onopen=e=>{qt.complete(Rt)},Rt.onmessage=Yt,Rt.onclose=e=>{},Rt.onerror=e=>{},async function(){const e=async()=>{let e=await Ot.createOffer();return await Ot.setLocalDescription(e),st((new TextEncoder).encode(Ot.localDescription.sdp))},t=async()=>{if(Dt)return Dt;Nt=await(async()=>await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"]))();let e=await crypto.subtle.exportKey("raw",Nt.publicKey);return Dt=new Uint8Array(e),Dt};kt=await(async(e,t,n)=>{let[a,r,i]=await Promise.all([e(),t(),n()]);return i?C(C(a,r),i):T(C(a,r),64,24)})(e,t,Ct),1===Tt.readyState&&Vt()}()}async function $t(e){await qt.join(),(e=>{e.length||e.byteLength})(e=it(e));let{z:t,m:n,c:a,d:r}=gt();if(t&&(e=st(e)),n&&(e=T(e,e.length),b(e,It)),a){const t=crypto.getRandomValues(new Uint8Array(12));b(e,t),e=A(t,new Uint8Array(await ct(e,Mt,t)))}if(r){const t=crypto.getRandomValues(new Uint8Array(12));b(e,t),e=A(t,new Uint8Array(await ct(e,bt.sskey,t)))}Rt.send(e),xt=performance.now()}async function Yt(e){let t=new Uint8Array(e.data),n=t.length,{z:a,m:r,c:i,d:o}=gt();if(o){let e=t.subarray(0,12);t=new Uint8Array(await lt(t.subarray(12),bt.sskey,e)),b(t,e)}if(i){let e=t.subarray(0,12);t=new Uint8Array(await lt(t.subarray(12),Mt,e)),b(t,e)}if(r){b(t,It);let{a:e}=E(t);t=new Uint8Array(e)}a&&(t=ot(t));(100*n/t.length).toFixed(2);let s=Jt(t);Kt.forEach((e=>e(s)))}const Vt=()=>{jt||(Tt.send(kt),jt=!0)},Jt=e=>rt(e);function Xt(e,t,n){const{root:a,subscribe:r,sample:i,cleanup:o}=ut;null==n&&(n=!t.$t);let s=ut.h([]),c=ut.add(s,""),l=new Map,u=new Map,d=new Set;function h(e,r){if(null==e)return;let i=u.get(e);return 1===r?(d.delete(e),i||(i=n?a((n=>(l.set(e,n),t(e.$v||e)))):t(e.$v||e),11===i.nodeType&&(i=(e=>{const{childNodes:t}=e,{length:n}=t;if(n<2)return t[0];let a=Array.from(t);return{nodeType:111,t:a[0],o:a[n-1],l(){if(t.length!==n){let t=0;for(;t<n;)e.appendChild(a[t++])}return e}}})(i)||i),u.set(e,i))):-1===r&&d.add(e),((e,t)=>111===e.nodeType?1/t<0?t?ut.rm(e.t.parentNode,e.t.nextSibling,e.o.nextSibling)||e.t:e.o:t?e.l():e.t:e)(i,r)}function f(e){let t=l.get(e);t&&(t(),l.delete(e)),u.delete(e)}return o(r((t=>{let n=e();return i((()=>{d.clear();let e=Array.from(function(e,t,n,a,r){let i,o,s=new Map,c=new Map;for(i=0;i<t.length;i++)s.set(t[i],i);for(i=0;i<n.length;i++)c.set(n[i],i);for(i=o=0;i!==t.length||o!==n.length;){var l=t[i],u=n[o];if(null===l)i++;else if(n.length<=o)e.removeChild(a(t[i],-1)),i++;else if(t.length<=i)e.insertBefore(a(u,1),a(t[i],0)||r),o++;else if(l===u)i++,o++;else{var d=c.get(l),h=s.get(u);void 0===d?(e.removeChild(a(t[i],-1)),i++):void 0===h?(e.insertBefore(a(u,1),a(t[i],0)||r),o++):(e.insertBefore(a(t[h],1),a(t[i],0)||r),t[h]=null,h>i+1&&i++,o++)}}return n}(c.parentNode,t||[],n,h,c));return d.forEach(f),e}))}))),o((function(){l.forEach((e=>e())),l.clear(),u.clear(),d.clear()})),s}window._b=Bt;const zt="0VMZYpdgCGL3iKAzDHwocTt97e1hasO2mJNjExq4PvR6XyWSFbIn-5B_8fUukQlr",Gt=zt.split(""),Wt=new Array(123);for(let e=0;e<zt.length;e++)Wt[zt.charCodeAt(e)]=e;const Zt=e=>{if(e<0)return"-"+Zt(-e);let t=e>>>0,n=e/4294967296>>>0,a="";for(;n>0;)a=Gt[63&t]+a,t>>>=6,t|=(63&n)<<26,n>>>=6;let r="";do{r=Gt[63&t]+r,t>>>=6}while(t>0);return r+a};var Qt={ntob:Zt,bton:e=>{let t=0;for(let n=0;n<e.length;n++)t=64*t+Wt[e.charCodeAt(n)];return t}};const en=[0,null,"🏠",0],tn=(()=>{let e=f(en);const t=f([e]),n=t=>e(t);return{path:t=>e()[t],paths:t,len:()=>t().length,setpath:n,same:t=>t===e(),cd:e=>{let a=t();a[e[0]]!==e&&(a[e[0]]=e),a.splice(e[0]+1),t(a),n(e),location.hash=e[0]>0?Qt.ntob(e[3]):""},update:e=>{t([en,...e]),n(e[e.length-1]||en)}}})(),nn=[];function an(){!function(e){for(const t of nn)t(e)}(document.location.hash.substr(1))}window.addEventListener("hashchange",an),setTimeout(an);const rn=30,on=new Map,sn=new Map,cn=new Map,ln=e=>(t,n)=>{if(!t)return e;let a=e.get(t);return n?a?a[n]:void 0:a},un=f([]),dn=f([]),hn=f(0),fn=f(0),pn=f(0),mn=f(0),wn=f(""),yn=f(""),gn=f(!1),vn=f(!1),bn=ln(on),Cn=ln(sn),En=ln(cn),Ln=(()=>{const e={},t={};return{create:n=>t[n]=new Promise((t=>e[n]=t)),complete:(t,n)=>e[t]?e[t](n):null,join:e=>t[e],joinall:(...e)=>Promise.all(e.map((e=>t[e]))),select:(...e)=>Promise.race(e.map((e=>t[e])))}})();Bt.recv((async e=>{switch(e.tag){case"Update":ee("updates",hn(),e.value);break;case"Updates":Ln.complete("updates",e.value);break;case"Login":if(!e.value)return vt(void 0),void wt("login",!1);await async function({data:e,chans:t}){let n=new Uint8Array(e.slice(16,20)),a=new Uint8Array(e.slice(20)),r=new DataView(n.buffer).getInt32(0,!1),i=(new TextDecoder).decode(a);bt.id(r),bt.name(i),bt.chans(t),bt.salt=new Uint8Array(e.slice(0,16)),bt.sskey=await Lt(vt(),bt.salt),vt(void 0);let o=new Uint8Array(await crypto.subtle.exportKey("raw",bt.sskey)),s=bt.salt.length,c=new Uint8Array(s+o.length+n.length+a.length);c.set(bt.salt),c.set(o,s),c.set(n,s+o.length),c.set(a,s+o.length+n.length),B("a",c.buffer),gt({d:!0}),B("c",t),Y("users",{id:r,name:i})}(e.value),wt("login",!0);break;case"Users":H("users",e.value),Ln.complete("users",e.value);break;case"Chans":H("chans",e.value),Ln.complete("chans",e.value);break;case"Chat":let t=dn();if(t.includes(e.value.id))return;let n=window.scrollY+window.innerHeight===document.body.scrollHeight;await Y("chats",e.value);let a=new Set(En().has(e.value.by)?[]:[e.value.by]),r=e.value.dir.filter((e=>!bn(e))),i=new Set(r);await Tn(a,i),e.value.nor=f(0),e.value.star=f(!1),e.value.txt=f(e.value.txt),Cn().set(e.value.id,e.value),t.push(e.value.id),dn(t),n&&y();let o=bt.chans();if(o.includes(e.value.chanid))return;o.push(e.value.chanid),bt.chans(o),await B("c",o);break;case"Chats":e.value.length>0&&H("chats",e.value),Ln.complete("chats",e.value);break;case"ChatScan":let s=e.value||[],c=hn();if(0===s.length)return gn(!0),z(c,null,!0),void Ln.complete("chatscan",s);gn(!1),z(c,[s[0],s[s.length-1]]);let l=s.map((e=>({chanid:c,chatid:e})));H("chanchats",l),Ln.complete("chatscan",s);break;case"ChanScan":let u=e.value||[];u.length>0?(vn(!1),await Nn(u)):vn(!0),Ln.complete("chanscan",u);break;case"ChanJoin":Ln.complete("chanjoin",e.value);break;case"DelChat":Rn(e.value);break;case"EditChat":let{id:d,txt:h}=e.value,p=Cn(d);p&&p.txt(h),p=await Q(d,"chats"),p&&(p.txt=h,await Y("chats",p))}}));const Sn="/"+zt;(e=>{nn.push(e)})((async e=>{if(!e||!Sn.includes(e[0]))return hn(0),xn([]),document.title="sonic",Mn(),void(document.getElementsByClassName("tbl").length>0&&Dn(0));if("/"===e[0]){let t=Qt.bton(e.slice(1));fn(t),await An([t]),Mn();let n=Cn(t).dir;return await Nn(n),xn(n),void(document.title=bn(hn(),"fullname")+" - sonic")}let t=Qt.bton(e);if(hn(t),Mn(),await Nn([t]),!bn(t))return;let n=bn(t).dir;await Nn(n),xn([...n,t]),document.getElementsByClassName("tbl").length>0&&Dn(tn.path(3)),document.title=bn(hn(),"fullname")+" - sonic"}));const Un=async(e,t=null)=>{await An(e);let n=e[0],a=new Set,r=new Set,i=dn(),o=new Set;switch(e.forEach((e=>{let t=Cn(e);"function"!=typeof t.txt&&(t.txt=f(t.txt),t.nor=f(t.nor),t.star=f(!1)),"string"==typeof t.timestamp&&(t.timestamp=new Date(t.timestamp)),En().has(t.by)||a.add(t.by),t.dir.forEach((e=>{bn().has(e)||r.add(e)})),o.has(e),o.add(e)})),await Tn(a,r),e.reverse(),t){case"re":dn(e);break;case"pre":dn(i.concat(e));break;default:dn(e.concat(i))}o=new Set,dn().forEach((e=>{o.has(e),o.add(e)})),n&&wt("keysloaded",n)},An=async e=>{if(0===(e=e.filter((e=>!Cn().has(e)))).length)return;let{value:t,missed:n}=await V("chats",e);if(w(t,Cn()),n.length>0){let e=await Ln.create("chats",Bt.send(ne.Chats(n)));w(e,Cn())}},Tn=async(e,t)=>{let n=await V("users",Array.from(e)),a=await V("chans",Array.from(t));w(n.value,En()),w(a.value,bn()),n.missed.length>0&&Ln.create("users",Bt.send(ne.Users(n.missed))),a.missed.length>0&&Ln.create("chans",Bt.send(ne.Chans(a.missed)));let[r,i]=await Ln.joinall("users","chans");r&&w(r,En()),i&&w(i,bn())},xn=e=>{let t=e.map(((e,t)=>{let n=bn(e)||{};return[t+1,n.mom,n.name,e]}));tn.update(t)},Nn=async e=>{if(0===(e=e.filter((e=>!bn().has(e)))).length)return;let{value:t,missed:n}=await V("chans",e);if(w(t,bn()),n.length>0){let e=await Ln.create("chans",Bt.send(ne.Chans(n)));w(e,bn())}};let kn=null;const On=async(e,t=null,n=null)=>{performance.now();let a=await((e,t=null,n=null,a=null,r=null)=>{t&&yn(t);let i=ne.ChanScan({filter:jn(e),kw:t,ub:n,lb:a,limit:r});return Ln.create("chanscan",Bt.send(i))})(e,t,n);n?0===a.length||un(un().concat(a)):(0!==a.length||t||wt("nochan"),un(a))},jn=e=>(kn=e,"number"==typeof e?te.Chanid(e):null),Dn=async e=>{kn!==e&&On(e)},In=(e=null,t=null,n=null)=>{let a=ne.ChatScan({filter:fn()>0?te.Id(fn()):hn()>0?te.Chanid(hn()):null,kw:null,ub:e,lb:t,limit:n});return Ln.create("chatscan",Bt.send(a))};async function Mn(){gn(!1),mn(!1),pn(0);let e=hn();performance.now();let t=await G(e)||[],n=t[0]||null,a=await X(te.Chanid(e),null,rn);await Un(a,"re"),mn(!0),wt("reloaded"),t[1]&&async function(e,t){let n=await Q(e,"updates");Bt.send(ne.Update({id:n,chanid:e,chatid:t}));let a=await Ln.create("updates");if(!a||0===a.length)return;let r=new Set([e]);for(const{action:e,chatid:t,txt:n}of a){let a=await Q(t,"chats");switch(a&&a.dir.forEach((e=>r.add(e))),e){case 2:a&&(a.txt=n,await Y("chats",a)),a=Cn(t),a&&n&&a.txt(n);break;case 3:a&&await $(a),a=Cn(t),a&&sn.delete(t);let e=dn(),r=e.indexOf(t);r>-1&&(e.splice(r,1),dn(e))}}r.forEach((e=>ee("updates",e,a[0].id)))}(e,t[1]);let r=await In(null,n)||[];await Un(r,r.length!==rn&&0!==a.length&&n?"pre":"re"),wt("reloaded")}async function Rn(e){let t=Cn(e);t&&sn.delete(e),t=await Q(e,"chats"),t&&await $(t);let n=dn(),a=n.indexOf(e);a>-1&&(n.splice(a,1),dn(n))}window._chn=()=>Array.from(on.values()),window._ch=()=>Array.from(sn.values()),window._us=()=>Array.from(cn.values()),window._chns=()=>un().map((e=>on.get(e))),window._chs=()=>dn().map((e=>sn.get(e))),window._chnid=hn,window._chid=fn,window._curid=pn,window._curtxt=wn,window._chnkw=yn;const _n=()=>{const e=document.createElement("div");e.contentEditable=!0,e.className="s-c",e.oninput=({target:{firstChild:t}})=>{var n,a,r,i;(n=function(){let t=e.textContent;var n;t.length>50||(n=t,On(tn.path(3),n))},a=100,function(){var e=this,t=arguments,o=function(){i=null,r||n.apply(e,t)},s=r&&!i;clearTimeout(i),i=setTimeout(o,a),s&&n.apply(e,t)})()},e.onkeydown=e=>{"Enter"!==e.key||e.shiftKey||e.preventDefault()};const t=(e,t)=>{if(e.stopPropagation(),!bt.id())return alert("you are not login!");bt.chans().includes(t)?(async e=>{performance.now();let t=await Ln.create("chanjoin",Bt.send(ne.ChanLeave(e)));if(!t)return;let n=bt.chans();if(!n.includes(t))return;const a=n.indexOf(t);a>-1&&n.splice(a,1),bt.chans(n),await B("c",n),await F(0,e),Mn()})(t):(async e=>{performance.now();let t=await Ln.create("chanjoin",Bt.send(ne.ChanJoin(e)));if(!t)return;let n=bt.chans();n.includes(t)||(n.push(t),bt.chans(n),await B("c",n),await F(0),Mn())})(t)},n=(e,t)=>{e.stopPropagation();const n=window.prompt("Enter email to add").trim();n&&(async(e,t)=>{Bt.send(ne.ChanAdd({id:e,email:t}))})(t,n)};let a=ft("div",null);setTimeout((function(){new IntersectionObserver((t=>{if(t[0].intersectionRatio<=0)return;let n=un(),a=n[n.length-1];if(!a||vn()||n.length<rn)return;let r=e.textContent||null;r&&r.length>50||setTimeout((()=>On(tn.path(3),r,a)))}),{}).observe(a)}));return ft([ft("div",{class:"s"},e),ft("div",{class:"tbl"},ft("table",null,ft("tbody",null,Xt(un,(e=>{let a=bn(e);return ft("tr",{onclick:()=>(async({id:e,mom:t,name:n})=>{await On(e),tn.cd([tn.path(0)+1,t,n,e])})(a)},ft("td",null,ft("button",{onclick:n=>t(n,e)},(()=>bt.chans().includes(e)?"✅":"➕"))),ft("td",null,a.fullname),ft("td",null,ft("button",{onclick:t=>n(t,e)},"👤➕")))})),(()=>un().length>0?null:ft("tr",null,ft("td",null,"no result"))),a))),ft("div",{class:"grid"},ft("div",{class:"container"},ft("ol",{class:"bc"},ft("li",null,ft("a",null,"#")," ",ft("a",null,(()=>tn.path(2)))))))])};let Pn;async function Kn(){await Bt.send(ne.Logout(Array.from(bt.salt))),await q(),gt({d:!1}),bt.id(0),bt.name(""),bt.chans([]),bt.sskey=void 0,bt.salt=void 0,location.hash="",Mn(),On(tn.path(3)),wt("logout")}mt("config",(({d:e})=>Fn(e?Hn:qn))),mt("login",(e=>{e&&(Mn(),On(tn.path(3)))}));const Bn=()=>ft("div",{class:"login"},ft(v(Fn),null),ft("div",{class:"v"},D.ver," ",D.build)),qn=()=>ft([ft("h2",null,"Login"),ft("form",{onsubmit:function(e){e.preventDefault();let{m:t,p:n}=e.target;!async function(e,t){Pn=performance.now(),await q();let n=await Et(t,e),a={email:e,key:Array.from(new Uint8Array(n))};vt(n),Bt.send(ne.Login(a))}(t.value,n.value)}},ft("input",{type:"text",name:"m",placeholder:"email",required:!0,autocomplete:"true"}),ft("input",{type:"password",name:"p",placeholder:"password",required:!0,autocomplete:"true"}),ft("button",{type:"submit"},"Login")),ft("h2",null,"Register"),ft("form",{onsubmit:function(e){e.preventDefault();let{m:t,n:n,p:a}=e.target;!async function(e,t,n){Pn=performance.now(),await q();let a=await Et(n,e),r={email:e,name:t,key:Array.from(new Uint8Array(a))};vt(a),Bt.send(ne.AddUser(r))}(t.value,n.value,a.value)}},ft("input",{type:"text",name:"m",placeholder:"email",required:!0,autocomplete:"true"}),ft("input",{type:"text",name:"n",placeholder:"name",required:!0,autocomplete:"true"}),ft("input",{type:"password",name:"p",placeholder:"password",required:!0,autocomplete:"true"}),ft("button",{type:"submit"},"Register"))]),Hn=()=>ft([ft("div",null,"You have logged in as ",ft("b",null,bt.name)),ft("button",{onclick:Kn},"Logout")]),Fn=f((()=>null));window._v=()=>D;const $n="defaultParagraphSeparator",Yn="formatBlock",Vn=(e,t,n)=>e.addEventListener(t,n),Jn=(e,t)=>e.appendChild(t),Xn=e=>document.createElement(e),zn=e=>document.queryCommandState(e),Gn=(e,t=null)=>document.execCommand(e,!1,t),Wn={bold:{icon:"<b>B</b>",title:"Bold",state:()=>zn("bold"),result:()=>Gn("bold")},italic:{icon:"<i>I</i>",title:"Italic",state:()=>zn("italic"),result:()=>Gn("italic")},underline:{icon:"<u>U</u>",title:"Underline",state:()=>zn("underline"),result:()=>Gn("underline")},strikethrough:{icon:"<strike>S</strike>",title:"Strike-through",state:()=>zn("strikeThrough"),result:()=>Gn("strikeThrough")},heading1:{icon:"<b>H1</b>",title:"Heading 1",result:()=>Gn(Yn,"<h1>")},heading2:{icon:"<b>H2</b>",title:"Heading 2",result:()=>Gn(Yn,"<h2>")},quote:{icon:"&#8220;&#8221;",title:"Quote",result:()=>Gn(Yn,"<blockquote>")},olist:{icon:"1.",title:"Ordered List",result:()=>Gn("insertOrderedList")},ulist:{icon:"&#8226;",title:"Unordered List",result:()=>Gn("insertUnorderedList")},code:{icon:"&lt;&gt;",title:"Code",result:()=>Gn(Yn,"<pre>")},line:{icon:"&#8213;",title:"Horizontal Line",result:()=>Gn("insertHorizontalRule")},link:{icon:"&#128279;",title:"Link",result:()=>{const e=window.prompt("Enter the link URL");e&&Gn("createLink",e)}},image:{icon:"&#128247;",title:"Image",result:()=>{const e=window.prompt("Enter the image URL");e&&Gn("insertImage",e)}}},Zn={actionbar:"e-a",button:"e-b",content:"e-c",selected:"e-bs",topic:"e-t"};function Qn(){return window.scrollY+window.innerHeight===document.body.scrollHeight}const ea=({topic:e,content:t})=>{if(!bt.id())return alert("you are not login!");if(!t.textContent.trim())return;let n=pn()||dn()[dn().length-1]||null,a=null;if(e.textContent!==wn()){if(a=e.textContent,0===a.trim().length)return alert("topic should not be empty"),!1;n=null}let r=t.innerHTML.trim();Bt.send(ne.AddChat({txt:r,re:n,chname:a})),t.textContent="",ta({},{topic:e})},ta=({id:e,txt:t},{topic:n})=>{if(!e||pn()===e)return n.textContent="",wn(""),void pn(0);n.innerHTML=t(),n.textContent=n.textContent,wn(n.textContent),pn(e)};mt("keysloaded",(e=>{document.getElementById(Qt.ntob(e)).scrollIntoView()})),mt("reloaded",(()=>{setTimeout((()=>{window.innerHeight-document.getElementsByClassName("cs")[0].clientHeight>110?document.body.classList.add("fx"):document.body.classList.remove("fx")}))}));const na=()=>{const e=(e=>{const t=e.actions?e.actions.map((e=>"string"==typeof e?Wn[e]:Wn[e.name]?{...Wn[e.name],...e}:e)):Object.keys(Wn).map((e=>Wn[e])),n={...Zn,...e.classes},a=e.defaultParagraphSeparator||"div",r=e.element.topic=Xn("div");r.contentEditable=!0,r.className=n.topic,r.onkeydown=e=>{"Enter"===e.key&&(i.focus(),e.preventDefault())},Jn(e.element,r);const i=e.element.content=Xn("div");i.contentEditable=!0,i.className=n.content,i.oninput=({target:{firstChild:t}})=>{e.oninput(i.innerHTML)},i.onkeydown=t=>{"Enter"===t.key&&(Qn()&&setTimeout((()=>y())),t.shiftKey||(e.onsend({topic:r,content:i}),t.preventDefault()))},Jn(e.element,i);const o=Xn("div");o.className=n.actionbar,Jn(e.element,o),t.forEach((e=>{const t=Xn("button");if(t.className=n.button,t.innerHTML=e.icon,t.title=e.title,t.setAttribute("type","button"),t.onclick=()=>e.result()&&i.focus(),e.state){const a=()=>t.classList[e.state()?"add":"remove"](n.selected);Vn(i,"keyup",a),Vn(i,"mouseup",a),Vn(t,"click",a)}Jn(o,t)}));const s=Xn("button");return s.className="ntb",s.innerHTML="New topic",s.title="New topic",s.setAttribute("type","button"),s.onclick=()=>{if(document.body.classList.contains("ed"))return void document.body.classList.remove("ed");let e=Qn();document.body.classList.add("ed"),e&&setTimeout((()=>y()))},Jn(o,s),e.styleWithCSS&&Gn("styleWithCSS"),Gn($n,a),e.element})({element:ft("div",{class:"e"}),oninput:e=>{},onsend:ea}),t=f(0),n=e=>{let{id:n,txt:r,by:o,chanid:c,re:u,star:d,nor:h}=e,f=dn(),p=bn(c);let m=f[f.indexOf(n)-1],w=Cn(m)||{},y=w.by!==o,g=!u||w.chanid!==c,v=Qt.ntob(n),b=Qt.ntob(p.id);const C=()=>{l("#/"+v,v)},E=(e,t)=>{l("#"+t,t),e.preventDefault()};return ft("div",{id:v,class:function(){return"c"+(()=>(d()?" star":"")+(g?" t":"")+(pn()===n?" cur":"")).call(this)},onclick:t=>s(t,e),onmouseover:e=>t()!==n&&t(n)},g?ft("div",{class:"tn"+(u?" re":" nw")},ft("a",{href:function(){return"#"+("function"==typeof b?b.call(this):b)},onclick:e=>E(e,b),innerHTML:bn(p.id,"fullname")}),ft("div",{class:"dr"},Xt((()=>[...p.dir.slice(tn.len()-1)]),(e=>{let t=Qt.ntob(e);return ft("span",null,ft("a",{href:function(){return"#"+("function"==typeof t?t.call(this):t)},onclick:e=>E(e,t),innerHTML:bn(e,"name")}))})))):null,y||g?ft("div",{class:"by"},En(o).name):null,ft("div",{onclick:e=>e.stopPropagation()},(()=>{let e=h();if(1!==e||n!==Cn(dn()[i+1]).re)return e>0?ft([ft("span",{class:"rep",onclick:C},e," ↩️")," "]):void 0}),ft("div",{class:"ct"},(()=>(e=>document.createRange().createContextualFragment(e))(r())))),(()=>t()===n?a(v,e):null))},a=(t,n)=>ft([ft("div",{class:"pm pr",onclick:t=>ta(n,e),title:"reply"},"↩️"),ft("div",{class:"pm"},"💬",ft("div",{class:"pu"},ft("div",{onclick:e=>r(t,n)},"✏️ edit"),ft("div",{onclick:e=>o(n)},"❌ delete")))]),r=(e,t)=>{let n=document.getElementById(e).querySelector(".ct");if("true"==n.contentEditable)return n.contentEditable=!1,n.classList.remove("ce"),void(n.innerHTML=t.txt());n.contentEditable=!0,n.focus(),n.classList.add("ce"),n.oninput=e=>{},n.onkeydown=e=>{if("Escape"===e.key)return n.contentEditable=!1,n.classList.remove("ce"),void(n.innerHTML=t.txt());if("Enter"===e.key){let a=n.innerHTML.trim();e.shiftKey||(e.preventDefault(),n.contentEditable=!1,n.classList.remove("ce"),a!=t.txt()&&function(e,t){Bt.send(ne.EditChat({id:e,txt:t}))}(t.id,a))}}},o=({id:e,txt:t})=>{confirm('Do you want to delete this chat? \n"'+t()+'"')&&function(e){Bt.send(ne.DelChat(e)),Rn(e)}(e)},s=(e,t)=>{e.x<18&&e.offsetY<22&&c(t)},c=({id:e,star:t})=>{const n=dn().filter((t=>t===e))[0],a=Cn(n);a.star?a.star(!t()):a.star=f(!1)},l=(e,t)=>{let n=screen.width/2-300,a=screen.height/2-300;window.open(e,t,`toolbar=yes,location=yes,status=no,menubar=yes,scrollbars=yes,resizable=yes,width=600,height=600,top=${a}, left=${n}`)},u=ft("div",null);return setTimeout((function(){new IntersectionObserver((e=>{if(e[0].intersectionRatio<=0)return void(document.body.classList.contains("fx")&&(document.body.classList.remove("fx"),y()));if(!mn())return;!dn()[0]||gn()||dn().length<rn||setTimeout((()=>{if(!mn())return;let e=dn()[0];!e||gn()||dn().length<rn||(async e=>{let t=hn();performance.now();let n=await G(t)||[];if(n[2]&&e===n[1])return void gn(!0);gn(!1);let a=await X(te.Chanid(t),e,rn);if(n[2]||a.length===rn)return void await Un(a);let r=await In(e);r.length>0&&await Un(r)})(e)}))}),{}).observe(u)})),ft([ft("div",{class:"cs"},u,Xt(dn,(e=>n(Cn(e))))),e])},aa=()=>{},ra=f(aa);document.querySelector("body").append((()=>{mt("login",(e=>e&&ra(aa))),mt("logout",(()=>ra(aa))),mt("nochan",(()=>ra(aa)));return ft([ft("div",{class:"n"},ft("div",null,ft("ol",{class:"bc"},(()=>Xt(tn.paths,(e=>ft("li",null,ft("a",{onclick:t=>(e=>{ra()!==_n?e[0]===tn.len()-1?ra(_n):tn.cd(e):tn.same(e)&&ra(aa),tn.setpath(e),ra()===_n&&Dn(e[3])})(e)},e[2])))))),ft("div",{class:"m"},ft("a",{onclick:e=>{ra()===Bn?ra(aa):ra(Bn)}},(()=>bt.name()||"login")))),ft(v(ra),null)),na])})())}();
